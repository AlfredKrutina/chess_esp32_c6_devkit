\doxysection{demo\+\_\+mode\+\_\+helpers.\+c}
\hypertarget{demo__mode__helpers_8c_source}{}\label{demo__mode__helpers_8c_source}\index{demo\_mode\_helpers.c@{demo\_mode\_helpers.c}}
\mbox{\hyperlink{demo__mode__helpers_8c}{Zobrazit dokumentaci tohoto souboru.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00014}00014\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00015}00015\ \textcolor{comment}{//\ DEMO\ MODE\ HELPER\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00016}00016\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00028}\mbox{\hyperlink{demo__mode__helpers_8c_ab5480af4a47935696e63f5cb45a754cc}{00028}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{demo__mode__helpers_8c_ab5480af4a47935696e63f5cb45a754cc}{demo\_is\_castling\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00029}00029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col,}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00030}00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[8][8])\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00031}00031\ \ \ \textcolor{comment}{//\ Must\ be\ on\ same\ rank}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00032}00032\ \ \ \textcolor{keywordflow}{if}\ (from\_row\ !=\ to\_row)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00033}00033\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00034}00034\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00036}00036\ \ \ \textcolor{comment}{//\ Check\ if\ piece\ is\ a\ king}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00037}00037\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00038}00038\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00039}00039\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00040}00040\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00042}00042\ \ \ \textcolor{comment}{//\ Check\ if\ king\ moves\ 2\ squares\ (castling\ signature)}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00043}00043\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ abs((\textcolor{keywordtype}{int})to\_col\ -\/\ (\textcolor{keywordtype}{int})from\_col);}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00044}00044\ \ \ \textcolor{keywordflow}{return}\ (col\_diff\ ==\ 2);}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00045}00045\ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00058}00058\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00059}\mbox{\hyperlink{demo__mode__helpers_8c_a1e81ab60269dcc2083cbe4acf50b3cbf}{00059}}\ \mbox{\hyperlink{demo__mode__helpers_8c_a1e81ab60269dcc2083cbe4acf50b3cbf}{demo\_get\_castling\_rook\_squares}}(uint8\_t\ king\_from\_row,\ uint8\_t\ king\_from\_col,}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_to\_col,\ uint8\_t\ *\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ uint8\_t\ *\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00063}00063\ \ \ *\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ king\_from\_row;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00064}00064\ \ \ *\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ =\ king\_from\_row;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00066}00066\ \ \ \textcolor{comment}{//\ Kingside\ castling\ (king\ moves\ to\ g-\/file,\ col\ 6)}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00067}00067\ \ \ \textcolor{keywordflow}{if}\ (king\_to\_col\ ==\ 6)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00068}00068\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 7;\ \textcolor{comment}{//\ h-\/file}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00069}00069\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 5;\ \ \ \textcolor{comment}{//\ f-\/file}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00070}00070\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00071}00071\ \ \ \textcolor{comment}{//\ Queenside\ castling\ (king\ moves\ to\ c-\/file,\ col\ 2)}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00072}00072\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (king\_to\_col\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00073}00073\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 0;\ \textcolor{comment}{//\ a-\/file}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00074}00074\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 3;\ \ \ \textcolor{comment}{//\ d-\/file}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00075}00075\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00076}00076\ \ \ \ \ \textcolor{comment}{//\ Should\ not\ happen\ if\ is\_castling\_move\ returned\ true}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00077}00077\ \ \ \ \ ESP\_LOGE(\textcolor{stringliteral}{"{}DEMO"{}},\ \textcolor{stringliteral}{"{}Invalid\ castling\ target\ column:\ \%d"{}},\ king\_to\_col);}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00078}00078\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00079}00079\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00080}00080\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00081}00081\ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00092}\mbox{\hyperlink{demo__mode__helpers_8c_a765d58ac494ce1812d1a714d714915b4}{00092}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{demo__mode__helpers_8c_a765d58ac494ce1812d1a714d714915b4}{demo\_is\_promotion\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[8][8])\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00094}00094\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00096}00096\ \ \ \textcolor{comment}{//\ Check\ if\ piece\ is\ a\ pawn}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00097}00097\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00098}00098\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00099}00099\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00101}00101\ \ \ \textcolor{comment}{//\ White\ pawn\ reaching\ rank\ 8\ (row\ 7)}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00102}00102\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ to\_row\ ==\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00103}00103\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00104}00104\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00106}00106\ \ \ \textcolor{comment}{//\ Black\ pawn\ reaching\ rank\ 1\ (row\ 0)}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00107}00107\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ to\_row\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00108}00108\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00109}00109\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00111}00111\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00112}00112\ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00123}\mbox{\hyperlink{demo__mode__helpers_8c_a610e6026c21231070bf571b79be34430}{00123}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a832ce297bfcf0b12c45b2ec754ab3bf5}{demo\_ensure\_safe\_timing}}(uint32\_t\ *last\_move\_time\_ms,}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ interval\_ms)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00125}00125\ \ \ uint32\_t\ now\_ms\ =\ xTaskGetTickCount()\ *\ portTICK\_PERIOD\_MS;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00126}00126\ \ \ uint32\_t\ elapsed\ =\ now\_ms\ -\/\ *last\_move\_time\_ms;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00128}00128\ \ \ \textcolor{comment}{//\ Wait\ if\ interval\ not\ yet\ elapsed}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00129}00129\ \ \ \textcolor{keywordflow}{if}\ (elapsed\ <\ interval\_ms)\ \{}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00130}00130\ \ \ \ \ uint32\_t\ wait\_ms\ =\ interval\_ms\ -\/\ elapsed;}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00131}00131\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(wait\_ms));}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00132}00132\ \ \ \}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00133}00133\ }
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00134}00134\ \ \ \textcolor{comment}{//\ Give\ web\ UI\ time\ to\ process\ highlight\ clearing\ (100ms)}}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00135}00135\ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{demo__mode__helpers_8c_source_l00136}00136\ \}}

\end{DoxyCode}
