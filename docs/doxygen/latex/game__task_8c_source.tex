\doxysection{game\+\_\+task.\+c}
\hypertarget{game__task_8c_source}{}\label{game__task_8c_source}\index{game\_task.c@{game\_task.c}}
\mbox{\hyperlink{game__task_8c}{Zobrazit dokumentaci tohoto souboru.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00159}00159\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00160}00160\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{game__task_8h}{game\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00161}00161\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{button__task_8h}{../button\_task/include/button\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00162}00162\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{chess__types_8h}{../freertos\_chess/include/chess\_types.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00163}00163\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{streaming__output_8h}{../freertos\_chess/include/streaming\_output.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00164}00164\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{led__task_8h}{../led\_task/include/led\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00165}00165\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{unified__animation__manager_8h}{../unified\_animation\_manager/include/unified\_animation\_manager.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00166}00166\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{freertos__chess_8h}{freertos\_chess.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00167}00167\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{game__led__animations_8h}{game\_led\_animations.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00168}00168\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{led__mapping_8h}{led\_mapping.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00169}00169\ \textcolor{comment}{//\ Enhanced\ castling\ system\ -\/\ include\ after\ other\ includes\ to\ avoid\ redefinition}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00170}00170\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{enhanced__castling__system_8h}{../enhanced\_castling\_system/include/enhanced\_castling\_system.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00171}00171\ \textcolor{comment}{//\ Timer\ system\ integration}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00172}00172\ \textcolor{preprocessor}{\#include\ "{}../../timer\_system/include/timer\_system.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00173}00173\ \textcolor{comment}{//\ ANSI\ color\ formatting\ macros}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00174}00174\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{game__colors_8h}{game\_colors.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00175}00175\ \textcolor{comment}{//\ Note:\ animation\_task.h\ is\ not\ included\ to\ avoid\ type\ conflicts\ with}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00176}00176\ \textcolor{comment}{//\ unified\_animation\_manager}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00177}00177\ \textcolor{preprocessor}{\#include\ "{}esp\_log.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00178}00178\ \textcolor{preprocessor}{\#include\ "{}esp\_task\_wdt.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00179}00179\ \textcolor{preprocessor}{\#include\ "{}esp\_timer.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00180}00180\ \textcolor{preprocessor}{\#include\ "{}freertos/queue.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00181}00181\ \textcolor{preprocessor}{\#include\ "{}freertos/semphr.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00182}00182\ \textcolor{preprocessor}{\#include\ "{}freertos/task.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00183}00183\ \textcolor{preprocessor}{\#include\ "{}freertos/timers.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00184}00184\ \textcolor{preprocessor}{\#include\ <inttypes.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00185}00185\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00186}00186\ \textcolor{preprocessor}{\#include\ <stdbool.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00187}00187\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00188}00188\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00189}00189\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00190}00190\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00192}\mbox{\hyperlink{game__task_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{00192}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}}\ =\ \textcolor{stringliteral}{"{}GAME\_TASK"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00194}00194\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00195}00195\ \textcolor{comment}{//\ WDT\ WRAPPER\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00196}00196\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00212}\mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{00212}}\ \textcolor{keyword}{static}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00213}00213\ \ \ esp\_err\_t\ ret\ =\ esp\_task\_wdt\_reset();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00214}00214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00215}00215\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_ERR\_NOT\_FOUND)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00216}00216\ \ \ \ \ \textcolor{comment}{//\ Log\ as\ WARNING\ instead\ of\ ERROR\ -\/\ task\ not\ registered\ yet}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00217}00217\ \ \ \ \ ESP\_LOGW(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00218}00218\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00219}00219\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}WDT\ reset:\ task\ not\ registered\ yet\ (this\ is\ normal\ during\ startup)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00220}00220\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;\ \textcolor{comment}{//\ Treat\ as\ success\ for\ our\ purposes}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00221}00221\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00222}00222\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}WDT\ reset\ failed:\ \%s"{}},\ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00223}00223\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00224}00224\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00225}00225\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00226}00226\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00227}00227\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00228}00228\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00229}00229\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00230}00230\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00231}00231\ \textcolor{comment}{//\ LOCAL\ VARIABLES\ AND\ CONSTANTS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00232}00232\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00234}00234\ \textcolor{comment}{//\ Direction\ vectors\ for\ piece\ movement}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00235}\mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{00235}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[8][2]\ =\ \{\{-\/2,\ -\/1\},\ \{-\/2,\ 1\},\ \{-\/1,\ -\/2\},\ \{-\/1,\ 2\},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00236}00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{1,\ -\/2\},\ \ \{1,\ 2\},\ \ \{2,\ -\/1\},\ \ \{2,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00237}00237\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00238}00238\ \textcolor{comment}{//\ Game\ configuration}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00239}\mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{00239}}\ \textcolor{preprocessor}{\#define\ MAX\_MOVES\_HISTORY\ 200\ \ }\textcolor{comment}{//\ Maximum\ moves\ to\ remember}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00240}00240\ \textcolor{comment}{//\#define\ GAME\_TIMEOUT\_MS\ 300000\ //\ 5\ minutes\ per\ move\ timeout\ \ \ not\ used\ in\ this\ version}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00241}\mbox{\hyperlink{game__task_8c_a2e965abc7c554be97017710630e9e0b7}{00241}}\ \textcolor{preprocessor}{\#define\ MOVE\_VALIDATION\_MS\ 100\ }\textcolor{comment}{//\ Move\ validation\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00242}00242\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00243}00243\ \textcolor{comment}{//\ Game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00244}\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{00244}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00245}\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{00245}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00246}\mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{00246}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00248}00248\ \textcolor{comment}{//\ Simplified\ castling\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00249}\mbox{\hyperlink{structcastling__state__t}{00249}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00250}\mbox{\hyperlink{structcastling__state__t_a1705abfdc6a05d4bec2293871b7b7fd1}{00250}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structcastling__state__t_a1705abfdc6a05d4bec2293871b7b7fd1}{in\_progress}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rošáda\ probíhá}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00251}\mbox{\hyperlink{structcastling__state__t_afde7ce6130b7476c3bc926c09e267d10}{00251}}\ \ \ uint8\_t\ \mbox{\hyperlink{structcastling__state__t_a5487d6de95e717db3a49bf0ed4aed5fd}{rook\_from\_row}},\ \mbox{\hyperlink{structcastling__state__t_afde7ce6130b7476c3bc926c09e267d10}{rook\_from\_col}};\ \textcolor{comment}{//\ Pozice\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00252}\mbox{\hyperlink{structcastling__state__t_a3f6d980f0e18ee2f5df5907b82d500a0}{00252}}\ \ \ uint8\_t\ \mbox{\hyperlink{structcastling__state__t_a4744be90f6da3461a00f214616844512}{rook\_to\_row}},\ \mbox{\hyperlink{structcastling__state__t_a3f6d980f0e18ee2f5df5907b82d500a0}{rook\_to\_col}};\ \ \ \ \ \textcolor{comment}{//\ Cíl\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00253}\mbox{\hyperlink{structcastling__state__t_ac32cc33e24d53fff7f4bca524ceceb1d}{00253}}\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{structcastling__state__t_ac32cc33e24d53fff7f4bca524ceceb1d}{player}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hráč,\ který\ provádí\ rošádu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00254}\mbox{\hyperlink{structcastling__state__t_aae2796ad5c3e40911c0c4002c77190ff}{00254}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structcastling__state__t_aae2796ad5c3e40911c0c4002c77190ff}{is\_kingside}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ to\ kingside\ rošáda?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00255}00255\ \}\ \mbox{\hyperlink{structcastling__state__t}{castling\_state\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00256}00256\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00257}\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{00257}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structcastling__state__t}{castling\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00258}00258\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00259}00259\ \textcolor{comment}{//\ Legacy\ castling\ state\ (for\ backward\ compatibility)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00260}\mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{00260}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00261}\mbox{\hyperlink{game__task_8c_aec956796e1629a92f299b1725070b1c2}{00261}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ \mbox{\hyperlink{game__task_8c_aec956796e1629a92f299b1725070b1c2}{pending\_castle\_move}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00262}00262\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00263}00263\ \textcolor{comment}{//\ Rook\ animation\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00264}\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{00264}}\ \textcolor{keyword}{static}\ TimerHandle\_t\ \mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00265}\mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{00265}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00266}\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{00266}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00267}00267\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00268}00268\ \textcolor{comment}{//\ Board\ representation\ (8x8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00269}\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{00269}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[8][8]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00270}\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{00270}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[8][8]\ =\ \{\textcolor{keyword}{false}\};\ \textcolor{comment}{//\ Track\ if\ pieces\ have\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00272}00272\ \textcolor{comment}{//\ Global\ variables\ for\ tracking\ lifted\ piece\ (UP/DN\ commands)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00273}\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{00273}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00274}\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{00274}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00275}\mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{00275}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00276}\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{00276}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00277}00277\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00278}00278\ \textcolor{comment}{//\ ✅\ 3-\/step\ capture\ flow\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00279}\mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{00279}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Je\ rozpracovaný\ capture?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00280}\mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{00280}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ 0;\ \ \ \textcolor{comment}{//\ Kam\ se\ má\ položit\ vlastní\ figurka}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00281}\mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{00281}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00282}\mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{00282}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00283}00283\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};\ \textcolor{comment}{//\ Jaká\ figurka\ byla\ odebrána}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00284}00284\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00285}00285\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Proměnné\ pro\ tracking\ opponent\ piece\ (když\ se\ zvedne\ figurka}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00286}00286\ \textcolor{comment}{//\ nehrajícího\ hráče)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00287}\mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{00287}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00288}\mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{00288}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00289}\mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{00289}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00290}\mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{00290}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00291}\mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{00291}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00292}\mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{00292}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00293}00293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00294}00294\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00295}00295\ \textcolor{comment}{//\ AUTO\ NEW\ GAME\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00296}00296\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00304}\mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{00304}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00305}\mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{00305}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{auto\_new\_game\_timer\_start}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00306}\mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{00306}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Flag\ aby\ se\ neopakoval\ reset}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00307}00307\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00308}\mbox{\hyperlink{game__task_8c_ab5d37ae881c4c3c8d9ac1a35e00e7b71}{00308}}\ \textcolor{preprocessor}{\#define\ AUTO\_NEW\_GAME\_CONFIRMATION\_TIME\_MS\ 2000\ }\textcolor{comment}{//\ 2\ sekundy}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00310}00310\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00311}00311\ \textcolor{comment}{//\ DEMO\ MODE\ STATE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00312}00312\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00313}00313\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00320}\mbox{\hyperlink{game__task_8c_a5e6a3c42019ea07caf53ff835fe123e4}{00320}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{main_8c_af252e203098e091d068b85d637b1083d}{demo\_mode\_enabled}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Is\ demo\ mode\ configured?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00321}\mbox{\hyperlink{game__task_8c_a524b9d765ca7598d09da9209411ab721}{00321}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a524b9d765ca7598d09da9209411ab721}{demo\_move\_interval\_ms}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00322}00322\ \ \ \ \ 2000;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Interval\ between\ moves\ (default\ 2s)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00323}\mbox{\hyperlink{game__task_8c_aa5125fe0a59dc9e79e7d3585a3bfde78}{00323}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aa5125fe0a59dc9e79e7d3585a3bfde78}{demo\_in\_progress}}\ =\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ Is\ demo\ currently\ running?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00324}\mbox{\hyperlink{game__task_8c_aa6c2b8854df7f9af92ed3920756942ab}{00324}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aa6c2b8854df7f9af92ed3920756942ab}{demo\_last\_move\_time}}\ =\ 0;\ \textcolor{comment}{//\ Timestamp\ of\ last\ demo\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00325}00325\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00326}\mbox{\hyperlink{game__task_8c_a7e5175effe0673fdfe9cc5eba2d886bd}{00326}}\ \textcolor{preprocessor}{\#define\ DEMO\_MIN\_INTERVAL\_MS\ 500\ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Minimum\ interval\ (0.5s)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00327}\mbox{\hyperlink{game__task_8c_a9d0135e87ed646894c9f20a29572e9e9}{00327}}\ \textcolor{preprocessor}{\#define\ DEMO\_MAX\_INTERVAL\_MS\ 10000\ \ \ \ \ \ \ }\textcolor{comment}{//\ Maximum\ interval\ (10s)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00328}\mbox{\hyperlink{game__task_8c_ae3018fd2ec7531ed59747ce1c2dc84ac}{00328}}\ \textcolor{preprocessor}{\#define\ DEMO\_MOVE\_EXECUTION\_DELAY\_MS\ 100\ }\textcolor{comment}{//\ Delay\ between\ pickup\ and\ place}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00329}00329\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00330}00330\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00331}00331\ \textcolor{comment}{//\ DEMO\ MODE\ HELPER\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00332}00332\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00333}00333\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00337}\mbox{\hyperlink{game__task_8c_a04510825a543fa3b6bf49c440affc5dc}{00337}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a04510825a543fa3b6bf49c440affc5dc}{demo\_is\_castling\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00338}00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00339}00339\ \ \ \textcolor{keywordflow}{if}\ (from\_row\ !=\ to\_row)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00340}00340\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00341}00341\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00342}00342\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00343}00343\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00344}00344\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00345}00345\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00346}00346\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ abs((\textcolor{keywordtype}{int})to\_col\ -\/\ (\textcolor{keywordtype}{int})from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00347}00347\ \ \ \textcolor{keywordflow}{return}\ (col\_diff\ ==\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00348}00348\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00349}00349\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00353}00353\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00354}\mbox{\hyperlink{game__task_8c_a87d3fb112c7c6e13fcd25d68f697d731}{00354}}\ \mbox{\hyperlink{game__task_8c_a87d3fb112c7c6e13fcd25d68f697d731}{demo\_get\_castling\_rook\_squares}}(uint8\_t\ king\_from\_row,\ uint8\_t\ king\_to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ *\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ uint8\_t\ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00356}00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ *\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ uint8\_t\ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00357}00357\ \ \ *\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ king\_from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00358}00358\ \ \ *\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ =\ king\_from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00359}00359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00360}00360\ \ \ \textcolor{keywordflow}{if}\ (king\_to\_col\ ==\ 6)\ \{\ \textcolor{comment}{//\ Kingside}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00361}00361\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 7;\ \ \ \textcolor{comment}{//\ h-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00362}00362\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 5;\ \ \ \ \ \textcolor{comment}{//\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00363}00363\ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Queenside\ (col\ 2)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00364}00364\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 0;\ \ \ \textcolor{comment}{//\ a-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00365}00365\ \ \ \ \ *\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 3;\ \ \ \ \ \textcolor{comment}{//\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00366}00366\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00367}00367\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00368}00368\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00372}\mbox{\hyperlink{game__task_8c_a9e8f544c7945e8ce3f4d2c8cdbd398dd}{00372}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a9e8f544c7945e8ce3f4d2c8cdbd398dd}{demo\_is\_promotion\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00374}00374\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00376}00376\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00377}00377\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00378}00378\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00379}00379\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ to\_row\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00380}00380\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00381}00381\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ to\_row\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00382}00382\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00383}00383\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00384}00384\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00385}00385\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00386}00386\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00390}\mbox{\hyperlink{game__task_8c_a832ce297bfcf0b12c45b2ec754ab3bf5}{00390}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a832ce297bfcf0b12c45b2ec754ab3bf5}{demo\_ensure\_safe\_timing}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00391}00391\ \ \ uint32\_t\ now\_ms\ =\ xTaskGetTickCount()\ *\ portTICK\_PERIOD\_MS;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00392}00392\ \ \ uint32\_t\ elapsed\ =\ now\_ms\ -\/\ \mbox{\hyperlink{game__task_8c_aa6c2b8854df7f9af92ed3920756942ab}{demo\_last\_move\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00393}00393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00394}00394\ \ \ \textcolor{keywordflow}{if}\ (elapsed\ <\ \mbox{\hyperlink{game__task_8c_a524b9d765ca7598d09da9209411ab721}{demo\_move\_interval\_ms}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00395}00395\ \ \ \ \ uint32\_t\ wait\_ms\ =\ \mbox{\hyperlink{game__task_8c_a524b9d765ca7598d09da9209411ab721}{demo\_move\_interval\_ms}}\ -\/\ elapsed;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00396}00396\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(wait\_ms));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00397}00397\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00398}00398\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00399}00399\ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));\ \textcolor{comment}{//\ Give\ UI\ time\ to\ clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00400}00400\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00401}00401\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00402}00402\ \textcolor{comment}{//\ Castling\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00403}\mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{00403}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00404}\mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{00404}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ a1\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00405}\mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{00405}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ h1\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00406}\mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{00406}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00407}\mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{00407}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ a8\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00408}\mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{00408}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ h8\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00409}00409\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00410}00410\ \textcolor{comment}{//\ En\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00411}\mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{00411}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00412}\mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{00412}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00413}\mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{00413}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00414}\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{00414}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00415}\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{00415}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00416}00416\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00417}00417\ \textcolor{comment}{//\ Move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00418}\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{00418}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00419}\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{00419}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00420}00420\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00421}00421\ \textcolor{comment}{//\ Task\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00422}\mbox{\hyperlink{game__task_8c_a35141cb45623cb3b7b4d96da35ed1831}{00422}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{animation__task_8c_a35141cb45623cb3b7b4d96da35ed1831}{task\_running}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00423}\mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{00423}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00424}00424\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00425}00425\ \textcolor{comment}{//\ \ Error\ handling\ -\/\ pamatování\ posledního\ validního\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00426}00426\ \textcolor{comment}{//\ Enhanced\ error\ recovery\ state\ for\ smart\ error\ handling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00427}00427\ \textcolor{keyword}{static}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00428}\mbox{\hyperlink{game__task_8c_aaf8f442c7b06c825971fa6dc67e06e66}{00428}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aaf8f442c7b06c825971fa6dc67e06e66}{has\_invalid\_piece}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ figurka\ na\ neplatném\ poli?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00429}\mbox{\hyperlink{game__task_8c_a571899e94ee6d82dbb7aae2c9038279d}{00429}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a3bc97aa032f065584d497d64d124632e}{invalid\_row}},\ \mbox{\hyperlink{game__task_8c_a571899e94ee6d82dbb7aae2c9038279d}{invalid\_col}};\ \textcolor{comment}{//\ Aktuální\ neplatná\ pozice\ (červené\ pole)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00430}\mbox{\hyperlink{game__task_8c_ae084bf0ad7337f75ef248cbeffa96672}{00430}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_ae084bf0ad7337f75ef248cbeffa96672}{original\_valid\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00431}\mbox{\hyperlink{game__task_8c_ad7a22cba87b0f065d0e829f5e2ce887f}{00431}}\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad7a22cba87b0f065d0e829f5e2ce887f}{original\_valid\_col}};\ \textcolor{comment}{//\ PŮVODNÍ\ validní\ pozice\ (nikdy\ se\ nezmění)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00432}\mbox{\hyperlink{game__task_8c_a60252451b47846f576a0ceb38633b917}{00432}}\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a60252451b47846f576a0ceb38633b917}{piece\_type}};\ \ \ \ \ \textcolor{comment}{//\ Typ\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00433}\mbox{\hyperlink{game__task_8c_a0d6232ac151a791249d00522a315fdb3}{00433}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a0d6232ac151a791249d00522a315fdb3}{waiting\_for\_move\_correction}};\ \textcolor{comment}{//\ Čekáme\ na\ opravu\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00434}\mbox{\hyperlink{game__task_8c_a2029e9c9788de523ece2dabbc7ffe2c7}{00434}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a2029e9c9788de523ece2dabbc7ffe2c7}{error\_count}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Počítadlo\ chyb\ za\ sebou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00435}\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{00435}}\ \}\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}\ =\ \{\textcolor{keyword}{false},\ 0,\ 0,\ 0,\ 0,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}},\ \textcolor{keyword}{false},\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00436}00436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00437}00437\ \textcolor{comment}{//\ NON-\/BLOCKING\ BLINK\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00438}\mbox{\hyperlink{structnon__blocking__blink__state__t}{00438}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00439}\mbox{\hyperlink{structnon__blocking__blink__state__t_ab2f4b6e5b386172f4152b49577696639}{00439}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structnon__blocking__blink__state__t_ab2f4b6e5b386172f4152b49577696639}{active}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00440}\mbox{\hyperlink{structnon__blocking__blink__state__t_a3d80bb44fac9c31373935f46b262978d}{00440}}\ \ \ uint8\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_a3d80bb44fac9c31373935f46b262978d}{led\_index}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00441}\mbox{\hyperlink{structnon__blocking__blink__state__t_a2cf6726c9629b2c9bd5ca4e34c368c01}{00441}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_a2cf6726c9629b2c9bd5ca4e34c368c01}{blink\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00442}\mbox{\hyperlink{structnon__blocking__blink__state__t_aecbf1a19f84e9e158e66165b9eb949cc}{00442}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_aecbf1a19f84e9e158e66165b9eb949cc}{max\_blinks}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00443}\mbox{\hyperlink{structnon__blocking__blink__state__t_aa4a0712510b6821b0a1367da1149b74f}{00443}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_aa4a0712510b6821b0a1367da1149b74f}{last\_toggle\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00444}\mbox{\hyperlink{structnon__blocking__blink__state__t_a3ff35a22d08f76595b205492b88c0409}{00444}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_a3ff35a22d08f76595b205492b88c0409}{blink\_interval\_ms}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00445}\mbox{\hyperlink{structnon__blocking__blink__state__t_ac30c937f5ac9092e85e8a313fb94830c}{00445}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structnon__blocking__blink__state__t_ac30c937f5ac9092e85e8a313fb94830c}{led\_state}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00446}00446\ \}\ \mbox{\hyperlink{structnon__blocking__blink__state__t}{non\_blocking\_blink\_state\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00447}00447\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00448}\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{00448}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structnon__blocking__blink__state__t}{non\_blocking\_blink\_state\_t}}\ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}\ =\ \{\textcolor{keyword}{false},\ 0,\ \ \ 0,\ \ \ \ 10,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00449}00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \ \ \ \ 300,\ \textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00450}00450\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00451}00451\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00452}00452\ \textcolor{comment}{//\ PROMOTION\ STATE\ -\/\ PHYSICAL\ BUTTON\ SUPPORT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00453}00453\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00454}00454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00461}00461\ \textcolor{keyword}{static}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00462}\mbox{\hyperlink{game__task_8c_a39f16d585c4531d2bf2562631a775d73}{00462}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a39f16d585c4531d2bf2562631a775d73}{pending}};\ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ promoce\ mozna/ceka\ se\ na\ ni?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00463}\mbox{\hyperlink{game__task_8c_a6ff5d035c17e8a98f013994186eca92b}{00463}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a6ff5d035c17e8a98f013994186eca92b}{square\_row}};\ \textcolor{comment}{//\ Radek\ s\ pescem\ k\ promoci\ (0\ nebo\ 7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00464}\mbox{\hyperlink{game__task_8c_a196aae5a38f9e4efbf2b30c0958d62cd}{00464}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a196aae5a38f9e4efbf2b30c0958d62cd}{square\_col}};\ \textcolor{comment}{//\ Sloupec\ s\ pescem\ k\ promoci\ (0-\/7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00465}\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{00465}}\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}};\ \ \ \ \textcolor{comment}{//\ Hrac\ ktery\ ma\ promovat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00466}\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{00466}}\ \}\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}\ =\ \{\textcolor{keyword}{false},\ 0,\ 0,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00467}00467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00468}00468\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00469}00469\ \textcolor{comment}{//\ KING\ RESIGNATION\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00470}00470\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00471}00471\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00472}\mbox{\hyperlink{structking__resignation__state__t}{00472}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00473}\mbox{\hyperlink{structking__resignation__state__t_a1186d33a02c7b828ad090842484f8f8c}{00473}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structking__resignation__state__t_a1186d33a02c7b828ad090842484f8f8c}{active}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ resignation\ timer\ aktivní?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00474}\mbox{\hyperlink{structking__resignation__state__t_aae1c259379dddc3435700259e5bebe8a}{00474}}\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{structking__resignation__state__t_aae1c259379dddc3435700259e5bebe8a}{player}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Který\ hráč\ drží\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00475}\mbox{\hyperlink{structking__resignation__state__t_a37e62616ed1e01e5461649b7fbe074e2}{00475}}\ \ \ uint8\_t\ \mbox{\hyperlink{structking__resignation__state__t_a8aa2d198aefd1c851caa794ed1c1af41}{king\_row}},\ \mbox{\hyperlink{structking__resignation__state__t_a37e62616ed1e01e5461649b7fbe074e2}{king\_col}};\ \ \ \ \textcolor{comment}{//\ Pozice\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00476}\mbox{\hyperlink{structking__resignation__state__t_ad466ba868c959c1683c6d3a8545380d0}{00476}}\ \ \ TimerHandle\_t\ \mbox{\hyperlink{structking__resignation__state__t_ad466ba868c959c1683c6d3a8545380d0}{main\_timer}};\ \ \ \ \ \ \textcolor{comment}{//\ Hlavní\ 10s\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00477}\mbox{\hyperlink{structking__resignation__state__t_a1c717d8def9f7fdab3de11b94f78fd8a}{00477}}\ \ \ TimerHandle\_t\ \mbox{\hyperlink{structking__resignation__state__t_a1c717d8def9f7fdab3de11b94f78fd8a}{animation\_timer}};\ \textcolor{comment}{//\ LED\ animation\ timer\ (50ms\ periodic)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00478}\mbox{\hyperlink{structking__resignation__state__t_a3405dda1390652be995ba6af7ad4db56}{00478}}\ \ \ uint64\_t\ \mbox{\hyperlink{structking__resignation__state__t_a3405dda1390652be995ba6af7ad4db56}{start\_time\_ms}};\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Čas\ startu\ (pro\ výpočet\ elapsed)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00479}\mbox{\hyperlink{structking__resignation__state__t_aaf4fec46a7bd11bc464a3a3b22d21c9d}{00479}}\ \ \ uint8\_t\ \mbox{\hyperlink{structking__resignation__state__t_aaf4fec46a7bd11bc464a3a3b22d21c9d}{last\_countdown\_sec}};\ \ \ \ \textcolor{comment}{//\ Poslední\ vypsaná\ sekunda\ (pro\ countdown)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00480}00480\ \}\ \mbox{\hyperlink{structking__resignation__state__t}{king\_resignation\_state\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00481}00481\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00482}\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{00482}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structking__resignation__state__t}{king\_resignation\_state\_t}}\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}\ =\ \{.active\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00483}00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00484}00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .king\_row\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00485}00485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .king\_col\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00486}00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .main\_timer\ =\ NULL,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00487}00487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .animation\_timer\ =\ NULL,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .start\_time\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00489}00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_countdown\_sec\ =\ 10\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00490}00490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00491}00491\ \textcolor{comment}{//\ Forward\ declarations\ pro\ resignation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00492}00492\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{resignation\_main\_timer\_callback}}(TimerHandle\_t\ xTimer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00493}00493\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{resignation\_animation\_timer\_callback}}(TimerHandle\_t\ xTimer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00494}00494\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{resignation\_start}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ uint8\_t\ row,\ uint8\_t\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00495}00495\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keywordtype}{bool}\ finalize);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00496}00496\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{resignation\_update\_button\_leds}}(uint32\_t\ elapsed\_ms);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00497}00497\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00498}00498\ \textcolor{comment}{//\ Forward\ declarations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00499}00499\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00500}00500\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00501}00501\ \textcolor{comment}{//\ Game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00502}\mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{00502}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00503}\mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{00503}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00504}\mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{00504}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00505}\mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{00505}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00506}00506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00507}00507\ \textcolor{comment}{//\ ✅\ FIX:\ Flag\ pro\ endgame\ report\ request\ (místo\ volání\ z\ timer\ callbacku)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00508}\mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{00508}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00509}00509\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00510}00510\ \textcolor{comment}{//\ ✅\ FIX:\ Typ\ konce\ hry\ pro\ lepší\ rozlišení\ v\ reportu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00511}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63ca}{00511}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00512}00512\ \ \ \textcolor{comment}{//\ Checkmate\ variations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00513}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{00513}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}}\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00514}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{00514}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}}\ =\ 1,\ \textcolor{comment}{//\ Šachmat\ pomocí\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00515}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{00515}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}}\ =\ 2,\ \ \ \textcolor{comment}{//\ Šachmat\ pomocí\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00516}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{00516}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}}\ =\ 3,\ \ \textcolor{comment}{//\ Šachmat\ po\ promoci\ pěšce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00517}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{00517}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}}\ =\ 4,\ \textcolor{comment}{//\ Šachmat\ odkrytým\ šachem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00518}00518\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00519}00519\ \ \ \textcolor{comment}{//\ Draw\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00520}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{00520}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}}\ =\ 10,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00521}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{00521}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}}\ =\ 11,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00522}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{00522}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}}\ =\ 12,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00523}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{00523}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}}\ =\ 13,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00524}00524\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00525}00525\ \ \ \textcolor{comment}{//\ Player\ actions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00526}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{00526}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}}\ =\ 20,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00527}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{00527}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}}\ =\ 21}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00528}00528\ \}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63ca}{endgame\_reason\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00529}00529\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00530}\mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{00530}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63ca}{endgame\_reason\_t}}\ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00531}00531\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00532}00532\ \textcolor{comment}{//\ ✅\ Typ\ posledního\ tahu\ pro\ detekci\ speciálních\ šachmatů}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00533}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428}{00533}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00534}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{00534}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}}\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00535}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{00535}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{LAST\_MOVE\_EN\_PASSANT}}\ =\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00536}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{00536}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}}\ =\ 2,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00537}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{00537}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{LAST\_MOVE\_PROMOTION}}\ =\ 3,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00538}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a1f704b3fdc9edf5defa5ca3f23fef635}{00538}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a1f704b3fdc9edf5defa5ca3f23fef635}{LAST\_MOVE\_DISCOVERED}}\ =\ 4}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00539}00539\ \}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428}{last\_move\_type\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00540}00540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00541}\mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{00541}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428}{last\_move\_type\_t}}\ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00542}00542\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00543}00543\ \textcolor{comment}{//\ Extended\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00544}\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{00544}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00545}\mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{00545}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00546}\mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{00546}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00547}\mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{00547}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00548}\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{00548}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00549}\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{00549}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00550}\mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{00550}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00551}\mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{00551}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00552}\mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{00552}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00553}\mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{00553}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00554}\mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{00554}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00555}\mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{00555}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00556}00556\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00557}00557\ \textcolor{comment}{//\ Captured\ pieces\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00558}\mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{00558}}\ \textcolor{preprocessor}{\#define\ MAX\_CAPTURED\_PIECES\ 16}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00559}\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{00559}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00560}\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{00560}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00561}\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{00561}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00562}\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{00562}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00563}\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{00563}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00564}\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{00564}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00565}00565\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00566}00566\ \textcolor{comment}{//\ Material\ advantage\ tracking\ (pro\ graf\ výhody\ v\ průběhu\ hry)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00567}\mbox{\hyperlink{game__task_8c_a80792d272b6a0d629d67d2a0cf00f55a}{00567}}\ \textcolor{preprocessor}{\#define\ MAX\_ADVANTAGE\_HISTORY\ 200}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00568}\mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{00568}}\ \textcolor{keyword}{static}\ int8\_t\ \mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00569}00569\ \ \ \ \ [\mbox{\hyperlink{game__task_8c_a80792d272b6a0d629d67d2a0cf00f55a}{MAX\_ADVANTAGE\_HISTORY}}];\ \textcolor{comment}{//\ -\/127\ až\ +127\ (White\ positive,\ Black\ negative)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00570}\mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{00570}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00571}00571\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00575}\mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{00575}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00576}00576\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00577}00577\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00578}00578\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00579}00579\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00580}00580\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'P'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00581}00581\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00582}00582\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'N'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00583}00583\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00584}00584\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'B'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00585}00585\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00586}00586\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'R'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00587}00587\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00588}00588\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'Q'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00589}00589\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00590}00590\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'K'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00591}00591\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00592}00592\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'p'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00593}00593\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00594}00594\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'n'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00595}00595\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00596}00596\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'b'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00597}00597\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00598}00598\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'r'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00599}00599\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00600}00600\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'q'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00601}00601\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00602}00602\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'k'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00603}00603\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00604}00604\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00605}00605\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00606}00606\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00607}00607\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00612}\mbox{\hyperlink{game__task_8c_af3188c30ca0951b2b2e762ab26cb0a4b}{00612}}\ \textcolor{keyword}{static}\ int8\_t\ \mbox{\hyperlink{game__task_8c_af3188c30ca0951b2b2e762ab26cb0a4b}{game\_calculate\_material\_advantage}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00613}00613\ \ \ \textcolor{keywordtype}{int}\ white\_material\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00614}00614\ \ \ \textcolor{keywordtype}{int}\ black\_material\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00615}00615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00616}00616\ \ \ \textcolor{comment}{//\ Hodnoty\ figur}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00617}00617\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ pawn\_value\ =\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00618}00618\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ knight\_value\ =\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00619}00619\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ bishop\_value\ =\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00620}00620\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ rook\_value\ =\ 5;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00621}00621\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ queen\_value\ =\ 9;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00622}00622\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00623}00623\ \ \ \textcolor{comment}{//\ Spočítat\ materiál\ na\ boardu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00624}00624\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00625}00625\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00626}00626\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00627}00627\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00628}00628\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00629}00629\ \ \ \ \ \ \ \ \ white\_material\ +=\ pawn\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00630}00630\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00631}00631\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00632}00632\ \ \ \ \ \ \ \ \ white\_material\ +=\ knight\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00633}00633\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00634}00634\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00635}00635\ \ \ \ \ \ \ \ \ white\_material\ +=\ bishop\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00636}00636\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00637}00637\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00638}00638\ \ \ \ \ \ \ \ \ white\_material\ +=\ rook\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00639}00639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00640}00640\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00641}00641\ \ \ \ \ \ \ \ \ white\_material\ +=\ queen\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00642}00642\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00643}00643\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00644}00644\ \ \ \ \ \ \ \ \ black\_material\ +=\ pawn\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00645}00645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00646}00646\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00647}00647\ \ \ \ \ \ \ \ \ black\_material\ +=\ knight\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00648}00648\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00649}00649\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00650}00650\ \ \ \ \ \ \ \ \ black\_material\ +=\ bishop\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00651}00651\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00652}00652\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00653}00653\ \ \ \ \ \ \ \ \ black\_material\ +=\ rook\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00654}00654\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00655}00655\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00656}00656\ \ \ \ \ \ \ \ \ black\_material\ +=\ queen\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00657}00657\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00658}00658\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00659}00659\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00660}00660\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00661}00661\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00662}00662\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00663}00663\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00664}00664\ \ \ \textcolor{keywordtype}{int}\ advantage\ =\ white\_material\ -\/\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00665}00665\ \ \ \textcolor{comment}{//\ Omezit\ na\ int8\_t\ rozsah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00666}00666\ \ \ \textcolor{keywordflow}{if}\ (advantage\ >\ 127)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00667}00667\ \ \ \ \ advantage\ =\ 127;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00668}00668\ \ \ \textcolor{keywordflow}{if}\ (advantage\ <\ -\/127)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00669}00669\ \ \ \ \ advantage\ =\ -\/127;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00670}00670\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00671}00671\ \ \ \textcolor{keywordflow}{return}\ (int8\_t)advantage;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00672}00672\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00673}00673\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00677}\mbox{\hyperlink{game__task_8c_abd6d559fc6b46a6a06f830b5c5cec56a}{00677}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_abd6d559fc6b46a6a06f830b5c5cec56a}{game\_record\_material\_advantage}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00678}00678\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ >=\ \mbox{\hyperlink{game__task_8c_a80792d272b6a0d629d67d2a0cf00f55a}{MAX\_ADVANTAGE\_HISTORY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00679}00679\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Historie\ plná}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00680}00680\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00681}00681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00682}00682\ \ \ int8\_t\ advantage\ =\ \mbox{\hyperlink{game__task_8c_af3188c30ca0951b2b2e762ab26cb0a4b}{game\_calculate\_material\_advantage}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00683}00683\ \ \ \mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}[\mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}++]\ =\ advantage;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00684}00684\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00685}00685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00689}\mbox{\hyperlink{game__task_8c_a9f117ec973e2706358d99dfe843cd6ae}{00689}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a9f117ec973e2706358d99dfe843cd6ae}{add\_captured\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00690}00690\ \ \ \textcolor{comment}{//\ Determine\ which\ array\ to\ use\ based\ on\ piece\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00691}00691\ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00692}00692\ \ \ \ \ \textcolor{comment}{//\ White\ piece\ captured\ by\ black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00693}00693\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00694}00694\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}++]\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00695}00695\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00696}00696\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00697}00697\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00698}00698\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00699}00699\ \ \ \ \ \textcolor{comment}{//\ Black\ piece\ captured\ by\ white}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00700}00700\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00701}00701\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}++]\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00702}00702\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00703}00703\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00704}00704\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00705}00705\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00706}00706\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00707}00707\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00708}\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{00708}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00709}\mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{00709}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00710}\mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{00710}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[100];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00711}\mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{00711}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00712}00712\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00713}00713\ \textcolor{comment}{//\ Game\ state\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00714}\mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{00714}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{timer\_enabled}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00715}\mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{00715}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00716}\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{00716}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[32]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00717}\mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{00717}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00718}\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{00718}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00719}00719\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};\ \textcolor{comment}{//\ Aktuální\ typ\ konce\ hry}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00720}00720\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00721}00721\ \textcolor{comment}{//\ Castling\ flags\ and\ en\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00722}00722\ \textcolor{comment}{//\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00723}00723\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00724}00724\ \textcolor{comment}{//\ Move\ generation\ buffers\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00725}00725\ \textcolor{comment}{//\ static\ chess\_move\_extended\_t\ legal\_moves\_buffer[128];}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00726}00726\ \textcolor{comment}{//\ static\ uint32\_t\ legal\_moves\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00727}00727\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00728}00728\ \textcolor{comment}{//\ Include\ ctype.h\ for\ tolower\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00729}00729\ \textcolor{preprocessor}{\#include\ <ctype.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00730}00730\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00731}00731\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00732}00732\ \textcolor{comment}{//\ FORWARD\ DECLARATIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00733}00733\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00734}00734\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00735}00735\ \textcolor{comment}{//\ Promotion\ functions\ -\/\ MUST\ BE\ FIRST\ (called\ from\ game\_initialize\_board)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00736}00736\ \textcolor{comment}{//\ Note:\ These\ are\ defined\ later\ in\ the\ file\ (around\ line\ 3800)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00737}00737\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00738}00738\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{game\_process\_promotion\_button}}(uint8\_t\ button\_id);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00739}00739\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00740}00740\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00741}00741\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aee07708800ca9d9eee519b40b78f71d3}{game\_print\_board\_enhanced}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00742}00742\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{game\_execute\_move\_enhanced}}(\mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00743}00743\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00744}00744\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a5d48aea6f905097dca8c53e1c2a057b1}{game\_analyze\_position}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00745}00745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00746}00746\ \textcolor{comment}{//\ Error\ recovery\ functions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00747}00747\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00748}00748\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00749}00749\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00750}00750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00751}00751\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00752}00752\ \textcolor{comment}{//\ POSITION\ HASHING\ AND\ DRAW\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00753}00753\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00754}00754\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00759}\mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{00759}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{game\_calculate\_position\_hash}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00760}00760\ \ \ uint32\_t\ hash\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00761}00761\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00762}00762\ \ \ \textcolor{comment}{//\ Hash\ board\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00763}00763\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00764}00764\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00765}00765\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00766}00766\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00767}00767\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Combine\ piece\ type,\ position,\ and\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00768}00768\ \ \ \ \ \ \ \ \ uint32\_t\ piece\_hash\ =\ (piece\ <<\ 16)\ |\ (row\ <<\ 8)\ |\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00769}00769\ \ \ \ \ \ \ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ piece\_hash;\ \textcolor{comment}{//\ Simple\ hash\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00770}00770\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00771}00771\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00772}00772\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00773}00773\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00774}00774\ \ \ \textcolor{comment}{//\ Include\ current\ player\ in\ hash}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00775}00775\ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00776}00776\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00777}00777\ \ \ \textcolor{comment}{//\ Include\ castling\ rights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00778}00778\ \ \ uint32\_t\ castling\_rights\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00779}00779\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[0][4])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00780}00780\ \ \ \ \ castling\_rights\ |=\ 0x01;\ \textcolor{comment}{//\ White\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00781}00781\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[0][0])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00782}00782\ \ \ \ \ castling\_rights\ |=\ 0x02;\ \textcolor{comment}{//\ White\ rook\ a1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00783}00783\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[0][7])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00784}00784\ \ \ \ \ castling\_rights\ |=\ 0x04;\ \textcolor{comment}{//\ White\ rook\ h1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00785}00785\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[7][4])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00786}00786\ \ \ \ \ castling\_rights\ |=\ 0x08;\ \textcolor{comment}{//\ Black\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00787}00787\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[7][0])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00788}00788\ \ \ \ \ castling\_rights\ |=\ 0x10;\ \textcolor{comment}{//\ Black\ rook\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00789}00789\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[7][7])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00790}00790\ \ \ \ \ castling\_rights\ |=\ 0x20;\ \textcolor{comment}{//\ Black\ rook\ h8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00791}00791\ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ castling\_rights;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00792}00792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00793}00793\ \ \ \textcolor{comment}{//\ Include\ en\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00794}00794\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00795}00795\ \ \ \ \ uint32\_t\ en\_passant\_hash\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00796}00796\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ <<\ 8)\ |\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00797}00797\ \ \ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ en\_passant\_hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00798}00798\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00799}00799\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00800}00800\ \ \ \textcolor{keywordflow}{return}\ hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00801}00801\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00802}00802\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00808}\mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{00808}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{game\_is\_position\_repeated}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00809}00809\ \ \ uint32\_t\ current\_hash\ =\ \mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{game\_calculate\_position\_hash}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00810}00810\ \ \ \textcolor{keywordtype}{int}\ repetition\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00811}00811\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00812}00812\ \ \ \textcolor{comment}{//\ Count\ how\ many\ times\ current\ position\ appears\ in\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00813}00813\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00814}00814\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[i]\ ==\ current\_hash)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00815}00815\ \ \ \ \ \ \ repetition\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00816}00816\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (repetition\_count\ >=\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00817}00817\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Threefold\ repetition\ detected}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00818}00818\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00819}00819\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00820}00820\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00821}00821\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00822}00822\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00823}00823\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00824}00824\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00828}\mbox{\hyperlink{game__task_8c_a7d059ee1bbc8427968feaf95af032112}{00828}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a7d059ee1bbc8427968feaf95af032112}{game\_add\_position\_to\_history}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00829}00829\ \ \ uint32\_t\ current\_hash\ =\ \mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{game\_calculate\_position\_hash}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00830}00830\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00831}00831\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ <\ 100)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00832}00832\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[\mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}++]\ =\ current\_hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00833}00833\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00834}00834\ \ \ \ \ \textcolor{comment}{//\ Shift\ history\ and\ add\ new\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00835}00835\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 99;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00836}00836\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[i]\ =\ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[i\ +\ 1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00837}00837\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00838}00838\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[99]\ =\ current\_hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00839}00839\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00840}00840\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00841}00841\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00842}00842\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00843}00843\ \textcolor{comment}{//\ MATERIAL\ CALCULATION\ AND\ SCORING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00844}00844\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00845}00845\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00846}00846\ \textcolor{comment}{//\ Standard\ piece\ values}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00847}\mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{00847}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{piece\_values}}[]\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00848}00848\ \ \ \ \ 0,\ \textcolor{comment}{//\ PIECE\_EMPTY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00849}00849\ \ \ \ \ 1,\ \textcolor{comment}{//\ PIECE\_WHITE\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00850}00850\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_WHITE\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00851}00851\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_WHITE\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00852}00852\ \ \ \ \ 5,\ \textcolor{comment}{//\ PIECE\_WHITE\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00853}00853\ \ \ \ \ 9,\ \textcolor{comment}{//\ PIECE\_WHITE\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00854}00854\ \ \ \ \ 0,\ \textcolor{comment}{//\ PIECE\_WHITE\_KING\ (infinite\ value)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00855}00855\ \ \ \ \ 1,\ \textcolor{comment}{//\ PIECE\_BLACK\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00856}00856\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_BLACK\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00857}00857\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_BLACK\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00858}00858\ \ \ \ \ 5,\ \textcolor{comment}{//\ PIECE\_BLACK\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00859}00859\ \ \ \ \ 9,\ \textcolor{comment}{//\ PIECE\_BLACK\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00860}00860\ \ \ \ \ 0\ \ \textcolor{comment}{//\ PIECE\_BLACK\_KING\ (infinite\ value)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00861}00861\ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00862}00862\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00870}\mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{00870}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\textcolor{keywordtype}{int}\ *white\_material,\ \textcolor{keywordtype}{int}\ *black\_material)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00871}00871\ \ \ \textcolor{keywordtype}{int}\ white\_total\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00872}00872\ \ \ \textcolor{keywordtype}{int}\ black\_total\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00873}00873\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00874}00874\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00875}00875\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00876}00876\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00877}00877\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00878}00878\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00879}00879\ \ \ \ \ \ \ \ \ \ \ white\_total\ +=\ \mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{piece\_values}}[piece];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00880}00880\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00881}00881\ \ \ \ \ \ \ \ \ \ \ black\_total\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00882}00882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{piece\_values}}[piece\ -\/\ 6];\ \textcolor{comment}{//\ Adjust\ index\ for\ black\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00883}00883\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00884}00884\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00885}00885\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00886}00886\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00887}00887\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00888}00888\ \ \ \textcolor{keywordflow}{if}\ (white\_material)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00889}00889\ \ \ \ \ *white\_material\ =\ white\_total;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00890}00890\ \ \ \textcolor{keywordflow}{if}\ (black\_material)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00891}00891\ \ \ \ \ *black\_material\ =\ black\_total;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00892}00892\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00893}00893\ \ \ \textcolor{keywordflow}{return}\ white\_total\ -\/\ black\_total;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00894}00894\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00895}00895\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00901}\mbox{\hyperlink{game__task_8c_a13f42aca89279614ea9159dec44ae36c}{00901}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a13f42aca89279614ea9159dec44ae36c}{game\_get\_material\_string}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00902}00902\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00903}00903\ \ \ \textcolor{keywordtype}{int}\ balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00904}00904\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00905}00905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00906}00906\ \ \ \textcolor{keywordflow}{if}\ (balance\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00907}00907\ \ \ \ \ snprintf(buffer,\ buffer\_size,\ \textcolor{stringliteral}{"{}White\ +\%d"{}},\ balance);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00908}00908\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (balance\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00909}00909\ \ \ \ \ snprintf(buffer,\ buffer\_size,\ \textcolor{stringliteral}{"{}Black\ +\%d"{}},\ -\/balance);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00910}00910\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00911}00911\ \ \ \ \ snprintf(buffer,\ buffer\_size,\ \textcolor{stringliteral}{"{}Even\ (+0)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00912}00912\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00913}00913\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00914}00914\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00915}00915\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00916}00916\ \textcolor{comment}{//\ GAME\ STATISTICS\ DISPLAY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00917}00917\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00918}00918\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00923}\mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{00923}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ result\_type)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00924}00924\ \ \ \textcolor{keywordflow}{switch}\ (result\_type)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00925}00925\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00926}00926\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00927}00927\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Statistics:\ White\ wins!\ (Total:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00928}00928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00929}00929\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00930}00930\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00931}00931\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00932}00932\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Statistics:\ Black\ wins!\ (Total:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00933}00933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00934}00934\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00935}00935\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00936}00936\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00937}00937\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0486ad918f30f8bb5d8db5d92f72c208}{RESULT\_DRAW\_REPETITION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00938}00938\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00939}00939\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00940}00940\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Statistics:\ Draw!\ (Total:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00941}00941\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00942}00942\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00943}00943\ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00944}00944\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Total\ games:\ \%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00945}00945\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00946}00946\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00951}00951\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00952}00952\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00953}00953\ \textcolor{comment}{//\ ENDGAME\ REPORT\ FORMATTING\ HELPERS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00954}00954\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00955}00955\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00965}\mbox{\hyperlink{game__task_8c_a195ade6830068f1a49821f3d0e8f24db}{00965}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a195ade6830068f1a49821f3d0e8f24db}{print\_report\_header}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *title)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00966}00966\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00967}00967\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00968}00968\ \ \ printf(\textcolor{stringliteral}{"{}\%s\(\backslash\)r\(\backslash\)n"{}},\ title);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00969}00969\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00970}00970\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00971}00971\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00978}\mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{00978}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00979}00979\ \ \ printf(\textcolor{stringliteral}{"{}───────────────────────────────────────────────────────────────\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00980}00980\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00981}00981\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00997}\mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{00997}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *label,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *fmt,\ ...)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00998}00998\ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ \%s:\ "{}},\ label);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00999}00999\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01000}01000\ \ \ va\_list\ args;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01001}01001\ \ \ va\_start(args,\ fmt);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01002}01002\ \ \ vprintf(fmt,\ args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01003}01003\ \ \ va\_end(args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01004}01004\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01005}01005\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01006}01006\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01007}01007\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01008}\mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{01008}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ result\_type)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01009}01009\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01010}01010\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01011}01011\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01012}01012\ \ \ uint32\_t\ minutes\ =\ game\_duration\ /\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01013}01013\ \ \ uint32\_t\ seconds\ =\ game\_duration\ \%\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01014}01014\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01015}01015\ \ \ \textcolor{comment}{//\ Print\ endgame\ announcement}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01016}01016\ \ \ \mbox{\hyperlink{game__task_8c_a195ade6830068f1a49821f3d0e8f24db}{print\_report\_header}}(\textcolor{stringliteral}{"{}🏆\ ENDGAME\ REPORT"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01017}01017\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01018}01018\ \ \ \textcolor{comment}{//\ ✅\ Určit\ výsledek\ a\ typ\ ukončení\ podle\ current\_endgame\_reason}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01019}01019\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01020}01020\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *loser\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01021}01021\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *end\_reason\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01022}01022\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01023}01023\ \ \ \textcolor{comment}{//\ Nejprve\ určíme\ vítěze\ z\ result\_type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01024}01024\ \ \ \textcolor{keywordflow}{if}\ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01025}01025\ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01026}01026\ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01027}01027\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01028}01028\ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01029}01029\ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01030}01030\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01031}01031\ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01032}01032\ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01033}01033\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01034}01034\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01035}01035\ \ \ \textcolor{comment}{//\ Pak\ určíme\ důvod\ konce\ hry\ a\ vytiskneme\ výsledek}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01036}01036\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01037}01037\ \ \ \textcolor{comment}{//\ ===\ CHECKMATE\ VARIATIONS\ ===}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01038}01038\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01039}01039\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎯\ Game\ Result:\ \%s\ WINS\ BY\ CHECKMATE\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01040}01040\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01041}01041\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01042}01042\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01043}01043\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01044}01044\ \ \ \ \ printf(\textcolor{stringliteral}{"{}⚔️\ Game\ Result:\ \%s\ WINS\ BY\ EN\ PASSANT\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01045}01045\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01046}01046\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (En\ Passant)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01047}01047\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01048}01048\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01049}01049\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🏰\ Game\ Result:\ \%s\ WINS\ BY\ CASTLING\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01050}01050\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01051}01051\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Castling)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01052}01052\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01053}01053\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01054}01054\ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ Game\ Result:\ \%s\ WINS\ BY\ PROMOTION\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01055}01055\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01056}01056\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Promotion)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01057}01057\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01058}01058\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01059}01059\ \ \ \ \ printf(\textcolor{stringliteral}{"{}💥\ Game\ Result:\ \%s\ WINS\ BY\ DISCOVERED\ CHECK\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01060}01060\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01061}01061\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Discovered\ Check)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01062}01062\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01063}01063\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01064}01064\ \ \ \textcolor{comment}{//\ ===\ PLAYER\ ACTIONS\ ===}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01065}01065\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01066}01066\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🏳️\ Game\ Result:\ \%s\ WINS\ BY\ RESIGNATION\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01067}01067\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01068}01068\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Resignation"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01069}01069\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01070}01070\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01071}01071\ \ \ \ \ printf(\textcolor{stringliteral}{"{}⏰\ Game\ Result:\ \%s\ WINS\ BY\ TIMEOUT\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01072}01072\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01073}01073\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Timeout"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01074}01074\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01075}01075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01076}01076\ \ \ \textcolor{comment}{//\ ===\ DRAW\ CONDITIONS\ ===}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01077}01077\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01078}01078\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ Stalemate\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01079}01079\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Stalemate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01080}01080\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01081}01081\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01082}01082\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ 50-\/move\ rule\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01083}01083\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}50-\/move\ rule"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01084}01084\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01085}01085\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01086}01086\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ Three-\/fold\ repetition\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01087}01087\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Threefold\ repetition"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01088}01088\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01089}01089\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01090}01090\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ Insufficient\ material\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01091}01091\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Insufficient\ material"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01092}01092\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01093}01093\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01094}01094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01095}01095\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01096}01096\ \ \ printf(\textcolor{stringliteral}{"{}📋\ Game\ Summary:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01097}01097\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Winner"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ winner);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01098}01098\ \ \ \textcolor{keywordflow}{if}\ (result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01099}01099\ \ \ \ \ \ \ result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01100}01100\ \ \ \ \ \ \ result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0486ad918f30f8bb5d8db5d92f72c208}{RESULT\_DRAW\_REPETITION}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01101}01101\ \ \ \ \ \ \ result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01102}01102\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Loser"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ loser);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01103}01103\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01104}01104\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}End\ Reason"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ end\_reason);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01105}01105\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Total\ Moves"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01106}01106\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Game\ Duration"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}:\%02"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (mm:ss)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01107}01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ minutes,\ seconds);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01108}01108\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01109}01109\ \ \ \textcolor{comment}{//\ Vypočítat\ material\ advantage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01110}01110\ \ \ \textcolor{keywordtype}{int}\ white\_material\ =\ 0,\ black\_material\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01111}01111\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01112}01112\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ p\ =\ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01113}01113\ \ \ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01114}01114\ \ \ \ \ \ \ white\_material\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01115}01115\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}\ ||\ p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01116}01116\ \ \ \ \ \ \ white\_material\ +=\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01117}01117\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01118}01118\ \ \ \ \ \ \ white\_material\ +=\ 5;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01119}01119\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01120}01120\ \ \ \ \ \ \ white\_material\ +=\ 9;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01121}01121\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01122}01122\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01123}01123\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ p\ =\ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01124}01124\ \ \ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01125}01125\ \ \ \ \ \ \ black\_material\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01126}01126\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ ||\ p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01127}01127\ \ \ \ \ \ \ black\_material\ +=\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01128}01128\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01129}01129\ \ \ \ \ \ \ black\_material\ +=\ 5;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01130}01130\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01131}01131\ \ \ \ \ \ \ black\_material\ +=\ 9;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01132}01132\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01133}01133\ \ \ \textcolor{keywordtype}{int}\ material\_diff\ =\ white\_material\ -\/\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01134}01134\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01135}01135\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01136}01136\ \ \ printf(\textcolor{stringliteral}{"{}📊\ Game\ Statistics:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01137}01137\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Moves"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ (\mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ +\ 1)\ /\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01138}01138\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Moves"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ /\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01139}01139\ \ \ \textcolor{keywordflow}{if}\ (game\_duration\ >\ 0\ \&\&\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01140}01140\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Avg\ Time\ per\ Move"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01141}01141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration\ /\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01142}01142\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01143}01143\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01144}01144\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01145}01145\ \ \ printf(\textcolor{stringliteral}{"{}⚔️\ \ Combat\ Statistics:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01146}01146\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Captures"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\ (\%d\ points)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01147}01147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}},\ white\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01148}01148\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Captures"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\ (\%d\ points)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01149}01149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}},\ black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01150}01150\ \ \ \textcolor{keywordflow}{if}\ (material\_diff\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01151}01151\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Material\ Advantage"{}},\ \textcolor{stringliteral}{"{}White\ +\%d"{}},\ material\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01152}01152\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (material\_diff\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01153}01153\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Material\ Advantage"{}},\ \textcolor{stringliteral}{"{}Black\ +\%d"{}},\ -\/material\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01154}01154\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01155}01155\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Material\ Advantage"{}},\ \textcolor{stringliteral}{"{}Equal\ (0)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01156}01156\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01157}01157\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Checks"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01158}01158\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Checks"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01159}01159\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01160}01160\ \ \ \textcolor{comment}{//\ Captured\ pieces\ vizuálně}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01161}01161\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01162}01162\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ White\ Captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01163}01163\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01164}01164\ \ \ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01165}01165\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01166}01166\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%c\ "{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01167}01167\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01168}01168\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01169}01169\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01170}01170\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01171}01171\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Black\ Captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01172}01172\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01173}01173\ \ \ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01174}01174\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01175}01175\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%c\ "{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01176}01176\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01177}01177\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01178}01178\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01179}01179\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01180}01180\ \ \ \textcolor{comment}{//\ Castling\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01181}01181\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Castling"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ >\ 0\ ?\ \textcolor{stringliteral}{"{}Yes"{}}\ :\ \textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01182}01182\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Castling"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ >\ 0\ ?\ \textcolor{stringliteral}{"{}Yes"{}}\ :\ \textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01183}01183\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01184}01184\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01185}01185\ \ \ printf(\textcolor{stringliteral}{"{}📈\ Overall\ Statistics:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01186}01186\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Total\ Games\ Played"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01187}01187\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Wins"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (\%.0f\%\%)"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01188}01188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}\ *\ 100.0f\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01189}01189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01190}01190\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Wins"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (\%.0f\%\%)"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01191}01191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}\ *\ 100.0f\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01192}01192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01193}01193\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Draws"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (\%.0f\%\%)"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01194}01194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}}\ *\ 100.0f\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}})\ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01195}01195\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01196}01196\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01197}01197\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01198}01198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01199}01199\ \ \ \textcolor{comment}{//\ Flush\ stdout\ pro\ okamžité\ zobrazení}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01200}01200\ \ \ fflush(stdout);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01201}01201\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01202}01202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01206}\mbox{\hyperlink{game__task_8c_ac06b42b52fc2abf90b66dcbd73ecd4a0}{01206}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ac06b42b52fc2abf90b66dcbd73ecd4a0}{game\_get\_white\_wins}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01207}01207\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01211}\mbox{\hyperlink{game__task_8c_a4c5423c283319ea94779b79682ca9b98}{01211}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a4c5423c283319ea94779b79682ca9b98}{game\_get\_black\_wins}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01212}01212\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01216}\mbox{\hyperlink{game__task_8c_a49a6874590b30a62f04f7ca6d3efcf05}{01216}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a49a6874590b30a62f04f7ca6d3efcf05}{game\_get\_draws}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01217}01217\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01221}\mbox{\hyperlink{game__task_8c_aed140b5d1ea696aa8fcd53aacc2303a9}{01221}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aed140b5d1ea696aa8fcd53aacc2303a9}{game\_get\_total\_games}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01222}01222\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01226}\mbox{\hyperlink{game__task_8c_a870a53ed0d150a3c293bcbcb76986fb2}{01226}}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{game__task_8c_a870a53ed0d150a3c293bcbcb76986fb2}{game\_get\_game\_state\_string}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01227}01227\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01228}01228\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01229}01229\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Active"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01230}01230\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01231}01231\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Paused"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01232}01232\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01233}01233\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Finished"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01234}01234\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01235}01235\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Promotion"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01236}01236\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01237}01237\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Idle"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01238}01238\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01239}01239\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01240}01240\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01241}01241\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01242}01242\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01246}\mbox{\hyperlink{game__task_8c_a605e2e1374b4e7090941389e6a581a24}{01246}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a605e2e1374b4e7090941389e6a581a24}{game\_print\_game\_stats}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01247}01247\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01248}01248\ \ \ uint32\_t\ game\_duration\ =\ current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01249}01249\ \ \ uint32\_t\ minutes\ =\ game\_duration\ /\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01250}01250\ \ \ uint32\_t\ seconds\ =\ game\_duration\ \%\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01251}01251\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01252}01252\ \ \ \textcolor{comment}{//\ Calculate\ average\ time\ per\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01253}01253\ \ \ uint32\_t\ white\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01254}01254\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01255}01255\ \ \ uint32\_t\ black\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01256}01256\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01257}01257\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01258}01258\ \ \ \textcolor{comment}{//\ Get\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01259}01259\ \ \ \textcolor{keywordtype}{char}\ material\_str[32];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01260}01260\ \ \ \mbox{\hyperlink{game__task_8c_a13f42aca89279614ea9159dec44ae36c}{game\_get\_material\_string}}(material\_str,\ \textcolor{keyword}{sizeof}(material\_str));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01261}01261\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01262}01262\ \ \ \textcolor{comment}{//\ Print\ atmospheric\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01263}01263\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╔═══════════════════════════════╗"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01264}01264\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ ESP32\ CHESS\ v2.4\ ║"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01265}01265\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ Move\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ -\/\ \%s\ to\ play\ ║"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01266}01266\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01267}01267\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ Material:\ \%s\ ║"{}},\ material\_str);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01268}01268\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╚═══════════════════════════════╝"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01269}01269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01270}01270\ \ \ \textcolor{comment}{//\ Game\ duration\ and\ move\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01271}01271\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01272}01272\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Game\ duration:\ \%02"{}}\ PRIu32\ \textcolor{stringliteral}{"{}:\%02"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\ Move\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01273}01273\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ (\%s\ to\ play)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01274}01274\ \ \ \ \ \ \ \ \ \ \ \ minutes,\ seconds,\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01275}01275\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01276}01276\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01277}01277\ \ \ \textcolor{comment}{//\ Capture\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01278}01278\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Captures:\ White\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces,\ Black\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01279}01279\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}},\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01280}01280\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01281}01281\ \ \ \textcolor{comment}{//\ Check\ and\ castle\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01282}01282\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01283}01283\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Checks:\ White\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\ Black\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01284}01284\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ |\ Castles:\ White\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\ Black\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01285}01285\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01286}01286\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01287}01287\ \ \ \textcolor{comment}{//\ Material\ breakdown}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01288}01288\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01289}01289\ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01290}01290\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Material:\ White\ \%d\ points,\ Black\ \%d\ points\ (\%s)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01291}01291\ \ \ \ \ \ \ \ \ \ \ \ white\_material,\ black\_material,\ material\_str);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01292}01292\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01293}01293\ \ \ \textcolor{comment}{//\ Time\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01294}01294\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{timer\_enabled}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01295}01295\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01296}01296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Time\ per\ move:\ White\ avg\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}s,\ Black\ avg\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01297}01297\ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_avg\_time,\ black\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01298}01298\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01299}01299\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01300}01300\ \ \ \textcolor{comment}{//\ Draw\ detection\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01301}01301\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ >\ 30)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01302}01302\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01303}01303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ \ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves\ without\ capture\ (50-\/move\ rule\ approaching)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01304}01304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01305}01305\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01306}01306\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01307}01307\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{game\_is\_position\_repeated}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01308}01308\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Position\ repeated\ (potential\ draw\ by\ repetition)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01309}01309\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01310}01310\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01311}01311\ \ \ \textcolor{comment}{//\ Game\ save\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01312}01312\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01313}01313\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💾\ Game\ saved\ as:\ \%s"{}},\ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01314}01314\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01315}01315\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01316}01316\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}═══════════════════════════════"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01317}01317\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01318}01318\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01319}01319\ \textcolor{comment}{//\ Last\ move\ tracking\ for\ board\ display}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01320}\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{01320}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01321}\mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{01321}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01322}\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{01322}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01323}\mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{01323}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01324}\mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{01324}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01325}01325\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01326}01326\ \textcolor{comment}{//\ Captured\ pieces\ counter\ (removed\ -\/\ already\ declared\ above\ with\ char\ arrays)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01327}01327\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01328}01328\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01329}01329\ \textcolor{comment}{//\ ENHANCED\ MOVE\ VALIDATION\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01330}01330\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01331}01331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01332}01332\ \textcolor{comment}{//\ Tutorial\ mode\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01333}\mbox{\hyperlink{game__task_8c_a53e9e83a9003c07651e45d0f0c7cc594}{01333}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a53e9e83a9003c07651e45d0f0c7cc594}{tutorial\_mode\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01334}\mbox{\hyperlink{game__task_8c_afae0eab069ccc976d3057e2faaef476b}{01334}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_afae0eab069ccc976d3057e2faaef476b}{show\_hints}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01335}01335\ \textcolor{comment}{//\ Game\ analysis\ flags\ (for\ future\ use)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01336}01336\ \textcolor{comment}{//\ static\ bool\ show\_warnings\ =\ true;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01337}01337\ \textcolor{comment}{//\ static\ bool\ show\_analysis\ =\ true;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01338}01338\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01339}01339\ \textcolor{comment}{//\ Move\ analysis\ cache\ (for\ future\ use)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01340}01340\ \textcolor{comment}{//\ static\ move\_suggestion\_t\ move\_suggestions[100];}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01341}01341\ \textcolor{comment}{//\ static\ uint32\_t\ suggestion\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01342}01342\ \textcolor{comment}{//\ static\ uint32\_t\ last\_analysis\_time\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01343}01343\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01344}01344\ \textcolor{comment}{//\ Piece\ symbols\ for\ display\ (ASCII)\ -\/\ FIXED\ INDEXES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01345}\mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{01345}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[]\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01346}01346\ \ \ \ \ \textcolor{stringliteral}{"{}\ "{}},\ \textcolor{comment}{//\ 0:\ PIECE\_EMPTY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01347}01347\ \ \ \ \ \textcolor{stringliteral}{"{}p"{}},\ \textcolor{comment}{//\ 1:\ PIECE\_WHITE\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01348}01348\ \ \ \ \ \textcolor{stringliteral}{"{}n"{}},\ \textcolor{comment}{//\ 2:\ PIECE\_WHITE\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01349}01349\ \ \ \ \ \textcolor{stringliteral}{"{}b"{}},\ \textcolor{comment}{//\ 3:\ PIECE\_WHITE\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01350}01350\ \ \ \ \ \textcolor{stringliteral}{"{}r"{}},\ \textcolor{comment}{//\ 4:\ PIECE\_WHITE\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01351}01351\ \ \ \ \ \textcolor{stringliteral}{"{}q"{}},\ \textcolor{comment}{//\ 5:\ PIECE\_WHITE\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01352}01352\ \ \ \ \ \textcolor{stringliteral}{"{}k"{}},\ \textcolor{comment}{//\ 6:\ PIECE\_WHITE\_KING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01353}01353\ \ \ \ \ \textcolor{stringliteral}{"{}P"{}},\ \textcolor{comment}{//\ 7:\ PIECE\_BLACK\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01354}01354\ \ \ \ \ \textcolor{stringliteral}{"{}N"{}},\ \textcolor{comment}{//\ 8:\ PIECE\_BLACK\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01355}01355\ \ \ \ \ \textcolor{stringliteral}{"{}B"{}},\ \textcolor{comment}{//\ 9:\ PIECE\_BLACK\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01356}01356\ \ \ \ \ \textcolor{stringliteral}{"{}R"{}},\ \textcolor{comment}{//\ 10:\ PIECE\_BLACK\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01357}01357\ \ \ \ \ \textcolor{stringliteral}{"{}Q"{}},\ \textcolor{comment}{//\ 11:\ PIECE\_BLACK\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01358}01358\ \ \ \ \ \textcolor{stringliteral}{"{}K"{}}\ \ \textcolor{comment}{//\ 12:\ PIECE\_BLACK\_KING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01359}01359\ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01360}01360\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01361}01361\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01362}01362\ \textcolor{comment}{//\ GAME\ INITIALIZATION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01363}01363\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01364}01364\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01370}\mbox{\hyperlink{game__task_8c_a3534f1702346800f3c81568d62f497bc}{01370}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a3534f1702346800f3c81568d62f497bc}{game\_is\_board\_in\_starting\_position}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01371}01371\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][0]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][1]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01372}01372\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][2]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][3]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01373}01373\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][5]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01374}01374\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][6]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][7]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01375}01375\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01376}01376\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01377}01377\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01378}01378\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[1][col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01379}01379\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01380}01380\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01381}01381\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01382}01382\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 2;\ row\ <\ 6;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01383}01383\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01384}01384\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01385}01385\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01386}01386\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01387}01387\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01388}01388\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01389}01389\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01390}01390\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[6][col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01391}01391\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01392}01392\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01393}01393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01394}01394\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][0]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][1]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01395}01395\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][2]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][3]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01396}01396\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][5]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01397}01397\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][6]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}\ ||\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][7]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01398}01398\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01399}01399\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01400}01400\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01401}01401\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01402}01402\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01416}\mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{01416}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{game\_initialize\_board}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01417}01417\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Initializing\ enhanced\ chess\ board..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01418}01418\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01419}01419\ \ \ \textcolor{comment}{//\ Clear\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01420}01420\ \ \ memset(\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01421}01421\ \ \ memset(\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01422}01422\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01423}01423\ \ \ \textcolor{comment}{//\ Set\ up\ white\ pieces\ (bottom\ rank\ -\/\ row\ 1,\ index\ 0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01424}01424\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][0]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}};\ \ \ \textcolor{comment}{//\ a1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01425}01425\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][1]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}};\ \textcolor{comment}{//\ b1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01426}01426\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][2]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}};\ \textcolor{comment}{//\ c1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01427}01427\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][3]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}};\ \ \textcolor{comment}{//\ d1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01428}01428\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}};\ \ \ \textcolor{comment}{//\ e1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01429}01429\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][5]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}};\ \textcolor{comment}{//\ f1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01430}01430\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][6]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}};\ \textcolor{comment}{//\ g1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01431}01431\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][7]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}};\ \ \ \textcolor{comment}{//\ h1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01432}01432\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01433}01433\ \ \ \textcolor{comment}{//\ Set\ up\ white\ pawns\ (row\ 2,\ index\ 1)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01434}01434\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01435}01435\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[1][col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01436}01436\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01437}01437\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01438}01438\ \ \ \textcolor{comment}{//\ Rows\ 3-\/6\ (indices\ 2-\/5)\ remain\ empty}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01439}01439\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01440}01440\ \ \ \textcolor{comment}{//\ Set\ up\ black\ pawns\ (row\ 7,\ index\ 6)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01441}01441\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01442}01442\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[6][col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01443}01443\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01444}01444\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01445}01445\ \ \ \textcolor{comment}{//\ Set\ up\ black\ pieces\ (top\ rank\ -\/\ row\ 8,\ index\ 7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01446}01446\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][0]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};\ \ \ \textcolor{comment}{//\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01447}01447\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][1]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};\ \textcolor{comment}{//\ b8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01448}01448\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][2]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};\ \textcolor{comment}{//\ c8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01449}01449\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][3]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};\ \ \textcolor{comment}{//\ d8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01450}01450\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};\ \ \ \textcolor{comment}{//\ e8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01451}01451\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][5]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};\ \textcolor{comment}{//\ f8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01452}01452\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][6]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};\ \textcolor{comment}{//\ g8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01453}01453\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][7]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};\ \ \ \textcolor{comment}{//\ h8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01454}01454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01455}01455\ \ \ \textcolor{comment}{//\ Reset\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01456}01456\ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01457}01457\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01458}01458\ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01459}01459\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01460}01460\ \ \ \textcolor{comment}{//\ Reset\ castling\ flags\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01461}01461\ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01462}01462\ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01463}01463\ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01464}01464\ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01465}01465\ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01466}01466\ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01467}01467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01468}01468\ \ \ \textcolor{comment}{//\ Reset\ en\ passant\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01469}01469\ \ \ \textcolor{comment}{//\ en\_passant\_available\ =\ false;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01470}01470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01471}01471\ \ \ \textcolor{comment}{//\ Reset\ other\ counters\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01472}01472\ \ \ \textcolor{comment}{//\ fifty\_move\_counter\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01473}01473\ \ \ \textcolor{comment}{//\ position\_history\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01474}01474\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01475}01475\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Enhanced\ chess\ board\ initialized\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01476}01476\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01477}01477\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Initial\ position:\ White\ pieces\ at\ bottom,\ Black\ pieces\ at\ top"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01478}01478\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01479}01479\ \ \ \textcolor{comment}{//\ ✅\ Update\ promotion\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01480}01480\ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01481}01481\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01482}01482\ \ \ \textcolor{comment}{//\ Board\ will\ be\ displayed\ after\ all\ tasks\ are\ initialized}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01483}01483\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01484}01484\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01501}\mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{01501}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01502}01502\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Resetting\ game..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01503}01503\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01504}01504\ \ \ \textcolor{comment}{//\ Zastavit\ resignation\ timer\ pokud\ běží}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01505}01505\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01506}01506\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01507}01507\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01508}01508\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01509}01509\ \ \ \textcolor{comment}{//\ Reset\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01510}01510\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01511}01511\ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01512}01512\ \ \ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01513}01513\ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01514}01514\ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01515}01515\ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01516}01516\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01517}01517\ \ \ \textcolor{comment}{//\ Reset\ extended\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01518}01518\ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01519}01519\ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01520}01520\ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01521}01521\ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01522}01522\ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01523}01523\ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01524}01524\ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01525}01525\ \ \ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01526}01526\ \ \ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01527}01527\ \ \ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01528}01528\ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01529}01529\ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01530}01530\ \ \ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01531}01531\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01532}01532\ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ pro\ novou\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01533}01533\ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}};\ \textcolor{comment}{//\ ✅\ Reset\ endgame\ reason}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01534}01534\ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ Reset\ last\ move\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01535}01535\ \ \ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01536}01536\ \ \ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[0]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01537}01537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01538}01538\ \ \ \textcolor{comment}{//\ Clear\ move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01539}01539\ \ \ memset(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01540}01540\ \ \ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01541}01541\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01542}01542\ \ \ \textcolor{comment}{//\ Clear\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01543}01543\ \ \ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01544}01544\ \ \ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01545}01545\ \ \ \mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01546}01546\ \ \ \mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01547}01547\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01548}01548\ \ \ \textcolor{comment}{//\ Clear\ material\ advantage\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01549}01549\ \ \ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01550}01550\ \ \ memset(\mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01551}01551\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01552}01552\ \ \ \textcolor{comment}{//\ Clear\ last\ move\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01553}01553\ \ \ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01554}01554\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01555}01555\ \ \ \textcolor{comment}{//\ Kompletní\ reset\ error\ recovery\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01556}01556\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01557}01557\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01558}01558\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01559}01559\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01560}01560\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01561}01561\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01562}01562\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01563}01563\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01564}01564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01565}01565\ \ \ \textcolor{comment}{//\ Reset\ opponent\ piece\ recovery\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01566}01566\ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01567}01567\ \ \ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01568}01568\ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01569}01569\ \ \ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01570}01570\ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01571}01571\ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01572}01572\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01573}01573\ \ \ \textcolor{comment}{//\ Reset\ capture\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01574}01574\ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01575}01575\ \ \ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01576}01576\ \ \ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01577}01577\ \ \ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01578}01578\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01579}01579\ \ \ \textcolor{comment}{//\ Zastavit\ endgame\ animaci\ při\ resetu\ hry}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01580}01580\ \ \ \mbox{\hyperlink{led__task_8h_a081382ca7f7a773156291851fdbe6f5f}{led\_stop\_endgame\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01581}01581\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01582}01582\ \ \ \textcolor{comment}{//\ Reinitialize\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01583}01583\ \ \ \mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{game\_initialize\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01584}01584\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01585}01585\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ reset\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01586}01586\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01587}01587\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01603}\mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{01603}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{game\_start\_new\_game}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01604}01604\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Starting\ new\ game..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01605}01605\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01606}01606\ \ \ \textcolor{comment}{//\ Reset\ game}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01607}01607\ \ \ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01608}01608\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01609}01609\ \ \ \textcolor{comment}{//\ Reset\ timer\ před\ novou\ hrou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01610}01610\ \ \ \mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{game\_reset\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01611}01611\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ reset\ for\ new\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01612}01612\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01613}01613\ \ \ \textcolor{comment}{//\ Initialize\ enhanced\ castling\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01614}01614\ \ \ \mbox{\hyperlink{enhanced__castling__system_8c_a61f43ef55c76d2c5863819a96679f86d}{enhanced\_castling\_init}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01615}01615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01616}01616\ \ \ \textcolor{comment}{//\ Set\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01617}01617\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01618}01618\ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01619}01619\ \ \ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01620}01620\ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01621}01621\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01622}01622\ \ \ \textcolor{comment}{//\ Start\ timer\ for\ white\ player\ if\ time\ control\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01623}01623\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f01e5a8d282157e3cd8bd5a03b9c8b5}{game\_is\_timer\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01624}01624\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Starting\ timer\ for\ white\ player\ at\ game\ start"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01625}01625\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\textcolor{keyword}{true});\ \textcolor{comment}{//\ Start\ timer\ for\ white}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01626}01626\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01627}01627\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01628}01628\ \ \ \textcolor{comment}{//\ Initialize\ extended\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01629}01629\ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01630}01630\ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01631}01631\ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01632}01632\ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01633}01633\ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01634}01634\ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01635}01635\ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01636}01636\ \ \ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01637}01637\ \ \ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01638}01638\ \ \ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01639}01639\ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01640}01640\ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01641}01641\ \ \ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01642}01642\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01643}01643\ \ \ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01644}01644\ \ \ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[0]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01645}01645\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01646}01646\ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01647}01647\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01648}01648\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}New\ game\ started\ -\/\ White\ to\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01649}01649\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Total\ games:\ \%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01650}01650\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01651}01651\ \ \ \textcolor{comment}{//\ Zastavit\ všechny\ animace\ před\ novou\ hrou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01652}01652\ \ \ \mbox{\hyperlink{unified__animation__manager_8h_a00e3ed0913caba4f42ed8749b9e41d6f}{unified\_animation\_stop\_all}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01653}01653\ \ \ \mbox{\hyperlink{led__task_8h_a081382ca7f7a773156291851fdbe6f5f}{led\_stop\_endgame\_animation}}();\ \textcolor{comment}{//\ Legacy\ endgame\ animations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01654}01654\ \ \ \mbox{\hyperlink{game__led__animations_8c_ad8316144bc70b897342c47d341b52b5b}{stop\_endgame\_animation}}();\ \ \ \ \ \textcolor{comment}{//\ Stop\ NEW\ endgame\ animations\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01655}01655\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ All\ animations\ stopped\ for\ new\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01656}01656\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01657}01657\ \ \ \textcolor{comment}{//\ Update\ promotion\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01658}01658\ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01659}01659\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Updated\ promotion\ button\ LED\ indications"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01660}01660\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01661}01661\ \ \ \textcolor{comment}{//\ Zvýraznit\ pohyblivé\ figurky\ na\ začátku\ hry}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01662}01662\ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));\ \textcolor{comment}{//\ Krátká\ pauza\ pro\ stabilizaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01663}01663\ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01664}01664\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Highlighted\ movable\ pieces\ for\ starting\ player"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01665}01665\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01666}01666\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01667}01667\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01668}01668\ \textcolor{comment}{//\ BOARD\ UTILITY\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01669}01669\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01670}01670\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01671}\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{01671}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01672}01672\ \ \ \textcolor{keywordflow}{return}\ (row\ >=\ 0\ \&\&\ row\ <\ 8\ \&\&\ col\ >=\ 0\ \&\&\ col\ <\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01673}01673\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01674}01674\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01675}\mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{01675}}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01676}01676\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(row,\ col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01677}01677\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01678}01678\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01679}01679\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01680}01680\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01681}01681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01682}\mbox{\hyperlink{game__task_8c_a3fc7b98c71a5a479e4f1965cb8229074}{01682}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a3fc7b98c71a5a479e4f1965cb8229074}{game\_set\_piece}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01683}01683\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(row,\ col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01684}01684\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01685}01685\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01686}01686\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01687}01687\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01688}01688\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01689}\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{01689}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01690}01690\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(row,\ col)\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01691}01691\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01692}01692\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01693}\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{01693}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01694}01694\ \ \ \textcolor{keywordflow}{return}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01695}01695\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01696}01696\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01697}\mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{01697}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01698}01698\ \ \ \textcolor{keywordflow}{return}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01699}01699\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01700}01700\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01701}\mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{01701}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{game\_is\_same\_color}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece1,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01702}01702\ \ \ \textcolor{keywordflow}{if}\ (piece1\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ ||\ piece2\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01703}01703\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01704}01704\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01705}01705\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece1)\ \&\&\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece2))\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01706}01706\ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece1)\ \&\&\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece2));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01707}01707\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01708}01708\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01709}\mbox{\hyperlink{game__task_8c_a7f6d6a865d66f62cfe46e3e29212f872}{01709}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a7f6d6a865d66f62cfe46e3e29212f872}{game\_is\_opponent\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01710}01710\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01711}01711\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01712}01712\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01713}01713\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01714}01714\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01715}01715\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01716}01716\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01717}01717\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01718}01718\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01719}01719\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01720}01720\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01721}01721\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01722}01722\ \textcolor{comment}{//\ MOVE\ VALIDATION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01723}01723\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01724}01724\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01725}\mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{01725}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01726}01726\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01727}01727\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae99b00ccc116996ee3eb7886d97f72e1}{MOVE\_ERROR\_INVALID\_MOVE\_STRUCTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01728}01728\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01729}01729\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01730}01730\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01731}01731\ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01732}01732\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a0d51fa502a0284e356d4c196152a9165}{MOVE\_ERROR\_OUT\_OF\_BOUNDS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01733}01733\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01734}01734\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01735}01735\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01736}01736\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a98e7980c293506d89bac9ef4fae9e237}{MOVE\_ERROR\_GAME\_NOT\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01737}01737\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01738}01738\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01739}01739\ \ \ \textcolor{comment}{//\ Check\ if\ source\ position\ has\ a\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01740}01740\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ source\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01741}01741\ \ \ \textcolor{keywordflow}{if}\ (source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01742}01742\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01743}01743\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01744}01744\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01745}01745\ \ \ \textcolor{comment}{//\ Check\ if\ source\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01746}01746\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(source\_piece))\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01747}01747\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(source\_piece)))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01748}01748\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01749}01749\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01750}01750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01751}01751\ \ \ \textcolor{comment}{//\ Check\ if\ destination\ is\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01752}01752\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01753}01753\ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01754}01754\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{game\_is\_same\_color}}(source\_piece,\ dest\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01755}01755\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4dab65373947ddaa9d99838441f3fcff}{MOVE\_ERROR\_DESTINATION\_OCCUPIED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01756}01756\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01757}01757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01758}01758\ \ \ \textcolor{comment}{//\ Validate\ move\ based\ on\ piece\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01759}01759\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ piece\_error\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01760}01760\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(move,\ source\_piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01761}01761\ \ \ \textcolor{keywordflow}{if}\ (piece\_error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01762}01762\ \ \ \ \ \textcolor{keywordflow}{return}\ piece\_error;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01763}01763\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01764}01764\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01765}01765\ \ \ \textcolor{comment}{//\ KONTROLA\ ROŠÁDY\ V\ PROGRESS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01766}01766\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01767}01767\ \ \ \ \ \textcolor{comment}{//\ Očekáváme\ tah\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01768}01768\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01769}01769\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01770}01770\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling\ in\ progress\ -\/\ expected\ rook\ move\ from\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01771}01771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01772}01772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01773}01773\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};\ \textcolor{comment}{//\ Použijeme\ existující\ error\ code}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01774}01774\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01775}01775\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01776}01776\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01777}01777\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01778}01778\ \ \ \ \ \ \ ESP\_LOGE(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01779}01779\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Incorrect\ rook\ destination\ during\ castling\ -\/\ expected\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01780}01780\ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01781}01781\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};\ \textcolor{comment}{//\ Použijeme\ existující\ error\ code}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01782}01782\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01783}01783\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01784}01784\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Correct\ rook\ move\ for\ castling\ completion"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01785}01785\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01786}01786\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01787}01787\ \ \ \textcolor{comment}{//\ Check\ if\ move\ would\ leave\ king\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01788}01788\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{game\_would\_move\_leave\_king\_in\_check}}(move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01789}01789\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a1efb8e4fd12884711d5de2950e74f087}{MOVE\_ERROR\_KING\_IN\_CHECK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01790}01790\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01791}01791\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01792}01792\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01793}01793\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01794}01794\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01795}01795\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01796}\mbox{\hyperlink{game__task_8c_aefd2619f5dc787e72db00b8c24ecc405}{01796}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aefd2619f5dc787e72db00b8c24ecc405}{game\_is\_valid\_move\_bool}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01797}01797\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01798}01798\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01799}01799\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01800}\mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{01800}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01801}01801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01802}01802\ \ \ \textcolor{comment}{//\ int\ row\_diff\ =\ move-\/>to\_row\ -\/\ move-\/>from\_row;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01803}01803\ \ \ \textcolor{comment}{//\ int\ col\_diff\ =\ move-\/>to\_col\ -\/\ move-\/>from\_col;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01804}01804\ \ \ \textcolor{comment}{//\ int\ abs\_row\_diff\ =\ abs(row\_diff);}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01805}01805\ \ \ \textcolor{comment}{//\ int\ abs\_col\_diff\ =\ abs(col\_diff);}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01806}01806\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01807}01807\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01808}01808\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01809}01809\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01810}01810\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{game\_validate\_pawn\_move\_enhanced}}(move,\ piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01811}01811\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01812}01812\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01813}01813\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01814}01814\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{game\_validate\_knight\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01815}01815\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01816}01816\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01817}01817\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01818}01818\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01819}01819\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01820}01820\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01821}01821\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01822}01822\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01823}01823\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01824}01824\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01825}01825\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01826}01826\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{game\_validate\_queen\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01827}01827\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01828}01828\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01829}01829\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01830}01830\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{game\_validate\_king\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01831}01831\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01832}01832\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01833}01833\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01834}01834\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01835}01835\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01836}01836\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01837}01837\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01838}\mbox{\hyperlink{game__task_8c_ae7cbb1bf49cc0ab8394c2015b2adbaa1}{01838}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ae7cbb1bf49cc0ab8394c2015b2adbaa1}{game\_validate\_piece\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01839}01839\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(move,\ piece)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01840}01840\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01841}01841\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01866}\mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{01866}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{game\_validate\_pawn\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01867}01867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01868}01868\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01869}01869\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01870}01870\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01871}01871\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01872}01872\ \ \ \textcolor{keywordtype}{bool}\ is\_white\ =\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01873}01873\ \ \ \textcolor{keywordtype}{int}\ direction\ =\ is\_white\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01874}01874\ \ \ \textcolor{keywordtype}{int}\ start\_row\ =\ is\_white\ ?\ 1\ :\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01875}01875\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01876}01876\ \ \ \textcolor{comment}{//\ \ Logovani\ validace\ pesce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01877}01877\ \ \ \textcolor{keywordtype}{char}\ from\_sq[3],\ to\_sq[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01878}01878\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ from\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01879}01879\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01880}01880\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01881}01881\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01882}01882\ \ \ \textcolor{comment}{//\ Forward\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01883}01883\ \ \ \textcolor{keywordflow}{if}\ (col\_diff\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01884}01884\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ moving\ backwards\ (invalid\ for\ pawns)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01885}01885\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ *\ direction\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01886}01886\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ cannot\ move\ backwards"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01887}01887\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01888}01888\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01889}01889\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01890}01890\ \ \ \ \ \textcolor{comment}{//\ Single\ square\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01891}01891\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ direction\ \&\&\ \mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01892}01892\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01893}01893\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01894}01894\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01895}01895\ \ \ \ \ \textcolor{comment}{//\ Double\ square\ move\ from\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01896}01896\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ 2\ *\ direction\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ ==\ start\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01897}01897\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ direction,\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01898}01898\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01899}01899\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01900}01900\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01901}01901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01902}01902\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ path\ is\ blocked\ (pro\ oba\ bílé\ i\ černé\ pěšce)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01903}01903\ \ \ \ \ \textcolor{comment}{//\ Původně:\ if\ (row\_diff\ >\ 0\ ...)\ -\/\ fungovalo\ jen\ pro\ bílé}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01904}01904\ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(row\_diff)\ >\ 0\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01905}01905\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ direction,\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01906}01906\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Pawn\ \%s→\%s:\ forward\ blocked"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01907}01907\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01908}01908\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01909}01909\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01910}01910\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01911}01911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ Pawn\ \%s→\%s:\ invalid\ forward\ pattern\ (dest\ occupied\ or\ wrong\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01912}01912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}distance)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01913}01913\ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01914}01914\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01915}01915\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01916}01916\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01917}01917\ \ \ \textcolor{comment}{//\ Capture\ move\ (diagonal)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01918}01918\ \ \ \textcolor{keywordflow}{if}\ (abs\_col\_diff\ ==\ 1\ \&\&\ row\_diff\ ==\ direction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01919}01919\ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{game\_is\_same\_color}}(piece,\ dest\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01920}01920\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Pawn\ \%s→\%s:\ valid\ capture\ of\ \%s"{}},\ from\_sq,\ to\_sq,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01921}01921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01922}01922\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01923}01923\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01924}01924\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01925}01925\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01926}01926\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01927}01927\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Pawn\ \%s→\%s:\ valid\ en\ passant"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01928}01928\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01929}01929\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01930}01930\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01931}01931\ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01932}01932\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ diagonal\ to\ empty\ square\ (not\ en\ passant)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01933}01933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01934}01934\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01935}01935\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ trying\ to\ capture\ own\ piece"{}},\ from\_sq,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01936}01936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01937}01937\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01938}01938\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01939}01939\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01940}01940\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01941}01941\ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01942}01942\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ invalid\ move\ pattern\ (col\_diff=\%d,\ row\_diff=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01943}01943\ \ \ \ \ \ \ \ \ \ \ \ from\_sq,\ to\_sq,\ col\_diff,\ row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01944}01944\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01945}01945\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01946}01946\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01947}01947\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01948}\mbox{\hyperlink{game__task_8c_a9cd825eb0de3ca38648e5543dad28d45}{01948}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a9cd825eb0de3ca38648e5543dad28d45}{game\_validate\_pawn\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01949}01949\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{game\_validate\_pawn\_move\_enhanced}}(move,\ piece)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01950}01950\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01951}01951\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01952}\mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{01952}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{game\_validate\_knight\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01953}01953\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01954}01954\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01955}01955\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01956}01956\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01957}01957\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01958}01958\ \ \ \textcolor{comment}{//\ Knight\ moves\ in\ L-\/shape:\ 2\ squares\ in\ one\ direction,\ 1\ square\ perpendicular}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01959}01959\ \ \ \textcolor{keywordflow}{if}\ ((abs\_row\_diff\ ==\ 2\ \&\&\ abs\_col\_diff\ ==\ 1)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01960}01960\ \ \ \ \ \ \ (abs\_row\_diff\ ==\ 1\ \&\&\ abs\_col\_diff\ ==\ 2))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01961}01961\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01962}01962\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01963}01963\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01964}01964\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01965}01965\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01966}01966\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01967}01967\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01968}\mbox{\hyperlink{game__task_8c_a5d3594a8fc5be27b2309559f535ed67d}{01968}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a5d3594a8fc5be27b2309559f535ed67d}{game\_validate\_knight\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01969}01969\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{game\_validate\_knight\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01970}01970\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01971}01971\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01990}\mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{01990}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01991}01991\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01992}01992\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01993}01993\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01994}01994\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01995}01995\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01996}01996\ \ \ \textcolor{comment}{//\ Bishop\ moves\ diagonally}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01997}01997\ \ \ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ !=\ abs\_col\_diff)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01998}01998\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01999}01999\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02000}02000\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02001}02001\ \ \ \textcolor{comment}{//\ Check\ if\ path\ is\ blocked}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02002}02002\ \ \ \textcolor{comment}{//\ Původně:\ while\ (...\&\&\ ...)\ -\/\ končilo\ předčasně}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02003}02003\ \ \ \textcolor{comment}{//\ Nově:\ while\ (...||\ ...)\ -\/\ kontroluje\ až\ do\ cíle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02004}02004\ \ \ \textcolor{keywordtype}{int}\ row\_step\ =\ (row\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02005}02005\ \ \ \textcolor{keywordtype}{int}\ col\_step\ =\ (col\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02006}02006\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02007}02007\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02008}02008\ \ \ \textcolor{keywordtype}{int}\ current\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ +\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02009}02009\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02010}02010\ \ \ \textcolor{comment}{//\ SAFETY:\ Prevent\ infinite\ loop\ (max\ 8\ squares\ on\ diagonal)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02011}02011\ \ \ \textcolor{keywordtype}{int}\ steps\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02012}02012\ \ \ \textcolor{keywordflow}{while}\ ((\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ||\ current\_col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02013}02013\ \ \ \ \ \ \ \ \ \ steps\ <\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02014}02014\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}},\ current\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02015}02015\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Bishop\ blocked\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ current\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02016}02016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02017}02017\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02018}02018\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02019}02019\ \ \ \ \ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ +=\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02020}02020\ \ \ \ \ current\_col\ +=\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02021}02021\ \ \ \ \ steps++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02022}02022\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02023}02023\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02024}02024\ \ \ \textcolor{comment}{//\ Safety\ check:\ if\ loop\ ended\ without\ reaching\ target,\ something\ is\ wrong}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02025}02025\ \ \ \textcolor{keywordflow}{if}\ (steps\ >=\ 8\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02026}02026\ \ \ \ \ \ \ (\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ||\ current\_col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02027}02027\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Bishop\ validation\ error:\ loop\ exceeded\ max\ steps"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02028}02028\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02029}02029\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02030}02030\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02031}02031\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02032}02032\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02033}02033\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02034}02034\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02035}\mbox{\hyperlink{game__task_8c_a6d303839b2a0088558c5b56452232f4b}{02035}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a6d303839b2a0088558c5b56452232f4b}{game\_validate\_bishop\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02036}02036\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02037}02037\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02038}02038\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02039}\mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{02039}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02040}02040\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02041}02041\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02042}02042\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02043}02043\ \ \ \textcolor{comment}{//\ Rook\ moves\ horizontally\ or\ vertically}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02044}02044\ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ !=\ 0\ \&\&\ col\_diff\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02045}02045\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02046}02046\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02047}02047\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02048}02048\ \ \ \textcolor{comment}{//\ Check\ if\ path\ is\ blocked}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02049}02049\ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02050}02050\ \ \ \ \ \textcolor{comment}{//\ Horizontal\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02051}02051\ \ \ \ \ \textcolor{keywordtype}{int}\ col\_step\ =\ (col\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02052}02052\ \ \ \ \ \textcolor{keywordtype}{int}\ current\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ +\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02053}02053\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02054}02054\ \ \ \ \ \textcolor{keywordflow}{while}\ (current\_col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02055}02055\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ current\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02056}02056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02057}02057\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02058}02058\ \ \ \ \ \ \ current\_col\ +=\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02059}02059\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02060}02060\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02061}02061\ \ \ \ \ \textcolor{comment}{//\ Vertical\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02062}02062\ \ \ \ \ \textcolor{keywordtype}{int}\ row\_step\ =\ (row\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02063}02063\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02064}02064\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02065}02065\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02066}02066\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02067}02067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02068}02068\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02069}02069\ \ \ \ \ \ \ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ +=\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02070}02070\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02071}02071\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02072}02072\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02073}02073\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02074}02074\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02075}02075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02076}02076\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02077}\mbox{\hyperlink{game__task_8c_ad41adafacc7ea4384a6b7337ddea7299}{02077}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad41adafacc7ea4384a6b7337ddea7299}{game\_validate\_rook\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02078}02078\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02079}02079\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02080}02080\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02081}\mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{02081}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{game\_validate\_queen\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02082}02082\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02083}02083\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02084}02084\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02085}02085\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02086}02086\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02087}02087\ \ \ \textcolor{comment}{//\ Queen\ moves\ like\ rook\ (horizontally/vertically)\ or\ bishop\ (diagonally)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02088}02088\ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ 0\ ||\ col\_diff\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02089}02089\ \ \ \ \ \textcolor{comment}{//\ Rook-\/like\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02090}02090\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02091}02091\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ ==\ abs\_col\_diff)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02092}02092\ \ \ \ \ \textcolor{comment}{//\ Bishop-\/like\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02093}02093\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02094}02094\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02095}02095\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02096}02096\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02097}02097\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02098}02098\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02099}02099\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02100}\mbox{\hyperlink{game__task_8c_a29083b28e0ddc03048382e5c8e73c200}{02100}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a29083b28e0ddc03048382e5c8e73c200}{game\_validate\_queen\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02101}02101\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{game\_validate\_queen\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02102}02102\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02103}02103\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02120}\mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{02120}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{game\_validate\_king\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02121}02121\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02122}02122\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02123}02123\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02124}02124\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02125}02125\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02126}02126\ \ \ \textcolor{comment}{//\ King\ moves\ one\ square\ in\ any\ direction}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02127}02127\ \ \ \textcolor{comment}{//\ Musi\ se\ pohnout\ alespon\ o\ 1\ pole\ (ne\ 0,0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02128}02128\ \ \ \textcolor{comment}{//\ Puvodni:\ povoloval\ tah\ na\ stejne\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02129}02129\ \ \ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ <=\ 1\ \&\&\ abs\_col\_diff\ <=\ 1\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02130}02130\ \ \ \ \ \ \ (abs\_row\_diff\ >\ 0\ ||\ abs\_col\_diff\ >\ 0))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02131}02131\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02132}02132\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02133}02133\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02134}02134\ \ \ \textcolor{comment}{//\ Check\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02135}02135\ \ \ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ ==\ 0\ \&\&\ abs\_col\_diff\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02136}02136\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a7169001872522d780e6e67a15d86a47e}{game\_validate\_castling}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02137}02137\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02138}02138\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02139}02139\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02140}02140\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02141}02141\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02142}02142\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02143}\mbox{\hyperlink{game__task_8c_ab0a42f4f2685e64e790a1eb2a5df5530}{02143}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ab0a42f4f2685e64e790a1eb2a5df5530}{game\_validate\_king\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02144}02144\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{game\_validate\_king\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02145}02145\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02146}02146\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02164}\mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{02164}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{game\_would\_move\_leave\_king\_in\_check}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02165}02165\ \ \ \textcolor{keywordflow}{if}\ (!move)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02166}02166\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Safety\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02167}02167\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02168}02168\ \ \ \textcolor{comment}{//\ Save\ original\ board\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02169}02169\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_from\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02170}02170\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_to\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02171}02171\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02172}02172\ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ an\ en\ passant\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02173}02173\ \ \ \textcolor{keywordtype}{bool}\ is\_en\_passant\ =\ \mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02174}02174\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_en\_passant\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02175}02175\ \ \ uint8\_t\ en\_passant\_victim\_row\_local\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02176}02176\ \ \ uint8\_t\ en\_passant\_victim\_col\_local\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02177}02177\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02178}02178\ \ \ \textcolor{comment}{//\ If\ en\ passant,\ save\ the\ victim\ pawn\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02179}02179\ \ \ \textcolor{keywordflow}{if}\ (is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02180}02180\ \ \ \ \ original\_en\_passant\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02181}02181\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02182}02182\ \ \ \ \ en\_passant\_victim\_row\_local\ =\ \mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02183}02183\ \ \ \ \ en\_passant\_victim\_col\_local\ =\ \mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02184}02184\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ victim\ pawn\ for\ simulation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02185}02185\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02186}02186\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02187}02187\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02188}02188\ \ \ \textcolor{comment}{//\ Make\ the\ move\ temporarily}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02189}02189\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ original\_from\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02190}02190\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02191}02191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02192}02192\ \ \ \textcolor{comment}{//\ Determine\ which\ player's\ king\ to\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02193}02193\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02194}02194\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(original\_from\_piece))\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02195}02195\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02196}02196\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check\ after\ this\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02197}02197\ \ \ \textcolor{keywordtype}{bool}\ king\_in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02198}02198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02199}02199\ \ \ \textcolor{comment}{//\ Undo\ the\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02200}02200\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}]\ =\ original\_from\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02201}02201\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ original\_to\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02202}02202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02203}02203\ \ \ \textcolor{comment}{//\ Restore\ en\ passant\ victim\ if\ it\ was\ removed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02204}02204\ \ \ \textcolor{keywordflow}{if}\ (is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02205}02205\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[en\_passant\_victim\_row\_local][en\_passant\_victim\_col\_local]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02206}02206\ \ \ \ \ \ \ \ \ original\_en\_passant\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02207}02207\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02208}02208\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02209}02209\ \ \ \textcolor{keywordflow}{return}\ king\_in\_check;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02210}02210\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02211}02211\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02226}\mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{02226}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02227}02227\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02228}02228\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ no\ last\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02229}02229\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02230}02230\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02231}02231\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02232}02232\ \ \ \textcolor{comment}{//\ Check\ if\ the\ last\ move\ was\ a\ pawn\ moving\ two\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02233}02233\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ last\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}][\mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02234}02234\ \ \ \textcolor{keywordtype}{bool}\ last\_was\_pawn\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02235}02235\ \ \ \ \ \ \ (last\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ last\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02236}02236\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02237}02237\ \ \ \textcolor{keywordflow}{if}\ (!last\_was\_pawn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02238}02238\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ last\ move\ was\ not\ pawn"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02239}02239\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02240}02240\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02241}02241\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02242}02242\ \ \ \textcolor{comment}{//\ Check\ if\ last\ move\ was\ a\ double\ square\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02243}02243\ \ \ \textcolor{keywordtype}{int}\ last\_row\_diff\ =\ abs((\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ -\/\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02244}02244\ \ \ \textcolor{keywordflow}{if}\ (last\_row\_diff\ !=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02245}02245\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ last\ move\ was\ not\ 2\ squares\ (diff=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02246}02246\ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02247}02247\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02248}02248\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02249}02249\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02250}02250\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ útočící\ pěšec\ je\ na\ stejném\ řádku\ jako\ právě}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02251}02251\ \ \ \textcolor{comment}{//\ pohnutý\ pěšec}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02252}02252\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ !=\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02253}02253\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02254}02254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ attacking\ pawn\ not\ on\ same\ row\ (from\_row=\%d,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02255}02255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}last\_to\_row=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02256}02256\ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02257}02257\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02258}02258\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02259}02259\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02260}02260\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ útočící\ pěšec\ je\ přesně\ vedle\ právě\ pohnutého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02261}02261\ \ \ \textcolor{comment}{//\ pěšce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02262}02262\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ abs((\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ -\/\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02263}02263\ \ \ \textcolor{keywordflow}{if}\ (col\_diff\ !=\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02264}02264\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ pawn\ not\ adjacent\ (col\_diff=\%d)"{}},\ col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02265}02265\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02266}02266\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02267}02267\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02268}02268\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02269}02269\ \ \ \textcolor{comment}{//\ En\ passant\ pole\ je\ vždy\ uprostřed\ mezi\ from\ a\ to\ (prostý\ průměr)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02270}02270\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ =\ (\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ +\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}})\ /\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02271}02271\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02272}02272\ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02273}02273\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ En\ passant\ check:\ last=\%c\%d→\%c\%d,\ target=\%c\%d,\ move=\%c\%d→\%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02274}02274\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}},\ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02275}02275\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}},\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02276}02276\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02277}02277\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02278}02278\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02279}02279\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02280}02280\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02281}02281\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ En\ passant\ VALID!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02282}02282\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02283}02283\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02284}02284\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02285}02285\ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02286}02286\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ En\ passant:\ target\ mismatch\ (to\_row=\%d\ vs\ target=\%d,\ to\_col=\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02287}02287\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}vs\ last\_col=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02288}02288\ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02289}02289\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02290}02290\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02291}02291\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02314}\mbox{\hyperlink{game__task_8c_a7169001872522d780e6e67a15d86a47e}{02314}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a7169001872522d780e6e67a15d86a47e}{game\_validate\_castling}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02315}02315\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02316}02316\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae99b00ccc116996ee3eb7886d97f72e1}{MOVE\_ERROR\_INVALID\_MOVE\_STRUCTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02317}02317\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02318}02318\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02319}02319\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02320}02320\ \ \ \textcolor{keywordtype}{bool}\ is\_white\ =\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02321}02321\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02322}02322\ \ \ \textcolor{comment}{//\ Check\ if\ it's\ a\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02323}02323\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02324}02324\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02325}02325\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02326}02326\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02327}02327\ \ \ \textcolor{comment}{//\ Check\ if\ king\ has\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02328}02328\ \ \ \textcolor{keywordflow}{if}\ ((is\_white\ \&\&\ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}})\ ||\ (!is\_white\ \&\&\ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02329}02329\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ king\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02330}02330\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02331}02331\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02332}02332\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02333}02333\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02334}02334\ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ is\_white\ ?\ 0\ :\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02335}02335\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ !=\ king\_row\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ !=\ 4)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02336}02336\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ king\ not\ in\ starting\ position"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02337}02337\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02338}02338\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02339}02339\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02340}02340\ \ \ \textcolor{comment}{//\ Determine\ castling\ direction}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02341}02341\ \ \ \textcolor{keywordtype}{bool}\ is\_kingside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ 6);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02342}02342\ \ \ \textcolor{keywordtype}{bool}\ is\_queenside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02343}02343\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02344}02344\ \ \ \textcolor{keywordflow}{if}\ (!is\_kingside\ \&\&\ !is\_queenside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02345}02345\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02346}02346\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02347}02347\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02348}02348\ \ \ \textcolor{comment}{//\ Determine\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02349}02349\ \ \ \textcolor{keywordtype}{int}\ rook\_col\ =\ is\_kingside\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02350}02350\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02351}02351\ \ \ \textcolor{comment}{//\ Check\ if\ rook\ exists\ at\ expected\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02352}02352\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ expected\_rook\ =\ is\_white\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02353}02353\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ rook\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][rook\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02354}02354\ \ \ \textcolor{keywordflow}{if}\ (rook\_piece\ !=\ expected\_rook)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02355}02355\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ rook\ not\ found\ at\ expected\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02356}02356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ rook\_col,\ king\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02357}02357\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02358}02358\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02359}02359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02360}02360\ \ \ \textcolor{comment}{//\ Check\ if\ corresponding\ rook\ has\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02361}02361\ \ \ \textcolor{keywordflow}{if}\ (is\_white)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02362}02362\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside\ \&\&\ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02363}02363\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ kingside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02364}02364\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02365}02365\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02366}02366\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_queenside\ \&\&\ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02367}02367\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ queenside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02368}02368\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02369}02369\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02370}02370\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02371}02371\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside\ \&\&\ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02372}02372\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ kingside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02373}02373\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02374}02374\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02375}02375\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_queenside\ \&\&\ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02376}02376\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ queenside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02377}02377\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02378}02378\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02379}02379\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02380}02380\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02381}02381\ \ \ \textcolor{comment}{//\ Check\ if\ squares\ between\ king\ and\ rook\ are\ empty}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02382}02382\ \ \ \textcolor{comment}{//\ rook\_col\ již\ definováno\ výše}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02383}02383\ \ \ \textcolor{keywordtype}{int}\ start\_col\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02384}02384\ \ \ \ \ \ \ (move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ <\ rook\_col)\ ?\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ +\ 1\ :\ rook\_col\ +\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02385}02385\ \ \ \textcolor{keywordtype}{int}\ end\_col\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ <\ rook\_col)\ ?\ rook\_col\ :\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02386}02386\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02387}02387\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ start\_col;\ col\ <\ end\_col;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02388}02388\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(king\_row,\ col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02389}02389\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02390}02390\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02391}02391\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02392}02392\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02393}02393\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ currently\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02394}02394\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(is\_white\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02395}02395\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02396}02396\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02397}02397\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02398}02398\ \ \ \textcolor{comment}{//\ Check\ if\ king\ would\ move\ through\ check\ or\ end\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02399}02399\ \ \ \textcolor{keywordtype}{int}\ step\ =\ is\_kingside\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02400}02400\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};\ col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ +\ step;\ col\ +=\ step)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02401}02401\ \ \ \ \ \textcolor{keywordflow}{if}\ (col\ ==\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02402}02402\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};\ \textcolor{comment}{//\ Skip\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02403}02403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02404}02404\ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ to\ test\ this\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02405}02405\ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02406}02406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02407}02407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02408}02408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02409}02409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02410}02410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02411}02411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02412}02412\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02413}02413\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{game\_would\_move\_leave\_king\_in\_check}}(\&temp\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02414}02414\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02415}02415\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02416}02416\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02417}02417\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02418}02418\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02419}02419\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02420}02420\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02421}02421\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02422}02422\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02423}02423\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02424}02424\ \textcolor{comment}{//\ ERROR\ FORMATTING\ HELPER}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02425}02425\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02426}02426\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02438}\mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{02438}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *label,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *fmt,\ ...)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02439}02439\ \ \ va\_list\ args;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02440}02440\ \ \ \textcolor{keywordtype}{char}\ buffer[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02441}02441\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02442}02442\ \ \ va\_start(args,\ fmt);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02443}02443\ \ \ vsnprintf(buffer,\ \textcolor{keyword}{sizeof}(buffer),\ fmt,\ args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02444}02444\ \ \ va\_end(args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02445}02445\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02446}02446\ \ \ \textcolor{comment}{//\ Format\ based\ on\ label\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02447}02447\ \ \ \textcolor{keywordflow}{if}\ (strcmp(label,\ \textcolor{stringliteral}{"{}Reason"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02448}02448\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a7f026776e12ac1b5e7736c24b756085d}{ANSI\_RED}}\ \textcolor{stringliteral}{"{}\ \ \ •\ \%s:\ "{}}\ \mbox{\hyperlink{game__colors_8h_a46587b83544b8e9be045bb93f644ac82}{ANSI\_BOLD}}\ \textcolor{stringliteral}{"{}\%s"{}}\ \mbox{\hyperlink{game__colors_8h_af77a445894f2f750d43cf2182cd29e55}{ANSI\_RESET}}\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ label,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02449}02449\ \ \ \ \ \ \ \ \ \ \ \ buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02450}02450\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcmp(label,\ \textcolor{stringliteral}{"{}Hint"{}})\ ==\ 0\ ||\ strcmp(label,\ \textcolor{stringliteral}{"{}Solution"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02451}02451\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a3bfaa4ef17d08f922b975ab28af9b499}{FMT\_HINT}}(\textcolor{stringliteral}{"{}\ \ \ •\ \%s:\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ label,\ buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02452}02452\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02453}02453\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ \%s:\ \%s\(\backslash\)r\(\backslash\)n"{}},\ label,\ buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02454}02454\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02455}02455\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02456}02456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02476}\mbox{\hyperlink{game__task_8c_a8d2513928ede14f22023e22c775c3033}{02476}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8d2513928ede14f22023e22c775c3033}{game\_display\_move\_error}}(\mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02477}02477\ \ \ \textcolor{keywordtype}{char}\ from\_square[3],\ to\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02478}02478\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02479}02479\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02480}02480\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02481}02481\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name\ =\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02482}02482\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *player\_name\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02483}02483\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02484}02484\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ source\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02485}02485\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02486}02486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02487}02487\ \ \ \textcolor{comment}{//\ Enhanced\ error\ messages\ with\ colors\ and\ detailed\ reasoning}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02488}02488\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02489}02489\ \ \ printf(\mbox{\hyperlink{game__colors_8h_a60d4e1d55cc7102123ffe5c3539ec165}{FMT\_ERROR}}(\textcolor{stringliteral}{"{}❌\ INVALID\ MOVE!"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02490}02490\ \ \ printf(\mbox{\hyperlink{game__colors_8h_abd9912e75415821ab3192e7cf4542b6d}{FMT\_INFO}}(\textcolor{stringliteral}{"{}\ \ \ •\ Move:\ \%s\ →\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02491}02491\ \ \ printf(\mbox{\hyperlink{game__colors_8h_abd9912e75415821ab3192e7cf4542b6d}{FMT\_INFO}}(\textcolor{stringliteral}{"{}\ \ \ •\ Piece:\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02492}02492\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02493}02493\ \ \ \textcolor{keywordflow}{switch}\ (error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02494}02494\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02495}02495\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}No\ piece\ at\ \%s"{}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02496}02496\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Choose\ a\ square\ with\ your\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02497}02497\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02498}02498\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02499}02499\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02500}02500\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}\%s\ cannot\ move\ \%s's\ piece"{}},\ player\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02501}02501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02502}02502\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Move\ only\ your\ own\ pieces"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02503}02503\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02504}02504\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02505}02505\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02506}02506\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Path\ from\ \%s\ to\ \%s\ is\ blocked"{}},\ from\_square,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02507}02507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02508}02508\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}Another\ piece\ is\ blocking\ the\ way"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02509}02509\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02510}02510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Clear\ the\ path\ or\ choose\ different\ destination"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02511}02511\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02512}02512\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02513}02513\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02514}02514\ \ \ \ \ \textcolor{comment}{//\ VYLEPŠENÉ\ REASONING\ pro\ pěšce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02515}02515\ \ \ \ \ \textcolor{keywordflow}{if}\ (source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02516}02516\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ abs((\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02517}02517\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_diagonal\ =\ (col\_diff\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02518}02518\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02519}02519\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_diagonal\ \&\&\ dest\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02520}02520\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02521}02521\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Reason"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02522}02522\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Pawn\ can\ only\ capture\ diagonally\ when\ enemy\ piece\ is\ present"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02523}02523\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02524}02524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Square\ \%s\ is\ empty\ -\/\ pawns\ cannot\ move\ diagonally\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02525}02525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}to\ empty\ squares"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02526}02526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02527}02527\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02528}02528\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02529}02529\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Move\ pawn\ forward\ or\ capture\ diagonally\ where\ enemy\ piece\ is"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02530}02530\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!is\_diagonal\ \&\&\ dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02531}02531\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Pawn\ cannot\ capture\ straight\ ahead"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02532}02532\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02533}02533\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}Square\ \%s\ is\ occupied\ -\/\ pawns\ can\ only\ capture\ diagonally"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02534}02534\ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02535}02535\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02536}02536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Capture\ the\ piece\ diagonally,\ not\ forward"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02537}02537\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02538}02538\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Pawn\ cannot\ move\ in\ this\ pattern"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02539}02539\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}Pawns\ move\ forward\ 1\ square\ (or\ 2\ from\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02540}02540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}start),\ capture\ diagonally"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02541}02541\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Follow\ pawn\ movement\ rules"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02542}02542\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02543}02543\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02544}02544\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}\%s\ cannot\ move\ from\ \%s\ to\ \%s"{}},\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02545}02545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02546}02546\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Follow\ the\ piece's\ movement\ rules"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02547}02547\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02548}02548\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02549}02549\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02550}02550\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a1efb8e4fd12884711d5de2950e74f087}{MOVE\_ERROR\_KING\_IN\_CHECK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02551}02551\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02552}02552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}This\ move\ would\ leave/keep\ your\ king\ in\ check"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02553}02553\ \ \ \ \ \textcolor{comment}{//\ Find\ and\ display\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02554}02554\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a3bfaa4ef17d08f922b975ab28af9b499}{FMT\_HINT}}(\textcolor{stringliteral}{"{}\ \ \ •\ Hint:\ Your\ king\ at\ "{}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02555}02555\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02556}02556\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02557}02557\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ r\ =\ 0;\ r\ <\ 8;\ r++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02558}02558\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ c\ =\ 0;\ c\ <\ 8;\ c++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02559}02559\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[r][c]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02560}02560\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ king\_sq[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02561}02561\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(r,\ c,\ king\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02562}02562\ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s\ would\ be\ under\ attack\(\backslash\)r\(\backslash\)n"{}},\ king\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02563}02563\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ king\_found;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02564}02564\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02565}02565\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02566}02566\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02567}02567\ \ \ \ \ printf(\textcolor{stringliteral}{"{}is\ under\ attack\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02568}02568\ \ \ king\_found:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02569}02569\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02570}02570\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02571}02571\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Protect\ your\ king\ by\ blocking,\ capturing\ attacker,\ or\ moving\ king"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02572}02572\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02573}02573\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02574}02574\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02575}02575\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Castling\ is\ not\ allowed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02576}02576\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02577}02577\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}King/Rook\ moved,\ squares\ under\ attack,\ or\ path\ blocked"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02578}02578\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02579}02579\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Castling\ requires\ unmoved\ king\ and\ rook\ with\ clear\ path"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02580}02580\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02581}02581\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02582}02582\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ac71919eb046ab42ba1e6a622b914863a}{MOVE\_ERROR\_EN\_PASSANT\_INVALID}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02583}02583\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}En\ passant\ is\ not\ possible\ here"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02584}02584\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}En\ passant\ only\ works\ immediately\ after\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02585}02585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}opponent's\ 2-\/square\ pawn\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02586}02586\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Capture\ normally\ or\ make\ different\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02587}02587\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02588}02588\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02589}02589\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4dab65373947ddaa9d99838441f3fcff}{MOVE\_ERROR\_DESTINATION\_OCCUPIED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02590}02590\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Destination\ \%s\ is\ occupied\ by\ your\ own\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02591}02591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square,\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02592}02592\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}You\ cannot\ capture\ your\ own\ pieces"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02593}02593\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02594}02594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Choose\ empty\ square\ or\ capture\ opponent's\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02595}02595\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02596}02596\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02597}02597\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a0d51fa502a0284e356d4c196152a9165}{MOVE\_ERROR\_OUT\_OF\_BOUNDS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02598}02598\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Coordinates\ are\ out\ of\ board\ bounds"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02599}02599\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Use\ valid\ chess\ notation\ (a1-\/h8)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02600}02600\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02601}02601\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02602}02602\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a98e7980c293506d89bac9ef4fae9e237}{MOVE\_ERROR\_GAME\_NOT\_ACTIVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02603}02603\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Game\ is\ not\ active"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02604}02604\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02605}02605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Start\ a\ new\ game\ first\ (use\ GAME\_NEW\ command)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02606}02606\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02607}02607\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02608}02608\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae99b00ccc116996ee3eb7886d97f72e1}{MOVE\_ERROR\_INVALID\_MOVE\_STRUCTURE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02609}02609\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Move\ structure\ is\ invalid"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02610}02610\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02611}02611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Use\ proper\ move\ format\ (e.g.,\ e2e4\ or\ e2-\/e4)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02612}02612\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02613}02613\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02614}02614\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02615}02615\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Unknown\ error\ occurred\ (code:\ \%d)"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02616}02616\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Try\ a\ different\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02617}02617\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02618}02618\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02619}02619\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02620}02620\ \ \ \textcolor{comment}{//\ Zobrazit\ stav\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02621}02621\ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02622}02622\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a4c5526bcd50bcf745bcbebcd4bc1b1e4}{FMT\_DATA}}(\textcolor{stringliteral}{"{}\ \ \ •\ Target:\ \%s\ at\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02623}02623\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece),\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02624}02624\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02625}02625\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a4c5526bcd50bcf745bcbebcd4bc1b1e4}{FMT\_DATA}}(\textcolor{stringliteral}{"{}\ \ \ •\ Target:\ Empty\ square\ at\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02626}02626\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02627}02627\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02628}02628\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02629}02629\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02630}02630\ \ \ \textcolor{comment}{//\ Show\ helpful\ suggestions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02631}02631\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a53e9e83a9003c07651e45d0f0c7cc594}{tutorial\_mode\_active}}\ \&\&\ \mbox{\hyperlink{game__task_8c_afae0eab069ccc976d3057e2faaef476b}{show\_hints}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02632}02632\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6e5f0e6f61004c63b6da0114e626c68b}{game\_show\_move\_suggestions}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02633}02633\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02634}02634\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02635}02635\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02641}\mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{02641}}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02642}02642\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02643}02643\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02644}02644\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Empty"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02645}02645\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02646}02646\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Pawn"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02647}02647\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02648}02648\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02649}02649\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02650}02650\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02651}02651\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02652}02652\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02653}02653\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02654}02654\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02655}02655\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02656}02656\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02657}02657\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02658}02658\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Pawn"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02659}02659\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02660}02660\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02661}02661\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02662}02662\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02663}02663\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02664}02664\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02665}02665\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02666}02666\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02667}02667\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02668}02668\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02669}02669\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02670}02670\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02671}02671\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02672}02672\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02673}02673\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02674}02674\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02675}02675\ \textcolor{comment}{//\ STRING\ BUILDING\ HELPER}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02676}02676\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02677}02677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02691}\mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{02691}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{int}\ pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02692}02692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02693}02693\ \ \ \textcolor{comment}{//\ Pridat\ separator\ pokud\ uz\ neco\ v\ bufferu\ je}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02694}02694\ \ \ \textcolor{keywordflow}{if}\ (pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02695}02695\ \ \ \ \ pos\ +=\ snprintf(buffer\ +\ pos,\ size\ -\/\ pos,\ \textcolor{stringliteral}{"{},\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02696}02696\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02697}02697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02698}02698\ \ \ \textcolor{comment}{//\ Pridat\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02699}02699\ \ \ pos\ +=\ snprintf(buffer\ +\ pos,\ size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\%s"{}},\ square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02700}02700\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02701}02701\ \ \ \textcolor{keywordflow}{return}\ pos;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02702}02702\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02703}02703\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02709}\mbox{\hyperlink{game__task_8c_a6e5f0e6f61004c63b6da0114e626c68b}{02709}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6e5f0e6f61004c63b6da0114e626c68b}{game\_show\_move\_suggestions}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02710}02710\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02711}02711\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02712}02712\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Hint:\ No\ piece\ at\ this\ position"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02713}02713\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02714}02714\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02715}02715\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02716}02716\ \ \ \textcolor{comment}{//\ Get\ available\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02717}02717\ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[50];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02718}02718\ \ \ uint32\_t\ count\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 50);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02719}02719\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02720}02720\ \ \ \textcolor{keywordflow}{if}\ (count\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02721}02721\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02722}02722\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(row,\ col,\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02723}02723\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Hint:\ \%s\ at\ \%s\ has\ no\ legal\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02724}02724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(piece),\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02725}02725\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02726}02726\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02727}02727\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02728}02728\ \ \ \textcolor{keywordtype}{char}\ from\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02729}02729\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(row,\ col,\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02730}02730\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Hint:\ \%s\ at\ \%s\ can\ move\ to:"{}},\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(piece),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02731}02731\ \ \ \ \ \ \ \ \ \ \ \ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02732}02732\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02733}02733\ \ \ \textcolor{comment}{//\ Group\ moves\ by\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02734}02734\ \ \ \textcolor{keywordtype}{char}\ normal\_moves[128]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02735}02735\ \ \ \textcolor{keywordtype}{char}\ capture\_moves[128]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02736}02736\ \ \ \textcolor{keywordtype}{char}\ special\_moves[128]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02737}02737\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02738}02738\ \ \ \textcolor{keywordtype}{int}\ normal\_pos\ =\ 0,\ capture\_pos\ =\ 0,\ special\_pos\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02739}02739\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02740}02740\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ count\ \&\&\ i\ <\ 20;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02741}02741\ \ \ \ \ \ \ \ i++)\ \{\ \textcolor{comment}{//\ Limit\ to\ 20\ moves\ for\ display}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02742}02742\ \ \ \ \ \textcolor{keywordtype}{char}\ to\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02743}02743\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(suggestions[i].to\_row,\ suggestions[i].to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02744}02744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02745}02745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02746}02746\ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[i].is\_capture)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02747}02747\ \ \ \ \ \ \ capture\_pos\ =\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(capture\_moves,\ \textcolor{keyword}{sizeof}(capture\_moves),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02748}02748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ capture\_pos,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02749}02749\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (suggestions[i].is\_castling\ ||\ suggestions[i].is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02750}02750\ \ \ \ \ \ \ special\_pos\ =\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(special\_moves,\ \textcolor{keyword}{sizeof}(special\_moves),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02751}02751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ special\_pos,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02752}02752\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02753}02753\ \ \ \ \ \ \ normal\_pos\ =\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(normal\_moves,\ \textcolor{keyword}{sizeof}(normal\_moves),\ normal\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02754}02754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02755}02755\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02756}02756\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02757}02757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02758}02758\ \ \ \textcolor{keywordflow}{if}\ (normal\_pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02759}02759\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Normal\ moves:\ \%s"{}},\ normal\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02760}02760\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02761}02761\ \ \ \textcolor{keywordflow}{if}\ (capture\_pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02762}02762\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Capture\ moves:\ \%s"{}},\ capture\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02763}02763\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02764}02764\ \ \ \textcolor{keywordflow}{if}\ (special\_pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02765}02765\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Special\ moves:\ \%s"{}},\ special\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02766}02766\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02767}02767\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02768}02768\ \ \ \textcolor{keywordflow}{if}\ (count\ >\ 20)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02769}02769\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ ...\ and\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ more\ moves"{}},\ count\ -\/\ 20);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02770}02770\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02771}02771\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02772}02772\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02781}\mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{02781}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(uint8\_t\ row,\ uint8\_t\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02782}02782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ *suggestions,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02783}02783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ max\_suggestions)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02784}02784\ \ \ \textcolor{keywordflow}{if}\ (suggestions\ ==\ NULL\ ||\ max\_suggestions\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02785}02785\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02786}02786\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02787}02787\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02788}02788\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02789}02789\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02790}02790\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02791}02791\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02792}02792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02793}02793\ \ \ uint32\_t\ count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02794}02794\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02795}02795\ \ \ \textcolor{comment}{//\ Optimized\ move\ generation\ based\ on\ piece\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02796}02796\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02797}02797\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02798}02798\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02799}02799\ \ \ \ \ \textcolor{comment}{//\ Knight\ moves\ in\ L-\/shape:\ 8\ possible\ positions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02800}02800\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8\ \&\&\ count\ <\ max\_suggestions;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02801}02801\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ row\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02802}02802\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ col\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02803}02803\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02804}02804\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02805}02805\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02806}02806\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02807}02807\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02808}02808\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02809}02809\ \ \ \ \ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02810}02810\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02811}02811\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ if\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02812}02812\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02813}02813\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02814}02814\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02815}02815\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02816}02816\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02817}02817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02818}02818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02819}02819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02820}02820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02821}02821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ target,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02822}02822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02823}02823\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02824}02824\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ move\ is\ valid\ (including\ check\ validation)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02825}02825\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&temp\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02826}02826\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02827}02827\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a940eca031248f8df49031c483af30f13}{from\_row}}\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02828}02828\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a5805172608c1e85601ee674644b69fe7}{from\_col}}\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02829}02829\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02830}02830\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02831}02831\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a95bfdc4963cc77122f941663554a8a67}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02832}02832\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =\ (target\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02833}02833\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a39763b8b278db010f5dfff7a4beb264a}{is\_check}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ TODO:\ Implement\ check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02834}02834\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_aa9a5da748efa93feb7e3f7c4f06e7839}{is\_castling}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02835}02835\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a77114011b2edb38b0218c36ce67cf0e6}{is\_en\_passant}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02836}02836\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a96c798a72d6ed66a18c8b2d1e840e604}{score}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02837}02837\ \ \ \ \ \ \ \ \ count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02838}02838\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02839}02839\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02840}02840\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02841}02841\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02842}02842\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02843}02843\ \ \ \ \ \textcolor{comment}{//\ For\ other\ pieces,\ use\ the\ original\ method\ (less\ efficient\ but\ works)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02844}02844\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_row\ =\ 0;\ to\_row\ <\ 8\ \&\&\ count\ <\ max\_suggestions;\ to\_row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02845}02845\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_col\ =\ 0;\ to\_col\ <\ 8\ \&\&\ count\ <\ max\_suggestions;\ to\_col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02846}02846\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ same\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02847}02847\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ row\ \&\&\ to\_col\ ==\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02848}02848\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02849}02849\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02850}02850\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02851}02851\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02852}02852\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02853}02853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02854}02854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02855}02855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02856}02856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02857}02857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02858}02858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02859}02859\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02860}02860\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ move\ is\ valid}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02861}02861\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&temp\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02862}02862\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02863}02863\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ to\ suggestions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02864}02864\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a940eca031248f8df49031c483af30f13}{from\_row}}\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02865}02865\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a5805172608c1e85601ee674644b69fe7}{from\_col}}\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02866}02866\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02867}02867\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02868}02868\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a95bfdc4963cc77122f941663554a8a67}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02869}02869\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02870}02870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02871}02871\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a39763b8b278db010f5dfff7a4beb264a}{is\_check}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02872}02872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false};\ \textcolor{comment}{//\ TODO:\ Implement\ check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02873}02873\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02874}02874\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Detect\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02875}02875\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_aa9a5da748efa93feb7e3f7c4f06e7839}{is\_castling}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02876}02876\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02877}02877\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (abs((\textcolor{keywordtype}{int})to\_col\ -\/\ (\textcolor{keywordtype}{int})col)\ ==\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02878}02878\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02879}02879\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Detect\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02880}02880\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a77114011b2edb38b0218c36ce67cf0e6}{is\_en\_passant}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02881}02881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(\&temp\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02882}02882\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02883}02883\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ capture\ flag\ for\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02884}02884\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[count].is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02885}02885\ \ \ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02886}02886\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02887}02887\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02888}02888\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a96c798a72d6ed66a18c8b2d1e840e604}{score}}\ =\ 0;\ \textcolor{comment}{//\ TODO:\ Implement\ move\ scoring}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02889}02889\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02890}02890\ \ \ \ \ \ \ \ \ \ \ count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02891}02891\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02892}02892\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02893}02893\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02894}02894\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02895}02895\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02896}02896\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02897}02897\ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02898}02898\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02899}02899\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02900}02900\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02901}02901\ \textcolor{comment}{//\ GAME\ STATE\ VARIABLES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02902}02902\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02903}02903\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02904}02904\ \textcolor{comment}{//\ Fifty-\/move\ rule\ counter}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02905}\mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{02905}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02906}02906\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02907}02907\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02908}02908\ \textcolor{comment}{//\ MOVE\ EXECUTION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02909}02909\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02910}02910\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02914}\mbox{\hyperlink{game__task_8c_a5d48aea6f905097dca8c53e1c2a057b1}{02914}}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a5d48aea6f905097dca8c53e1c2a057b1}{game\_analyze\_position}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02915}02915\ \ \ \textcolor{keywordtype}{bool}\ king\_in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02916}02916\ \ \ uint32\_t\ legal\_moves\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02917}02917\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02918}02918\ \ \ \textcolor{keywordflow}{if}\ (legal\_moves\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02919}02919\ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02920}02920\ \ \ \ \ \ \ \textcolor{comment}{//\ Checkmate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02921}02921\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02922}02922\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ result\_type\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02923}02923\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}\ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02924}02924\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ result\_type;\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02925}02925\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(result\_type);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02926}02926\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(result\_type);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02927}02927\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE!\ \%s\ wins!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02928}02928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02929}02929\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02930}02930\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02931}02931\ \ \ \ \ \ \ \textcolor{comment}{//\ Stalemate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02932}02932\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02933}02933\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}};\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02934}02934\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02935}02935\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02936}02936\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ STALEMATE!\ Game\ drawn!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02937}02937\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02938}02938\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02939}02939\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02940}02940\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02941}02941\ \ \ \textcolor{comment}{//\ Check\ for\ fifty-\/move\ rule}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02942}02942\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}\ >=\ 100)\ \{\ \textcolor{comment}{//\ 50\ moves\ per\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02943}02943\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02944}02944\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}};\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02945}02945\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02946}02946\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02947}02947\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Fifty-\/move\ rule!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02948}02948\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02949}02949\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02950}02950\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02951}02951\ \ \ \textcolor{comment}{//\ Check\ for\ insufficient\ material\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02952}02952\ \ \ \textcolor{keywordtype}{int}\ white\_pieces\ =\ 0,\ black\_pieces\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02953}02953\ \ \ \textcolor{keywordtype}{bool}\ white\_has\_major\ =\ \textcolor{keyword}{false},\ black\_has\_major\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02954}02954\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02955}02955\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02956}02956\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02957}02957\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02958}02958\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02959}02959\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02960}02960\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02961}02961\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02962}02962\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02963}02963\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02964}02964\ \ \ \ \ \ \ \ \ \ \ \ \ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02965}02965\ \ \ \ \ \ \ \ \ \ \ white\_has\_major\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02966}02966\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02967}02967\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02968}02968\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02969}02969\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02970}02970\ \ \ \ \ \ \ \ \ \ \ \ \ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02971}02971\ \ \ \ \ \ \ \ \ \ \ black\_has\_major\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02972}02972\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02973}02973\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02974}02974\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02975}02975\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02976}02976\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02977}02977\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ <=\ 2\ \&\&\ black\_pieces\ <=\ 2\ \&\&\ !white\_has\_major\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02978}02978\ \ \ \ \ \ \ !black\_has\_major)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02979}02979\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02980}02980\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}};\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02981}02981\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02982}02982\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02983}02983\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Insufficient\ material!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02984}02984\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02985}02985\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02986}02986\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02987}02987\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02988}02988\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02989}02989\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02990}\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{02990}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02991}02991\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02992}02992\ \ \ \textcolor{keywordflow}{if}\ (error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02993}02993\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move\ attempted:\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02994}02994\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02995}02995\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02996}02996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02997}02997\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Executing\ move:\ \%c\%d-\/\%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02998}02998\ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02999}02999\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03000}03000\ \ \ \textcolor{comment}{//\ Get\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03001}03001\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ source\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03002}03002\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03003}03003\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03004}03004\ \ \ \textcolor{comment}{//\ Create\ extended\ move\ for\ proper\ handling\ of\ special\ cases}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03005}03005\ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ extended\_move\ =\ \{.from\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03006}03006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03007}03007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03008}03008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03009}03009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ source\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03010}03010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ dest\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03011}03011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .move\_type\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03012}03012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .promotion\_piece\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03013}03013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03014}03014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03015}03015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .is\_check\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03016}03016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .is\_checkmate\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03017}03017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .is\_stalemate\ =\ \textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03018}03018\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03019}03019\ \ \ \textcolor{comment}{//\ Detect\ special\ move\ types}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03020}03020\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03021}03021\ \ \ \textcolor{comment}{//Disable\ special\ move\ detection\ during\ error\ recovery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03022}03022\ \ \ \textcolor{comment}{//\ During\ error\ recovery,\ ALL\ moves\ are\ treated\ as\ NORMAL\ moves\ to\ prevent}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03023}03023\ \ \ \textcolor{comment}{//\ state\ conflicts}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03024}03024\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03025}03025\ \ \ \ \ \textcolor{comment}{//\ 1.\ Check\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03026}03026\ \ \ \ \ \textcolor{keywordflow}{if}\ ((source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03027}03027\ \ \ \ \ \ \ \ \ \ source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03028}03028\ \ \ \ \ \ \ \ \ abs(move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03029}03029\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ >\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03030}03030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03031}03031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03032}03032\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03033}03033\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03034}03034\ \ \ \ \ \textcolor{comment}{//\ 2.\ Check\ for\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03035}03035\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03036}03036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03037}03037\ \ \ \ \ \ \ \ \ \ \ \ \ \ abs(move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 1\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03038}03038\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03039}03039\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03040}03040\ \ \ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03041}03041\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03042}03042\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03043}03043\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03044}03044\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03045}03045\ \ \ \ \ \textcolor{comment}{//\ 3.\ Check\ for\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03046}03046\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ 7)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03047}03047\ \ \ \ \ \ \ \ \ \ \ \ \ \ (source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ 0))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03048}03048\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03049}03049\ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ default\ promotion\ to\ Queen\ -\/\ can\ be\ enhanced\ later\ with\ user\ input}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03050}03050\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03051}03051\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03052}03052\ \ \ \ \ \textcolor{comment}{//\ 4.\ Check\ for\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03053}03053\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03054}03054\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03055}03055\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Capture:\ \%s\ captures\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03056}03056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(source\_piece),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03057}03057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03058}03058\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03059}03059\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ captured\ piece\ to\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03060}03060\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a9f117ec973e2706358d99dfe843cd6ae}{add\_captured\_piece}}(dest\_piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03061}03061\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03062}03062\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03063}03063\ \ \ \ \ \textcolor{comment}{//\ During\ error\ recovery,\ treat\ everything\ as\ NORMAL\ move\ (or\ CAPTURE\ if}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03064}03064\ \ \ \ \ \textcolor{comment}{//\ opponent\ piece\ present)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03065}03065\ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03066}03066\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03067}03067\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Error\ recovery:\ treating\ as\ simple\ capture"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03068}03068\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03069}03069\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03070}03070\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Error\ recovery:\ treating\ as\ normal\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03071}03071\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03072}03072\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03073}03073\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03074}03074\ \ \ \textcolor{comment}{//\ Execute\ the\ enhanced\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03075}03075\ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{game\_execute\_move\_enhanced}}(\&extended\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03076}03076\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03077}03077\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03078}03078\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ game\_execute\_move:\ success=\%d,\ current\_player\ before\ change=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03079}03079\ \ \ \ \ \ \ \ \ \ \ \ success,\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03080}03080\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03081}03081\ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03082}03082\ \ \ \ \ \textcolor{comment}{//\ Update\ last\ move\ tracking\ for\ future\ en\ passant\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03083}03083\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03084}03084\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03085}03085\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03086}03086\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03087}03087\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03088}03088\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03089}03089\ \ \ \ \ \textcolor{comment}{//\ Add\ to\ move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03090}03090\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ <\ \mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03091}03091\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}]\ =\ *move;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03092}03092\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}].piece\ =\ source\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03093}03093\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}].captured\_piece\ =\ dest\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03094}03094\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}].timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03095}03095\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03096}03096\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03097}03097\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03098}03098\ \ \ \ \ \textcolor{comment}{//\ Update\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03099}03099\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03100}03100\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03101}03101\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03102}03102\ \ \ \ \ \textcolor{comment}{//\ Record\ material\ advantage\ pro\ graf}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03103}03103\ \ \ \ \ \mbox{\hyperlink{game__task_8c_abd6d559fc6b46a6a06f830b5c5cec56a}{game\_record\_material\_advantage}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03104}03104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03105}03105\ \ \ \ \ \textcolor{comment}{//\ ENHANCED\ CASTLING\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03106}03106\ \ \ \ \ \textcolor{keywordflow}{if}\ (extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03107}03107\ \ \ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03108}03108\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ CASTLING\ DETECTED!\ King\ moved\ 2\ squares"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03109}03109\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03110}03110\ \ \ \ \ \ \ \textcolor{comment}{//\ Nastavit\ castling\ state\ pro\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03111}03111\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03112}03112\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03113}03113\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.is\_kingside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ >\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03114}03114\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03115}03115\ \ \ \ \ \ \ \textcolor{comment}{//\ Vypočítat\ očekávané\ pozice\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03116}03116\ \ \ \ \ \ \ uint8\_t\ rook\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03117}03117\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.is\_kingside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03118}03118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03119}03119\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ =\ 7;\ \textcolor{comment}{//\ h-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03120}03120\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03121}03121\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col\ =\ 5;\ \textcolor{comment}{//\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03122}03122\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03123}03123\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03124}03124\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ =\ 0;\ \textcolor{comment}{//\ a-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03125}03125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03126}03126\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col\ =\ 3;\ \textcolor{comment}{//\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03127}03127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03128}03128\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03129}03129\ \ \ \ \ \ \ \textcolor{comment}{//\ Ukázat\ LED\ indikaci\ pro\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03130}03130\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03131}03131\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03132}03132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03133}03133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 192,\ 192,\ 192);\ \textcolor{comment}{//\ Stříbrná\ pro\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03134}03134\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03135}03135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03136}03136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ pro\ cíl\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03137}03137\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03138}03138\ \ \ \ \ \ \ \textcolor{comment}{//\ NEMĚNIT\ HRÁČE\ pro\ castling!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03139}03139\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03140}03140\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏳\ Waiting\ for\ rook\ move\ from\ \%c\%d\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03141}03141\ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03142}03142\ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03143}03143\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ in\ progress\ -\/\ player\ remains\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03144}03144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03145}03145\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;\ \textcolor{comment}{//\ Return\ success\ but\ don't\ change\ player\ -\/\ hráč\ se\ změní}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03146}03146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ až\ po\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03147}03147\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03148}03148\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03149}03149\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ promotion\ -\/\ start\ promotion\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03150}03150\ \ \ \ \ \textcolor{keywordflow}{if}\ (extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03151}03151\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ PROMOTION\ DETECTED!\ Starting\ promotion\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03152}03152\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03153}03153\ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ promotion\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03154}03154\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03155}03155\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03156}03156\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03157}03157\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03158}03158\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03159}03159\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03160}03160\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03161}03161\ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03162}03162\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03163}03163\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03164}03164\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03165}03165\ \ \ \ \ \textcolor{comment}{//\ KONTROLA\ DOKONČENÍ\ ROŠÁDY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03166}03166\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03167}03167\ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ to\ tah\ věže\ pro\ dokončení\ rošády?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03168}03168\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03169}03169\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03170}03170\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03171}03171\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03172}03172\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03173}03173\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ CASTLING\ COMPLETED!\ Rook\ moved\ correctly"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03174}03174\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03175}03175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Provedeme\ posun\ věže\ v\ board[][]}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03176}03176\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03177}03177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row][\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03178}03178\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03179}03179\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03180}03180\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ příznaky\ pro\ krále\ a\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03181}03181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03182}03182\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03183}03183\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03184}03184\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03185}03185\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03186}03186\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03187}03187\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03188}03188\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03189}03189\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03190}03190\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03191}03191\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03192}03192\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03193}03193\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03194}03194\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03195}03195\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zlatá\ animace\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03196}03196\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{show\_castling\_completion\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03197}03197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03198}03198\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TEPRVE\ NYÍ\ změnit\ hráče\ po\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03199}03199\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03200}03200\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03201}03201\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03202}03202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03203}03203\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎉\ Castling\ completed!\ Player\ changed\ to\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03204}03204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03205}03205\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03206}03206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03207}03207\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03208}03208\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03209}03209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (castling):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03210}03210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03211}03211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03212}03212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03213}03213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03214}03214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03215}03215\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03216}03216\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03217}03217\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03218}03218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03219}03219\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03220}03220\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03221}03221\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03222}03222\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03223}03223\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03224}03224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03225}03225\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03226}03226\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03227}03227\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03228}03228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03229}03229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03230}03230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03231}03231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03232}03232\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03233}03233\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03234}03234\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03235}03235\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03236}03236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ castling!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03237}03237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03238}03238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03239}03239\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03240}03240\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03241}03241\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03242}03242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03243}03243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03244}03244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03245}03245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03246}03246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03247}03247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03248}03248\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03249}03249\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03250}03250\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03251}03251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03252}03252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03253}03253\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03254}03254\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03255}03255\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03256}03256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03257}03257\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03258}03258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03259}03259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03260}03260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03261}03261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03262}03262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03263}03263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03264}03264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03265}03265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03266}03266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03267}03267\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03268}03268\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03269}03269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03270}03270\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ castling\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03271}03271\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03272}03272\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03273}03273\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figury\ pro\ nového\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03274}03274\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03275}03275\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03276}03276\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03277}03277\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03278}03278\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03279}03279\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03280}03280\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03281}03281\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03282}03282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03283}03283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03284}03284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03285}03285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03286}03286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03287}03287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03288}03288\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03289}03289\ \ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03290}03290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03291}03291\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03292}03292\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03293}03293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03294}03294\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ RETURN\ po\ dokončení\ rošády\ -\/\ hráč\ se\ už\ změnil}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03295}03295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03296}03296\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03297}03297\ \ \ \ \ \ \ \ \ ESP\_LOGE(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03298}03298\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03299}03299\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Wrong\ move\ during\ castling\ -\/\ expected\ rook\ from\ \%c\%d\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03300}03300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03301}03301\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03302}03302\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03303}03303\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nezměnit\ hráče\ -\/\ stále\ čekáme\ na\ správný\ tah\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03304}03304\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;\ \textcolor{comment}{//\ Return\ success\ but\ don't\ change\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03305}03305\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03306}03306\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03307}03307\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03308}03308\ \ \ \ \ \textcolor{comment}{//\ NORMÁLNÍ\ TAHY\ -\/\ změnit\ hráče\ (move\ animace\ se\ spouští\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03309}03309\ \ \ \ \ \textcolor{comment}{//\ game\_process\_drop\_command)\ Switch\ player\ BEFORE\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03310}03310\ \ \ \ \ \textcolor{comment}{//\ endgame\ conditions\ (podle\ starého\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03311}03311\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03312}03312\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Changing\ player\ from\ \%s\ to\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03313}03313\ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03314}03314\ \ \ \ \ \ \ \ \ \ \ \ \ \ (previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03315}03315\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03316}03316\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03317}03317\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03318}03318\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03319}03319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Move\ executed\ successfully.\ \%s\ to\ move\ (current\_player=\%s)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03320}03320\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03321}03321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03322}03322\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03323}03323\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ endgame\ conditions\ after\ move\ execution\ (podle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03324}03324\ \ \ \ \ \textcolor{comment}{//\ starého\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03325}03325\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03326}03326\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03327}03327\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Endgame\ detected\ after\ move\ execution"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03328}03328\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03329}03329\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03330}03330\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03331}03331\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03332}03332\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03333}03333\ \ \ \textcolor{comment}{//\ Update\ promotion\ LED\ indications\ after\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03334}03334\ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03335}03335\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03336}03336\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03337}03337\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03338}03338\ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03339}03339\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03340}03340\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03341}03341\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03342}03342\ \textcolor{comment}{//\ GAME\ STATUS\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03343}03343\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03344}03344\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03345}\mbox{\hyperlink{game__task_8c_ac8bfd19bdb7f1bbe6986c0f007713f73}{03345}}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_ac8bfd19bdb7f1bbe6986c0f007713f73}{game\_get\_state}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03346}03346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03347}\mbox{\hyperlink{game__task_8c_a98c28bfe096e1b2f5dd819da477efbe1}{03347}}\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_a98c28bfe096e1b2f5dd819da477efbe1}{game\_get\_current\_player}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03348}03348\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03349}\mbox{\hyperlink{game__task_8c_a2e528b3b66fe59544f28ca993c4a6143}{03349}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2e528b3b66fe59544f28ca993c4a6143}{game\_get\_move\_count}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03350}03350\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03351}\mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{03351}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{game\_print\_board}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03352}03352\ \ \ \textcolor{comment}{//\ Add\ spacing\ before\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03353}03353\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03354}03354\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03355}03355\ \textcolor{comment}{//\ Enhanced\ ANSI\ color\ codes}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03356}03356\ \textcolor{preprocessor}{\#define\ COLOR\_RESET\ "{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03357}03357\ \textcolor{preprocessor}{\#define\ COLOR\_BOLD\ "{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03358}03358\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_WHITE\ "{}\(\backslash\)033[97m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03359}03359\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_RED\ "{}\(\backslash\)033[91m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03360}03360\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_GREEN\ "{}\(\backslash\)033[92m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03361}03361\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_YELLOW\ "{}\(\backslash\)033[93m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03362}03362\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_BLUE\ "{}\(\backslash\)033[94m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03363}03363\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_CYAN\ "{}\(\backslash\)033[96m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03364}03364\ \textcolor{preprocessor}{\#define\ BG\_WHITE\ "{}\(\backslash\)033[47m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03365}03365\ \textcolor{preprocessor}{\#define\ BG\_BLACK\ "{}\(\backslash\)033[40m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03366}03366\ \textcolor{preprocessor}{\#define\ BG\_YELLOW\ "{}\(\backslash\)033[43m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03367}03367\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03368}03368\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}===\ Chess\ Board\ ==="{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03369}03369\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03370}03370\ \ \ \textcolor{comment}{//\ Print\ board\ header\ with\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03371}03371\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03372}03372\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03373}03373\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03374}03374\ \ \ \textcolor{comment}{//\ Print\ board\ rows\ (8\ to\ 1)\ -\/\ FIXED:\ row\ 7\ =\ rank\ 8,\ row\ 0\ =\ rank\ 1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03375}03375\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03376}03376\ \ \ \ \ \textcolor{keywordtype}{char}\ row\_header[16];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03377}03377\ \ \ \ \ snprintf(row\_header,\ \textcolor{keyword}{sizeof}(row\_header),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03378}03378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \%d\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03379}03379\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s"{}},\ row\_header);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03380}03380\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03381}03381\ \ \ \ \ \textcolor{comment}{//\ Print\ pieces\ in\ this\ row}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03382}03382\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03383}03383\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03384}03384\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03385}03385\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ square\ is\ part\ of\ the\ last\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03386}03386\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_last\_move\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03387}03387\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03388}03388\ \ \ \ \ \ \ \ \ \ \ ((row\ ==\ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03389}03389\ \ \ \ \ \ \ \ \ \ \ \ (row\ ==\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03390}03390\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03391}03391\ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ square\ color\ (white/black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03392}03392\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_white\_square\ =\ ((row\ +\ col)\ \%\ 2)\ ==\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03393}03393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03394}03394\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03395}03395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_last\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03396}03396\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03397}03397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ *\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});\ \textcolor{comment}{//\ Highlight\ empty\ square\ from\ last\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03398}03398\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03399}03399\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_white\_square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03400}03400\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a6beded3f171517df3902c52f79f6fea2}{BG\_WHITE}}\ \textcolor{stringliteral}{"{}\ \ \ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03401}03401\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03402}03402\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a0e5ebbe291d95cf1b8f1661252722fe0}{BG\_BLACK}}\ \textcolor{stringliteral}{"{}\ \ \ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03403}03403\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03404}03404\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03405}03405\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03406}03406\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ piece\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03407}03407\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03408}03408\ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03409}03409\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03410}03410\ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_piece\ ?\ \mbox{\hyperlink{game__task_8c_aa0977659d900017c4b65818c42a60a66}{COLOR\_BRIGHT\_WHITE}}\ :\ \mbox{\hyperlink{game__task_8c_a07544b84bb0b8d3c7b2580ca0b48a098}{COLOR\_BRIGHT\_RED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03411}03411\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03412}03412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_last\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03413}03413\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}*"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03414}03414\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \textcolor{stringliteral}{"{}\%s\%s"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ piece\_color,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03415}03415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03416}03416\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03417}03417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}*"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});\ \textcolor{comment}{//\ Highlight\ piece\ from\ last\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03418}03418\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03419}03419\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_white\_square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03420}03420\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a6beded3f171517df3902c52f79f6fea2}{BG\_WHITE}}\ \textcolor{stringliteral}{"{}\%s\%s\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ piece\_color,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03421}03421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03422}03422\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03423}03423\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a0e5ebbe291d95cf1b8f1661252722fe0}{BG\_BLACK}}\ \textcolor{stringliteral}{"{}\%s\%s\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ piece\_color,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03424}03424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03425}03425\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03426}03426\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03427}03427\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03428}03428\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03429}03429\ \ \ \ \ \textcolor{keywordtype}{char}\ row\_footer[16];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03430}03430\ \ \ \ \ snprintf(row\_footer,\ \textcolor{keyword}{sizeof}(row\_footer),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03431}03431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \%d\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03432}03432\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s"{}},\ row\_footer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03433}03433\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03434}03434\ \ \ \ \ \textcolor{comment}{//\ Print\ row\ separator\ (except\ after\ last\ row)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03435}03435\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03436}03436\ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03437}03437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03438}03438\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03439}03439\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03440}03440\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03441}03441\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03442}03442\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03443}03443\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03444}03444\ \ \ \textcolor{comment}{//\ Print\ game\ status\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03445}03445\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03446}03446\ \ \ printf(\mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}\ \mbox{\hyperlink{game__task_8c_a30dd0aa7ae6b1f5ffbcdd51024ee6c47}{COLOR\_BRIGHT\_GREEN}}\ \textcolor{stringliteral}{"{}🎮\ GAME\ STATUS:\(\backslash\)r\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03447}03447\ \ \ printf(\mbox{\hyperlink{game__task_8c_a27c03232867e0e1d6477d73e4e385026}{COLOR\_BRIGHT\_YELLOW}}\ \textcolor{stringliteral}{"{}\ \ \ •\ Current\ player:\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03448}03448\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03449}03449\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_aa0977659d900017c4b65818c42a60a66}{COLOR\_BRIGHT\_WHITE}}\ \textcolor{stringliteral}{"{}♔\ WHITE"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03450}03450\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03451}03451\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a07544b84bb0b8d3c7b2580ca0b48a098}{COLOR\_BRIGHT\_RED}}\ \textcolor{stringliteral}{"{}♚\ BLACK"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03452}03452\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03453}03453\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03454}03454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03455}03455\ \ \ printf(\mbox{\hyperlink{game__task_8c_a27c03232867e0e1d6477d73e4e385026}{COLOR\_BRIGHT\_YELLOW}}\ \textcolor{stringliteral}{"{}\ \ \ •\ Move\ number:\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}}\ \mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03456}03456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03457}03457\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03458}03458\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03459}03459\ \ \ \textcolor{comment}{//\ Print\ last\ move\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03460}03460\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03461}03461\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_square[4],\ to\_square[4];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03462}03462\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}},\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03463}03463\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}},\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03464}03464\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a27c03232867e0e1d6477d73e4e385026}{COLOR\_BRIGHT\_YELLOW}}\ \textcolor{stringliteral}{"{}\ \ \ •\ Last\ move:\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}}\ \mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03465}03465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ →\ \%s\(\backslash\)r\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03466}03466\ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03467}03467\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03468}03468\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03469}03469\ \ \ \textcolor{comment}{//\ Check\ for\ special\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03470}03470\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03471}03471\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a07544b84bb0b8d3c7b2580ca0b48a098}{COLOR\_BRIGHT\_RED}}\ \textcolor{stringliteral}{"{}\ \ \ ⚠️\ \ "{}}\ \mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}\ \textcolor{stringliteral}{"{}CHECK!"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}}\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03472}03472\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03473}03473\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03474}03474\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03475}03475\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03476}03476\ \ \ \textcolor{comment}{//\ Print\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03477}03477\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ >\ 0\ ||\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03478}03478\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Captured\ pieces:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03479}03479\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03480}03480\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ White\ captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03481}03481\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03482}03482\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s\ "{}},\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[(\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i]]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03483}03483\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03484}03484\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}(\%lu\ total)\(\backslash\)n"{}},\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03485}03485\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03486}03486\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03487}03487\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ Black\ captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03488}03488\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03489}03489\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s\ "{}},\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[(\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i]]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03490}03490\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03491}03491\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}(\%lu\ total)\(\backslash\)n"{}},\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03492}03492\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03493}03493\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03494}03494\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03495}03495\ \ \ \textcolor{comment}{//\ Print\ piece\ legend}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03496}03496\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Piece\ Legend:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03497}03497\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ White:\ p=pawn,\ n=knight,\ b=bishop,\ r=rook,\ q=queen,\ k=king"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03498}03498\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Black:\ P=pawn,\ N=knight,\ B=bishop,\ R=rook,\ Q=queen,\ K=king"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03499}03499\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Empty:\ space,\ *\ =\ last\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03500}03500\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03501}03501\ \ \ \textcolor{comment}{//\ Print\ game\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03502}03502\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Status:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03503}03503\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Current\ player:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03504}03504\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03505}03505\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Move\ count:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03506}03506\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Game\ state:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03507}03507\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Active"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03508}03508\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Idle"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03509}03509\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}})\ ?\ \textcolor{stringliteral}{"{}Paused"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03510}03510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Finished"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03511}03511\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03512}03512\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03513}\mbox{\hyperlink{game__task_8c_a6852701612778b8ad618fa420a0b7dca}{03513}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6852701612778b8ad618fa420a0b7dca}{game\_print\_move\_history}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03514}03514\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Move\ history\ (\%lu\ moves):"{}},\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03515}03515\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03516}03516\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03517}03517\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03518}03518\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \%lu.\ \%c\%d-\/\%c\%d\ \%s"{}},\ i\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03519}03519\ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03520}03520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03521}03521\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03522}03522\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03523}03523\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03524}03524\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03525}03525\ \textcolor{comment}{//\ GENIUS\ COMPATIBILITY\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03526}03526\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03527}03527\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03531}\mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{03531}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *message,\ \textcolor{keywordtype}{bool}\ is\_error,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03532}03532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QueueHandle\_t\ response\_queue)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03533}03533\ \ \ \textcolor{keywordflow}{if}\ (response\_queue\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03534}03534\ \ \ \ \ \textcolor{comment}{//\ Fallback\ to\ logging\ if\ no\ response\ queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03535}03535\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03536}03536\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}GAME\_ERROR:\ \%s"{}},\ message\ ?\ message\ :\ \textcolor{stringliteral}{"{}Unknown\ error"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03537}03537\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03538}03538\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}GAME\_SUCCESS:\ \%s"{}},\ message\ ?\ message\ :\ \textcolor{stringliteral}{"{}Success"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03539}03539\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03540}03540\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03541}03541\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03542}03542\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03543}03543\ \ \ \textcolor{comment}{//\ Create\ simple\ response\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03544}03544\ \ \ \textcolor{keywordtype}{char}\ response\_message[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03545}03545\ \ \ \textcolor{keywordflow}{if}\ (message)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03546}03546\ \ \ \ \ strncpy(response\_message,\ message,\ \textcolor{keyword}{sizeof}(response\_message)\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03547}03547\ \ \ \ \ response\_message[\textcolor{keyword}{sizeof}(response\_message)\ -\/\ 1]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03548}03548\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03549}03549\ \ \ \ \ strcpy(response\_message,\ is\_error\ ?\ \textcolor{stringliteral}{"{}Unknown\ error"{}}\ :\ \textcolor{stringliteral}{"{}Success"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03550}03550\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03551}03551\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03552}03552\ \ \ \textcolor{comment}{//\ Send\ response\ to\ UART\ task\ as\ game\_response\_t}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03553}03553\ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03554}03554\ \ \ \ \ \ \ .type\ =\ is\_error\ ?\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a39ae193ecb15c805e19efa3c004cda8b}{GAME\_RESPONSE\_ERROR}}\ :\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03555}03555\ \ \ \ \ \ \ .command\_type\ =\ 0,\ \textcolor{comment}{//\ Will\ be\ set\ by\ caller\ if\ needed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03556}03556\ \ \ \ \ \ \ .error\_code\ =\ is\_error\ ?\ 1\ :\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03557}03557\ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03558}03558\ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03559}03559\ \ \ strcpy(response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}},\ response\_message);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03560}03560\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03561}03561\ \ \ \textcolor{comment}{//\ ✅\ STABILITY\ FIX:\ Use\ timeout\ instead\ of\ portMAX\_DELAY\ to\ prevent\ deadlocks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03562}03562\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03563}03563\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03564}03564\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ acquire\ game\_mutex\ -\/\ timeout!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03565}03565\ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Return\ early\ if\ mutex\ unavailable}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03566}03566\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03567}03567\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03568}03568\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03569}03569\ \ \ \textcolor{keywordflow}{if}\ (xQueueSend(response\_queue,\ \&response,\ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03570}03570\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03571}03571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Failed\ to\ send\ response\ to\ UART\ task\ (queue\ full\ or\ timeout)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03572}03572\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03573}03573\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Response\ sent\ to\ UART\ task:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03574}03574\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_error\ ?\ \textcolor{stringliteral}{"{}ERROR"{}}\ :\ \textcolor{stringliteral}{"{}SUCCESS"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03575}03575\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03576}03576\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03577}03577\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03578}03578\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03579}03579\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03580}03580\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03581}03581\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03585}\mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{03585}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{game\_send\_board\_to\_uart}}(QueueHandle\_t\ response\_queue)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03586}03586\ \ \ \textcolor{keywordflow}{if}\ (response\_queue\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03587}03587\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}No\ response\ queue\ available\ for\ board\ data"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03588}03588\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03589}03589\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03590}03590\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03591}03591\ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ starting\ operation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03592}03592\ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03593}03593\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03594}03594\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ malloc(3072)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03595}03595\ \ \ \textcolor{comment}{//\ This\ eliminates\ heap\ fragmentation\ and\ reduces\ memory\ usage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03596}03596\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📡\ Using\ streaming\ output\ for\ board\ display\ (no\ malloc)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03597}03597\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03598}03598\ \ \ \textcolor{comment}{//\ Configure\ streaming\ for\ queue\ output}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03599}03599\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{streaming__output_8h_aca427711530c81651095df3f70106d66}{streaming\_set\_queue\_output}}(response\_queue);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03600}03600\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03601}03601\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ configure\ streaming\ output:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03602}03602\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03603}03603\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03604}03604\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03605}03605\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03606}03606\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ large\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03607}03607\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03608}03608\ \ \ \textcolor{comment}{//\ Stream\ board\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03609}03609\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03610}03610\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03611}03611\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03612}03612\ \ \ \textcolor{comment}{//\ Stream\ board\ rows}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03613}03613\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03614}03614\ \ \ \ \ \textcolor{comment}{//\ Reset\ watchdog\ every\ row\ to\ prevent\ timeouts}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03615}03615\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03616}03616\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03617}03617\ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\%d\ |"{}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03618}03618\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03619}03619\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03620}03620\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03621}03621\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *symbol;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03622}03622\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03623}03623\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03624}03624\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03625}03625\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}P"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03626}03626\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03627}03627\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03628}03628\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}N"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03629}03629\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03630}03630\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03631}03631\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}B"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03632}03632\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03633}03633\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03634}03634\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}R"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03635}03635\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03636}03636\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03637}03637\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}Q"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03638}03638\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03639}03639\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03640}03640\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}K"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03641}03641\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03642}03642\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03643}03643\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}p"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03644}03644\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03645}03645\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03646}03646\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}n"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03647}03647\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03648}03648\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03649}03649\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}b"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03650}03650\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03651}03651\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03652}03652\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}r"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03653}03653\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03654}03654\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03655}03655\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}q"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03656}03656\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03657}03657\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03658}03658\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}k"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03659}03659\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03660}03660\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03661}03661\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}·"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03662}03662\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03663}03663\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03664}03664\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03665}03665\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \%s\ |"{}},\ symbol);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03666}03666\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03667}03667\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03668}03668\ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \%d\(\backslash\)n"{}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03669}03669\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03670}03670\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03671}03671\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03672}03672\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03673}03673\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03674}03674\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03675}03675\ \ \ \textcolor{comment}{//\ Stream\ board\ footer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03676}03676\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03677}03677\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03678}03678\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03679}03679\ \ \ \textcolor{comment}{//\ Stream\ game\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03680}03680\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\(\backslash\)nCurrent\ player:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03681}03681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03682}03682\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03683}03683\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}Move\ count:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03684}03684\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03685}03685\ \ \ \textcolor{comment}{//\ Stream\ helpful\ tip}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03686}03686\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}💡\ Use\ 'UP\ <square>'\ to\ lift\ piece,\ 'DN\ <square>'\ to\ place"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03687}03687\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03688}03688\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Streaming\ output\ handles\ data\ transmission}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03689}03689\ \ \ \textcolor{comment}{//\ Send\ completion\ message\ to\ response\ queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03690}03690\ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ completion\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03691}03691\ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03692}03692\ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03693}03693\ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03694}03694\ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Board\ display\ streaming\ completed\ successfully"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03695}03695\ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03696}03696\ \ \ strcpy(completion\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}},\ \textcolor{stringliteral}{"{}streaming\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03697}03697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03698}03698\ \ \ \textcolor{keywordflow}{if}\ (response\_queue\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03699}03699\ \ \ \ \ xQueueSend(response\_queue,\ \&completion\_response,\ pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03700}03700\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03701}03701\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03702}03702\ \ \ \textcolor{comment}{//\ No\ need\ for\ manual\ queue\ management\ or\ large\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03703}03703\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Board\ display\ streaming\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03704}03704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03705}03705\ \ \ \textcolor{comment}{//\ Final\ WDT\ reset}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03706}03706\ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03707}03707\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03708}03708\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03709}03709\ \textcolor{comment}{//\ Function\ removed\ -\/\ using\ game\_send\_board\_to\_uart(QueueHandle\_t)\ instead}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03710}03710\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03714}\mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{03714}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03715}03715\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03716}03716\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03717}03717\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03718}03718\ \ \ \textcolor{comment}{//\ Ignore\ matrix\ events\ during\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03719}03719\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03720}03720\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03721}03721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ PICKUP\ ignored\ -\/\ promotion\ pending\ at\ \%c\%d.\ Please\ press\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03722}03722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}promotion\ button\ first\ (green\ LEDs)."{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03723}03723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03724}03724\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03725}03725\ \ \ \ \ \textcolor{comment}{//\ Send\ informative\ message\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03726}03726\ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[512];\ \textcolor{comment}{//\ Increased\ from\ 256\ to\ 512\ (message\ is\ \string~320\ bytes)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03727}03727\ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03728}03728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Physical\ piece\ movement\ ignored\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03729}03729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ pending\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03730}03730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Please\ press\ promotion\ button:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03731}03731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ QUEEN\ \ (button\ 0)\ -\/\ green\ LED\ 64\ or\ 68\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03732}03732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ ROOK\ \ \ (button\ 1)\ -\/\ green\ LED\ 65\ or\ 69\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03733}03733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ BISHOP\ (button\ 2)\ -\/\ green\ LED\ 66\ or\ 70\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03734}03734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ KNIGHT\ (button\ 3)\ -\/\ green\ LED\ 67\ or\ 71\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03735}03735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📝\ Or\ use\ UART:\ PROMOTE\ \%c\%d=Q"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03736}03736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03737}03737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03738}03738\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03739}03739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03740}03740\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03741}03741\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03742}03742\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03743}03743\ \ \ \textcolor{comment}{//\ PŘERUŠIT\ BLIKÁNÍ\ při\ zvednutí\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03744}03744\ \ \ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03745}03745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03746}03746\ \ \ \textcolor{comment}{//\ Bezpečnostní\ kontrola\ notation\ stringu\ (array\ je\ vždy\ !=\ NULL)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03747}03747\ \ \ \textcolor{keywordflow}{if}\ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03748}03748\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ or\ corrupted\ notation\ string"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03749}03749\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ notation\ format"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03750}03750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03751}03751\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03752}03752\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03753}03753\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03754}03754\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Processing\ PICKUP\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03755}03755\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03756}03756\ \ \ \textcolor{comment}{//\ Convert\ notation\ to\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03757}03757\ \ \ uint8\_t\ from\_row,\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03758}03758\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&from\_row,\ \&from\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03759}03759\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03760}03760\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03761}03761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03762}03762\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03763}03763\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03764}03764\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03765}03765\ \ \ \textcolor{comment}{//\ KONTROLA\ ERROR\ RECOVERY\ STAVU}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03766}03766\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03767}03767\ \ \ \ \ \textcolor{comment}{//\ KONTROLA:\ Je\ to\ správná\ neplatná\ pozice?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03768}03768\ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_row\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03769}03769\ \ \ \ \ \ \ \ \ from\_col\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03770}03770\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03771}03771\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Lifting\ piece\ from\ invalid\ position\ \%s\ (error\ \#\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03772}03772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03773}03773\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Showing\ valid\ moves\ from\ ORIGINAL\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03774}03774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03775}03775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03776}03776\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03777}03777\ \ \ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03778}03778\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03779}03779\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03780}03780\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03781}03781\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03782}03782\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03783}03783\ \ \ \ \ \ \ \textcolor{comment}{//\ KLÍČOVÉ:\ Ukázat\ validní\ tahy\ z\ PŮVODNÍ\ pozice,\ ne\ z\ posledního}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03784}03784\ \ \ \ \ \ \ \textcolor{comment}{//\ pokusu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03785}03785\ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03786}03786\ \ \ \ \ \ \ uint32\_t\ valid\_moves\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03787}03787\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03788}03788\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03789}03789\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03790}03790\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Found\ \%lu\ valid\ moves\ from\ original\ position"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03791}03791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03792}03792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03793}03793\ \ \ \ \ \ \ \textcolor{comment}{//\ VYČISTIT\ A\ NASTAVIT\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03794}03794\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03795}03795\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03796}03796\ \ \ \ \ \ \ \textcolor{comment}{//\ Žlutá\ na\ aktuální\ pozici\ (kde\ je\ figurka\ nyní)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03797}03797\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03798}03798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03799}03799\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03800}03800\ \ \ \ \ \ \ \textcolor{comment}{//\ MODRÁ\ na\ původní\ validní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03801}03801\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03802}03802\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03803}03803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03804}03804\ \ \ \ \ \ \ \ \ \ \ 0,\ 0,\ 255);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03805}03805\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03806}03806\ \ \ \ \ \ \ \textcolor{comment}{//\ ZELENÉ\ LED\ pro\ validní\ cílová\ pole\ (z\ původní\ pozice)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03807}03807\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03808}03808\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(suggestions[i].to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03809}03809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ suggestions[i].to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03810}03810\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03811}03811\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nepřepisovat\ žlutou\ (aktuální\ pozici)\ a\ modrou\ (původní\ pozici)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03812}03812\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_led\ !=\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03813}03813\ \ \ \ \ \ \ \ \ \ \ \ \ dest\_led\ !=\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03814}03814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03815}03815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03816}03816\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[i].is\_capture)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03817}03817\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(dest\_led,\ 255,\ 165,\ 0);\ \textcolor{comment}{//\ Oranžová\ pro\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03818}03818\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03819}03819\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(dest\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ pro\ normální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03820}03820\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03821}03821\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03822}03822\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03823}03823\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03824}03824\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03825}03825\ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03826}03826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Lifted\ from\ invalid\ position\ -\/\ \%u\ valid\ moves\ from\ ORIGINAL\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03827}03827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%c\%d\ (blue)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03828}03828\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03829}03829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03830}03830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03831}03831\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03832}03832\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03833}03833\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03834}03834\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03835}03835\ \ \ \ \ \ \ \textcolor{comment}{//\ UP\ z\ jiné\ pozice\ během\ error\ recovery\ -\/\ ignorovat\ nebo\ resetovat?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03836}03836\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03837}03837\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ UP\ from\ different\ position\ during\ error\ recovery:\ \%s\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03838}03838\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(expected\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03839}03839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03840}03840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03841}03841\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03842}03842\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ warning\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03843}03843\ \ \ \ \ \ \ snprintf(warning\_msg,\ \textcolor{keyword}{sizeof}(warning\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03844}03844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Error\ recovery\ active\ -\/\ lift\ piece\ from\ \%c\%d\ first"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03845}03845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03846}03846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03847}03847\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(warning\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03848}03848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03849}03849\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03850}03850\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03851}03851\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03852}03852\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03853}03853\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ piece\ at\ the\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03854}03854\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03855}03855\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03856}03856\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03857}03857\ \ \ \ \ \textcolor{comment}{//\ Bezpečný\ snprintf\ s\ kontrolou\ návratové\ hodnoty}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03858}03858\ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =\ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),\ \textcolor{stringliteral}{"{}❌\ No\ piece\ at\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03859}03859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03860}03860\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(error\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03861}03861\ \ \ \ \ \ \ strcpy(error\_msg,\ \textcolor{stringliteral}{"{}❌\ No\ piece\ at\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03862}03862\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03863}03863\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ piece\ at\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03864}03864\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03865}03865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03866}03866\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03867}03867\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03868}03868\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03869}03869\ \ \ \textcolor{comment}{//\ Check\ if\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03870}03870\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03871}03871\ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03872}03872\ \ \ \textcolor{keywordtype}{bool}\ is\_black\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03873}03873\ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03874}03874\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03875}03875\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !is\_white\_piece)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03876}03876\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !is\_black\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03877}03877\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03878}03878\ \ \ \ \ \textcolor{comment}{//\ 3-\/STEP\ CAPTURE\ FLOW:\ UP\ own\ →\ UP\ opponent\ (remove)\ →\ DN\ own\ (execute)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03879}03879\ \ \ \ \ \textcolor{comment}{//\ Rozlišit\ capture\ vs\ error}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03880}03880\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03881}03881\ \ \ \ \ \textcolor{comment}{//\ FIX\ ISSUE\ 1:\ NESMÍ\ se\ povolit\ capture\ během\ error\ recovery!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03882}03882\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03883}03883\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03884}03884\ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03885}03885\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03886}03886\ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03887}03887\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03888}03888\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03889}03889\ \ \ \ \ \ \ \textcolor{comment}{//\ STEP\ 2\ of\ CAPTURE:\ Zkontrolovat\ zda\ lifted\ piece\ MŮŽE\ sebrat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03890}03890\ \ \ \ \ \ \ \textcolor{comment}{//\ opponent\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03891}03891\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ capture\_attempt\ =\ \{.from\_row\ =\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03892}03892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03893}03893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03894}03894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03895}03895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03896}03896\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03897}03897\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03898}03898\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03899}03899\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ capture\_valid\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&capture\_attempt);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03900}03900\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03901}03901\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (capture\_valid\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03902}03902\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ VALIDNÍ\ CAPTURE:\ Remove\ opponent\ piece,\ wait\ for\ DN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03903}03903\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}♟️\ \ Step\ 2/3\ Capture:\ Removing\ opponent\ piece\ at\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03904}03904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03905}03905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03906}03906\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Odstranit\ opponent\ piece\ z\ boardu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03907}03907\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03908}03908\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03909}03909\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nastavit\ capture\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03910}03910\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03911}03911\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03912}03912\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03913}03913\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03914}03914\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03915}03915\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Decentní\ LED\ feedback:\ Žlutá\ na\ lifted\ piece,\ FIALOVÁ\ na\ target\ (kde}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03916}03916\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ má\ polož\ it)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03917}03917\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03918}03918\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03919}03919\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}),\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03920}03920\ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03921}03921\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 128,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03922}03922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 128);\ \textcolor{comment}{//\ Purple\ =\ target}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03923}03923\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03924}03924\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Poslat\ info\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03925}03925\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03926}03926\ \ \ \ \ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03927}03927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}♟️\ \ Step\ 2/3:\ Opponent\ piece\ removed.\ Place\ \%s\ on\ PURPLE\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03928}03928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}square\ (\%s)\ to\ capture"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03929}03929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}),\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03930}03930\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03931}03931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03932}03932\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03933}03933\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03934}03934\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ INVALID\ CAPTURE:\ Proceed\ to\ error\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03935}03935\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03936}03936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Invalid\ capture\ attempt:\ \%s\ from\ \%c\%d\ CANNOT\ capture\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03937}03937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}),\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03938}03938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ +\ 1,\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ capture\_valid);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03939}03939\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03940}03940\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03941}03941\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03942}03942\ \ \ \ \ \textcolor{comment}{//\ ERROR\ FLOW:\ Wrong\ color\ piece\ lifted\ inappropriately}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03943}03943\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *safe\_notation\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03944}03944\ \ \ \ \ \ \ \ \ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 0)\ ?\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}}\ :\ \textcolor{stringliteral}{"{}??"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03945}03945\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03946}03946\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03947}03947\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03948}03948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Cannot\ capture\ during\ error\ recovery\ -\/\ opponent\ piece\ at\ \%s\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03949}03949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}ignored"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03950}03950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ safe\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03951}03951\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03952}03952\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03953}03953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Cannot\ capture\ opponent\ piece\ at\ \%s\ -\/\ invalid\ move\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03954}03954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ safe\_notation,\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03955}03955\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03956}03956\ \ \ \ \ \ \ ESP\_LOGW(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03957}03957\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03958}03958\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Opponent's\ piece\ lifted\ WITHOUT\ own\ piece\ lifted\ at\ \%s\ -\/\ ERROR"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03959}03959\ \ \ \ \ \ \ \ \ \ \ safe\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03960}03960\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03961}03961\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03962}03962\ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Nastavit\ error\_recovery\_state\ pro\ proper\ recovery\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03963}03963\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03964}03964\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03965}03965\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03966}03966\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03967}03967\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03968}03968\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03969}03969\ \ \ \ \ \ \ \ \ from\_row;\ \textcolor{comment}{//\ Původní\ pozice\ =\ kde\ má\ být\ vrácena}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03970}03970\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03971}03971\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03972}03972\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03973}03973\ \ \ \ \ \textcolor{comment}{//\ Uložit\ informace\ o\ opponent\ piece\ (backward\ compatibility)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03974}03974\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03975}03975\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03976}03976\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03977}03977\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03978}03978\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03979}03979\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03980}03980\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03981}03981\ \ \ \ \ \textcolor{comment}{//\ Odstranit\ figurku\ z\ boardu\ (byla\ zvednuta)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03982}03982\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03983}03983\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03984}03984\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ recovery\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03985}03985\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da8d38d078f83ba6d016773d797e914e80}{GAME\_STATE\_WAITING\_FOR\_RETURN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03986}03986\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03987}03987\ \ \ \ \ \textcolor{comment}{//\ LED:\ Spustit\ červené\ blikání\ na\ původní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03988}03988\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03989}03989\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(from\_row,\ from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03990}03990\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03991}03991\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ lifted\ piece\ state\ pro\ případné\ drop}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03992}03992\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03993}03993\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03994}03994\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03995}03995\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03996}03996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03997}03997\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03998}03998\ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03999}03999\ \ \ \ \ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04000}04000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Wrong\ color\ piece!\ \%s\ belongs\ to\ opponent\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04001}04001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔴\ Return\ piece\ to\ BLINKING\ RED\ square\ (\%s)\ to\ continue\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04002}04002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ To\ capture:\ lift\ YOUR\ piece\ first,\ then\ opponent's\ piece"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04003}04003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ safe\_notation,\ safe\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04004}04004\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(error\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04005}04005\ \ \ \ \ \ \ strcpy(error\_msg,\ \textcolor{stringliteral}{"{}❌\ Return\ opponent's\ piece\ to\ RED\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04006}04006\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04007}04007\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04008}04008\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04009}04009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04010}04010\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04011}04011\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04012}04012\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04013}04013\ \ \ \textcolor{comment}{//\ KING\ RESIGNATION:\ Detekce\ zvednutí\ vlastního\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04014}04014\ \ \ \textcolor{keywordflow}{if}\ ((piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04015}04015\ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04016}04016\ \ \ \ \ \textcolor{comment}{//\ Hráč\ zvedl\ svého\ krále\ -\/\ spustit\ resignation\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04017}04017\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{resignation\_start}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}},\ from\_row,\ from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04018}04018\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04019}04019\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ lifted\ piece\ (pro\ případné\ drop)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04020}04020\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04021}04021\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04022}04022\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04023}04023\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04024}04024\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04025}04025\ \ \ \ \ \textcolor{keywordtype}{char}\ msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04026}04026\ \ \ \ \ snprintf(msg,\ \textcolor{keyword}{sizeof}(msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04027}04027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ King\ lifted\ -\/\ resignation\ timer\ started\ (10s)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04028}04028\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(msg,\ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04029}04029\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Nepokračovat\ s\ normálním\ pickup\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04030}04030\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04031}04031\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04032}04032\ \ \ \textcolor{comment}{//\ Check\ if\ enhanced\ castling\ is\ active\ and\ this\ is\ a\ king\ or\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04033}04033\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{enhanced__castling__system_8c_a551d56ee547e30c59358ecfbef86302b}{enhanced\_castling\_is\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04034}04034\ \ \ \ \ \mbox{\hyperlink{enhanced__castling__system_8h_a5488d560e2ddb85e20098a6a750ff984}{castling\_phase\_t}}\ phase\ =\ \mbox{\hyperlink{enhanced__castling__system_8c_a573e41c1cc049dbb2722bc68b25f174b}{enhanced\_castling\_get\_phase}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04035}04035\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04036}04036\ \ \ \ \ \textcolor{keywordflow}{if}\ ((piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04037}04037\ \ \ \ \ \ \ \ \ phase\ ==\ \mbox{\hyperlink{enhanced__castling__system_8h_a5488d560e2ddb85e20098a6a750ff984a6b8198b3c2a1bd0fc46f7d18dbfc04a6}{CASTLING\_STATE\_KING\_LIFTED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04038}04038\ \ \ \ \ \ \ \mbox{\hyperlink{enhanced__castling__system_8c_a71c6334fe7eed0d589acfeb1cb6aeaaf}{enhanced\_castling\_handle\_king\_lift}}(from\_row,\ from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04039}04039\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04040}04040\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04041}04041\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04042}04042\ \ \ \ \ \textcolor{keywordflow}{if}\ ((piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04043}04043\ \ \ \ \ \ \ \ \ phase\ ==\ \mbox{\hyperlink{enhanced__castling__system_8h_a5488d560e2ddb85e20098a6a750ff984ac9da4000210f2ea7dcbde1e49ecad0df}{CASTLING\_STATE\_KING\_MOVED\_WAITING\_ROOK}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04044}04044\ \ \ \ \ \ \ \mbox{\hyperlink{enhanced__castling__system_8c_a1298ed566772765b083158dd04d7617e}{enhanced\_castling\_handle\_rook\_lift}}(from\_row,\ from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04045}04045\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04046}04046\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04047}04047\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04048}04048\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04049}04049\ \ \ \textcolor{comment}{//\ FIXED:\ No\ animation\ when\ lifting\ piece,\ just\ highlight\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04050}04050\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Piece\ lifted\ from\ \%s\ -\/\ showing\ possible\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04051}04051\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04052}04052\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04053}04053\ \ \ \textcolor{comment}{//\ Clear\ previous\ highlights\ before\ showing\ new\ ones}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04054}04054\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04055}04055\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04056}04056\ \ \ \textcolor{comment}{//\ Send\ LED\ command\ to\ highlight\ source\ square\ using\ new\ game\ state\ logic}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04057}04057\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04058}04058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04059}04059\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04060}04060\ \ \ \textcolor{comment}{//\ Track\ the\ lifted\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04061}04061\ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04062}04062\ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04063}04063\ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04064}04064\ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04065}04065\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04066}04066\ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04067}04067\ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04068}04068\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04069}04069\ \ \ \textcolor{comment}{//\ Show\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04070}04070\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Showing\ possible\ moves\ from\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04071}04071\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04072}04072\ \ \ \textcolor{comment}{//\ Get\ valid\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04073}04073\ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04074}04074\ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04075}04075\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(from\_row,\ from\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04076}04076\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04077}04077\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Found\ \%lu\ valid\ moves\ for\ piece\ at\ \%s"{}},\ valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04078}04078\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04079}04079\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04080}04080\ \ \ \textcolor{comment}{//\ Send\ LED\ commands\ to\ highlight\ possible\ destinations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04081}04081\ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04082}04082\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04083}04083\ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04084}04084\ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04085}04085\ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04086}04086\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04087}04087\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ destination\ has\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04088}04088\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04089}04089\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04090}04090\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04091}04091\ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04092}04092\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04093}04093\ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04094}04094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04095}04095\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04096}04096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04097}04097\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04098}04098\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04099}04099\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04100}04100\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04101}04101\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04102}04102\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04103}04103\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04104}04104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04105}04105\ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04106}04106\ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04107}04107\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04108}04108\ \ \ \textcolor{comment}{//\ MATRIX\ COMPATIBILITY:\ Show\ opponent\ pieces\ after\ pickup\ (same\ as\ matrix}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04109}04109\ \ \ \textcolor{comment}{//\ flow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04110}04110\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04111}04111\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04112}04112\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04113}04113\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04114}04114\ \ \ \textcolor{comment}{//\ Send\ success\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04115}04115\ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04116}04116\ \ \ \textcolor{comment}{//\ Bezpečný\ snprintf\ pro\ success\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04117}04117\ \ \ \textcolor{keywordtype}{int}\ written\ =\ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04118}04118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Piece\ lifted\ from\ \%s\ -\/\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ possible\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04119}04119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04120}04120\ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(success\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04121}04121\ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04122}04122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Piece\ lifted\ -\/\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves"{}},\ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04123}04123\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04124}04124\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04125}04125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04126}04126\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04127}04127\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04132}04132\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04140}04140\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04144}\mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{04144}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04145}04145\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04146}04146\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04147}04147\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04148}04148\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Processing\ DROP\ command:\ \%s\ (START)"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04149}04149\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04150}04150\ \ \ \textcolor{comment}{//\ PROMOTION\ PROTECTION:\ Ignore\ matrix\ events\ during\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04151}04151\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04152}04152\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04153}04153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ DROP\ ignored\ -\/\ promotion\ pending\ at\ \%c\%d.\ Please\ press\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04154}04154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}promotion\ button\ first\ (green\ LEDs)."{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04155}04155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04156}04156\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04157}04157\ \ \ \ \ \textcolor{comment}{//\ Send\ informative\ message\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04158}04158\ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[512];\ \textcolor{comment}{//\ Increased\ from\ 256\ to\ 512\ (message\ is\ \string~320\ bytes)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04159}04159\ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04160}04160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Physical\ piece\ movement\ ignored\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04161}04161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ pending\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04162}04162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Please\ press\ promotion\ button:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04163}04163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ QUEEN\ \ (button\ 0)\ -\/\ green\ LED\ 64\ or\ 68\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04164}04164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ ROOK\ \ \ (button\ 1)\ -\/\ green\ LED\ 65\ or\ 69\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04165}04165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ BISHOP\ (button\ 2)\ -\/\ green\ LED\ 66\ or\ 70\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04166}04166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ KNIGHT\ (button\ 3)\ -\/\ green\ LED\ 67\ or\ 71\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04167}04167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📝\ Or\ use\ UART:\ PROMOTE\ \%c\%d=Q"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04168}04168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04169}04169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04170}04170\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04171}04171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04172}04172\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04173}04173\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04174}04174\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04175}04175\ \ \ \textcolor{comment}{//\ KING\ RESIGNATION:\ Zrušit\ resignation\ pokud\ běží}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04176}04176\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04177}04177\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04178}04178\ \ \ \ \ \textcolor{comment}{//\ Pokračovat\ s\ normálním\ drop\ processingem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04179}04179\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04180}04180\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04181}04181\ \ \ \textcolor{comment}{//\ MOVED:\ New\ game\ detection\ moved\ to\ end\ of\ function\ to\ avoid\ false}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04182}04182\ \ \ \textcolor{comment}{//\ positives\ during\ move\ sequence}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04183}04183\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04184}04184\ \ \ \textcolor{comment}{//\ Convert\ notation\ to\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04185}04185\ \ \ uint8\_t\ to\_row,\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04186}04186\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \&to\_row,\ \&to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04187}04187\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04188}04188\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04189}04189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04190}04190\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04191}04191\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04192}04192\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04193}04193\ \ \ \textcolor{comment}{//\ 3-\/STEP\ CAPTURE:\ Check\ if\ completing\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04194}04194\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04195}04195\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04196}04196\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}♟️\ \ Capture\ complete\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04197}04197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04198}04198\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ capture\_move\ =\ \{.from\_row\ =\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04199}04199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04200}04200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04201}04201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04202}04202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04203}04203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04204}04204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04205}04205\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04206}04206\ \ \ \ \ \ \ \textcolor{comment}{//\ FIX:\ Temporarily\ restore\ captured\ piece\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04207}04207\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_is\_valid\_move\ needs\ to\ see\ the\ opponent\ piece\ to\ validate\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04208}04208\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04209}04209\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04210}04210\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&capture\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04211}04211\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04212}04212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04213}04213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04214}04214\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04215}04215\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04216}04216\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NO\ manual\ player\ switch\ -\/\ game\_execute\_move()\ already\ does\ it!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04217}04217\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Player\ is\ already\ switched\ by\ game\_execute\_move()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04218}04218\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04219}04219\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ already\ handled\ by\ game\_execute\_move()\ too}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04220}04220\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ do\ post-\/move\ cleanup}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04221}04221\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04222}04222\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04223}04223\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04224}04224\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04225}04225\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04226}04226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04227}04227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04228}04228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04229}04229\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04230}04230\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Capture\ complete!"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04231}04231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04232}04232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04233}04233\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04234}04234\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04235}04235\ \ \ \ \ \ \ \textcolor{comment}{//\ Cancel\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04236}04236\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}][\mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}]\ =\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04237}04237\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04238}04238\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}⚠️\ Capture\ cancelled"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04239}04239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04240}04240\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04241}04241\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04242}04242\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04243}04243\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04244}04244\ \ \ \textcolor{comment}{//\ OPRAVA:\ Kontrola\ opponent\ piece\ recovery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04245}04245\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da8d38d078f83ba6d016773d797e914e80}{GAME\_STATE\_WAITING\_FOR\_RETURN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04246}04246\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04247}04247\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Processing\ opponent\ piece\ return"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04248}04248\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04249}04249\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04250}04250\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Opponent\ piece\ returned\ to\ original\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04251}04251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04252}04252\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04253}04253\ \ \ \ \ \ \ \textcolor{comment}{//\ Vrátit\ figurku\ na\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04254}04254\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04255}04255\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04256}04256\ \ \ \ \ \ \ \textcolor{comment}{//\ FIX:\ Resetovat\ error\_recovery\_state\ (byl\ nastaven\ při\ PICKUP)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04257}04257\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04258}04258\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04259}04259\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04260}04260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Clearing\ error\_recovery\_state\ after\ opponent\ piece\ return"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04261}04261\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04262}04262\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04263}04263\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04264}04264\ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ opponent\ piece\ recovery\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04265}04265\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04266}04266\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04267}04267\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04268}04268\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04269}04269\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04270}04270\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04271}04271\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04272}04272\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04273}04273\ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04274}04274\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04275}04275\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04276}04276\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04277}04277\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04278}04278\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04279}04279\ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ LED\ a\ ukázat\ normální\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04280}04280\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04281}04281\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04282}04282\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04283}04283\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Opponent\ piece\ returned\ -\/\ continue\ game"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04284}04284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04285}04285\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04286}04286\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04287}04287\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04288}04288\ \ \ \ \ \textcolor{comment}{//\ NESPRÁVNÉ\ POLOŽENÍ:\ Figurka\ se\ pokládá\ na\ jinou\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04289}04289\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04290}04290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Opponent\ piece\ placed\ at\ wrong\ position\ \%c\%d\ (should\ be\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04291}04291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04292}04292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04293}04293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04294}04294\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ aktuální\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04295}04295\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04296}04296\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04297}04297\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04298}04298\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ board\ (figurka\ je\ nyní\ na\ nové\ pozici)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04299}04299\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04300}04300\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04301}04301\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ lifted\ piece\ state\ pro\ další\ pokus}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04302}04302\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04303}04303\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04304}04304\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04305}04305\ \ \ \ \ \textcolor{comment}{//\ LED:\ Zobrazit\ červenou\ LED\ na\ původní\ pozici\ (kde\ má\ být\ figurka}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04306}04306\ \ \ \ \ \textcolor{comment}{//\ vrácena)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04307}04307\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04308}04308\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04309}04309\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}},\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04310}04310\ \ \ \ \ \ \ \ \ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Solid\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04311}04311\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04312}04312\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04313}04313\ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04314}04314\ \ \ \ \ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04315}04315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Opponent\ piece\ at\ wrong\ position\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04316}04316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔴\ Return\ to\ RED\ square\ (\%c\%d)\ to\ continue"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04317}04317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04318}04318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04319}04319\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(error\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04320}04320\ \ \ \ \ \ \ strcpy(error\_msg,\ \textcolor{stringliteral}{"{}⚠️\ Return\ opponent\ piece\ to\ RED\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04321}04321\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04322}04322\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04323}04323\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04324}04324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04325}04325\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04326}04326\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04327}04327\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04328}04328\ \ \ \textcolor{comment}{//\ KONTROLA:\ Je\ figurka\ v\ error\ recovery\ stavu?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04329}04329\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04330}04330\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Processing\ move\ correction\ from\ error\ state"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04331}04331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04332}04332\ \ \ \ \ \textcolor{comment}{//\ KONTROLA\ NÁVRATU\ NA\ PŮVODNÍ\ POZICI}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04333}04333\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04334}04334\ \ \ \ \ \ \ \ \ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04335}04335\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04336}04336\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}↩️\ Piece\ returned\ to\ ORIGINAL\ valid\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04337}04337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04338}04338\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04339}04339\ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Opravit\ board\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04340}04340\ \ \ \ \ \ \ \textcolor{comment}{//\ Odstranit\ figurku\ z\ neplatné\ pozice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04341}04341\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row]}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04342}04342\ \ \ \ \ \ \ \ \ \ \ \ [\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04343}04343\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04344}04344\ \ \ \ \ \ \ \textcolor{comment}{//\ Vrátit\ figurku\ na\ původní\ validní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04345}04345\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04346}04346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04347}04347\ \ \ \ \ \ \ \textcolor{comment}{//\ RESETOVAT\ error\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04348}04348\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04349}04349\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04350}04350\ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ LED\ a\ ukázat\ normální\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04351}04351\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04352}04352\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04353}04353\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04354}04354\ \ \ \ \ \ \ \textcolor{comment}{//\ RESETOVAT\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04355}04355\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04356}04356\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04357}04357\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04358}04358\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04359}04359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04360}04360\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Piece\ returned\ to\ original\ valid\ position"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04361}04361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04362}04362\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04363}04363\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04364}04364\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04365}04365\ \ \ \ \ \textcolor{comment}{//\ Pokus\ o\ jiný\ tah\ z\ error\ pozice\ -\/\ validovat\ jako\ normální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04366}04366\ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ correction\_move\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04367}04367\ \ \ \ \ \ \ \ \ .from\_row\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04368}04368\ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04369}04369\ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04370}04370\ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04371}04371\ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04372}04372\ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04373}04373\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04374}04374\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04375}04375\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&correction\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04376}04376\ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04377}04377\ \ \ \ \ \ \ \textcolor{comment}{//\ Validní\ korekční\ tah!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04378}04378\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Valid\ correction\ move\ from\ error\ position"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04379}04379\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04380}04380\ \ \ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ board\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04381}04381\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row]}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04382}04382\ \ \ \ \ \ \ \ \ \ \ \ [\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04383}04383\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04384}04384\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04385}04385\ \ \ \ \ \ \ \textcolor{comment}{//\ Provést\ normální\ move\ execution}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04386}04386\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&correction\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04387}04387\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Úspěšný\ tah\ -\/\ resetovat\ error\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04388}04388\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04389}04389\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04390}04390\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Změnit\ hráče\ a\ přepnout\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04391}04391\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04392}04392\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04393}04393\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04394}04394\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04395}04395\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04396}04396\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04397}04397\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04398}04398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (correction):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04399}04399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04400}04400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04401}04401\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04402}04402\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04403}04403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04404}04404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Kontrola\ checkmate/stalemate\ po\ correction\ tahu!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04405}04405\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04406}04406\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04407}04407\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04408}04408\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04409}04409\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎉\ Game\ finished\ detected\ in\ correction\ move!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04410}04410\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04411}04411\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04412}04412\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ LED\ a\ ukázat\ nový\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04413}04413\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04414}04414\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04415}04415\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04416}04416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04417}04417\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04418}04418\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04419}04419\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04420}04420\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04421}04421\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04422}04422\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04423}04423\ \ \ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04424}04424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Correction\ move\ successful:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04425}04425\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04426}04426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04427}04427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04428}04428\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04429}04429\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04430}04430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04431}04431\ \ \ \ \ \textcolor{comment}{//\ Stále\ neplatný\ tah\ -\/\ pokračovat\ v\ error\ stavu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04432}04432\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Correction\ move\ still\ invalid:\ error\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04433}04433\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04434}04434\ \ \ \ \ \textcolor{comment}{//\ FIX\ KRITICKÝ:\ Aktualizovat\ board\ stav\ a\ invalid\ pozici!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04435}04435\ \ \ \ \ \textcolor{comment}{//\ Figurka\ se\ FYZICKY\ přesunula\ z\ A5\ na\ H5,\ musíme\ to\ reflektovat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04436}04436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04437}04437\ \ \ \ \ \textcolor{comment}{//\ 1.\ Přesunout\ figurku\ na\ boardu\ z\ old\ invalid\ na\ new\ invalid}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04438}04438\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row][\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04439}04439\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04440}04440\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04441}04441\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04442}04442\ \ \ \ \ \textcolor{comment}{//\ 2.\ Aktualizovat\ invalid\ pozici\ na\ novou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04443}04443\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ to\_row;\ \textcolor{comment}{//\ H5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04444}04444\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04445}04445\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04446}04446\ \ \ \ \ \textcolor{comment}{//\ 3.\ Aktualizovat\ lifted\ piece\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04447}04447\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04448}04448\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04449}04449\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04450}04450\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04451}04451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔧\ Successive\ invalid\ move:\ updated\ invalid\ position\ to\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04452}04452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(original\_valid\ still\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04453}04453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04454}04454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04455}04455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04456}04456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04457}04457\ \ \ \ \ \textcolor{comment}{//\ 4.\ Poslat\ odpověď\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04458}04458\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04459}04459\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04460}04460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Still\ invalid\ move\ to\ \%c\%d\ -\/\ return\ to\ ORIGINAL\ \%c\%d\ or\ find\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04461}04461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}valid\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04462}04462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04463}04463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04464}04464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04465}04465\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04466}04466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04467}04467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04468}04468\ \ \ \ \ \textcolor{comment}{//\ 5.\ Blikat\ červeně\ na\ NOVÉ\ invalid\ pozici\ (H5,\ ne\ A5!)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04469}04469\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04470}04470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04471}04471\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04472}04472\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04473}04473\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04474}04474\ \ \ \textcolor{comment}{//\ NORMÁLNÍ\ PROCESSING\ -\/\ kontrola\ jestli\ máme\ lifted\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04475}04475\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04476}04476\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ piece\ was\ lifted\ -\/\ use\ UP\ command\ first"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04477}04477\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ No\ piece\ was\ lifted\ -\/\ use\ UP\ command\ first"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04478}04478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{true},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04479}04479\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04480}04480\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04481}04481\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04482}04482\ \ \ \textcolor{comment}{//\ KONTROLA\ ZRUŠENÍ\ TAHU\ (drop\ na\ stejné\ pole)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04483}04483\ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04484}04484\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Move\ cancelled:\ piece\ placed\ on\ source\ square\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04485}04485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04486}04486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04487}04487\ \ \ \ \ \textcolor{comment}{//\ Reset\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04488}04488\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04489}04489\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04490}04490\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04491}04491\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04492}04492\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04493}04493\ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04494}04494\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04495}04495\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04496}04496\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04497}04497\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Move\ cancelled"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04498}04498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04499}04499\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04500}04500\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04501}04501\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04502}04502\ \ \ \textcolor{comment}{//\ VALIDACE\ TAHU}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04503}04503\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ move\ =\ \{.from\_row\ =\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04504}04504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04505}04505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04506}04506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04507}04507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04508}04508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04509}04509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04510}04510\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04511}04511\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04512}04512\ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04513}04513\ \ \ \ \ \textcolor{comment}{//\ VALIDNÍ\ TAH\ -\/\ normální\ processing}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04514}04514\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Valid\ move\ detected"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04515}04515\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04516}04516\ \ \ \ \ \textcolor{comment}{//\ Detect\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04517}04517\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_castling\ =\ (\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04518}04518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04519}04519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})to\_col\ -\/\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}})\ ==\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04520}04520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04521}04521\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04522}04522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ game\_process\_drop\_command:\ BEFORE\ game\_execute\_move,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04523}04523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_player=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04524}04524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04525}04525\ \ \ \ \ \textcolor{keywordtype}{bool}\ move\_success\ =\ \mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04526}04526\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04527}04527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ game\_process\_drop\_command:\ AFTER\ game\_execute\_move,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04528}04528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}move\_success=\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04529}04529\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_success);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04530}04530\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04531}04531\ \ \ \ \ \textcolor{keywordflow}{if}\ (move\_success)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04532}04532\ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Reset\ error\ state\ při\ jakémkoliv\ validním\ tahu!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04533}04533\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04534}04534\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Valid\ move\ -\/\ clearing\ error\ recovery\ state"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04535}04535\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04536}04536\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04537}04537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04538}04538\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04539}04539\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ move\ path\ animaci\ PŘED\ změnou\ hráče\ (podle\ starého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04540}04540\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04541}04541\ \ \ \ \ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04542}04542\ \ \ \ \ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04543}04543\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ move\_path\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04544}04544\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dab4580f84f360910c3c26cd55b1ecdf42}{LED\_CMD\_ANIM\_MOVE\_PATH}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04545}04545\ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04546}04546\ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04547}04547\ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04548}04548\ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04549}04549\ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04550}04550\ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&to\_led\ \textcolor{comment}{//\ Cílová\ pozice\ v\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04551}04551\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04552}04552\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&move\_path\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04553}04553\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04554}04554\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Animace\ běží\ asynchronně,\ neblokujeme\ zpracování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04555}04555\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Animace\ jsou\ spuštěny\ v\ led\_task\ a\ běží\ nezávisle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04556}04556\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (vTaskDelay\ odstraněn\ pro\ lepší\ throughput)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04557}04557\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04558}04558\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ HRÁČ\ SE\ UŽ\ ZMĚNIL\ V\ game\_execute\_move()\ -\/\ použít\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04559}04559\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04560}04560\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04561}04561\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04562}04562\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04563}04563\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (drop):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04564}04564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04565}04565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04566}04566\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04567}04567\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04568}04568\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04569}04569\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04570}04570\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04571}04571\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04572}04572\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04573}04573\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04574}04574\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04575}04575\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04576}04576\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04577}04577\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04578}04578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player;\ \textcolor{comment}{//\ Vítěz\ je\ předchozí\ hráč\ (ten,\ kdo\ udělal\ tah)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04579}04579\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04580}04580\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04581}04581\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04582}04582\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04583}04583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04584}04584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04585}04585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04586}04586\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04587}04587\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04588}04588\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04589}04589\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04590}04590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ in\ DROP\ command!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04591}04591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04592}04592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04593}04593\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04594}04594\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04595}04595\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04596}04596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04597}04597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04598}04598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04599}04599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04600}04600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04601}04601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04602}04602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&winner\ \ \ \textcolor{comment}{//\ Pass\ winner\ color\ to\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04603}04603\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04604}04604\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04605}04605\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04606}04606\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04607}04607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04608}04608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04609}04609\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04610}04610\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci\ s\ NOVÝM\ hráčem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04611}04611\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (current\_player)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04612}04612\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04613}04613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04614}04614\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04615}04615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ OPRAVA:\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04616}04616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04617}04617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04618}04618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04619}04619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04620}04620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04621}04621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04622}04622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04623}04623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ NOVÉHO\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04624}04624\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04625}04625\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04626}04626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04627}04627\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04628}04628\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04629}04629\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04630}04630\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04631}04631\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04632}04632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04633}04633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04634}04634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04635}04635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04636}04636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04637}04637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04638}04638\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04639}04639\ \ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04640}04640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04641}04641\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04642}04642\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04643}04643\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04644}04644\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ movable\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04645}04645\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04646}04646\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04647}04647\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04648}04648\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04649}04649\ \ \ \ \ \ \ \textcolor{comment}{//\ MATRIX\ COMPATIBILITY:\ Show\ opponent\ pieces\ after\ successful\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04650}04650\ \ \ \ \ \ \ \textcolor{comment}{//\ (same\ as\ matrix\ flow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04651}04651\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04652}04652\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04653}04653\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04654}04654\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04655}04655\ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ lifted\ piece\ state\ po\ úspěšném\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04656}04656\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04657}04657\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04658}04658\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04659}04659\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04660}04660\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04661}04661\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04662}04662\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ success\_msg);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04663}04663\ \ \ \ \ \ \ snprintf(success\_msg\ +\ strlen(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04664}04664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(success\_msg)\ -\/\ strlen(success\_msg),\ \textcolor{stringliteral}{"{}\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04665}04665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04666}04666\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📤\ Sending\ success\ response..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04667}04667\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04668}04668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04669}04669\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📤\ Success\ response\ sent"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04670}04670\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04671}04671\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04672}04672\ \ \ \ \ \textcolor{comment}{//\ NEVALIDNÍ\ TAH\ -\/\ ENHANCED\ ERROR\ HANDLING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04673}04673\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ move\ attempt:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04674}04674\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04675}04675\ \ \ \ \ \textcolor{comment}{//\ FIX\ KRITICKÝ:\ Rozlišit\ první\ error\ vs\ další\ errory}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04676}04676\ \ \ \ \ \textcolor{keywordtype}{bool}\ already\_in\_error\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04677}04677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04678}04678\ \ \ \ \ \textcolor{comment}{//\ SPOLEČNÉ\ NASTAVENÍ\ pro\ všechny\ chyby}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04679}04679\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04680}04680\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04681}04681\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04682}04682\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04683}04683\ \ \ \ \ \ \ \ \ to\_row;\ \textcolor{comment}{//\ Aktualizovat\ na\ novou\ neplatnou\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04684}04684\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04685}04685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04686}04686\ \ \ \ \ \textcolor{comment}{//\ FIX\ KRITICKÝ:\ Nastavit\ original\_valid\ POUZE\ při\ PRVNÍM\ erroru!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04687}04687\ \ \ \ \ \textcolor{comment}{//\ Při\ dalších\ errorech\ NEPŘEPISOVAT\ -\/\ original\ zůstává\ stejné\ (A2)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04688}04688\ \ \ \ \ \textcolor{keywordflow}{if}\ (!already\_in\_error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04689}04689\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04690}04690\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}};\ \textcolor{comment}{//\ A2\ -\/\ první\ validní\ pozice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04691}04691\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04692}04692\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔧\ First\ error:\ original\_valid\ set\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04693}04693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04694}04694\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04695}04695\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04696}04696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔧\ Successive\ error:\ original\_valid\ stays\ at\ \%c\%d\ (invalid\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04697}04697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}moves\ to\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04698}04698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04699}04699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04700}04700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04701}04701\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04702}04702\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04703}04703\ \ \ \ \ \textcolor{comment}{//\ AKTUALIZOVAT\ board\ stav\ -\/\ figurka\ je\ nyní\ na\ neplatném\ poli\ (fyzická}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04704}04704\ \ \ \ \ \textcolor{comment}{//\ realita)\ Board\ musí\ odpovídat\ fyzickému\ stavu,\ aby\ PICKUP\ fungoval}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04705}04705\ \ \ \ \ \textcolor{comment}{//\ správně!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04706}04706\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}][\mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04707}04707\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ původní\ pole\ prázdné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04708}04708\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}};\ \textcolor{comment}{//\ neplatné\ pole\ má\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04709}04709\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04710}04710\ \ \ \ \ \textcolor{comment}{//\ AKTUALIZOVAT\ lifted\_piece\ tracking\ na\ novou\ neplatnou\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04711}04711\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04712}04712\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04713}04713\ \ \ \ \ \textcolor{comment}{//\ piece\_lifted\ =\ true;\ //\ Zůstává\ true!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04714}04714\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04715}04715\ \ \ \ \ \textcolor{comment}{//\ LED\ INDIKACE\ -\/\ červené\ blikání\ na\ neplatném\ poli}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04716}04716\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(to\_row,\ to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04717}04717\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04718}04718\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04719}04719\ \ \ \ \ snprintf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04720}04720\ \ \ \ \ \ \ \ \ error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04721}04721\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ move\ to\ \%s\ -\/\ return\ to\ ORIGINAL\ \%c\%d\ or\ find\ valid\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04722}04722\ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04723}04723\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04724}04724\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04725}04725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04726}04726\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04727}04727\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04728}04728\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04734}\mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{04734}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(uint8\_t\ error\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04735}04735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ error\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04736}04736\ \ \ \ \ \textcolor{comment}{//\ Přerušit\ předchozí\ blikání}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04737}04737\ \ \ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04738}04738\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04739}04739\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ Starting\ non-\/blocking\ blink\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ error\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04740}04740\ \ \ \ \ \ \ \ \ \ \ \ error\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04741}04741\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04742}04742\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04743}04743\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04744}04744\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(error\_row,\ error\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04745}04745\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04746}04746\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.max\_blinks\ =\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04747}04747\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.last\_toggle\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04748}04748\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_interval\_ms\ =\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04749}04749\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04750}04750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04751}04751\ \ \ \textcolor{comment}{//\ Spustit\ první\ toggle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04752}04752\ \ \ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04753}04753\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04754}04754\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04758}\mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{04758}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04759}04759\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04760}04760\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04761}04761\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04762}04762\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04763}04763\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04764}04764\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04765}04765\ \ \ \textcolor{comment}{//\ Kontrola\ timeoutu\ pro\ toggle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04766}04766\ \ \ \textcolor{keywordflow}{if}\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.last\_toggle\_time\ >=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04767}04767\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_interval\_ms)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04768}04768\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04769}04769\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04770}04770\ \ \ \ \ \textcolor{comment}{//\ Toggle\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04771}04771\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04772}04772\ \ \ \ \ \ \ \textcolor{comment}{//\ Vypnout\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04773}04773\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04774}04774\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04775}04775\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04776}04776\ \ \ \ \ \ \ \textcolor{comment}{//\ Zapnout\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04777}04777\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Červená}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04778}04778\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04779}04779\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04780}04780\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04781}04781\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.last\_toggle\_time\ =\ current\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04782}04782\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04783}04783\ \ \ \ \ \textcolor{comment}{//\ Kontrola\ ukončení\ blikání}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04784}04784\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_count\ >=\ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.max\_blinks)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04785}04785\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04786}04786\ \ \ \ \ \ \ \textcolor{comment}{//\ Nechat\ LED\ rozsvícenou\ na\ konci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04787}04787\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 255,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04788}04788\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Error\ blink\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04789}04789\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04790}04790\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04791}04791\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04792}04792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04796}\mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{04796}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04797}04797\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04798}04798\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04799}04799\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 0,\ 0,\ 0);\ \textcolor{comment}{//\ Vypnout\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04800}04800\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🛑\ Error\ blink\ interrupted\ by\ user\ action"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04801}04801\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04802}04802\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04803}04803\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04807}\mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{04807}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04808}04808\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04809}04809\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04810}04810\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04811}04811\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04812}04812\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04813}04813\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04814}04814\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04815}04815\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04816}04816\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04817}04817\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Error\ recovery\ state\ reset"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04818}04818\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04819}04819\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04820}04820\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04821}04821\ \textcolor{comment}{//\ PROMOTION\ HELPER\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04822}04822\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04823}04823\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04842}\mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{04842}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04843}04843\ \ \ \textcolor{comment}{//\ Reset\ promotion\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04844}04844\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04845}04845\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04846}04846\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04847}04847\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04848}04848\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04849}04849\ \ \ \textcolor{comment}{//\ Check\ for\ pawns\ on\ promotion\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04850}04850\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04851}04851\ \ \ \ \ \textcolor{comment}{//\ White\ pawn\ on\ rank\ 8\ (row\ 7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04852}04852\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04853}04853\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04854}04854\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04855}04855\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04856}04856\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04857}04857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04858}04858\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ White\ promotion\ needed\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04859}04859\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04860}04860\ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ promotion\ menu\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04861}04861\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04862}04862\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04863}04863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04864}04864\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ PAWN\ PROMOTION\ AVAILABLE!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04865}04865\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04866}04866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04867}04867\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📍\ Square:\ \%c\%d\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04868}04868\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎮\ Player:\ White\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04869}04869\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04870}04870\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎯\ Choose\ promotion\ piece:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04871}04871\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04872}04872\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}💡\ PHYSICAL\ BUTTONS\ (press\ one):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04873}04873\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 0\ (LED\ 64\ 🟢)\ →\ QUEEN\ \ (most\ powerful)\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04874}04874\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 1\ (LED\ 65\ 🟢)\ →\ ROOK\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04875}04875\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 2\ (LED\ 66\ 🟢)\ →\ BISHOP\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04876}04876\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 3\ (LED\ 67\ 🟢)\ →\ KNIGHT\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04877}04877\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04878}04878\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📝\ UART\ COMMANDS\ (alternative):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04879}04879\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=Q\ \ →\ Queen\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04880}04880\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=R\ \ →\ Rook\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04881}04881\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=B\ \ →\ Bishop\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04882}04882\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=N\ \ →\ Knight\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04883}04883\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04884}04884\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}⚠️\ \ Note:\ Physical\ piece\ movements\ are\ PAUSED\ until\ promotion\ is\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04885}04885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}completed\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04886}04886\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04887}04887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04888}04888\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04889}04889\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04890}04890\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04891}04891\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04892}04892\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04893}04893\ \ \ \ \ \textcolor{comment}{//\ Black\ pawn\ on\ rank\ 1\ (row\ 0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04894}04894\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04895}04895\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04896}04896\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04897}04897\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04898}04898\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04899}04899\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04900}04900\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Black\ promotion\ needed\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04901}04901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04902}04902\ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ promotion\ menu\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04903}04903\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04904}04904\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04905}04905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04906}04906\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ PAWN\ PROMOTION\ AVAILABLE!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04907}04907\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04908}04908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04909}04909\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📍\ Square:\ \%c\%d\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04910}04910\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎮\ Player:\ Black\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04911}04911\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04912}04912\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎯\ Choose\ promotion\ piece:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04913}04913\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04914}04914\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}💡\ PHYSICAL\ BUTTONS\ (press\ one):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04915}04915\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 0\ (LED\ 68\ 🟢)\ →\ QUEEN\ \ (most\ powerful)\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04916}04916\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 1\ (LED\ 69\ 🟢)\ →\ ROOK\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04917}04917\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 2\ (LED\ 70\ 🟢)\ →\ BISHOP\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04918}04918\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 3\ (LED\ 71\ 🟢)\ →\ KNIGHT\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04919}04919\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04920}04920\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📝\ UART\ COMMANDS\ (alternative):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04921}04921\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=Q\ \ →\ Queen\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04922}04922\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=R\ \ →\ Rook\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04923}04923\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=B\ \ →\ Bishop\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04924}04924\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=N\ \ →\ Knight\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04925}04925\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04926}04926\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}⚠️\ \ Note:\ Physical\ piece\ movements\ are\ PAUSED\ until\ promotion\ is\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04927}04927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}completed\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04928}04928\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04929}04929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04930}04930\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04931}04931\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04932}04932\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04933}04933\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04934}04934\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04935}04935\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04936}04936\ \ \ \textcolor{comment}{//\ Update\ LED\ indications\ for\ all\ promotion\ buttons}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04937}04937\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04938}04938\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04939}04939\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ promotion\ buttons\ (64-\/67):\ GREEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04940}04940\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 64;\ i\ <=\ 67;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04941}04941\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04942}04942\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04943}04943\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ promotion\ buttons\ (68-\/71):\ BLUE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04944}04944\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 68;\ i\ <=\ 71;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04945}04945\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04946}04946\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04947}04947\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04948}04948\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ promotion\ buttons\ (64-\/67):\ BLUE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04949}04949\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 64;\ i\ <=\ 67;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04950}04950\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04951}04951\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04952}04952\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ promotion\ buttons\ (68-\/71):\ GREEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04953}04953\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 68;\ i\ <=\ 71;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04954}04954\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04955}04955\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04956}04956\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04957}04957\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04958}04958\ \ \ \ \ \textcolor{comment}{//\ No\ promotion\ pending\ -\/\ all\ promotion\ buttons\ BLUE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04959}04959\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 64;\ i\ <=\ 71;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04960}04960\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04961}04961\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04962}04962\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04963}04963\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04964}04964\ \ \ \textcolor{comment}{//\ Reset\ button\ (LED\ 72):\ Always\ GREEN\ (always\ active)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04965}04965\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(72,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04966}04966\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04967}04967\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04982}\mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{04982}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{game\_process\_promotion\_button}}(uint8\_t\ button\_id)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04983}04983\ \ \ \textcolor{comment}{//\ Check\ if\ promotion\ is\ pending}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04984}04984\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04985}04985\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Promotion\ button\ \%d\ pressed\ but\ no\ promotion\ pending"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04986}04986\ \ \ \ \ \ \ \ \ \ \ \ \ \ button\_id);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04987}04987\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04988}04988\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04989}04989\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04990}04990\ \ \ \textcolor{comment}{//\ Map\ physical\ button\ ID\ (0-\/3)\ to\ promotion\ choice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04991}04991\ \ \ \textcolor{comment}{//\ Physical\ buttons\ are\ shared\ between\ players:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04992}04992\ \ \ \textcolor{comment}{//\ -\/\ Button\ 0:\ QUEEN\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04993}04993\ \ \ \textcolor{comment}{//\ -\/\ Button\ 1:\ ROOK\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04994}04994\ \ \ \textcolor{comment}{//\ -\/\ Button\ 2:\ BISHOP\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04995}04995\ \ \ \textcolor{comment}{//\ -\/\ Button\ 3:\ KNIGHT\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04996}04996\ \ \ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04997}04997\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04998}04998\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04999}04999\ \ \ \textcolor{keywordflow}{if}\ (button\_id\ <=\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05000}05000\ \ \ \ \ \textcolor{comment}{//\ Valid\ physical\ button\ (0-\/3)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05001}05001\ \ \ \ \ choice\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})button\_id;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05002}05002\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05003}05003\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Invalid\ promotion\ button\ ID:\ \%d\ (expected\ 0-\/3)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05004}05004\ \ \ \ \ \ \ \ \ \ \ \ \ \ button\_id);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05005}05005\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05006}05006\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05007}05007\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05008}05008\ \ \ \textcolor{comment}{//\ Get\ piece\ name}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05009}05009\ \ \ \textcolor{keywordflow}{switch}\ (choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05010}05010\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05011}05011\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05012}05012\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05013}05013\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05014}05014\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05015}05015\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05016}05016\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05017}05017\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05018}05018\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05019}05019\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05020}05020\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05021}05021\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05022}05022\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05023}05023\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05024}05024\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05025}05025\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05026}05026\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05027}05027\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Processing\ promotion\ button\ \%d:\ \%s"{}},\ button\_id,\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05028}05028\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05029}05029\ \ \ \textcolor{comment}{//\ Execute\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05030}05030\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(choice))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05031}05031\ \ \ \ \ \textcolor{comment}{//\ Clear\ promotion\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05032}05032\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05033}05033\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05034}05034\ \ \ \ \ \textcolor{comment}{//\ Log\ success}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05035}05035\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05036}05036\ \ \ \ \ printf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05037}05037\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05038}05038\ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ PAWN\ PROMOTION\ SUCCESSFUL!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05039}05039\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Square:\ \%c\%d\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05040}05040\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05041}05041\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Promoted\ to:\ \%s\(\backslash\)r\(\backslash\)n"{}},\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05042}05042\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Player:\ \%s\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05043}05043\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05044}05044\ \ \ \ \ printf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05045}05045\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05046}05046\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05047}05047\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05048}05048\ \ \ \ \ \textcolor{comment}{//\ Switch\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05049}05049\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05050}05050\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05051}05051\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05052}05052\ \ \ \ \ \textcolor{comment}{//\ ✅\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05053}05053\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05054}05054\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05055}05055\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05056}05056\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05057}05057\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05058}05058\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05059}05059\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05060}05060\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05061}05061\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05062}05062\ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05063}05063\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05064}05064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05065}05065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05066}05066\ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05067}05067\ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05068}05068\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05069}05069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05070}05070\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05071}05071\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05072}05072\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05073}05073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ promotion!\ Starting\ endgame\ animation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05074}05074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05075}05075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05076}05076\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05077}05077\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05078}05078\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05079}05079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05080}05080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05081}05081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05082}05082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05083}05083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05084}05084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05085}05085\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05086}05086\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05087}05087\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05088}05088\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05089}05089\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05090}05090\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05091}05091\ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05092}05092\ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05093}05093\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05094}05094\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05095}05095\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05096}05096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05097}05097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05098}05098\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05099}05099\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05100}05100\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05101}05101\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05102}05102\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05103}05103\ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05104}05104\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05105}05105\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05106}05106\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05107}05107\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05108}05108\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05109}05109\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05110}05110\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05111}05111\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05112}05112\ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05113}05113\ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05114}05114\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05115}05115\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05116}05116\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05117}05117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05118}05118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05119}05119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05120}05120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05121}05121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05122}05122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05123}05123\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05124}05124\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05125}05125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05126}05126\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05127}05127\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05128}05128\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promotion\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05129}05129\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05130}05130\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Promotion\ execution\ failed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05131}05131\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05132}05132\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05133}05133\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05134}05134\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05135}05135\ \textcolor{comment}{//\ GRAPH\ GENERATION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05136}05136\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05137}05137\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05145}\mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{05145}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{game\_generate\_advantage\_graph}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05146}05146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ game\_duration,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05147}05147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ total\_moves)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05148}05148\ \ \ \textcolor{keywordflow}{if}\ (!buffer\ ||\ buffer\_size\ <\ 512)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05149}05149\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05150}05150\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05151}05151\ \ \ \textcolor{comment}{//\ Graph\ dimensions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05152}05152\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ GRAPH\_WIDTH\ =\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05153}05153\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ GRAPH\_HEIGHT\ =\ 20;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05154}05154\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ MAX\_ADVANTAGE\ =\ 100;\ \textcolor{comment}{//\ Maximum\ advantage\ percentage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05155}05155\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05156}05156\ \ \ \textcolor{keywordtype}{char}\ *ptr\ =\ buffer;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05157}05157\ \ \ \textcolor{keywordtype}{size\_t}\ remaining\ =\ buffer\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05158}05158\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05159}05159\ \ \ \textcolor{comment}{//\ Graph\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05160}05160\ \ \ \textcolor{keywordtype}{int}\ written\ =\ snprintf(ptr,\ remaining,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05161}05161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n📈\ Game\ Advantage\ Graph\ (Chess.com\ Style):\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05162}05162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ White\ Advantage\ \%\%\%\%\ \ |\ \ Time\ (minutes)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05163}05163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05164}05164\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05165}05165\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05166}05166\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05167}05167\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05168}05168\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05169}05169\ \ \ \textcolor{comment}{//\ Generate\ graph\ data\ points\ based\ on\ move\ history\ and\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05170}05170\ \ \ \textcolor{keywordtype}{int}\ graph\_data[GRAPH\_WIDTH];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05171}05171\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05172}05172\ \ \ \textcolor{comment}{//\ Simulate\ advantage\ curve\ based\ on\ real\ game\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05173}05173\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ GRAPH\_WIDTH;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05174}05174\ \ \ \ \ \textcolor{keywordtype}{float}\ progress\ =\ (float)i\ /\ (GRAPH\_WIDTH\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05175}05175\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05176}05176\ \ \ \ \ \textcolor{comment}{//\ Calculate\ advantage\ based\ on\ material\ balance\ and\ move\ progression}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05177}05177\ \ \ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05178}05178\ \ \ \ \ \textcolor{keywordtype}{int}\ current\_balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05179}05179\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05180}05180\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05181}05181\ \ \ \ \ \textcolor{comment}{//\ Simulate\ advantage\ curve\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05182}05182\ \ \ \ \ \textcolor{keywordtype}{float}\ base\_advantage\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05183}05183\ \ \ \ \ \ \ \ \ (float)current\_balance\ *\ 10.0f;\ \textcolor{comment}{//\ Convert\ material\ to\ percentage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05184}05184\ \ \ \ \ \textcolor{keywordtype}{float}\ time\_factor\ =\ sin(progress\ *\ 3.14159f)\ *\ 20.0f;\ \textcolor{comment}{//\ Oscillating\ factor}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05185}05185\ \ \ \ \ \textcolor{keywordtype}{float}\ move\_factor\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05186}05186\ \ \ \ \ \ \ \ \ (total\_moves\ >\ 0)\ ?\ ((\textcolor{keywordtype}{float})i\ /\ total\_moves)\ *\ 30.0f\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05187}05187\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05188}05188\ \ \ \ \ \textcolor{keywordtype}{int}\ advantage\ =\ (int)(base\_advantage\ +\ time\_factor\ +\ move\_factor);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05189}05189\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05190}05190\ \ \ \ \ \textcolor{comment}{//\ Clamp\ advantage\ to\ valid\ range}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05191}05191\ \ \ \ \ \textcolor{keywordflow}{if}\ (advantage\ >\ MAX\_ADVANTAGE)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05192}05192\ \ \ \ \ \ \ advantage\ =\ MAX\_ADVANTAGE;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05193}05193\ \ \ \ \ \textcolor{keywordflow}{if}\ (advantage\ <\ -\/MAX\_ADVANTAGE)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05194}05194\ \ \ \ \ \ \ advantage\ =\ -\/MAX\_ADVANTAGE;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05195}05195\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05196}05196\ \ \ \ \ graph\_data[i]\ =\ advantage;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05197}05197\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05198}05198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05199}05199\ \ \ \textcolor{comment}{//\ Draw\ graph\ from\ top\ to\ bottom}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05200}05200\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ GRAPH\_HEIGHT\ -\/\ 1;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05201}05201\ \ \ \ \ \textcolor{keywordtype}{float}\ y\_value\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05202}05202\ \ \ \ \ \ \ \ \ (float)row\ /\ (GRAPH\_HEIGHT\ -\/\ 1)\ *\ (2\ *\ MAX\_ADVANTAGE)\ -\/\ MAX\_ADVANTAGE;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05203}05203\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05204}05204\ \ \ \ \ \textcolor{comment}{//\ Y-\/axis\ label}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05205}05205\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ \%\ 4\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05206}05206\ \ \ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\%3.0f\%\%\ |"{}},\ y\_value);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05207}05207\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05208}05208\ \ \ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\ \ \ \ |"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05209}05209\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05210}05210\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05211}05211\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05212}05212\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05213}05213\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05214}05214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05215}05215\ \ \ \ \ \textcolor{comment}{//\ Draw\ graph\ line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05216}05216\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ GRAPH\_WIDTH;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05217}05217\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ advantage\ =\ graph\_data[col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05218}05218\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ symbol\ =\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05219}05219\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05220}05220\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(advantage\ -\/\ (\textcolor{keywordtype}{int})y\_value)\ <=\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05221}05221\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (advantage\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05222}05222\ \ \ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'\#'};\ \textcolor{comment}{//\ White\ advantage\ (solid\ block)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05223}05223\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (advantage\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05224}05224\ \ \ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'*'};\ \textcolor{comment}{//\ Black\ advantage\ (darker\ block)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05225}05225\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05226}05226\ \ \ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'-\/'};\ \textcolor{comment}{//\ Equal\ (line)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05227}05227\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05228}05228\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (row\ ==\ GRAPH\_HEIGHT\ /\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05229}05229\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'-\/'};\ \textcolor{comment}{//\ Center\ line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05230}05230\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05231}05231\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05232}05232\ \ \ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\%c"{}},\ symbol);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05233}05233\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05234}05234\ \ \ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05235}05235\ \ \ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05236}05236\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05237}05237\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05238}05238\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05239}05239\ \ \ \ \ \textcolor{comment}{//\ End\ of\ line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05240}05240\ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05241}05241\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05242}05242\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05243}05243\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05244}05244\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05245}05245\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05246}05246\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05247}05247\ \ \ \textcolor{comment}{//\ X-\/axis}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05248}05248\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\ \ \ \ +"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05249}05249\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05250}05250\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05251}05251\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05252}05252\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05253}05253\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05254}05254\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ GRAPH\_WIDTH;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05255}05255\ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}-\/"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05256}05256\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05257}05257\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05258}05258\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05259}05259\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05260}05260\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05261}05261\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05262}05262\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05263}05263\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05264}05264\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05265}05265\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05266}05266\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05267}05267\ \ \ \textcolor{comment}{//\ X-\/axis\ labels}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05268}05268\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\ \ \ \ \ 0"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05269}05269\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05270}05270\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05271}05271\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05272}05272\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05273}05273\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05274}05274\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <=\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05275}05275\ \ \ \ \ \textcolor{keywordtype}{int}\ label\_pos\ =\ (GRAPH\_WIDTH\ /\ 5)\ *\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05276}05276\ \ \ \ \ \textcolor{keywordtype}{float}\ time\_label\ =\ (float)i\ /\ 5.0f\ *\ (game\_duration\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05277}05277\ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\%*s\%.1f"{}},\ label\_pos\ -\/\ (i\ >\ 1\ ?\ 3\ :\ 0),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05278}05278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}},\ time\_label);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05279}05279\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05280}05280\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05281}05281\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05282}05282\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05283}05283\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05284}05284\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05285}05285\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05286}05286\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05287}05287\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05288}05288\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05289}05289\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05290}05290\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05291}05291\ \ \ \textcolor{comment}{//\ Legend}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05292}05292\ \ \ written\ =\ snprintf(ptr,\ remaining,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05293}05293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n📊\ Legend:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05294}05294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \#\ =\ White\ Advantage\ (Positive)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05295}05295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ *\ =\ Black\ Advantage\ (Negative)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05296}05296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ -\/\ =\ Equal\ Position\ (0\%\%)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05297}05297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ X-\/axis:\ Game\ Time\ (minutes)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05298}05298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ Y-\/axis:\ Advantage\ Percentage\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05299}05299\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05300}05300\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05301}05301\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05302}05302\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05303}05303\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05304}05304\ \ \ \textcolor{comment}{//\ Ensure\ null\ termination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05305}05305\ \ \ *ptr\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05306}05306\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05307}05307\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05308}05308\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05309}05309\ \textcolor{comment}{//\ KING\ RESIGNATION\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05310}05310\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05311}05311\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05316}\mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{05316}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{resignation\_update\_button\_leds}}(uint32\_t\ elapsed\_ms)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05317}05317\ \ \ \textcolor{comment}{//\ 4\ tlačítka\ hráče\ (indexy\ 64-\/67\ pro\ white,\ 68-\/71\ pro\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05318}05318\ \ \ uint8\_t\ button\_start\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05319}05319\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 64\ :\ 68;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05320}05320\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05321}05321\ \ \ \textcolor{comment}{//\ Každé\ LED\ fáduje\ 2500ms\ (2.5s),\ s\ odstupem\ 2500ms\ mezi\ každým}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05322}05322\ \ \ \textcolor{keyword}{const}\ uint32\_t\ FADE\_DURATION\_MS\ =\ 2500;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05323}05323\ \ \ \textcolor{keyword}{const}\ uint32\_t\ LED\_OFFSET\_MS\ =\ 2500;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05324}05324\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05325}05325\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05326}05326\ \ \ \ \ uint32\_t\ led\_start\_time\ =\ i\ *\ LED\_OFFSET\_MS;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05327}05327\ \ \ \ \ uint8\_t\ brightness\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05328}05328\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05329}05329\ \ \ \ \ \textcolor{keywordflow}{if}\ (elapsed\_ms\ >=\ led\_start\_time)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05330}05330\ \ \ \ \ \ \ uint32\_t\ led\_elapsed\ =\ elapsed\_ms\ -\/\ led\_start\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05331}05331\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (led\_elapsed\ >=\ FADE\_DURATION\_MS)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05332}05332\ \ \ \ \ \ \ \ \ brightness\ =\ 0;\ \textcolor{comment}{//\ Úplně\ zhaslé}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05333}05333\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05334}05334\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lineární\ fade\ z\ 255\ na\ 0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05335}05335\ \ \ \ \ \ \ \ \ brightness\ =\ 255\ -\/\ (led\_elapsed\ *\ 255\ /\ FADE\_DURATION\_MS);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05336}05336\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05337}05337\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05338}05338\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05339}05339\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ LED\ -\/\ oranžová\ barva\ s\ fade}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05340}05340\ \ \ \ \ uint8\_t\ led\_index\ =\ button\_start\_index\ +\ (3\ -\/\ i);\ \textcolor{comment}{//\ Zprava\ doleva}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05341}05341\ \ \ \ \ \mbox{\hyperlink{button__task_8c_ad004f184d705cb6e12a079c8105867bc}{button\_set\_led\_color}}(led\_index,\ brightness,\ brightness\ /\ 2,\ 0);\ \textcolor{comment}{//\ Oranžová}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05342}05342\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05343}05343\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05344}05344\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05348}\mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{05348}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{resignation\_animation\_timer\_callback}}(TimerHandle\_t\ xTimer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05349}05349\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05350}05350\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05351}05351\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05352}05352\ \ \ uint64\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;\ \textcolor{comment}{//\ ms}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05353}05353\ \ \ uint32\_t\ elapsed\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05354}05354\ \ \ \ \ \ \ (uint32\_t)(current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.start\_time\_ms);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05355}05355\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05356}05356\ \ \ \textcolor{comment}{//\ Update\ button\ LEDs}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05357}05357\ \ \ \mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{resignation\_update\_button\_leds}}(elapsed\_ms);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05358}05358\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05359}05359\ \ \ \textcolor{comment}{//\ Countdown\ v\ terminálu\ (každou\ sekundu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05360}05360\ \ \ uint8\_t\ current\_sec\ =\ 10\ -\/\ (elapsed\_ms\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05361}05361\ \ \ \textcolor{keywordflow}{if}\ (current\_sec\ !=\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.last\_countdown\_sec\ \&\&\ current\_sec\ <\ 10)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05362}05362\ \ \ \ \ printf(\textcolor{stringliteral}{"{}⏰\ King\ resignation\ countdown:\ \%d\ second\%s\ remaining...\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05363}05363\ \ \ \ \ \ \ \ \ \ \ \ current\_sec,\ current\_sec\ ==\ 1\ ?\ \textcolor{stringliteral}{"{}"{}}\ :\ \textcolor{stringliteral}{"{}s"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05364}05364\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.last\_countdown\_sec\ =\ current\_sec;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05365}05365\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05366}05366\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05367}05367\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05371}\mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{05371}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{resignation\_main\_timer\_callback}}(TimerHandle\_t\ xTimer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05372}05372\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔔\ RESIGNATION\ TIMER\ CALLBACK\ FIRED!\ (after\ 10\ seconds)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05373}05373\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05374}05374\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05375}05375\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ Resignation\ not\ active,\ skipping\ callback"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05376}05376\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05377}05377\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05378}05378\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05379}05379\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *player\_name\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05380}05380\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05381}05381\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\_name\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05382}05382\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05383}05383\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05384}05384\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏳️\ \%s\ resigned!\ \%s\ wins!"{}},\ player\_name,\ winner\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05385}05385\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05386}05386\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05387}05387\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05388}05388\ \ \ printf(\textcolor{stringliteral}{"{}🏳️\ \%s\ RESIGNED\ by\ lifting\ king\ for\ 10+\ seconds!\(\backslash\)r\(\backslash\)n"{}},\ player\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05389}05389\ \ \ printf(\textcolor{stringliteral}{"{}🏆\ \%s\ WINS\ by\ resignation!\(\backslash\)r\(\backslash\)n"{}},\ winner\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05390}05390\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05391}05391\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05392}05392\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05393}05393\ \ \ \textcolor{comment}{//\ Ukončit\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05394}05394\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05395}05395\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05396}05396\ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05397}05397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05398}05398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05399}05399\ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05400}05400\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ resignation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05401}05401\ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05402}05402\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05403}05403\ \ \ \textcolor{comment}{//\ ✅\ FIX:\ Místo\ přímého\ volání\ game\_print\_endgame\_report\_uart()\ (2KB\ stack!)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05404}05404\ \ \ \textcolor{comment}{//\ pouze\ nastavíme\ flag\ -\/\ report\ se\ vypíše\ v\ game\ task\ s\ dostatečným\ stackem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05405}05405\ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05406}05406\ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ ✅\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05407}05407\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05408}05408\ \ \ \textcolor{comment}{//\ ✅\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05409}05409\ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05410}05410\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05411}05411\ \ \ \textcolor{comment}{//\ Spustit\ victory\ animaci\ pro\ vítěze}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05412}05412\ \ \ uint8\_t\ king\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05413}05413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05414}05414\ \ \ \mbox{\hyperlink{game__led__animations_8c_a512b0ba5745a638b00545a16423c4e17}{start\_endgame\_animation}}(\mbox{\hyperlink{game__led__animations_8h_a30603ef39ed3a32a5ae1be1274874159a7559cb124fcc149b6ba6375635c70757}{ENDGAME\_ANIM\_VICTORY\_WAVE}},\ king\_led);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05415}05415\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05416}05416\ \ \ \textcolor{comment}{//\ Zastavit\ resignation\ (cleanup)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05417}05417\ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});\ \textcolor{comment}{//\ false\ =\ už\ je\ finalizováno}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05418}05418\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05419}05419\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Resignation\ callback\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05420}05420\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05421}05421\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05425}\mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{05425}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{resignation\_start}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05426}05426\ \ \ \textcolor{comment}{//\ Zastavit\ existující\ timer\ pokud\ běží}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05427}05427\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05428}05428\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05429}05429\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05430}05430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05431}05431\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *player\_name\ =\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05432}05432\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n⚠️\ \%s\ king\ lifted\ -\/\ hold\ for\ 10+\ seconds\ to\ resign!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05433}05433\ \ \ \ \ \ \ \ \ \ player\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05434}05434\ \ \ printf(\textcolor{stringliteral}{"{}👑\ Resignation\ timer\ started\ for\ \%s\ player\(\backslash\)r\(\backslash\)n"{}},\ player\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05435}05435\ \ \ printf(\textcolor{stringliteral}{"{}🎨\ Button\ LED\ animation\ started\ (4\ buttons)\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05436}05436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05437}05437\ \ \ \textcolor{comment}{//\ Inicializovat\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05438}05438\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05439}05439\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05440}05440\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05441}05441\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05442}05442\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.start\_time\_ms\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05443}05443\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.last\_countdown\_sec\ =\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05444}05444\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05445}05445\ \ \ \textcolor{comment}{//\ ✅\ CRITICAL\ FIX:\ Odstranit\ krále\ z\ boardu\ (jako\ normální\ pickup)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05446}05446\ \ \ \textcolor{comment}{//\ Jinak\ drop\ kód\ očekává\ prázdné\ pole\ a\ spadne}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05447}05447\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05448}05448\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ King\ removed\ from\ board[\%d][\%d]\ for\ resignation"{}},\ row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05449}05449\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05450}05450\ \ \ \textcolor{comment}{//\ Červené\ podsvícení\ pozice\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05451}05451\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05452}05452\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05453}05453\ \ \ \textcolor{comment}{//\ Spustit\ tlačítka\ na\ plnou\ oranžovou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05454}05454\ \ \ uint8\_t\ button\_start\_index\ =\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 64\ :\ 68;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05455}05455\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05456}05456\ \ \ \ \ \mbox{\hyperlink{button__task_8c_ad004f184d705cb6e12a079c8105867bc}{button\_set\_led\_color}}(button\_start\_index\ +\ i,\ 255,\ 128,\ 0);\ \textcolor{comment}{//\ Plná\ oranžová}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05457}05457\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05458}05458\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05459}05459\ \ \ \textcolor{comment}{//\ Vytvořit\ hlavní\ timer\ (10\ sekund,\ one-\/shot)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05460}05460\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05461}05461\ \ \ \ \ \ \ xTimerCreate(\textcolor{stringliteral}{"{}resignation\_main"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05462}05462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(10000),\ \textcolor{comment}{//\ 10\ sekund}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05463}05463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdFALSE,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ One-\/shot}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05464}05464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NULL,\ \mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{resignation\_main\_timer\_callback}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05465}05465\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05466}05466\ \ \ \textcolor{comment}{//\ Vytvořit\ animation\ timer\ (50ms,\ periodic)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05467}05467\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05468}05468\ \ \ \ \ \ \ xTimerCreate(\textcolor{stringliteral}{"{}resignation\_anim"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05469}05469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(50),\ \textcolor{comment}{//\ 50ms}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05470}05470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdTRUE,\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Periodic}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05471}05471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NULL,\ \mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{resignation\_animation\_timer\_callback}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05472}05472\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05473}05473\ \ \ \textcolor{comment}{//\ ✅\ DEBUG:\ Zkontrolovat\ vytvoření\ timerů}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05474}05474\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05475}05475\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ FAILED\ to\ create\ main\ resignation\ timer!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05476}05476\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05477}05477\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05478}05478\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05479}05479\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05480}05480\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ FAILED\ to\ create\ animation\ timer!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05481}05481\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05482}05482\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05483}05483\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05484}05484\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05485}05485\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Timers\ created\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05486}05486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05487}05487\ \ \ \textcolor{comment}{//\ Spustit\ timery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05488}05488\ \ \ BaseType\_t\ main\_result\ =\ xTimerStart(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05489}05489\ \ \ BaseType\_t\ anim\_result\ =\ xTimerStart(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05490}05490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05491}05491\ \ \ \textcolor{comment}{//\ ✅\ DEBUG:\ Zkontrolovat\ start\ timerů}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05492}05492\ \ \ \textcolor{keywordflow}{if}\ (main\_result\ ==\ pdPASS)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05493}05493\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Main\ timer\ (10s)\ started\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05494}05494\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05495}05495\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ FAILED\ to\ start\ main\ timer!\ Result:\ \%d"{}},\ main\_result);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05496}05496\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05497}05497\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05498}05498\ \ \ \textcolor{keywordflow}{if}\ (anim\_result\ ==\ pdPASS)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05499}05499\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Animation\ timer\ (50ms)\ started\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05500}05500\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05501}05501\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ FAILED\ to\ start\ animation\ timer!\ Result:\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05502}05502\ \ \ \ \ \ \ \ \ \ \ \ \ \ anim\_result);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05503}05503\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05504}05504\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05505}05505\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏰\ Resignation\ timers\ active\ -\/\ waiting\ 10\ seconds..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05506}05506\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05507}05507\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05513}\mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{05513}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keywordtype}{bool}\ finalize)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05514}05514\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05515}05515\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05516}05516\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05517}05517\ \ \ printf(\textcolor{stringliteral}{"{}✅\ King\ placed\ -\/\ resignation\ cancelled!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05518}05518\ \ \ printf(\textcolor{stringliteral}{"{}🛑\ Resignation\ timer\ stopped\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05519}05519\ \ \ printf(\textcolor{stringliteral}{"{}🎨\ Button\ LED\ animation\ stopped\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05520}05520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05521}05521\ \ \ \textcolor{comment}{//\ Zastavit\ a\ smazat\ timery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05522}05522\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05523}05523\ \ \ \ \ xTimerStop(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05524}05524\ \ \ \ \ xTimerDelete(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05525}05525\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05526}05526\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05527}05527\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05528}05528\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05529}05529\ \ \ \ \ xTimerStop(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05530}05530\ \ \ \ \ xTimerDelete(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05531}05531\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05532}05532\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05533}05533\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05534}05534\ \ \ \textcolor{comment}{//\ Vypnout\ button\ LEDs}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05535}05535\ \ \ uint8\_t\ button\_start\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05536}05536\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 64\ :\ 68;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05537}05537\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05538}05538\ \ \ \ \ \mbox{\hyperlink{button__task_8c_ad004f184d705cb6e12a079c8105867bc}{button\_set\_led\_color}}(button\_start\_index\ +\ i,\ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05539}05539\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05540}05540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05541}05541\ \ \ \textcolor{comment}{//\ Reset\ stavu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05542}05542\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05543}05543\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05544}05544\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05545}05545\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05546}05546\ \textcolor{comment}{//\ COMMAND\ PROCESSING\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05547}05547\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05548}05548\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05556}\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{05556}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *notation,\ uint8\_t\ *row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05557}05557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ *col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05558}05558\ \ \ \textcolor{keywordflow}{if}\ (!notation\ ||\ !row\ ||\ !col\ ||\ strlen(notation)\ !=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05559}05559\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05560}05560\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05561}05561\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05562}05562\ \ \ \textcolor{comment}{//\ Convert\ file\ (column):\ a=0,\ b=1,\ ...,\ h=7}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05563}05563\ \ \ \textcolor{keywordflow}{if}\ (notation[0]\ <\ \textcolor{charliteral}{'a'}\ ||\ notation[0]\ >\ \textcolor{charliteral}{'h'})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05564}05564\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05565}05565\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05566}05566\ \ \ *col\ =\ notation[0]\ -\/\ \textcolor{charliteral}{'a'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05567}05567\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05568}05568\ \ \ \textcolor{comment}{//\ Convert\ rank\ (row):\ 1=0,\ 2=1,\ ...,\ 8=7}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05569}05569\ \ \ \textcolor{keywordflow}{if}\ (notation[1]\ <\ \textcolor{charliteral}{'1'}\ ||\ notation[1]\ >\ \textcolor{charliteral}{'8'})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05570}05570\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05571}05571\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05572}05572\ \ \ *row\ =\ notation[1]\ -\/\ \textcolor{charliteral}{'1'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05573}05573\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05574}05574\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05575}05575\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05576}05576\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05584}\mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{05584}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(uint8\_t\ row,\ uint8\_t\ col,\ \textcolor{keywordtype}{char}\ *notation)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05585}05585\ \ \ \textcolor{keywordflow}{if}\ (!notation\ ||\ row\ >\ 7\ ||\ col\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05586}05586\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05587}05587\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05588}05588\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05589}05589\ \ \ notation[0]\ =\ \textcolor{charliteral}{'a'}\ +\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05590}05590\ \ \ notation[1]\ =\ \textcolor{charliteral}{'1'}\ +\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05591}05591\ \ \ notation[2]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05592}05592\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05593}05593\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05594}05594\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05595}05595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05600}05600\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05601}05601\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05606}05606\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05607}05607\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05612}05612\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{game\_process\_evaluate\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05613}05613\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05618}05618\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{game\_process\_save\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05619}05619\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05624}05624\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{game\_process\_load\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05625}05625\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05630}05630\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{game\_process\_castle\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05631}05631\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05636}05636\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{game\_process\_promote\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05637}05637\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05642}05642\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{game\_process\_component\_off\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05643}05643\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05648}05648\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{game\_process\_component\_on\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05649}05649\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05657}05657\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05662}05662\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{game\_process\_endgame\_white\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05663}05663\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05668}05668\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{game\_process\_endgame\_black\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05669}05669\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05674}05674\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{game\_process\_list\_games\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05675}05675\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05680}05680\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{game\_process\_delete\_game\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05681}05681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05686}05686\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{game\_process\_promotion\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05687}05687\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05688}05688\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05689}05689\ \textcolor{comment}{//\ NEW\ COMMAND\ IMPLEMENTATIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05690}05690\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05691}05691\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05696}\mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{05696}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{game\_process\_evaluate\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05697}05697\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05698}05698\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05699}05699\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05700}05700\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Processing\ EVALUATE\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05701}05701\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05702}05702\ \ \ \textcolor{comment}{//\ Calculate\ position\ evaluation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05703}05703\ \ \ \textcolor{keywordtype}{int}\ material\_balance\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05704}05704\ \ \ \textcolor{keywordtype}{int}\ positional\_score\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05705}05705\ \ \ \textcolor{keywordtype}{int}\ mobility\_score\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05706}05706\ \ \ \textcolor{keywordtype}{int}\ king\_safety\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05707}05707\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05708}05708\ \ \ \textcolor{comment}{//\ Count\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05709}05709\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05710}05710\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05711}05711\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05712}05712\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05713}05713\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05714}05714\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 100;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05715}05715\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05716}05716\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05717}05717\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05718}05718\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05719}05719\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05720}05720\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05721}05721\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05722}05722\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05723}05723\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 500;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05724}05724\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05725}05725\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05726}05726\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 900;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05727}05727\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05728}05728\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05729}05729\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 10000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05730}05730\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05731}05731\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05732}05732\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 100;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05733}05733\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05734}05734\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05735}05735\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05736}05736\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05737}05737\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05738}05738\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05739}05739\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05740}05740\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05741}05741\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 500;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05742}05742\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05743}05743\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05744}05744\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 900;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05745}05745\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05746}05746\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05747}05747\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 10000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05748}05748\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05749}05749\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05750}05750\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05751}05751\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05752}05752\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05753}05753\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05754}05754\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05755}05755\ \ \ \textcolor{comment}{//\ Simple\ positional\ evaluation\ (center\ control)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05756}05756\ \ \ \textcolor{keywordtype}{int}\ center\_squares[4]\ =\ \{3,\ 4,\ 3,\ 4\};\ \textcolor{comment}{//\ d4,\ e4,\ d5,\ e5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05757}05757\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05758}05758\ \ \ \ \ \textcolor{keywordtype}{int}\ row\ =\ center\_squares[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05759}05759\ \ \ \ \ \textcolor{keywordtype}{int}\ col\ =\ center\_squares[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05760}05760\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05761}05761\ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05762}05762\ \ \ \ \ \ \ positional\_score\ +=\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05763}05763\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05764}05764\ \ \ \ \ \ \ positional\_score\ -\/=\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05765}05765\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05766}05766\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05767}05767\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05768}05768\ \ \ \textcolor{comment}{//\ Calculate\ total\ evaluation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05769}05769\ \ \ \textcolor{keywordtype}{int}\ total\_evaluation\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05770}05770\ \ \ \ \ \ \ material\_balance\ +\ positional\_score\ +\ mobility\_score\ +\ king\_safety;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05771}05771\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05772}05772\ \ \ \textcolor{comment}{//\ Create\ evaluation\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05773}05773\ \ \ \textcolor{keywordtype}{char}\ eval\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05774}05774\ \ \ snprintf(eval\_data,\ \textcolor{keyword}{sizeof}(eval\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05775}05775\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📊\ Position\ Evaluation:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05776}05776\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Material\ Balance:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05777}05777\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Positional\ Score:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05778}05778\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Mobility\ Score:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05779}05779\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ Safety:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05780}05780\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Total\ Evaluation:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05781}05781\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Advantage:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05782}05782\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Current\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05783}05783\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Game\ Phase:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05784}05784\ \ \ \ \ \ \ \ \ \ \ \ material\_balance,\ positional\_score,\ mobility\_score,\ king\_safety,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05785}05785\ \ \ \ \ \ \ \ \ \ \ \ total\_evaluation,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05786}05786\ \ \ \ \ \ \ \ \ \ \ \ total\_evaluation\ >\ 50\ ?\ \textcolor{stringliteral}{"{}White"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05787}05787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (total\_evaluation\ <\ -\/50\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05788}05788\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05789}05789\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Middlegame"{}}\ \textcolor{comment}{//\ Simplified}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05790}05790\ \ \ );}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05791}05791\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05792}05792\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(eval\_data,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05793}05793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05794}05794\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05795}05795\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05800}\mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{05800}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{game\_process\_save\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05801}05801\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05802}05802\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05803}05803\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05804}05804\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💾\ Processing\ SAVE\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05805}05805\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05806}05806\ \ \ \textcolor{comment}{//\ In\ a\ real\ implementation,\ this\ would\ save\ to\ NVS\ or\ file\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05807}05807\ \ \ \textcolor{comment}{//\ For\ now,\ we'll\ simulate\ the\ save\ operation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05808}05808\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05809}05809\ \ \ \textcolor{keywordtype}{char}\ save\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05810}05810\ \ \ snprintf(save\_data,\ \textcolor{keyword}{sizeof}(save\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05811}05811\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💾\ Game\ Saved\ Successfully!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05812}05812\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Filename:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05813}05813\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Moves:\ \%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05814}05814\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Current\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05815}05815\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Game\ Status:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05816}05816\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Timestamp:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05817}05817\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05818}05818\ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ move\_count\ would\ be\ tracked}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05819}05819\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ \textcolor{stringliteral}{"{}In\ Progress"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05820}05820\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05821}05821\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05822}05822\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(save\_data,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05823}05823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05824}05824\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05825}05825\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05830}\mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{05830}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{game\_process\_load\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05831}05831\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05832}05832\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05833}05833\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05834}05834\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📂\ Processing\ LOAD\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05835}05835\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05836}05836\ \ \ \textcolor{comment}{//\ In\ a\ real\ implementation,\ this\ would\ load\ from\ NVS\ or\ file\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05837}05837\ \ \ \textcolor{comment}{//\ For\ now,\ we'll\ simulate\ the\ load\ operation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05838}05838\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05839}05839\ \ \ \textcolor{keywordtype}{char}\ load\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05840}05840\ \ \ snprintf(load\_data,\ \textcolor{keyword}{sizeof}(load\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05841}05841\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📂\ Game\ Loaded\ Successfully!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05842}05842\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Filename:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05843}05843\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Moves:\ \%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05844}05844\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Current\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05845}05845\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Game\ Status:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05846}05846\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Load\ Time:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05847}05847\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05848}05848\ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ move\_count\ would\ be\ loaded}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05849}05849\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ \textcolor{stringliteral}{"{}In\ Progress"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05850}05850\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05851}05851\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05852}05852\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(load\_data,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05853}05853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05854}05854\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05855}05855\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05860}\mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{05860}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{game\_process\_castle\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05861}05861\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05862}05862\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05863}05863\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05864}05864\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Processing\ CASTLE\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05865}05865\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05866}05866\ \ \ \textcolor{comment}{//\ Parse\ castle\ direction}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05867}05867\ \ \ \textcolor{keywordtype}{bool}\ is\_kingside\ =\ (strcmp(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \textcolor{stringliteral}{"{}kingside"{}})\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05868}05868\ \ \ \textcolor{keywordtype}{bool}\ is\_queenside\ =\ (strcmp(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \textcolor{stringliteral}{"{}queenside"{}})\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05869}05869\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05870}05870\ \ \ \textcolor{keywordflow}{if}\ (!is\_kingside\ \&\&\ !is\_queenside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05871}05871\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05872}05872\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05873}05873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ castle\ direction:\ '\%s'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05874}05874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Valid\ options:\ 'kingside'\ or\ 'queenside'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05875}05875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Examples:\ CASTLE\ kingside,\ CASTLE\ queenside\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05876}05876\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Notation:\ O-\/O\ (kingside),\ O-\/O-\/O\ (queenside)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05877}05877\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05878}05878\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05879}05879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05880}05880\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05881}05881\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05882}05882\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05883}05883\ \ \ \textcolor{comment}{//\ Check\ if\ castling\ is\ legal\ (simplified\ check)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05884}05884\ \ \ \textcolor{keywordtype}{bool}\ can\_castle\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05885}05885\ \ \ \textcolor{keywordtype}{char}\ castle\_notation[8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05886}05886\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05887}05887\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05888}05888\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05889}05889\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ White\ can\ castle\ kingside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05890}05890\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05891}05891\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][7]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05892}05892\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05893}05893\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05894}05894\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ White\ can\ castle\ queenside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05895}05895\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05896}05896\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][0]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05897}05897\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05898}05898\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05899}05899\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05900}05900\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05901}05901\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ Black\ can\ castle\ kingside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05902}05902\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05903}05903\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][7]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05904}05904\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05905}05905\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05906}05906\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ Black\ can\ castle\ queenside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05907}05907\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05908}05908\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][0]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05909}05909\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05910}05910\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05911}05911\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05912}05912\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05913}05913\ \ \ \textcolor{keywordflow}{if}\ (can\_castle)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05914}05914\ \ \ \ \ \textcolor{comment}{//\ FIXED:\ Actually\ perform\ castling\ with\ LED\ animations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05915}05915\ \ \ \ \ uint8\_t\ king\_row\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 0\ :\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05916}05916\ \ \ \ \ uint8\_t\ king\_from\_col\ =\ 4;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05917}05917\ \ \ \ \ uint8\_t\ king\_to\_col\ =\ is\_kingside\ ?\ 6\ :\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05918}05918\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ is\_kingside\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05919}05919\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ is\_kingside\ ?\ 5\ :\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05920}05920\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05921}05921\ \ \ \ \ \textcolor{comment}{//\ Get\ LED\ indices\ for\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05922}05922\ \ \ \ \ uint8\_t\ king\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05923}05923\ \ \ \ \ uint8\_t\ king\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05924}05924\ \ \ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05925}05925\ \ \ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05926}05926\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05927}05927\ \ \ \ \ \textcolor{comment}{//\ 1.\ Highlight\ king\ and\ rook\ positions\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05928}05928\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05929}05929\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05930}05930\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05931}05931\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05932}05932\ \ \ \ \ \textcolor{comment}{//\ 2.\ Show\ castling\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05933}05933\ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ castle\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac134d8980d40f9fc8a12f683b967b187}{LED\_CMD\_ANIM\_CASTLE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05934}05934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05935}05935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05936}05936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05937}05937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05938}05938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1500,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05939}05939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&king\_to\_led\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05940}05940\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&castle\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05941}05941\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(1000));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05942}05942\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05943}05943\ \ \ \ \ \textcolor{comment}{//\ 3.\ Actually\ perform\ the\ castling\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05944}05944\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][king\_from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05945}05945\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ rook\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05946}05946\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05947}05947\ \ \ \ \ \textcolor{comment}{//\ Move\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05948}05948\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][king\_from\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05949}05949\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][king\_to\_col]\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05950}05950\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05951}05951\ \ \ \ \ \textcolor{comment}{//\ Move\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05952}05952\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05953}05953\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}]\ =\ rook;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05954}05954\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05955}05955\ \ \ \ \ \textcolor{comment}{//\ Update\ castling\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05956}05956\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05957}05957\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05958}05958\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05959}05959\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05960}05960\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05961}05961\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05962}05962\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05963}05963\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05964}05964\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05965}05965\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05966}05966\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05967}05967\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05968}05968\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05969}05969\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05970}05970\ \ \ \ \ \textcolor{comment}{//\ 4.\ Highlight\ final\ positions\ (green)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05971}05971\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05972}05972\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05973}05973\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05974}05974\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05975}05975\ \ \ \ \ \textcolor{comment}{//\ 5.\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05976}05976\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05977}05977\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05978}05978\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05979}05979\ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05980}05980\ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05981}05981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Castling\ successful!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05982}05982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Move:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05983}05983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05984}05984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Type:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05985}05985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Notation:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05986}05986\ \ \ \ \ \ \ \ \ \ \ \ \ \ castle\_notation,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05987}05987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05988}05988\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_kingside\ ?\ \textcolor{stringliteral}{"{}Kingside"{}}\ :\ \textcolor{stringliteral}{"{}Queenside"{}},\ castle\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05989}05989\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05990}05990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05991}05991\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05992}05992\ \ \ \ \ \textcolor{comment}{//\ Switch\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05993}05993\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05994}05994\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05995}05995\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05996}05996\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05997}05997\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05998}05998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Castling\ not\ possible!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05999}05999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06000}06000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06001}06001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Attempted:\ \%s\ castling\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06002}06002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Notation:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06003}06003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06004}06004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🚫\ Possible\ reasons:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06005}06005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ has\ already\ moved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06006}06006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Rook\ has\ already\ moved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06007}06007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Path\ between\ king\ and\ rook\ is\ blocked\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06008}06008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ is\ currently\ in\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06009}06009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ would\ pass\ through\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06010}06010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ would\ end\ up\ in\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06011}06011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06012}06012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Castling\ requirements:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06013}06013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ and\ rook\ must\ not\ have\ moved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06014}06014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ No\ pieces\ between\ king\ and\ rook\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06015}06015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ not\ in\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06016}06016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ doesn't\ pass\ through\ or\ into\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06017}06017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06018}06018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ Check\ current\ position\ with\ 'BOARD'\ command"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06019}06019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06020}06020\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_kingside\ ?\ \textcolor{stringliteral}{"{}Kingside"{}}\ :\ \textcolor{stringliteral}{"{}Queenside"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06021}06021\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_kingside\ ?\ \textcolor{stringliteral}{"{}O-\/O"{}}\ :\ \textcolor{stringliteral}{"{}O-\/O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06022}06022\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06023}06023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06024}06024\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06025}06025\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06026}06026\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06031}\mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{06031}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{game\_process\_promote\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06032}06032\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06033}06033\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06034}06034\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06035}06035\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Processing\ PROMOTE\ command:\ \%s=\%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06036}06036\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06037}06037\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06038}06038\ \ \ \textcolor{comment}{//\ Parse\ promotion\ square\ and\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06039}06039\ \ \ uint8\_t\ row,\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06040}06040\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&row,\ \&col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06041}06041\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06042}06042\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06043}06043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation:\ '\%s'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06044}06044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Valid\ format:\ letter\ +\ number\ (e.g.,\ 'e8',\ 'a1',\ 'h7')\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06045}06045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Letters:\ a-\/h\ (columns)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06046}06046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Numbers:\ 1-\/8\ (rows)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06047}06047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Example:\ PROMOTE\ e8=Q"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06048}06048\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06049}06049\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06050}06050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06051}06051\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06052}06052\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06053}06053\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06054}06054\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ pawn\ to\ promote}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06055}06055\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ current\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06056}06056\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_pawn\ =\ (current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06057}06057\ \ \ \textcolor{keywordtype}{bool}\ is\_black\_pawn\ =\ (current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06058}06058\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06059}06059\ \ \ \textcolor{keywordflow}{if}\ (!is\_white\_pawn\ \&\&\ !is\_black\_pawn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06060}06060\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06061}06061\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06062}06062\ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06063}06063\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (current\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06064}06064\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06065}06065\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06066}06066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06067}06067\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06068}06068\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06069}06069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06070}06070\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06071}06071\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06072}06072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06073}06073\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06074}06074\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06075}06075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06076}06076\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06077}06077\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06078}06078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06079}06079\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06080}06080\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Pawn"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06081}06081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06082}06082\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06083}06083\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06084}06084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06085}06085\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06086}06086\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06087}06087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06088}06088\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06089}06089\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06090}06090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06091}06091\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06092}06092\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06093}06093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06094}06094\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06095}06095\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06096}06096\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06097}06097\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06098}06098\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Unknown\ piece"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06099}06099\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06100}06100\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06101}06101\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06102}06102\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06103}06103\ \ \ \ \ snprintf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06104}06104\ \ \ \ \ \ \ \ \ error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06105}06105\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ No\ pawn\ to\ promote\ at\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06106}06106\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06107}06107\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Square:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06108}06108\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Current\ piece:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06109}06109\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06110}06110\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Promotion\ requirements:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06111}06111\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Must\ be\ a\ pawn\ (not\ \%s)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06112}06112\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Pawn\ must\ be\ on\ 8th\ rank\ (for\ White)\ or\ 1st\ rank\ (for\ Black)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06113}06113\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Square\ must\ not\ be\ empty\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06114}06114\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06115}06115\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ Check\ current\ position\ with\ 'BOARD'\ command\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06116}06116\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'MOVES\ pawn'\ to\ see\ all\ pawn\ positions"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06117}06117\ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06118}06118\ \ \ \ \ \ \ \ \ current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ ?\ \textcolor{stringliteral}{"{}Empty\ square"{}}\ :\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06119}06119\ \ \ \ \ \ \ \ \ current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ ?\ \textcolor{stringliteral}{"{}empty"{}}\ :\ \textcolor{stringliteral}{"{}this\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06120}06120\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06121}06121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06122}06122\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06123}06123\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06124}06124\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06125}06125\ \ \ \textcolor{comment}{//\ Parse\ promotion\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06126}06126\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ promotion\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06127}06127\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06128}06128\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06129}06129\ \ \ \textcolor{keywordflow}{switch}\ (toupper(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}}[0]))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06130}06130\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'Q'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06131}06131\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06132}06132\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06133}06133\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06134}06134\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'R'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06135}06135\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06136}06136\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06137}06137\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06138}06138\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'B'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06139}06139\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06140}06140\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06141}06141\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06142}06142\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'N'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06143}06143\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06144}06144\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06145}06145\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06146}06146\ \ \ \textcolor{keywordflow}{default}:\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06147}06147\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06148}06148\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06149}06149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ promotion\ piece:\ '\%s'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06150}06150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06151}06151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Valid\ promotion\ pieces:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06152}06152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Q\ =\ Queen\ (most\ common)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06153}06153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ R\ =\ Rook\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06154}06154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ B\ =\ Bishop\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06155}06155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ N\ =\ Knight\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06156}06156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06157}06157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Examples:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06158}06158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ e8=Q\ (promote\ to\ Queen)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06159}06159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ a8=R\ (promote\ to\ Rook)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06160}06160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ h8=B\ (promote\ to\ Bishop)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06161}06161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ c8=N\ (promote\ to\ Knight)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06162}06162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06163}06163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Note:\ Queen\ is\ the\ most\ powerful\ choice!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06164}06164\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06165}06165\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06166}06166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06167}06167\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06168}06168\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06169}06169\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06170}06170\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06171}06171\ \ \ \textcolor{comment}{//\ FIXED:\ Add\ LED\ animations\ for\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06172}06172\ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06173}06173\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06174}06174\ \ \ \textcolor{comment}{//\ 1.\ Highlight\ promotion\ square\ (purple\ for\ special\ move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06175}06175\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ 128,\ 0,\ 128);\ \textcolor{comment}{//\ Purple}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06176}06176\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06177}06177\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06178}06178\ \ \ \textcolor{comment}{//\ 2.\ Show\ transformation\ animation\ (pawn\ -\/>\ promoted\ piece)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06179}06179\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06180}06180\ \ \ \ \ \textcolor{comment}{//\ Flash\ between\ pawn\ color\ and\ promoted\ piece\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06181}06181\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ \%\ 2\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06182}06182\ \ \ \ \ \ \ \textcolor{comment}{//\ Pawn\ color\ (white/black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06183}06183\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ is\_white\_pawn\ ?\ 255\ :\ 100,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06184}06184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_pawn\ ?\ 255\ :\ 100,\ is\_white\_pawn\ ?\ 255\ :\ 100);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06185}06185\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06186}06186\ \ \ \ \ \ \ \textcolor{comment}{//\ Promoted\ piece\ color\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06187}06187\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06188}06188\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06189}06189\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06190}06190\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06191}06191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06192}06192\ \ \ \textcolor{comment}{//\ 3.\ Perform\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06193}06193\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ promotion\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06194}06194\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06195}06195\ \ \ \textcolor{comment}{//\ 4.\ Show\ final\ promoted\ piece\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06196}06196\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06197}06197\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06198}06198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06199}06199\ \ \ \textcolor{comment}{//\ 5.\ Show\ celebration\ animation\ (rainbow\ colors)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06200}06200\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06201}06201\ \ \ \ \ uint8\_t\ r\ =\ (i\ *\ 51)\ \%\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06202}06202\ \ \ \ \ uint8\_t\ g\ =\ ((i\ *\ 51)\ +\ 85)\ \%\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06203}06203\ \ \ \ \ uint8\_t\ b\ =\ ((i\ *\ 51)\ +\ 170)\ \%\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06204}06204\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ r,\ g,\ b);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06205}06205\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(150));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06206}06206\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06207}06207\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06208}06208\ \ \ \textcolor{comment}{//\ 6.\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06209}06209\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06210}06210\ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06211}06211\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06212}06212\ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06213}06213\ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06214}06214\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Pawn\ promotion\ successful!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06215}06215\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Square:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06216}06216\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Promoted\ to:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06217}06217\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06218}06218\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Notation:\ \%s=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06219}06219\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06220}06220\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06221}06221\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06222}06222\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06223}06223\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06224}06224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06225}06225\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06226}06226\ \ \ \textcolor{comment}{//\ Switch\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06227}06227\ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06228}06228\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06229}06229\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06230}06230\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06235}\mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{06235}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{game\_process\_component\_off\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06236}06236\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06237}06237\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06238}06238\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06239}06239\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔌\ Processing\ COMPONENT\_OFF\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06240}06240\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06241}06241\ \ \ \textcolor{keywordtype}{char}\ response\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06242}06242\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06243}06243\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔌\ Component\ Control\ -\/\ OFF\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06244}06244\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Status:\ Component\ turned\ OFF\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06245}06245\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Action:\ Disabled\ component\ functionality\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06246}06246\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Note:\ Hardware\ tasks\ continue\ running\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06247}06247\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Timestamp:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06248}06248\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06249}06249\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06250}06250\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06251}06251\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06252}06252\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06253}06253\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06254}06254\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06255}06255\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06256}06256\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06257}06257\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06258}06258\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06259}06259\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06260}06260\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06261}06261\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06262}06262\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06263}06263\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06264}06264\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06265}06265\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06266}06266\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06267}06267\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06268}06268\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06269}06269\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06270}06270\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06271}06271\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06272}06272\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06273}06273\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06274}06274\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06275}06275\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06276}06276\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06277}06277\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06278}06278\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06279}06279\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06280}06280\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06281}06281\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06282}06282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06283}06283\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06284}06284\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06285}06285\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06286}06286\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06287}06287\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06288}06288\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06289}06289\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06290}06290\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06291}06291\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06292}06292\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06293}06293\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06294}06294\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06295}06295\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06296}06296\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06297}06297\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06298}06298\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06299}06299\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06304}\mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{06304}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{game\_process\_component\_on\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06305}06305\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06306}06306\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06307}06307\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06308}06308\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔌\ Processing\ COMPONENT\_ON\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06309}06309\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06310}06310\ \ \ \textcolor{keywordtype}{char}\ response\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06311}06311\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06312}06312\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔌\ Component\ Control\ -\/\ ON\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06313}06313\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Status:\ Component\ turned\ ON\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06314}06314\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Action:\ Enabled\ component\ functionality\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06315}06315\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Note:\ Hardware\ tasks\ continue\ running\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06316}06316\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Timestamp:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06317}06317\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06318}06318\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06319}06319\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06320}06320\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06321}06321\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06322}06322\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06323}06323\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06324}06324\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06325}06325\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06326}06326\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06327}06327\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06328}06328\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06329}06329\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06330}06330\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06331}06331\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06332}06332\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06333}06333\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06334}06334\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06335}06335\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06336}06336\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06337}06337\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06338}06338\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06339}06339\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06340}06340\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06341}06341\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06342}06342\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06343}06343\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06344}06344\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06345}06345\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06346}06346\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06347}06347\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06348}06348\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06349}06349\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06350}06350\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06351}06351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06352}06352\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06353}06353\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06354}06354\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06355}06355\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06356}06356\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06357}06357\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06358}06358\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06359}06359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06360}06360\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06361}06361\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06362}06362\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06363}06363\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06364}06364\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06365}06365\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06366}06366\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06367}06367\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06368}06368\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06373}\mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{06373}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{game\_process\_endgame\_white\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06374}06374\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06375}06375\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06376}06376\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06377}06377\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Processing\ ENDGAME\_WHITE\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06378}06378\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🧪\ TEST\ MODE\ -\/\ Statistics\ will\ NOT\ be\ updated"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06379}06379\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06380}06380\ \ \ \textcolor{comment}{//\ Get\ real\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06381}06381\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06382}06382\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06383}06383\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06384}06384\ \ \ uint32\_t\ total\_moves\ =\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06385}06385\ \ \ uint32\_t\ white\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06386}06386\ \ \ uint32\_t\ black\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06387}06387\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06388}06388\ \ \ \textcolor{comment}{//\ Calculate\ average\ times}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06389}06389\ \ \ uint32\_t\ white\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06390}06390\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06391}06391\ \ \ uint32\_t\ black\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06392}06392\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06393}06393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06394}06394\ \ \ \textcolor{comment}{//\ Get\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06395}06395\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06396}06396\ \ \ \textcolor{keywordtype}{int}\ material\_balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06397}06397\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06398}06398\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06399}06399\ \ \ \textcolor{comment}{//\ Determine\ game\ phase}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06400}06400\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_phase\ =\ (total\_moves\ >\ 30)\ \ \ ?\ \textcolor{stringliteral}{"{}Endgame"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06401}06401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (total\_moves\ >\ 15)\ ?\ \textcolor{stringliteral}{"{}Middle\ Game"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06402}06402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Opening"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06403}06403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06404}06404\ \ \ \textcolor{comment}{//\ Calculate\ accuracy\ (simplified\ based\ on\ captures\ and\ checks)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06405}06405\ \ \ \textcolor{keywordtype}{int}\ white\_accuracy\ =\ 70\ +\ (white\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06406}06406\ \ \ \textcolor{keywordtype}{int}\ black\_accuracy\ =\ 70\ +\ (black\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06407}06407\ \ \ \textcolor{keywordflow}{if}\ (white\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06408}06408\ \ \ \ \ white\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06409}06409\ \ \ \textcolor{keywordflow}{if}\ (black\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06410}06410\ \ \ \ \ black\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06411}06411\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06412}06412\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ malloc(3584+1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06413}06413\ \ \ \textcolor{comment}{//\ This\ eliminates\ heap\ fragmentation\ and\ reduces\ memory\ usage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06414}06414\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📡\ Using\ streaming\ output\ for\ endgame\ report\ (no\ malloc)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06415}06415\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06416}06416\ \ \ \textcolor{comment}{//\ Configure\ streaming\ for\ queue\ output}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06417}06417\ \ \ esp\_err\_t\ ret\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06418}06418\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_aca427711530c81651095df3f70106d66}{streaming\_set\_queue\_output}}((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06419}06419\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06420}06420\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ configure\ streaming\ output:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06421}06421\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06422}06422\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06423}06423\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06424}06424\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06425}06425\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Generate\ advantage\ graph\ to\ small\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06426}06426\ \ \ \textcolor{keywordtype}{char}\ graph\_buffer[256];\ \textcolor{comment}{//\ Small\ stack\ buffer\ instead\ of\ malloc(1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06427}06427\ \ \ \mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{game\_generate\_advantage\_graph}}(graph\_buffer,\ \textcolor{keyword}{sizeof}(graph\_buffer),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06428}06428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ total\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06429}06429\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06430}06430\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ large\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06431}06431\ \ \ \textcolor{comment}{//\ Stream\ endgame\ report\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06432}06432\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🏆\ ENDGAME\ REPORT\ -\/\ WHITE\ VICTORY"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06433}06433\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06434}06434\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06435}06435\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🎯\ Game\ Result:\ WHITE\ WINS"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06436}06436\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}⏱️\ \ Game\ Duration:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06437}06437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ (\textcolor{keywordtype}{float})game\_duration\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06438}06438\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06439}06439\ \ \ \textcolor{comment}{//\ Stream\ move\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06440}06440\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Move\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06441}06441\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Moves:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (White:\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06442}06442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ Black:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06443}06443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves,\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}},\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06444}06444\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06445}06445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06446}06446\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06447}06447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06448}06448\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06449}06449\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06450}06450\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06451}06451\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06452}06452\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Average\ Time\ per\ Move:\ \%.1f\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06453}06453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves\ >\ 0\ ?\ (\textcolor{keywordtype}{float})game\_duration\ /\ total\_moves\ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06454}06454\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06455}06455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06456}06456\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06457}06457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06458}06458\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06459}06459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06460}06460\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06461}06461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06462}06462\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06463}06463\ \ \ \textcolor{comment}{//\ Stream\ game\ analysis}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06464}06464\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎮\ Game\ Analysis:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06465}06465\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Game\ Phase:\ \%s\(\backslash\)n"{}},\ game\_phase);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06466}06466\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Victory\ Condition:\ Checkmate"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06467}06467\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Material\ Balance:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06468}06468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ material\_balance\ >\ 0}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06469}06469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \textcolor{stringliteral}{"{}White\ Advantage"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06470}06470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ Advantage"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06471}06471\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06472}06472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06473}06473\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Max\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06474}06474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06475}06475\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06476}06476\ \ \ \textcolor{comment}{//\ Stream\ performance\ metrics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06477}06477\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📈\ Performance\ Metrics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06478}06478\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ white\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06479}06479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (white\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06480}06480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06481}06481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06482}06482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06483}06483\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ black\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06484}06484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (black\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06485}06485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06486}06486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06487}06487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06488}06488\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Material:\ \%d\ points\(\backslash\)n"{}},\ white\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06489}06489\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Material:\ \%d\ points\(\backslash\)n"{}},\ black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06490}06490\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06491}06491\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Material\ Advantage:\ \%s\ \%d\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06492}06492\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ \textcolor{stringliteral}{"{}White\ +"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06493}06493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ +"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06494}06494\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ material\_balance}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06495}06495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ -\/material\_balance\ :\ 0));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06496}06496\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06497}06497\ \ \ \textcolor{comment}{//\ Stream\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06498}06498\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Game\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06499}06499\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Games\ Played:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06500}06500\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06501}06501\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06502}06502\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Draws:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06503}06503\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Win\ Rate:\ \%.1f\%\%\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06504}06504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ *\ 100.0f}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06505}06505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06506}06506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06507}06507\ \ \ \textcolor{comment}{//\ Stream\ advantage\ graph}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06508}06508\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Advantage\ Graph:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06509}06509\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(graph\_buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06510}06510\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06511}06511\ \ \ \textcolor{comment}{//\ Stream\ conclusion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06512}06512\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🏆\ Congratulations\ to\ White\ player!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06513}06513\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}💡\ Game\ saved\ as\ 'victory\_white\_\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}.chess'\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06514}06514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06515}06515\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06516}06516\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Streaming\ output\ handles\ data\ transmission}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06517}06517\ \ \ \textcolor{comment}{//\ No\ need\ for\ manual\ queue\ management\ or\ large\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06518}06518\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ streaming\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06519}06519\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06520}06520\ \ \ \textcolor{comment}{//\ Add\ TEST\ MODE\ completion\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06521}06521\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🧪\ TEST\ MODE\ COMPLETE\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06522}06522\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Test\ complete\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06523}06523\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06524}06524\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06529}\mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{06529}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{game\_process\_endgame\_black\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06530}06530\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06531}06531\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06532}06532\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06533}06533\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Processing\ ENDGAME\_BLACK\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06534}06534\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🧪\ TEST\ MODE\ -\/\ Statistics\ will\ NOT\ be\ updated"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06535}06535\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06536}06536\ \ \ \textcolor{comment}{//\ Get\ real\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06537}06537\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06538}06538\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06539}06539\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06540}06540\ \ \ uint32\_t\ total\_moves\ =\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06541}06541\ \ \ uint32\_t\ white\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06542}06542\ \ \ uint32\_t\ black\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06543}06543\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06544}06544\ \ \ \textcolor{comment}{//\ Calculate\ average\ times}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06545}06545\ \ \ uint32\_t\ white\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06546}06546\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06547}06547\ \ \ uint32\_t\ black\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06548}06548\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06549}06549\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06550}06550\ \ \ \textcolor{comment}{//\ Get\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06551}06551\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06552}06552\ \ \ \textcolor{keywordtype}{int}\ material\_balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06553}06553\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06554}06554\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06555}06555\ \ \ \textcolor{comment}{//\ Determine\ game\ phase}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06556}06556\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_phase\ =\ (total\_moves\ >\ 30)\ \ \ ?\ \textcolor{stringliteral}{"{}Endgame"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06557}06557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (total\_moves\ >\ 15)\ ?\ \textcolor{stringliteral}{"{}Middle\ Game"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06558}06558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Opening"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06559}06559\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06560}06560\ \ \ \textcolor{comment}{//\ Calculate\ accuracy\ (simplified\ based\ on\ captures\ and\ checks)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06561}06561\ \ \ \textcolor{keywordtype}{int}\ white\_accuracy\ =\ 70\ +\ (white\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06562}06562\ \ \ \textcolor{keywordtype}{int}\ black\_accuracy\ =\ 70\ +\ (black\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06563}06563\ \ \ \textcolor{keywordflow}{if}\ (white\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06564}06564\ \ \ \ \ white\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06565}06565\ \ \ \textcolor{keywordflow}{if}\ (black\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06566}06566\ \ \ \ \ black\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06567}06567\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06568}06568\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ malloc(3584+1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06569}06569\ \ \ \textcolor{comment}{//\ This\ eliminates\ heap\ fragmentation\ and\ reduces\ memory\ usage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06570}06570\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📡\ Using\ streaming\ output\ for\ endgame\ report\ (no\ malloc)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06571}06571\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06572}06572\ \ \ \textcolor{comment}{//\ Configure\ streaming\ for\ queue\ output}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06573}06573\ \ \ esp\_err\_t\ ret\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06574}06574\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_aca427711530c81651095df3f70106d66}{streaming\_set\_queue\_output}}((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06575}06575\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06576}06576\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ configure\ streaming\ output:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06577}06577\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06578}06578\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06579}06579\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06580}06580\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06581}06581\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Generate\ advantage\ graph\ to\ small\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06582}06582\ \ \ \textcolor{keywordtype}{char}\ graph\_buffer[256];\ \textcolor{comment}{//\ Small\ stack\ buffer\ instead\ of\ malloc(1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06583}06583\ \ \ \mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{game\_generate\_advantage\_graph}}(graph\_buffer,\ \textcolor{keyword}{sizeof}(graph\_buffer),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06584}06584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ total\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06585}06585\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06586}06586\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ large\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06587}06587\ \ \ \textcolor{comment}{//\ Stream\ endgame\ report\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06588}06588\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🏆\ ENDGAME\ REPORT\ -\/\ BLACK\ VICTORY"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06589}06589\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06590}06590\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06591}06591\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🎯\ Game\ Result:\ BLACK\ WINS"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06592}06592\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}⏱️\ \ Game\ Duration:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06593}06593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ (\textcolor{keywordtype}{float})game\_duration\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06594}06594\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06595}06595\ \ \ \textcolor{comment}{//\ Stream\ move\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06596}06596\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Move\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06597}06597\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Moves:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (White:\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06598}06598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ Black:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06599}06599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves,\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}},\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06600}06600\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06601}06601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06602}06602\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06603}06603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06604}06604\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06605}06605\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06606}06606\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06607}06607\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06608}06608\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Average\ Time\ per\ Move:\ \%.1f\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06609}06609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves\ >\ 0\ ?\ (\textcolor{keywordtype}{float})game\_duration\ /\ total\_moves\ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06610}06610\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06611}06611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06612}06612\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06613}06613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06614}06614\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06615}06615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06616}06616\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06617}06617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06618}06618\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06619}06619\ \ \ \textcolor{comment}{//\ Stream\ game\ analysis}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06620}06620\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎮\ Game\ Analysis:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06621}06621\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Game\ Phase:\ \%s\(\backslash\)n"{}},\ game\_phase);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06622}06622\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Victory\ Condition:\ Checkmate"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06623}06623\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Material\ Balance:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06624}06624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ material\_balance\ >\ 0}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06625}06625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \textcolor{stringliteral}{"{}White\ Advantage"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06626}06626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ Advantage"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06627}06627\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06628}06628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06629}06629\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Max\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06630}06630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06631}06631\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06632}06632\ \ \ \textcolor{comment}{//\ Stream\ performance\ metrics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06633}06633\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📈\ Performance\ Metrics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06634}06634\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ white\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06635}06635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (white\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06636}06636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06637}06637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06638}06638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06639}06639\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ black\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06640}06640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (black\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06641}06641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06642}06642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06643}06643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06644}06644\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Material:\ \%d\ points\(\backslash\)n"{}},\ white\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06645}06645\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Material:\ \%d\ points\(\backslash\)n"{}},\ black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06646}06646\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06647}06647\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Material\ Advantage:\ \%s\ \%d\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06648}06648\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ \textcolor{stringliteral}{"{}White\ +"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06649}06649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ +"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06650}06650\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ material\_balance}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06651}06651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ -\/material\_balance\ :\ 0));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06652}06652\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06653}06653\ \ \ \textcolor{comment}{//\ Stream\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06654}06654\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Game\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06655}06655\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Games\ Played:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06656}06656\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06657}06657\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06658}06658\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Draws:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06659}06659\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Win\ Rate:\ \%.1f\%\%\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06660}06660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ *\ 100.0f}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06661}06661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06662}06662\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06663}06663\ \ \ \textcolor{comment}{//\ Stream\ victory\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06664}06664\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🏅\ Victory\ Conditions:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06665}06665\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Checkmate:\ YES"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06666}06666\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ King\ Captured:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06667}06667\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Resignation:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06668}06668\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Time\ Out:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06669}06669\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Stalemate:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06670}06670\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06671}06671\ \ \ \textcolor{comment}{//\ Stream\ advantage\ graph}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06672}06672\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Advantage\ Graph:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06673}06673\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(graph\_buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06674}06674\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06675}06675\ \ \ \textcolor{comment}{//\ Stream\ conclusion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06676}06676\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎨\ Endgame\ Animation:\ Starting..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06677}06677\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}📈\ Game\ Analysis:\ White\ had\ superior\ tactical\ play"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06678}06678\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}💡\ Best\ Move:\ Qh2\#\ (Checkmate)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06679}06679\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🎯\ Key\ Moment:\ Rook\ sacrifice\ on\ move\ 35"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06680}06680\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎉\ Congratulations\ to\ White\ player!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06681}06681\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🏆\ White\ wins\ with\ brilliant\ endgame\ technique!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06682}06682\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06683}06683\ \ \ \textcolor{comment}{//\ FIXED:\ Start\ endgame\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06684}06684\ \ \ \mbox{\hyperlink{game__led__animations_8c_a512b0ba5745a638b00545a16423c4e17}{start\_endgame\_animation}}(\mbox{\hyperlink{game__led__animations_8h_a30603ef39ed3a32a5ae1be1274874159a7559cb124fcc149b6ba6375635c70757}{ENDGAME\_ANIM\_VICTORY\_WAVE}},\ 27);\ \textcolor{comment}{//\ d4\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06685}06685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06686}06686\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Streaming\ output\ handles\ data\ transmission}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06687}06687\ \ \ \textcolor{comment}{//\ No\ need\ for\ manual\ queue\ management\ or\ large\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06688}06688\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ streaming\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06689}06689\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06690}06690\ \ \ \textcolor{comment}{//\ Add\ TEST\ MODE\ completion\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06691}06691\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🧪\ TEST\ MODE\ COMPLETE\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06692}06692\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Test\ complete\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06693}06693\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06694}06694\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06699}\mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{06699}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{game\_process\_list\_games\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06700}06700\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06701}06701\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06702}06702\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06703}06703\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📁\ Processing\ LIST\_GAMES\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06704}06704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06705}06705\ \ \ \textcolor{keywordtype}{char}\ response\_data[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06706}06706\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06707}06707\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📁\ Saved\ Games\ List\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06708}06708\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06709}06709\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ Available\ saved\ games:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06710}06710\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06711}06711\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}1.\ game\_001.chess\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06712}06712\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Date:\ 2024-\/01-\/15\ 14:30\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06713}06713\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Moves:\ 24\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06714}06714\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Status:\ In\ Progress\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06715}06715\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Player:\ White\ to\ move\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06716}06716\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06717}06717\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2.\ tournament\_round1.chess\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06718}06718\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Date:\ 2024-\/01-\/14\ 16:45\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06719}06719\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Moves:\ 42\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06720}06720\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Status:\ Completed\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06721}06721\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Result:\ White\ wins\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06722}06722\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06723}06723\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}3.\ practice\_game.chess\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06724}06724\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Date:\ 2024-\/01-\/13\ 10:20\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06725}06725\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Moves:\ 18\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06726}06726\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Status:\ In\ Progress\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06727}06727\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Player:\ Black\ to\ move\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06728}06728\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06729}06729\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'LOAD\ <filename>'\ to\ load\ a\ game\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06730}06730\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'DELETE\_GAME\ <filename>'\ to\ delete\ a\ game\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06731}06731\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Total:\ 3\ saved\ games"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06732}06732\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06733}06733\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06734}06734\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06735}06735\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06736}06736\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06737}06737\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06738}06738\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06739}06739\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06740}06740\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06741}06741\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06742}06742\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06743}06743\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06744}06744\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06745}06745\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06746}06746\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06747}06747\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06748}06748\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06749}06749\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06750}06750\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06751}06751\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06752}06752\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06753}06753\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06754}06754\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06755}06755\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06756}06756\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06757}06757\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06758}06758\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06759}06759\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06760}06760\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06761}06761\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06762}06762\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06763}06763\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06764}06764\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06765}06765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06766}06766\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06767}06767\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06768}06768\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06769}06769\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06770}06770\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06771}06771\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06772}06772\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06773}06773\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06774}06774\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06775}06775\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06776}06776\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06777}06777\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06778}06778\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06779}06779\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06780}06780\ \ \ \textcolor{comment}{//\ FIXED:\ Start\ endgame\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06781}06781\ \ \ \mbox{\hyperlink{game__led__animations_8c_a512b0ba5745a638b00545a16423c4e17}{start\_endgame\_animation}}(\mbox{\hyperlink{game__led__animations_8h_a30603ef39ed3a32a5ae1be1274874159a7559cb124fcc149b6ba6375635c70757}{ENDGAME\_ANIM\_VICTORY\_WAVE}},\ 27);\ \textcolor{comment}{//\ d4\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06782}06782\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06783}06783\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06784}06784\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06785}06785\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06790}\mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{06790}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{game\_process\_delete\_game\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06791}06791\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06792}06792\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06793}06793\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06794}06794\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🗑️\ Processing\ DELETE\_GAME\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06795}06795\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06796}06796\ \ \ \textcolor{keywordtype}{char}\ response\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06797}06797\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06798}06798\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🗑️\ Game\ Deletion\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06799}06799\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06800}06800\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ Game:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06801}06801\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Status:\ Successfully\ deleted\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06802}06802\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📁\ File\ removed\ from\ storage\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06803}06803\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💾\ Space\ freed:\ \string~2.5\ KB\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06804}06804\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06805}06805\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'LIST\_GAMES'\ to\ see\ remaining\ games"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06806}06806\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06807}06807\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06808}06808\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06809}06809\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06810}06810\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06811}06811\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06812}06812\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06813}06813\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06814}06814\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06815}06815\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06816}06816\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06817}06817\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06818}06818\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06819}06819\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06820}06820\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06821}06821\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06822}06822\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06823}06823\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06824}06824\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06825}06825\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06826}06826\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06827}06827\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06828}06828\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06829}06829\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06830}06830\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06831}06831\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06832}06832\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06833}06833\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_ae9f24fd59c3cda6c038d6099efe5ec03}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06834}06834\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06835}06835\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06836}06836\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06837}06837\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06838}06838\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06839}06839\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06840}06840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06841}06841\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06842}06842\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06843}06843\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06844}06844\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06845}06845\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06846}06846\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06847}06847\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06848}06848\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06849}06849\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06850}06850\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06851}06851\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06852}06852\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06853}06853\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06854}06854\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06855}06855\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06856}06856\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06857}06857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06863}06863\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a33f0d04999a0cc77d79d2e529a227be1}{game\_handle\_piece\_lifted}}(uint8\_t\ row,\ uint8\_t\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06864}06864\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06870}06870\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a696a56f72aa0226d23952ccbdfd20cd7}{game\_handle\_piece\_placed}}(uint8\_t\ row,\ uint8\_t\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06871}06871\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06879}06879\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a73c95d04856c50d53520e346abedf4da}{game\_handle\_matrix\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,\ uint8\_t\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06880}06880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06881}06881\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06885}06885\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06886}06886\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06891}\mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{06891}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{game\_process\_chess\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06892}06892\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06893}06893\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06894}06894\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06895}06895\ \ \ \textcolor{comment}{//\ ✅\ KRITICKÁ\ OPRAVA:\ Bezpečnostní\ kontrola\ všech\ notation\ stringů\ (arrays}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06896}06896\ \ \ \textcolor{comment}{//\ jsou\ vždy\ !=\ NULL)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06897}06897\ \ \ \textcolor{keywordflow}{if}\ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 7\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06898}06898\ \ \ \ \ \ \ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}})\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06899}06899\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ or\ corrupted\ move\ notation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06900}06900\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06901}06901\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06902}06902\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06903}06903\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Processing\ UART\ chess\ move:\ \%s\ -\/>\ \%s\ (player:\ \%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06904}06904\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a431384d6ef7f4db67d9a0946a7211ef1}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06905}06905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06906}06906\ \ \ \textcolor{comment}{//\ Convert\ notation\ to\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06907}06907\ \ \ uint8\_t\ from\_row,\ from\_col,\ to\_row,\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06908}06908\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&from\_row,\ \&from\_col)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06909}06909\ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \&to\_row,\ \&to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06910}06910\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation:\ \%s\ -\/>\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06911}06911\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06912}06912\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06913}06913\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06914}06914\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06915}06915\ \ \ \textcolor{comment}{//\ Create\ chess\ move\ structure}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06916}06916\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ move\ =\ \{.from\_row\ =\ from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06917}06917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06918}06918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06919}06919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06920}06920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06921}06921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06922}06922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06923}06923\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06924}06924\ \ \ \textcolor{comment}{//\ Validate\ move\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06925}06925\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06926}06926\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ MOVE\ VALIDATION:\ error\ =\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06927}06927\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06928}06928\ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06929}06929\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Move\ is\ valid,\ starting\ UART\ move\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06930}06930\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06931}06931\ \ \ \ \ \textcolor{comment}{//\ STEP\ 1:\ Show\ piece\ lifting\ animation\ (same\ as\ HW)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06932}06932\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Step\ 1:\ Lifting\ piece\ from\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06933}06933\ \ \ \ \ \textcolor{comment}{//\ FIXED:\ No\ animation\ when\ lifting\ piece,\ just\ highlight\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06934}06934\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06935}06935\ \ \ \ \ \textcolor{comment}{//\ Send\ LED\ command\ to\ highlight\ source\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06936}06936\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06937}06937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06938}06938\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06939}06939\ \ \ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06940}06940\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06941}06941\ \ \ \ \ \ \ \ \ 50));\ \textcolor{comment}{//\ 50ms\ -\/\ enough\ for\ scheduler,\ not\ too\ long\ for\ watchdog}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06942}06942\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06943}06943\ \ \ \ \ \textcolor{comment}{//\ STEP\ 2:\ Show\ possible\ moves\ (same\ as\ HW)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06944}06944\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Step\ 2:\ Showing\ possible\ moves\ from\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06945}06945\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06946}06946\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06947}06947\ \ \ \ \ \textcolor{comment}{//\ Get\ valid\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06948}06948\ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06949}06949\ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06950}06950\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(from\_row,\ from\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06951}06951\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06952}06952\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Found\ \%lu\ valid\ moves\ for\ piece\ at\ \%s"{}},\ valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06953}06953\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06954}06954\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06955}06955\ \ \ \ \ \textcolor{comment}{//\ Send\ LED\ commands\ to\ highlight\ possible\ destinations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06956}06956\ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06957}06957\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06958}06958\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06959}06959\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06960}06960\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06961}06961\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06962}06962\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ destination\ has\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06963}06963\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06964}06964\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06965}06965\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06966}06966\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06967}06967\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06968}06968\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06969}06969\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06970}06970\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06971}06971\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06972}06972\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06973}06973\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06974}06974\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06975}06975\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06976}06976\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06977}06977\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06978}06978\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06979}06979\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06980}06980\ \ \ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06981}06981\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06982}06982\ \ \ \ \ \ \ \ \ 50));\ \textcolor{comment}{//\ 50ms\ -\/\ enough\ for\ scheduler,\ not\ too\ long\ for\ watchdog}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06983}06983\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06984}06984\ \ \ \ \ \textcolor{comment}{//\ STEP\ 3:\ Execute\ the\ move\ immediately\ (same\ as\ HW)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06985}06985\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Step\ 3:\ Executing\ move\ \%s\ -\/>\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06986}06986\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06987}06987\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06988}06988\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06989}06989\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ UART\ move\ executed\ successfully:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06990}06990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06991}06991\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06992}06992\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ a\ castling\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06993}06993\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_castling\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06994}06994\ \ \ \ \ \ \ \ \ \ \ (move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06995}06995\ \ \ \ \ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06996}06996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06997}06997\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06998}06998\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Castling\ move\ -\/\ don't\ change\ player,\ don't\ show\ player\ change}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06999}06999\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07000}07000\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07001}07001\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07002}07002\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ UART\ Castling\ move\ executed\ -\/\ waiting\ for\ rook\ to\ be\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07003}07003\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07004}07004\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ successful\ castling\ move\ with\ colors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07005}07005\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07006}07006\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[92m🏰\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07007}07007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07008}07008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CASTLING\ MOVE\ EXECUTED!"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07009}07009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07010}07010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07011}07011\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Move:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07012}07012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07013}07013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ →\ \%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07014}07014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07015}07015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07016}07016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07017}07017\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Piece:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07018}07018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07019}07019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07020}07020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07021}07021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07022}07022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07023}07023\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[96m\ \ \ •\ Next:\ Move\ the\ rook\ to\ complete\ castling!"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07024}07024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07025}07025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07026}07026\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07027}07027\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07028}07028\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ success\ response\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07029}07029\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07030}07030\ \ \ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07031}07031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castling\ move\ completed:\ \%s\ -\/>\ \%s.\ Now\ move\ the\ rook!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07032}07032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07033}07033\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07034}07034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07035}07035\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07036}07036\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ move\ -\/\ switch\ player\ and\ show\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07037}07037\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ successful\ move\ with\ colors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07038}07038\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07039}07039\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[92m✅\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07040}07040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07041}07041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}MOVE\ EXECUTED\ SUCCESSFULLY!"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07042}07042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07043}07043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07044}07044\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Move:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07045}07045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07046}07046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ →\ \%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07047}07047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07048}07048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07049}07049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07050}07050\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Piece:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07051}07051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07052}07052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07053}07053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07054}07054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07055}07055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07056}07056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (move.\mbox{\hyperlink{structchess__move__t_a02d91c42164e16fe1bb058dd71f04b8e}{captured\_piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07057}07057\ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Captured:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07058}07058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07059}07059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07060}07060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07061}07061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07062}07062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[move.\mbox{\hyperlink{structchess__move__t_a02d91c42164e16fe1bb058dd71f04b8e}{captured\_piece}}]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07063}07063\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07064}07064\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07065}07065\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07066}07066\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ FIXED:\ LED\ animations\ are\ now\ handled\ in\ game\_process\_drop\_command}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07067}07067\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ function\ only\ shows\ text\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07068}07068\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07069}07069\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Odstraněno\ modré\ bliknutí\ -\/\ animace\ se\ řeší\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07070}07070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_process\_drop\_command\ LED\ se\ zhasínají\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07071}07071\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_process\_drop\_command\ po\ úspěšném\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07072}07072\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07073}07073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ Spustit\ move\ path\ animaci\ PŘED\ změnou\ hráče\ (podle\ starého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07074}07074\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07075}07075\ \ \ \ \ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07076}07076\ \ \ \ \ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07077}07077\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ move\_path\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07078}07078\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dab4580f84f360910c3c26cd55b1ecdf42}{LED\_CMD\_ANIM\_MOVE\_PATH}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07079}07079\ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07080}07080\ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07081}07081\ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07082}07082\ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07083}07083\ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07084}07084\ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&to\_led\ \textcolor{comment}{//\ Cílová\ pozice\ v\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07085}07085\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07086}07086\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&move\_path\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07087}07087\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07088}07088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ STABILITY\ FIX:\ Animace\ běží\ asynchronně,\ neblokujeme\ zpracování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07089}07089\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Animace\ jsou\ spuštěny\ v\ led\_task\ a\ běží\ nezávisle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07090}07090\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (vTaskDelay\ odstraněn\ pro\ lepší\ throughput)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07091}07091\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07092}07092\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ HRÁČ\ SE\ UŽ\ ZMĚNIL\ V\ game\_execute\_move()\ -\/\ použít\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07093}07093\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07094}07094\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07095}07095\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07096}07096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07097}07097\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07098}07098\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07099}07099\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07100}07100\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07101}07101\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07102}07102\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07103}07103\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07104}07104\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07105}07105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07106}07106\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07107}07107\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07108}07108\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07109}07109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07110}07110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07111}07111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07112}07112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07113}07113\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07114}07114\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07115}07115\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07116}07116\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07117}07117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ in\ UART\ move!\ Starting\ endgame\ animation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07118}07118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07119}07119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07120}07120\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07121}07121\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07122}07122\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07123}07123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07124}07124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07125}07125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07126}07126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07127}07127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07128}07128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07129}07129\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07130}07130\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07131}07131\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07132}07132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07133}07133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07134}07134\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07135}07135\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07136}07136\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07137}07137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07138}07138\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07139}07139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07140}07140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07141}07141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07142}07142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07143}07143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07144}07144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07145}07145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07146}07146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07147}07147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07148}07148\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07149}07149\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07150}07150\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07151}07151\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07152}07152\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07153}07153\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07154}07154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07155}07155\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07156}07156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07157}07157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07158}07158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07159}07159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07160}07160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07161}07161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07162}07162\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07163}07163\ \ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07164}07164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07165}07165\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07166}07166\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07167}07167\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07168}07168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07169}07169\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07170}07170\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Timer\ switch:\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07171}07171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07172}07172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07173}07173\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07174}07174\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07175}07175\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07176}07176\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Zobrazit\ pohyblivé\ figurky\ pro\ nového\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07177}07177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07178}07178\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07179}07179\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ success\ response\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07180}07180\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07181}07181\ \ \ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),\ \textcolor{stringliteral}{"{}Move\ executed:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07182}07182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07183}07183\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07184}07184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07185}07185\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07186}07186\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07187}07187\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ execute\ UART\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07188}07188\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}Failed\ to\ execute\ move"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07189}07189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07190}07190\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07191}07191\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07192}07192\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ UART\ move:\ error\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07193}07193\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ CALLING\ SMART\ ERROR\ HANDLING..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07194}07194\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07195}07195\ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Použít\ chytrý\ error\ handling\ místo\ starého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07196}07196\ \ \ \ \ \mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{game\_handle\_invalid\_move}}(error,\ \&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07197}07197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07198}07198\ \ \ \ \ \textcolor{comment}{//\ Send\ error\ response\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07199}07199\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07200}07200\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07201}07201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Invalid\ move:\ \%s\ -\/>\ \%s\ -\/\ piece\ moved\ to\ red\ square"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07202}07202\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07203}07203\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07204}07204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07205}07205\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07206}07206\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔴\ Smart\ error\ handling\ activated\ -\/\ red\ square\ will\ stay\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07207}07207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}lit\ until\ piece\ is\ lifted"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07208}07208\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07209}07209\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07210}07210\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07211}\mbox{\hyperlink{game__task_8c_ac4ac5416414272fb1942f0269ea572c7}{07211}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac4ac5416414272fb1942f0269ea572c7}{game\_process\_commands}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07212}07212\ \ \ \textcolor{comment}{//\ ✅\ AKTUALIZOVAT\ non-\/blocking\ blink}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07213}07213\ \ \ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07214}07214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07215}07215\ \ \ \textcolor{comment}{//\ ✅\ STABILITY\ FIX:\ Process\ ALL\ commands\ in\ queue\ (not\ just\ one)\ with\ limit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07216}07216\ \ \ \textcolor{comment}{//\ to\ prevent\ watchdog\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07217}07217\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07218}07218\ \ \ \ \ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ chess\_cmd;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07219}07219\ \ \ \ \ uint32\_t\ commands\_processed\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07220}07220\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ MAX\_COMMANDS\_PER\_CYCLE\ =\ 15;\ \textcolor{comment}{//\ ✅\ Limit\ to\ prevent\ watchdog\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07221}07221\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07222}07222\ \ \ \ \ \textcolor{comment}{//\ Process\ all\ commands\ in\ queue\ (up\ to\ limit)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07223}07223\ \ \ \ \ \textcolor{keywordflow}{while}\ (xQueueReceive(\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}},\ \&chess\_cmd,\ 0)\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07224}07224\ \ \ \ \ \ \ commands\_processed++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07225}07225\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📥\ Received\ command\ type:\ \%d\ (processed:\ \%lu/\%lu)"{}},\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07226}07226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}},\ commands\_processed,\ MAX\_COMMANDS\_PER\_CYCLE);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07227}07227\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07228}07228\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a9cdd3824f45d61a774ab6868e898e1c0}{GAME\_CMD\_NEW\_GAME}}:\ \textcolor{comment}{//\ 0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07229}07229\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ NEW\ GAME\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07230}07230\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{game\_start\_new\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07231}07231\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}New\ game\ started\ successfully!"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07232}07232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07233}07233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07234}07234\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07235}07235\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4afa32272119e942c6d9ecf8e41d53e0e0}{GAME\_CMD\_RESET\_GAME}}:\ \textcolor{comment}{//\ 1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07236}07236\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ RESET\ GAME\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07237}07237\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07238}07238\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}Game\ reset\ to\ starting\ position!"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07239}07239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07240}07240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07241}07241\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07242}07242\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4f5010e7796f733431849acc8175fdbe}{GAME\_CMD\_MAKE\_MOVE}}:\ \textcolor{comment}{//\ 2}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07243}07243\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ MAKE\ MOVE\ command\ from\ UART:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07244}07244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07245}07245\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{game\_process\_chess\_move}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07246}07246\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07247}07247\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07248}07248\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a982ea3a5c5efd162ad30ebb49ca51216}{GAME\_CMD\_UNDO\_MOVE}}:\ \textcolor{comment}{//\ 3}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07249}07249\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ UNDO\ MOVE\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07250}07250\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Implement\ undo\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07251}07251\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07252}07252\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07253}07253\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ad280705c3d4a5140b36a1ed9bf9d0d45}{GAME\_CMD\_GET\_STATUS}}:\ \textcolor{comment}{//\ 4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07254}07254\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\ STATUS\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07255}07255\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a138dd79d240e644870a7d53580720206}{game\_print\_status}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07256}07256\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07257}07257\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07258}07258\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ac834cfe65957284eaf2fc08fb85f82c1}{GAME\_CMD\_GET\_BOARD}}:\ \textcolor{comment}{//\ 5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07259}07259\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\ BOARD\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07260}07260\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{game\_send\_board\_to\_uart}}((QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07261}07261\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07262}07262\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07263}07263\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a605e6b57d3beaf8791ef5fdb55b4eb8c}{GAME\_CMD\_GET\_VALID\_MOVES}}:\ \textcolor{comment}{//\ 6}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07264}07264\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\ VALID\ MOVES\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07265}07265\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Implement\ get\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07266}07266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07267}07267\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07268}07268\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 7:\ \textcolor{comment}{//\ GAME\_CMD\_PICKUP\_PIECE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07269}07269\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PICKUP\ PIECE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07270}07270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07271}07271\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07272}07272\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07273}07273\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07274}07274\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 8:\ \textcolor{comment}{//\ GAME\_CMD\_DROP\_PIECE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07275}07275\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ DROP\ PIECE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07276}07276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07277}07277\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07278}07278\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07279}07279\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07280}07280\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 9:\ \textcolor{comment}{//\ GAME\_CMD\_PROMOTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07281}07281\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PROMOTION\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07282}07282\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{game\_process\_promotion\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07283}07283\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07284}07284\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07285}07285\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 10:\ \textcolor{comment}{//\ GAME\_CMD\_MOVE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07286}07286\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ MOVE\ command\ from\ UART:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07287}07287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07288}07288\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{game\_process\_chess\_move}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07289}07289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07290}07290\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07291}07291\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 11:\ \textcolor{comment}{//\ GAME\_CMD\_SHOW\_BOARD}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07292}07292\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ SHOW\ BOARD\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07293}07293\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{game\_send\_board\_to\_uart}}((QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07294}07294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07295}07295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07296}07296\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 12:\ \textcolor{comment}{//\ GAME\_CMD\_PICKUP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07297}07297\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PICKUP\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07298}07298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07299}07299\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07300}07300\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07301}07301\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07302}07302\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 13:\ \textcolor{comment}{//\ GAME\_CMD\_DROP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07303}07303\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ DROP\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07304}07304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07305}07305\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07306}07306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07307}07307\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07308}07308\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 17:\ \textcolor{comment}{//\ GAME\_CMD\_EVALUATE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07309}07309\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ EVALUATE\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07310}07310\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{game\_process\_evaluate\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07311}07311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07312}07312\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07313}07313\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 18:\ \textcolor{comment}{//\ GAME\_CMD\_SAVE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07314}07314\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ SAVE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07315}07315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07316}07316\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{game\_process\_save\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07317}07317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07318}07318\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07319}07319\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 19:\ \textcolor{comment}{//\ GAME\_CMD\_LOAD}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07320}07320\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ LOAD\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07321}07321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07322}07322\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{game\_process\_load\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07323}07323\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07324}07324\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07325}07325\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 20:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_20}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07326}07326\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 29:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_29}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07327}07327\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 30:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_30}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07328}07328\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 31:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_31}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07329}07329\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 32:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_32}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07330}07330\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 38:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_38}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07331}07331\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Ignored\ legacy\ puzzle\ command:\ \%d"{}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07332}07332\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Puzzle\ system\ neni\ dostupny"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07333}07333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07334}07334\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07335}07335\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07336}07336\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 21:\ \textcolor{comment}{//\ GAME\_CMD\_CASTLE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07337}07337\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ CASTLE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07338}07338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07339}07339\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{game\_process\_castle\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07340}07340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07341}07341\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07342}07342\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 22:\ \textcolor{comment}{//\ GAME\_CMD\_PROMOTE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07343}07343\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PROMOTE\ command\ from\ UART:\ \%s=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07344}07344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07345}07345\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{game\_process\_promote\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07346}07346\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07347}07347\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07348}07348\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 23:\ \textcolor{comment}{//\ GAME\_CMD\_COMPONENT\_OFF}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07349}07349\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ COMPONENT\_OFF\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07350}07350\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{game\_process\_component\_off\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07351}07351\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07352}07352\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07353}07353\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 24:\ \textcolor{comment}{//\ GAME\_CMD\_COMPONENT\_ON}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07354}07354\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ COMPONENT\_ON\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07355}07355\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{game\_process\_component\_on\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07356}07356\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07357}07357\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07358}07358\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 25:\ \textcolor{comment}{//\ GAME\_CMD\_ENDGAME\_WHITE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07359}07359\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ ENDGAME\_WHITE\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07360}07360\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{game\_process\_endgame\_white\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07361}07361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07362}07362\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07363}07363\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 26:\ \textcolor{comment}{//\ GAME\_CMD\_ENDGAME\_BLACK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07364}07364\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ ENDGAME\_BLACK\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07365}07365\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{game\_process\_endgame\_black\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07366}07366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07367}07367\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07368}07368\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 27:\ \textcolor{comment}{//\ GAME\_CMD\_LIST\_GAMES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07369}07369\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ LIST\_GAMES\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07370}07370\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{game\_process\_list\_games\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07371}07371\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07372}07372\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07373}07373\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 28:\ \textcolor{comment}{//\ GAME\_CMD\_DELETE\_GAME}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07374}07374\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ DELETE\_GAME\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07375}07375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07376}07376\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{game\_process\_delete\_game\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07377}07377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07378}07378\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07379}07379\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 33:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_MOVE\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07380}07380\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_MOVE\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07381}07381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad58e853637de174a1bc4f6ad9556bbaa}{game\_test\_move\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07382}07382\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07383}07383\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07384}07384\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 34:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_PLAYER\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07385}07385\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_PLAYER\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07386}07386\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0054718644880d12b2f8ccb352644a2b}{game\_test\_player\_change\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07387}07387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07388}07388\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07389}07389\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 35:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_CASTLE\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07390}07390\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_CASTLE\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07391}07391\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a38bb9a0b5b3cd868021ba1f05be228d6}{game\_test\_castle\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07392}07392\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07393}07393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07394}07394\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 36:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_PROMOTE\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07395}07395\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_PROMOTE\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07396}07396\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54c0942839659e43c97af3b1c7aca7e9}{game\_test\_promote\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07397}07397\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07398}07398\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07399}07399\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 37:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_ENDGAME\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07400}07400\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_ENDGAME\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07401}07401\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac06cb22933b494c00b27ecb35160eeaa}{game\_test\_endgame\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07402}07402\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07403}07403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07404}07404\ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ System\ Commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07405}07405\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a0ba09395c8b55913ce75adb28ac19003}{GAME\_CMD\_SET\_TIME\_CONTROL}}:\ \textcolor{comment}{//\ 39}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07406}07406\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ SET\_TIME\_CONTROL\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07407}07407\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07408}07408\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07409}07409\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07410}07410\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a04714aa90de7f3ace2585fe01cf67659}{GAME\_CMD\_PAUSE\_TIMER}}:\ \textcolor{comment}{//\ 40}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07411}07411\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PAUSE\_TIMER\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07412}07412\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07413}07413\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07414}07414\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07415}07415\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a19a04a30f9a17d5a85cd43db2b1e298a}{GAME\_CMD\_RESUME\_TIMER}}:\ \textcolor{comment}{//\ 41}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07416}07416\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ RESUME\_TIMER\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07417}07417\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07418}07418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07419}07419\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07420}07420\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4aee7fca1d1758d39255d3b023f569313d}{GAME\_CMD\_RESET\_TIMER}}:\ \textcolor{comment}{//\ 42}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07421}07421\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ RESET\_TIMER\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07422}07422\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07423}07423\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07424}07424\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07425}07425\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ae152c62fc7eae57cbf8fc14a3ff749e2}{GAME\_CMD\_GET\_TIMER\_STATE}}:\ \textcolor{comment}{//\ 43}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07426}07426\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\_TIMER\_STATE\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07427}07427\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07428}07428\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07429}07429\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07430}07430\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a1963a76107560b25595a00d47b103534}{GAME\_CMD\_TIMER\_TIMEOUT}}:\ \textcolor{comment}{//\ 44}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07431}07431\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TIMER\_TIMEOUT\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07432}07432\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07433}07433\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07434}07434\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07435}07435\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07436}07436\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Unknown\ game\ command:\ \%d"{}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07437}07437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07438}07438\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07439}07439\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07440}07440\ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ STABILITY\ FIX:\ Check\ limit\ to\ prevent\ watchdog\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07441}07441\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (commands\_processed\ >=\ MAX\_COMMANDS\_PER\_CYCLE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07442}07442\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Reached\ max\ commands\ per\ cycle\ (\%lu),\ processing\ rest\ in\ next\ cycle"{}},\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07443}07443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MAX\_COMMANDS\_PER\_CYCLE);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07444}07444\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Process\ remaining\ commands\ in\ next\ cycle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07445}07445\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07446}07446\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07447}07447\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07448}07448\ \ \ \ \ \textcolor{comment}{//\ Log\ if\ we\ processed\ multiple\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07449}07449\ \ \ \ \ \textcolor{keywordflow}{if}\ (commands\_processed\ >\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07450}07450\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Processed\ \%lu\ commands\ in\ this\ cycle"{}},\ commands\_processed);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07451}07451\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07452}07452\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07453}07453\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07454}07454\ \ \ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07455}07455\ \ \ \textcolor{comment}{//\ BUTTON\ EVENT\ PROCESSING\ -\/\ Physical\ button\ support}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07456}07456\ \ \ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07457}07457\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07458}07458\ \ \ \textcolor{comment}{//\ Process\ button\ events\ from\ button\_task}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07459}07459\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_a05107bbe85fd87a92dad9efd71dbd653}{button\_event\_queue}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07460}07460\ \ \ \ \ \mbox{\hyperlink{structbutton__event__t}{button\_event\_t}}\ button\_event;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07461}07461\ \ \ \ \ \textcolor{keywordflow}{while}\ (xQueueReceive(\mbox{\hyperlink{freertos__chess_8c_a05107bbe85fd87a92dad9efd71dbd653}{button\_event\_queue}},\ \&button\_event,\ 0)\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07462}07462\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07463}07463\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ process\ PRESS\ events\ (ignore\ release,\ long\ press,\ double\ press)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07464}07464\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\_event.\mbox{\hyperlink{structbutton__event__t_aaf4df16f9df04bfcd820337024e7dec6}{type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a54c67f8a6d26165b932e66b06b5b904bac5a8f24e3beed7990f5495be58d2dc79}{BUTTON\_EVENT\_PRESS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07465}07465\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07466}07466\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎮\ Button\ pressed:\ ID=\%d"{}},\ button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07467}07467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07468}07468\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ button\ (ID\ 8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07469}07469\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}}\ ==\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07470}07470\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Reset\ button\ pressed\ -\/\ resetting\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07471}07471\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07472}07472\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();\ \textcolor{comment}{//\ Update\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07473}07473\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07474}07474\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07475}07475\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07476}07476\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Promotion\ buttons\ (ID\ 0-\/3)\ -\/\ physical\ buttons}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07477}07477\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}}\ <=\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07478}07478\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Promotion\ button\ \%d\ pressed"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07479}07479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07480}07480\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{game\_process\_promotion\_button}}(button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07481}07481\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07482}07482\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07483}07483\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07484}07484\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unknown\ button}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07485}07485\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Unknown\ button\ ID:\ \%d"{}},\ button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07486}07486\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07487}07487\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07488}07488\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07489}07489\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07490}07490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07496}07496\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07497}07497\ \textcolor{comment}{//\ ENHANCED\ SMART\ ERROR\ HANDLING\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07498}07498\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07499}07499\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07505}\mbox{\hyperlink{game__task_8c_ae998755862849e203b40a085fde47541}{07505}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae998755862849e203b40a085fde47541}{game\_handle\_invalid\_move\_smart}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07506}07506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07507}07507\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚫\ INVALID\ MOVE\ -\/\ Starting\ smart\ recovery"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07508}07508\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07509}07509\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07510}07510\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Critical\ error:\ NULL\ move\ pointer\ in\ error\ handling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07511}07511\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07512}07512\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07513}07513\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07514}07514\ \ \ \textcolor{comment}{//\ 1.\ Červené\ bliknutí\ chybného\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07515}07515\ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07516}07516\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07517}07517\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07518}07518\ \ \ \textcolor{comment}{//\ Flash\ error\ -\/\ 5\ rychlých\ červených\ bliknutí}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07519}07519\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07520}07520\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07521}07521\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 255,\ 0,\ 0);\ \ \ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07522}07522\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07523}07523\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07524}07524\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07525}07525\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07526}07526\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07527}07527\ \ \ \textcolor{comment}{//\ 2.\ Rosvítit\ zeleně\ zdrojové\ pole\ (kde\ je\ figurka)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07528}07528\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green\ -\/\ kde\ vzít\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07529}07529\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07530}07530\ \ \ \textcolor{comment}{//\ 3.\ Rosvítit\ červeně\ kolem\ nevalidního\ cíle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07531}07531\ \ \ \mbox{\hyperlink{game__task_8c_acd21a8521c05d2746643f0a674e9ee5d}{game\_highlight\_invalid\_target\_area}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07532}07532\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07533}07533\ \ \ \textcolor{comment}{//\ 4.\ Rosvítit\ validní\ tahy\ pro\ tuto\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07534}07534\ \ \ \mbox{\hyperlink{game__task_8c_ac0310521f54ddea6598d78bf6e009713}{game\_highlight\_valid\_moves\_for\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07535}07535\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07536}07536\ \ \ \textcolor{comment}{//\ 5.\ KRITICKÉ:\ Neměnit\ hráče,\ nechat\ ho\ opravit\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07537}07537\ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07538}07538\ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07539}07539\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Please\ return\ piece\ to\ correct\ square.\ Valid\ moves\ are\ highlighted."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07540}07540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07541}07541\ \ \ \textcolor{comment}{//\ 6.\ Nastavit\ internal\ stav\ "{}waiting\ for\ correction"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07542}07542\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07543}07543\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07544}07544\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07545}07545\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07546}07546\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07552}\mbox{\hyperlink{game__task_8c_acd21a8521c05d2746643f0a674e9ee5d}{07552}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_acd21a8521c05d2746643f0a674e9ee5d}{game\_highlight\_invalid\_target\_area}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07553}07553\ \ \ \textcolor{comment}{//\ Rosvítit\ červeně\ pole\ okolo\ nevalidního\ cíle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07554}07554\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dr\ =\ -\/1;\ dr\ <=\ 1;\ dr++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07555}07555\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dc\ =\ -\/1;\ dc\ <=\ 1;\ dc++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07556}07556\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ new\_row\ =\ row\ +\ dr;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07557}07557\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ new\_col\ =\ col\ +\ dc;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07558}07558\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07559}07559\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_row\ >=\ 0\ \&\&\ new\_row\ <\ 8\ \&\&\ new\_col\ >=\ 0\ \&\&\ new\_col\ <\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07560}07560\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(new\_row,\ new\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07561}07561\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 50,\ 50);\ \textcolor{comment}{//\ Light\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07562}07562\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07563}07563\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07564}07564\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07565}07565\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07566}07566\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07572}\mbox{\hyperlink{game__task_8c_ac0310521f54ddea6598d78bf6e009713}{07572}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac0310521f54ddea6598d78bf6e009713}{game\_highlight\_valid\_moves\_for\_piece}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07573}07573\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07574}07574\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07575}07575\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07576}07576\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07577}07577\ \ \ \textcolor{comment}{//\ Najít\ všechny\ validní\ tahy\ pro\ tuto\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07578}07578\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_row\ =\ 0;\ to\_row\ <\ 8;\ to\_row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07579}07579\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_col\ =\ 0;\ to\_col\ <\ 8;\ to\_col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07580}07580\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ test\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07581}07581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07582}07582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07583}07583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07584}07584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07585}07585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07586}07586\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07587}07587\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&test\_move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07588}07588\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(to\_row,\ to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07589}07589\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue\ -\/\ validní\ tahy}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07590}07590\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07591}07591\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07592}07592\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07593}07593\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07594}07594\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07598}\mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{07598}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{game\_handle\_invalid\_move}}(\mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07599}07599\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ ENTERING\ game\_handle\_invalid\_move\ -\/\ error:\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07600}07600\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07601}07601\ \ \ \textcolor{comment}{//\ ✅\ KRITICKÁ\ OPRAVA:\ Bezpečnostní\ kontrola\ move\ pointeru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07602}07602\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07603}07603\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Critical\ error:\ NULL\ move\ pointer\ in\ error\ handling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07604}07604\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07605}07605\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07606}07606\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07607}07607\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Kontrola\ validity\ coordinates\ před\ použitím}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07608}07608\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ >=\ 8\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ >=\ 8\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ >=\ 8\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07609}07609\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ >=\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07610}07610\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Critical\ error:\ Invalid\ coordinates\ in\ move\ structure"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07611}07611\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07612}07612\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07613}07613\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07614}07614\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ Invalid\ move\ detected\ -\/\ smart\ error\ handling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07615}07615\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Move:\ \%c\%d\ -\/>\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07616}07616\ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07617}07617\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07618}07618\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Chytrý\ error\ handling\ podle\ požadavků}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07619}07619\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07620}07620\ \ \ \textcolor{comment}{//\ 1.\ Nastavit\ červené\ pole\ na\ neplatné\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07621}07621\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07622}07622\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07623}07623\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07624}07624\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07625}07625\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07626}07626\ \ \ \textcolor{comment}{//\ 2.\ Zapamatovat\ si\ původní\ validní\ pozici\ (odkud\ byl\ tah)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07627}07627\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07628}07628\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07629}07629\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07630}07630\ \ \ \textcolor{comment}{//\ 3.\ Přesunout\ figurku\ na\ neplatnou\ pozici\ (simulace\ HW\ reality)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07631}07631\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07632}07632\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07633}07633\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07634}07634\ \ \ \textcolor{comment}{//\ 4.\ JASNÉ\ VIZUÁLNÍ\ UPOZORNĚNÍ\ -\/\ červené\ pole\ +\ blikání\ pro\ upoutání}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07635}07635\ \ \ \textcolor{comment}{//\ pozornosti}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07636}07636\ \ \ \mbox{\hyperlink{led__task_8h_afff280b4c9b7261d1a086e0cfa356604}{led\_clear\_all\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07637}07637\ \ \ uint8\_t\ invalid\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07638}07638\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07639}07639\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ STARTING\ ERROR\ ANIMATION\ -\/\ RED\ BLINKING"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07640}07640\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07641}07641\ \ \ \textcolor{comment}{//\ Blikání\ pro\ upoutání\ pozornosti\ (krátké,\ non-\/blocking)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07642}07642\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ blink\ =\ 0;\ blink\ <\ 4;\ blink++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07643}07643\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(invalid\_led,\ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Červená}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07644}07644\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(150));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07645}07645\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(invalid\_led,\ 0,\ 0,\ 0);\ \textcolor{comment}{//\ Zhasnout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07646}07646\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(150));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07647}07647\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07648}07648\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07649}07649\ \ \ \textcolor{comment}{//\ Nechat\ červené\ pole\ trvale\ rozsvícené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07650}07650\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(invalid\_led,\ 255,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07651}07651\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07652}07652\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔴\ RED\ SQUARE\ ACTIVE:\ \%c\%d\ (piece\ must\ be\ lifted\ from\ here)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07653}07653\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07654}07654\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07655}07655\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📍\ RECOVERY\ TARGET:\ Valid\ moves\ will\ show\ from\ \%c\%d\ when\ piece\ is\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07656}07656\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}lifted"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07657}07657\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07658}07658\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07659}07659\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ USER\ ACTION\ REQUIRED:\ Lift\ piece\ from\ red\ square\ to\ continue"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07660}07660\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07661}07661\ \ \ \textcolor{comment}{//\ ✅\ KRITICKÁ\ OPRAVA:\ NON-\/BLOCKING\ error\ handling\ -\/\ žádné\ loops!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07662}07662\ \ \ \textcolor{comment}{//\ Červené\ pole\ zůstane\ rozsvícené\ dokud\ se\ figurka\ nezvedne}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07663}07663\ \ \ \textcolor{comment}{//\ Recovery\ se\ řeší\ v\ game\_process\_pickup\_command()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07664}07664\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07665}07665\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Error\ recovery\ active\ -\/\ red\ square\ will\ stay\ lit\ until\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07666}07666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}piece\ is\ lifted"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07667}07667\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07668}07668\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07673}\mbox{\hyperlink{game__task_8c_a1e6678c31e3832807ff10c23bbcd517b}{07673}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1e6678c31e3832807ff10c23bbcd517b}{game\_process\_move\_command}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *move\_cmd\_ptr)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07674}07674\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07675}07675\ \ \ \ \ uint8\_t\ command\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07676}07676\ \ \ \ \ uint8\_t\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07677}07677\ \ \ \ \ uint8\_t\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07678}07678\ \ \ \ \ uint8\_t\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07679}07679\ \ \ \ \ uint8\_t\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07680}07680\ \ \ \}\ move\_command\_t;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07681}07681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07682}07682\ \ \ \textcolor{keyword}{const}\ move\_command\_t\ *move\_cmd\ =\ (\textcolor{keyword}{const}\ move\_command\_t\ *)move\_cmd\_ptr;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07683}07683\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07684}07684\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ move:\ [\%d,\%d]\ -\/>\ [\%d,\%d]"{}},\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07685}07685\ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_col,\ move\_cmd-\/>to\_row,\ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07686}07686\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07687}07687\ \ \ \textcolor{comment}{//\ Validate\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07688}07688\ \ \ \textcolor{keywordflow}{if}\ (move\_cmd-\/>from\_row\ >=\ 8\ ||\ move\_cmd-\/>from\_col\ >=\ 8\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07689}07689\ \ \ \ \ \ \ move\_cmd-\/>to\_row\ >=\ 8\ ||\ move\_cmd-\/>to\_col\ >=\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07690}07690\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ coordinates:\ out\ of\ board\ range"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07691}07691\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07692}07692\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07693}07693\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07694}07694\ \ \ \textcolor{comment}{//\ Get\ pieces\ at\ source\ and\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07695}07695\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ from\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move\_cmd-\/>from\_row][move\_cmd-\/>from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07696}07696\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ to\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move\_cmd-\/>to\_row][move\_cmd-\/>to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07697}07697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07698}07698\ \ \ \textcolor{comment}{//\ Check\ if\ source\ square\ has\ a\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07699}07699\ \ \ \textcolor{keywordflow}{if}\ (from\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07700}07700\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move:\ no\ piece\ at\ [\%d,\%d]"{}},\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07701}07701\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07702}07702\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07703}07703\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07704}07704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07705}07705\ \ \ \textcolor{comment}{//\ Check\ if\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07706}07706\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07707}07707\ \ \ \ \ \ \ (from\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ from\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07708}07708\ \ \ \textcolor{keywordtype}{bool}\ is\_black\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07709}07709\ \ \ \ \ \ \ (from\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ from\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07710}07710\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07711}07711\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !is\_white\_piece)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07712}07712\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !is\_black\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07713}07713\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move:\ cannot\ move\ opponent's\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07714}07714\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07715}07715\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07716}07716\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07717}07717\ \ \ \textcolor{comment}{//\ Check\ if\ destination\ is\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07718}07718\ \ \ \textcolor{keywordflow}{if}\ (to\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07719}07719\ \ \ \ \ \textcolor{keywordtype}{bool}\ dest\_is\_white\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07720}07720\ \ \ \ \ \ \ \ \ (to\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ to\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07721}07721\ \ \ \ \ \textcolor{keywordtype}{bool}\ dest\_is\_black\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07722}07722\ \ \ \ \ \ \ \ \ (to\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ to\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07723}07723\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07724}07724\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_is\_white)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07725}07725\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_is\_black))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07726}07726\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move:\ destination\ occupied\ by\ own\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07727}07727\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07728}07728\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07729}07729\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07730}07730\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07731}07731\ \ \ \textcolor{comment}{//\ TODO:\ Add\ proper\ chess\ move\ validation\ (piece-\/specific\ rules)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07732}07732\ \ \ \textcolor{comment}{//\ For\ now,\ just\ allow\ any\ move\ that\ passes\ basic\ checks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07733}07733\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07734}07734\ \ \ \textcolor{comment}{//\ Create\ chess\ move\ structure\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07735}07735\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ chess\_move\ =\ \{.from\_row\ =\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07736}07736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ move\_cmd-\/>from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07737}07737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ move\_cmd-\/>to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07738}07738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ move\_cmd-\/>to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07739}07739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ from\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07740}07740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ to\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07741}07741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07742}07742\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07743}07743\ \ \ \textcolor{comment}{//\ Validate\ move\ using\ enhanced\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07744}07744\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ move\_error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&chess\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07745}07745\ \ \ \textcolor{keywordflow}{if}\ (move\_error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07746}07746\ \ \ \ \ \textcolor{comment}{//\ NEW\ ERROR\ HANDLING:\ Don't\ return,\ handle\ invalid\ move\ properly}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07747}07747\ \ \ \ \ \mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{game\_handle\_invalid\_move}}(move\_error,\ \&chess\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07748}07748\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07749}07749\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07750}07750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07751}07751\ \ \ \textcolor{comment}{//\ ✅\ CRITICAL\ FIX:\ Use\ game\_execute\_move()\ instead\ of\ direct\ board\ manipulation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07752}07752\ \ \ \textcolor{comment}{//\ This\ ensures\ all\ game\ state\ is\ properly\ updated\ (castling\ flags,\ en\ passant,\ etc.)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07753}07753\ \ \ \textcolor{comment}{//\ and\ player\ is\ changed\ correctly}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07754}07754\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Executing\ move:\ \%s\ piece\ from\ [\%d,\%d]\ to\ [\%d,\%d]"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07755}07755\ \ \ \ \ \ \ \ \ \ \ \ (is\_white\_piece\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}}),\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07756}07756\ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_col,\ move\_cmd-\/>to\_row,\ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07757}07757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07758}07758\ \ \ \textcolor{comment}{//\ Execute\ the\ move\ using\ proper\ game\_execute\_move()\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07759}07759\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&chess\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07760}07760\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ execute\ move\ from\ [\%d,\%d]\ to\ [\%d,\%d]"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07761}07761\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_row,\ move\_cmd-\/>from\_col,\ move\_cmd-\/>to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07762}07762\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07763}07763\ \ \ \ \ \textcolor{comment}{//\ Note:\ move\_cmd\ doesn't\ have\ response\_queue,\ this\ is\ legacy\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07764}07764\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07765}07765\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07766}07766\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07767}07767\ \ \ \textcolor{comment}{//\ ✅\ HRÁČ\ SE\ UŽ\ ZMĚNIL\ V\ game\_execute\_move()\ -\/\ použít\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07768}07768\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07769}07769\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07770}07770\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07771}07771\ \ \ \textcolor{comment}{//\ ✅\ Spustit\ move\ path\ animaci\ PŘED\ změnou\ hráče\ (podle\ starého\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07772}07772\ \ \ uint8\_t\ from\_led\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07773}07773\ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move\_cmd-\/>from\_row,\ move\_cmd-\/>from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07774}07774\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move\_cmd-\/>to\_row,\ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07775}07775\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ move\_path\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07776}07776\ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dab4580f84f360910c3c26cd55b1ecdf42}{LED\_CMD\_ANIM\_MOVE\_PATH}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07777}07777\ \ \ \ \ \ \ .led\_index\ =\ from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07778}07778\ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07779}07779\ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07780}07780\ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07781}07781\ \ \ \ \ \ \ .duration\_ms\ =\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07782}07782\ \ \ \ \ \ \ .data\ =\ \&to\_led\ \textcolor{comment}{//\ Cílová\ pozice\ v\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07783}07783\ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07784}07784\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&move\_path\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07785}07785\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07786}07786\ \ \ \textcolor{comment}{//\ ✅\ STABILITY\ FIX:\ Animace\ běží\ asynchronně,\ neblokujeme\ zpracování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07787}07787\ \ \ \textcolor{comment}{//\ Animace\ jsou\ spuštěny\ v\ led\_task\ a\ běží\ nezávisle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07788}07788\ \ \ \textcolor{comment}{//\ (vTaskDelay\ odstraněn\ pro\ lepší\ throughput)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07789}07789\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07790}07790\ \ \ \textcolor{comment}{//\ ✅\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07791}07791\ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07792}07792\ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07793}07793\ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07794}07794\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07795}07795\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07796}07796\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07797}07797\ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07798}07798\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07799}07799\ \ \ \ \ \ \ \ \ previous\_player;\ \ \ \textcolor{comment}{//\ Vítěz\ je\ předchozí\ hráč\ (ten,\ kdo\ udělal\ tah)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07800}07800\ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07801}07801\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07802}07802\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07803}07803\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07804}07804\ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07805}07805\ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07806}07806\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07807}07807\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07808}07808\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07809}07809\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07810}07810\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07811}07811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ in\ move\ command!\ Starting\ endgame\ animation\ at\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07812}07812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07813}07813\ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07814}07814\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07815}07815\ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07816}07816\ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07817}07817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07818}07818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07819}07819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07820}07820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07821}07821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07822}07822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07823}07823\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07824}07824\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07825}07825\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07826}07826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07827}07827\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07828}07828\ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci\ s\ NOVÝM\ hráčem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07829}07829\ \ \ \ \ \textcolor{comment}{//\ (current\_player)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07830}07830\ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07831}07831\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07832}07832\ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07833}07833\ \ \ \ \ \ \ \ \ .type\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07834}07834\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Použít\ ANIM\_PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07835}07835\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ místo\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07836}07836\ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07837}07837\ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07838}07838\ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07839}07839\ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07840}07840\ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07841}07841\ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ NOVÉHO\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07842}07842\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07843}07843\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07844}07844\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07845}07845\ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07846}07846\ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07847}07847\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07848}07848\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07849}07849\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07850}07850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07851}07851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07852}07852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07853}07853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07854}07854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07855}07855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07856}07856\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07857}07857\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07858}07858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07859}07859\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07860}07860\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07861}07861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07862}07862\ \ \ \textcolor{comment}{//\ ✅\ CRITICAL\ FIX:\ History\ and\ last\_move\ tracking\ is\ already\ done\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07863}07863\ \ \ \textcolor{comment}{//\ game\_execute\_move()\ -\/\ no\ need\ to\ duplicate\ here}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07864}07864\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07865}07865\ \ \ \textcolor{comment}{//\ Track\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07866}07866\ \ \ \textcolor{keywordflow}{if}\ (to\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07867}07867\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07868}07868\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ piece\ was\ captured\ by\ white}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07869}07869\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ <\ 16)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07870}07870\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}++]\ =\ to\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07871}07871\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07872}07872\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07873}07873\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07874}07874\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ piece\ was\ captured\ by\ black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07875}07875\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ <\ 16)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07876}07876\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}++]\ =\ to\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07877}07877\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07878}07878\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07879}07879\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07880}07880\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;\ \textcolor{comment}{//\ Reset\ counter\ on\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07881}07881\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07882}07882\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}++;\ \textcolor{comment}{//\ Increment\ counter\ for\ non-\/capture\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07883}07883\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ >\ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07884}07884\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07885}07885\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07886}07886\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07887}07887\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07888}07888\ \ \ \textcolor{comment}{//\ Update\ time\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07889}07889\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07890}07890\ \ \ uint32\_t\ move\_time\ =\ current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07891}07891\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07892}07892\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07893}07893\ \ \ \ \ \textcolor{comment}{//\ Black\ just\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07894}07894\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ +=\ move\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07895}07895\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07896}07896\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07897}07897\ \ \ \ \ \textcolor{comment}{//\ White\ just\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07898}07898\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ +=\ move\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07899}07899\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07900}07900\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07901}07901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07902}07902\ \ \ \textcolor{comment}{//\ Update\ position\ history\ for\ draw\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07903}07903\ \ \ \mbox{\hyperlink{game__task_8c_a7d059ee1bbc8427968feaf95af032112}{game\_add\_position\_to\_history}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07904}07904\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07905}07905\ \ \ \textcolor{comment}{//\ Note:\ End-\/game\ conditions\ already\ checked\ earlier\ in\ this\ function\ (line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07906}07906\ \ \ \textcolor{comment}{//\ 6612)\ If\ game\ finished,\ it\ was\ already\ handled\ with\ endgame\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07907}07907\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07908}07908\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07909}07909\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07910}07910\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07911}07911\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07912}07912\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07913}07913\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07914}07914\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07915}07915\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ CHECK!\ \%s\ king\ is\ under\ attack!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07916}07916\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07917}07917\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07918}07918\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07919}07919\ \ \ \textcolor{comment}{//\ Update\ last\ move\ time\ for\ next\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07920}07920\ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ current\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07921}07921\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07922}07922\ \ \ \textcolor{comment}{//\ Display\ updated\ board\ (check\ auto-\/display\ setting)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07923}07923\ \ \ \textcolor{comment}{//\ Note:\ Auto-\/display\ control\ is\ in\ UART\ task,\ board\ is\ always\ shown\ for\ now}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07924}07924\ \ \ \mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{game\_print\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07925}07925\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07926}07926\ \ \ \textcolor{comment}{//\ Check\ for\ check/checkmate\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07927}07927\ \ \ \mbox{\hyperlink{game__task_8c_ad50b0c62b7700e4422eba52d68e2a938}{game\_check\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07928}07928\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07929}07929\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07939}\mbox{\hyperlink{game__task_8c_a5fb8c34959fb71ce48802b7757701dbb}{07939}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5fb8c34959fb71ce48802b7757701dbb}{game\_show\_move\_animation}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07940}07940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07941}07941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ captured)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07942}07942\ \ \ \textcolor{comment}{//\ Convert\ coordinates\ to\ chess\ notation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07943}07943\ \ \ \textcolor{keywordtype}{char}\ from\_square[4],\ to\_square[4];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07944}07944\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(from\_row,\ from\_col,\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07945}07945\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(to\_row,\ to\_col,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07946}07946\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07947}07947\ \ \ \textcolor{comment}{//\ Get\ piece\ symbol\ and\ name}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07948}07948\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_symbol\ =\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07949}07949\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name\ =\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07950}07950\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07951}07951\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╭─────────────────────────────────╮"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07952}07952\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ \ \ \ \ \ \ MOVE\ ANIMATION\ \ \ \ \ \ \ \ \ \ │"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07953}07953\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}├─────────────────────────────────┤"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07954}07954\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ \%s\ \%s\ moves\ from\ \%s\ to\ \%s\ \ │"{}},\ piece\_symbol,\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07955}07955\ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07956}07956\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07957}07957\ \ \ \textcolor{keywordflow}{if}\ (captured\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07958}07958\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *captured\_symbol\ =\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[captured];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07959}07959\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *captured\_name\ =\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(captured);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07960}07960\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ Captures:\ \%s\ \%s\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ │"{}},\ captured\_symbol,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07961}07961\ \ \ \ \ \ \ \ \ \ \ \ \ \ captured\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07962}07962\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07963}07963\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ No\ capture\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ │"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07964}07964\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07965}07965\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07966}07966\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╰─────────────────────────────────╯"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07967}07967\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07968}07968\ \ \ \textcolor{comment}{//\ FIXED:\ LED\ animations\ are\ now\ handled\ in\ game\_process\_drop\_command}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07969}07969\ \ \ \textcolor{comment}{//\ This\ function\ only\ shows\ text\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07970}07970\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07971}07971\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Move:\ \%s\ -\/>\ \%s"{}},\ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07972}07972\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}♟️\ \ \%s\ \%s\ moves..."{}},\ piece\_symbol,\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07973}07973\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✨\ ...to\ \%s"{}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07974}07974\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07975}07975\ \ \ \textcolor{keywordflow}{if}\ (captured\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07976}07976\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💥\ \%s\ captured!"{}},\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(captured));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07977}07977\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07978}07978\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07979}07979\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Move\ completed!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07980}07980\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07981}07981\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07987}\mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{07987}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{game\_show\_player\_change\_animation}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07988}07988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07989}07989\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Showing\ player\ change\ animation:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07990}07990\ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07991}07991\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07992}07992\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07993}07993\ \ \ \textcolor{comment}{//\ Clear\ board\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07994}07994\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07995}07995\ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07996}07996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07997}07997\ \ \ \textcolor{comment}{//\ FIXED:\ Find\ all\ pieces\ first,\ then\ animate\ all\ columns\ simultaneously}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07998}07998\ \ \ \textcolor{keywordtype}{int}\ prev\_pieces[8]\ =\ \{-\/1,\ -\/1,\ -\/1,\ -\/1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07999}07999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/1,\ -\/1,\ -\/1,\ -\/1\};\ \textcolor{comment}{//\ Row\ positions\ for\ each\ column}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08000}08000\ \ \ \textcolor{keywordtype}{int}\ curr\_pieces[8]\ =\ \{-\/1,\ -\/1,\ -\/1,\ -\/1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08001}08001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/1,\ -\/1,\ -\/1,\ -\/1\};\ \textcolor{comment}{//\ Row\ positions\ for\ each\ column}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08002}08002\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08003}08003\ \ \ \textcolor{comment}{//\ Find\ closest\ pieces\ for\ all\ columns}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08004}08004\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08005}08005\ \ \ \ \ \textcolor{comment}{//\ Find\ closest\ piece\ of\ previous\ player\ (closest\ to\ opponent's\ side)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08006}08006\ \ \ \ \ \textcolor{keywordflow}{if}\ (previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08007}08007\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ top\ (row\ 7)\ down\ to\ find\ white\ piece\ closest\ to\ black\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08008}08008\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08009}08009\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08010}08010\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08011}08011\ \ \ \ \ \ \ \ \ \ \ prev\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08012}08012\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08013}08013\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08014}08014\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08015}08015\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08016}08016\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ bottom\ (row\ 0)\ up\ to\ find\ black\ piece\ closest\ to\ white\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08017}08017\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08018}08018\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08019}08019\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08020}08020\ \ \ \ \ \ \ \ \ \ \ prev\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08021}08021\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08022}08022\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08023}08023\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08024}08024\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08025}08025\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08026}08026\ \ \ \ \ \textcolor{comment}{//\ Find\ closest\ piece\ of\ current\ player\ (closest\ to\ previous\ player's\ side)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08027}08027\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08028}08028\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ bottom\ (row\ 0)\ up\ to\ find\ white\ piece\ closest\ to\ black\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08029}08029\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08030}08030\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08031}08031\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08032}08032\ \ \ \ \ \ \ \ \ \ \ curr\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08033}08033\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08034}08034\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08035}08035\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08036}08036\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08037}08037\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ top\ (row\ 7)\ down\ to\ find\ black\ piece\ closest\ to\ white\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08038}08038\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08039}08039\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08040}08040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08041}08041\ \ \ \ \ \ \ \ \ \ \ curr\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08042}08042\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08043}08043\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08044}08044\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08045}08045\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08046}08046\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08047}08047\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08048}08048\ \ \ \textcolor{comment}{//\ ENHANCED:\ Ultra-\/smooth\ player\ change\ animation\ with\ harmonious\ colors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08049}08049\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ step\ =\ 0;\ step\ <\ 8;\ step++)\ \{\ \textcolor{comment}{//\ Reduced\ steps\ for\ speed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08050}08050\ \ \ \ \ \textcolor{keywordtype}{float}\ progress\ =\ (float)step\ /\ 7.0f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08051}08051\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08052}08052\ \ \ \ \ \textcolor{comment}{//\ Clear\ board\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08053}08053\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08054}08054\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08055}08055\ \ \ \ \ \textcolor{comment}{//\ Animate\ all\ columns\ at\ once\ with\ ultra-\/smooth\ trail\ effect}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08056}08056\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08057}08057\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prev\_pieces[col]\ !=\ -\/1\ \&\&\ curr\_pieces[col]\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08058}08058\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ ultra-\/smooth\ trail\ effect\ -\/\ show\ multiple\ points\ along\ the}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08059}08059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ path}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08060}08060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ trail\ =\ 0;\ trail\ <\ 5;\ trail++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08061}08061\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ trail\_progress\ =\ progress\ -\/\ (trail\ *\ 0.12f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08062}08062\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08063}08063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08064}08064\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trail\_progress\ >\ 1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08065}08065\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08066}08066\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08067}08067\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ intermediate\ position\ with\ smooth\ easing}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08068}08068\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ eased\_progress\ =\ trail\_progress\ *\ trail\_progress\ *}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08069}08069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (3.0f\ -\/\ 2.0f\ *\ trail\_progress);\ \textcolor{comment}{//\ Smooth\ step}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08070}08070\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08071}08071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prev\_pieces[col]\ +}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08072}08072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (curr\_pieces[col]\ -\/\ prev\_pieces[col])\ *\ eased\_progress;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08073}08073\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08074}08074\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ inter\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(inter\_row,\ inter\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08075}08075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08076}08076\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Harmonious\ color\ transition:\ Deep\ Blue\ -\/>\ Purple\ -\/>\ Magenta\ -\/>\ Pink}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08077}08077\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/>\ Gold\ -\/>\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08078}08078\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ red,\ green,\ blue;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08079}08079\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.16f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08080}08080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Deep\ Blue\ to\ Purple}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08081}08081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ trail\_progress\ /\ 0.16f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08082}08082\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ (uint8\_t)(128\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08083}08083\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08084}08084\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08085}08085\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.33f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08086}08086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Purple\ to\ Magenta}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08087}08087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.16f)\ /\ 0.17f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08088}08088\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 128\ +\ (uint8\_t)(127\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08089}08089\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08090}08090\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08091}08091\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.5f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08092}08092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Magenta\ to\ Pink}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08093}08093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.33f)\ /\ 0.17f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08094}08094\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08095}08095\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ (uint8\_t)(128\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08096}08096\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 255\ -\/\ (uint8\_t)(128\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08097}08097\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.66f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08098}08098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pink\ to\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08099}08099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.5f)\ /\ 0.16f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08100}08100\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08101}08101\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 128\ +\ (uint8\_t)(127\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08102}08102\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 127\ -\/\ (uint8\_t)(127\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08103}08103\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.83f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08104}08104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Gold\ to\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08105}08105\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08106}08106\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08107}08107\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08108}08108\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08109}08109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow\ to\ Bright\ White}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08110}08110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.83f)\ /\ 0.17f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08111}08111\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08112}08112\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08113}08113\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ (uint8\_t)(255\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08114}08114\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08115}08115\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08116}08116\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enhanced\ trail\ brightness\ effect\ -\/\ smoother\ gradient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08117}08117\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ trail\_brightness\ =\ 1.0f\ -\/\ (trail\ *\ 0.18f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08118}08118\ \ \ \ \ \ \ \ \ \ \ red\ =\ (uint8\_t)(red\ *\ trail\_brightness);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08119}08119\ \ \ \ \ \ \ \ \ \ \ green\ =\ (uint8\_t)(green\ *\ trail\_brightness);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08120}08120\ \ \ \ \ \ \ \ \ \ \ blue\ =\ (uint8\_t)(blue\ *\ trail\_brightness);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08121}08121\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08122}08122\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enhanced\ pulsing\ effect\ with\ multiple\ harmonics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08123}08123\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ pulse1\ =\ 0.7f\ +\ 0.3f\ *\ sin(progress\ *\ 6.28f\ +\ trail\ *\ 1.26f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08124}08124\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ pulse2\ =\ 0.9f\ +\ 0.1f\ *\ sin(progress\ *\ 12.56f\ +\ trail\ *\ 2.51f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08125}08125\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ combined\_pulse\ =\ pulse1\ *\ pulse2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08126}08126\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08127}08127\ \ \ \ \ \ \ \ \ \ \ red\ =\ (uint8\_t)(red\ *\ combined\_pulse);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08128}08128\ \ \ \ \ \ \ \ \ \ \ green\ =\ (uint8\_t)(green\ *\ combined\_pulse);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08129}08129\ \ \ \ \ \ \ \ \ \ \ blue\ =\ (uint8\_t)(blue\ *\ combined\_pulse);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08130}08130\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08131}08131\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(inter\_led,\ red,\ green,\ blue);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08132}08132\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08133}08133\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08134}08134\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08135}08135\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08136}08136\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(25));\ \textcolor{comment}{//\ Faster\ animation\ -\/\ half\ the\ time}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08137}08137\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08138}08138\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08139}08139\ \ \ \textcolor{comment}{//\ Clear\ board\ after\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08140}08140\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08141}08141\ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08142}08142\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08143}08143\ \ \ \textcolor{comment}{//\ Finally,\ highlight\ movable\ pieces\ for\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08144}08144\ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08145}08145\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08146}08146\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08150}\mbox{\hyperlink{game__task_8c_ad58e853637de174a1bc4f6ad9556bbaa}{08150}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad58e853637de174a1bc4f6ad9556bbaa}{game\_test\_move\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08151}08151\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ move\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08152}08152\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08153}08153\ \ \ \textcolor{comment}{//\ Test\ move\ from\ e2\ to\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08154}08154\ \ \ \textcolor{comment}{//\ uint8\_t\ to\_led\ =\ chess\_pos\_to\_led\_index(3,\ 4);\ \ \ //\ e4\ -\/\ removed\ unused}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08155}08155\ \ \ \textcolor{comment}{//\ variable}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08156}08156\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08157}08157\ \ \ \textcolor{comment}{//\ Progressive\ color\ animation\ from\ green\ to\ blue\ -\/\ ZRYCHLENO}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08158}08158\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ step\ =\ 0;\ step\ <\ 6;\ step++)\ \{\ \textcolor{comment}{//\ ✅\ ZRYCHLENO:\ z\ 10\ na\ 6\ kroků}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08159}08159\ \ \ \ \ \textcolor{keywordtype}{float}\ progress\ =\ (float)step\ /\ 5.0f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08160}08160\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08161}08161\ \ \ \ \ \textcolor{comment}{//\ Calculate\ intermediate\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08162}08162\ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_row\ =\ 1\ +\ (3\ -\/\ 1)\ *\ progress;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08163}08163\ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_col\ =\ 4;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08164}08164\ \ \ \ \ uint8\_t\ inter\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(inter\_row,\ inter\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08165}08165\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08166}08166\ \ \ \ \ \textcolor{comment}{//\ Calculate\ color\ transition\ (green\ -\/>\ blue)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08167}08167\ \ \ \ \ uint8\_t\ red\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08168}08168\ \ \ \ \ uint8\_t\ green\ =\ 255\ -\/\ (255\ *\ progress);\ \textcolor{comment}{//\ 255\ -\/>\ 0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08169}08169\ \ \ \ \ uint8\_t\ blue\ =\ 0\ +\ (255\ *\ progress);\ \ \ \ \textcolor{comment}{//\ 0\ -\/>\ 255}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08170}08170\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08171}08171\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08172}08172\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(inter\_led,\ red,\ green,\ blue);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08173}08173\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));\ \textcolor{comment}{//\ ✅\ ZRYCHLENO:\ z\ 100ms\ na\ 50ms}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08174}08174\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08175}08175\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08176}08176\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Odstraněno\ modré\ bliknutí\ na\ konci\ -\/\ animace\ končí\ plynule}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08177}08177\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08178}08178\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08182}\mbox{\hyperlink{game__task_8c_a0054718644880d12b2f8ccb352644a2b}{08182}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0054718644880d12b2f8ccb352644a2b}{game\_test\_player\_change\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08183}08183\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ player\ change\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08184}08184\ \ \ \mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{game\_show\_player\_change\_animation}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}},\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08185}08185\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08186}08186\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08190}\mbox{\hyperlink{game__task_8c_a38bb9a0b5b3cd868021ba1f05be228d6}{08190}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a38bb9a0b5b3cd868021ba1f05be228d6}{game\_test\_castle\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08191}08191\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ castling\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08192}08192\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08193}08193\ \ \ \textcolor{comment}{//\ Test\ white\ kingside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08194}08194\ \ \ uint8\_t\ king\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 4);\ \textcolor{comment}{//\ e1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08195}08195\ \ \ uint8\_t\ king\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 6);\ \ \ \textcolor{comment}{//\ g1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08196}08196\ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 7);\ \textcolor{comment}{//\ h1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08197}08197\ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 5);\ \ \ \textcolor{comment}{//\ f1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08198}08198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08199}08199\ \ \ \textcolor{comment}{//\ 1.\ Highlight\ king\ and\ rook\ positions\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08200}08200\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08201}08201\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08202}08202\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08203}08203\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08204}08204\ \ \ \textcolor{comment}{//\ 2.\ Show\ castling\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08205}08205\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ castle\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac134d8980d40f9fc8a12f683b967b187}{LED\_CMD\_ANIM\_CASTLE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08206}08206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08207}08207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08208}08208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08209}08209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08210}08210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1500,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08211}08211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&king\_to\_led\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08212}08212\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&castle\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08213}08213\ \ \ vTaskDelay(pdMS\_TO\_TICKS(1000));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08214}08214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08215}08215\ \ \ \textcolor{comment}{//\ 3.\ Highlight\ final\ positions\ (green)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08216}08216\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08217}08217\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08218}08218\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08219}08219\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08220}08220\ \ \ \textcolor{comment}{//\ 4.\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08221}08221\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08222}08222\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08223}08223\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08227}\mbox{\hyperlink{game__task_8c_a54c0942839659e43c97af3b1c7aca7e9}{08227}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a54c0942839659e43c97af3b1c7aca7e9}{game\_test\_promote\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08228}08228\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ promotion\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08229}08229\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08230}08230\ \ \ \textcolor{comment}{//\ Test\ promotion\ on\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08231}08231\ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(7,\ 0);\ \textcolor{comment}{//\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08232}08232\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08233}08233\ \ \ \textcolor{comment}{//\ Show\ enhanced\ promotion\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08234}08234\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08235}08235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ promotion\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08236}08236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08237}08237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08238}08238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08239}08239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08240}08240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08241}08241\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08242}08242\ \ \ vTaskDelay(pdMS\_TO\_TICKS(1000));\ \textcolor{comment}{//\ Faster\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08243}08243\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08244}08244\ \ \ \textcolor{comment}{//\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08245}08245\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08246}08246\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08247}08247\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08251}\mbox{\hyperlink{game__task_8c_ac06cb22933b494c00b27ecb35160eeaa}{08251}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac06cb22933b494c00b27ecb35160eeaa}{game\_test\_endgame\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08252}08252\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ endgame\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08253}08253\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08254}08254\ \ \ \textcolor{comment}{//\ Test\ endgame\ animation\ using\ direct\ LED\ command}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08255}08255\ \ \ uint8\_t\ king\_pos\ =\ 27;\ \textcolor{comment}{//\ d4\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08256}08256\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08257}08257\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08258}08258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08259}08259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08260}08260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08261}08261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08262}08262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 3000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08263}08263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08264}08264\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08265}08265\ \ \ vTaskDelay(pdMS\_TO\_TICKS(1500));\ \textcolor{comment}{//\ Faster\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08266}08266\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08267}08267\ \ \ \textcolor{comment}{//\ Clear\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08268}08268\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08269}08269\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08270}08270\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08274}\mbox{\hyperlink{game__task_8c_ad50b0c62b7700e4422eba52d68e2a938}{08274}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad50b0c62b7700e4422eba52d68e2a938}{game\_check\_game\_conditions}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08275}08275\ \ \ \textcolor{comment}{//\ TODO:\ Implement\ check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08276}08276\ \ \ \textcolor{comment}{//\ For\ now,\ just\ log\ the\ current\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08277}08277\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08278}08278\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Checking\ game\ conditions..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08279}08279\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08280}08280\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08281}08281\ \ \ \textcolor{keywordtype}{bool}\ white\_king\_found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08282}08282\ \ \ \textcolor{keywordtype}{bool}\ black\_king\_found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08283}08283\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08284}08284\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08285}08285\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08286}08286\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08287}08287\ \ \ \ \ \ \ \ \ white\_king\_found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08288}08288\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08289}08289\ \ \ \ \ \ \ \ \ black\_king\_found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08290}08290\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08291}08291\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08292}08292\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08293}08293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08294}08294\ \ \ \textcolor{keywordflow}{if}\ (!white\_king\_found)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08295}08295\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ WHITE\ KING\ MISSING\ -\/\ Black\ wins!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08296}08296\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08297}08297\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!black\_king\_found)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08298}08298\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ BLACK\ KING\ MISSING\ -\/\ White\ wins!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08299}08299\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08300}08300\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08301}08301\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08302}08302\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ state:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08303}08303\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Active"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08304}08304\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Idle"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08305}08305\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}})\ ?\ \textcolor{stringliteral}{"{}Paused"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08306}08306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Finished"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08307}08307\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08308}08308\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08309}08309\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08310}08310\ \textcolor{comment}{//\ END-\/GAME\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08311}08311\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08312}08312\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08318}\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{08318}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08319}08319\ \ \ \textcolor{comment}{//\ Find\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08320}08320\ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08321}08321\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08322}08322\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08323}08323\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08324}08324\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08325}08325\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08326}08326\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08327}08327\ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08328}08328\ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08329}08329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08330}08330\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08331}08331\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08332}08332\ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08333}08333\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08334}08334\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08335}08335\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08336}08336\ \ \ \textcolor{keywordflow}{if}\ (king\_row\ ==\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08337}08337\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ King\ not\ found}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08338}08338\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08339}08339\ \ \ \textcolor{comment}{//\ Check\ if\ any\ opponent\ piece\ can\ capture\ the\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08340}08340\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ opponent\_pieces\_start\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08341}08341\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08342}08342\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ opponent\_pieces\_end\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08343}08343\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08344}08344\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08345}08345\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08346}08346\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08347}08347\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08348}08348\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ opponent\_pieces\_start\ \&\&\ piece\ <=\ opponent\_pieces\_end)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08349}08349\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ to\ check\ if\ it\ can\ capture\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08350}08350\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08351}08351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08352}08352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ king\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08353}08353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ king\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08354}08354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08355}08355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ king\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08356}08356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08357}08357\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08358}08358\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ move\ is\ valid\ (would\ capture\ king)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08359}08359\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(\&temp\_move,\ piece)\ ==}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08360}08360\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08361}08361\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ King\ is\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08362}08362\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08363}08363\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08364}08364\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08365}08365\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08366}08366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08367}08367\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08368}08368\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08369}08369\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08375}\mbox{\hyperlink{game__task_8c_a90e272f6928e9145d30671ce523ff35e}{08375}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a90e272f6928e9145d30671ce523ff35e}{game\_has\_legal\_moves}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08376}08376\ \ \ \textcolor{comment}{//\ Use\ existing\ move\ generation\ system\ instead\ of\ brute\ force}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08377}08377\ \ \ uint32\_t\ moves\_count\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08378}08378\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08379}08379\ \ \ \textcolor{keywordflow}{return}\ (moves\_count\ >\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08380}08380\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08381}08381\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08389}\mbox{\hyperlink{chess__types_8h_a4a1fae8d66a8db2dd28a091a3b11279c}{08389}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a4a1fae8d66a8db2dd28a091a3b11279c}{game\_is\_enemy\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08390}08390\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08391}08391\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08392}08392\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08393}08393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08394}08394\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08395}08395\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08396}\mbox{\hyperlink{game__task_8c_a93a1f0d6a82af5e13f78ebecc8a5ed8c}{08396}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a93a1f0d6a82af5e13f78ebecc8a5ed8c}{game\_is\_insufficient\_material}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08397}08397\ \ \ \textcolor{keywordtype}{int}\ white\_pieces\ =\ 0,\ black\_pieces\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08398}08398\ \ \ \textcolor{keywordtype}{int}\ white\_minors\ =\ 0,\ black\_minors\ =\ 0;\ \textcolor{comment}{//\ Knights\ and\ bishops}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08399}08399\ \ \ \textcolor{keywordtype}{bool}\ white\_has\_bishop\ =\ \textcolor{keyword}{false},\ black\_has\_bishop\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08400}08400\ \ \ \textcolor{keywordtype}{bool}\ white\_has\_knight\ =\ \textcolor{keyword}{false},\ black\_has\_knight\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08401}08401\ \ \ \textcolor{keywordtype}{bool}\ white\_bishop\_color\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08402}08402\ \ \ \ \ \ \ \ black\_bishop\_color\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ false\ =\ light,\ true\ =\ dark}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08403}08403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08404}08404\ \ \ \textcolor{comment}{//\ Count\ pieces\ and\ analyze\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08405}08405\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08406}08406\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08407}08407\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08408}08408\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08409}08409\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08410}08410\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08411}08411\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08412}08412\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08413}08413\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08414}08414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08415}08415\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08416}08416\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08417}08417\ \ \ \ \ \ \ \ \ white\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08418}08418\ \ \ \ \ \ \ \ \ white\_has\_bishop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08419}08419\ \ \ \ \ \ \ \ \ white\_bishop\_color\ =\ ((row\ +\ col)\ \%\ 2\ ==\ 0);\ \textcolor{comment}{//\ Light\ squares\ =\ false}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08420}08420\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08421}08421\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08422}08422\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08423}08423\ \ \ \ \ \ \ \ \ white\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08424}08424\ \ \ \ \ \ \ \ \ white\_has\_knight\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08425}08425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08426}08426\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08427}08427\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08428}08428\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08429}08429\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08430}08430\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08431}08431\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08432}08432\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08433}08433\ \ \ \ \ \ \ \ \ black\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08434}08434\ \ \ \ \ \ \ \ \ black\_has\_bishop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08435}08435\ \ \ \ \ \ \ \ \ black\_bishop\_color\ =\ ((row\ +\ col)\ \%\ 2\ ==\ 0);\ \textcolor{comment}{//\ Light\ squares\ =\ false}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08436}08436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08437}08437\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08438}08438\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08439}08439\ \ \ \ \ \ \ \ \ black\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08440}08440\ \ \ \ \ \ \ \ \ black\_has\_knight\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08441}08441\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08442}08442\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08443}08443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08444}08444\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08445}08445\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08446}08446\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08447}08447\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08448}08448\ \ \ \textcolor{comment}{//\ King\ vs\ King\ -\/\ always\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08449}08449\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ ==\ 0\ \&\&\ black\_pieces\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08450}08450\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08451}08451\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08452}08452\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08453}08453\ \ \ \textcolor{comment}{//\ King\ +\ minor\ vs\ King\ -\/\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08454}08454\ \ \ \textcolor{keywordflow}{if}\ ((white\_pieces\ ==\ 1\ \&\&\ black\_pieces\ ==\ 0)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08455}08455\ \ \ \ \ \ \ (white\_pieces\ ==\ 0\ \&\&\ black\_pieces\ ==\ 1))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08456}08456\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08457}08457\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08458}08458\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08459}08459\ \ \ \textcolor{comment}{//\ King\ +\ Bishop\ vs\ King\ +\ Bishop\ (same\ color)\ -\/\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08460}08460\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ ==\ 1\ \&\&\ black\_pieces\ ==\ 1\ \&\&\ white\_has\_bishop\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08461}08461\ \ \ \ \ \ \ black\_has\_bishop\ \&\&\ white\_bishop\_color\ ==\ black\_bishop\_color)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08462}08462\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08463}08463\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08464}08464\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08465}08465\ \ \ \textcolor{comment}{//\ King\ +\ Knight\ vs\ King\ +\ Knight\ -\/\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08466}08466\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ ==\ 1\ \&\&\ black\_pieces\ ==\ 1\ \&\&\ white\_has\_knight\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08467}08467\ \ \ \ \ \ \ black\_has\_knight)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08468}08468\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08469}08469\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08470}08470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08471}08471\ \ \ \textcolor{comment}{//\ King\ +\ 2\ Knights\ vs\ King\ -\/\ insufficient\ (very\ rare,\ but\ technically}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08472}08472\ \ \ \textcolor{comment}{//\ insufficient)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08473}08473\ \ \ \textcolor{keywordflow}{if}\ ((white\_pieces\ ==\ 2\ \&\&\ black\_pieces\ ==\ 0\ \&\&\ white\_minors\ ==\ 2\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08474}08474\ \ \ \ \ \ \ \ white\_has\_knight)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08475}08475\ \ \ \ \ \ \ (white\_pieces\ ==\ 0\ \&\&\ black\_pieces\ ==\ 2\ \&\&\ black\_minors\ ==\ 2\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08476}08476\ \ \ \ \ \ \ \ black\_has\_knight))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08477}08477\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08478}08478\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08479}08479\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08480}08480\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Sufficient\ material\ for\ checkmate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08481}08481\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08482}08482\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08511}\mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{08511}}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08512}08512\ \ \ \textcolor{comment}{//\ Check\ if\ current\ player\ is\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08513}08513\ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08514}08514\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08515}08515\ \ \ \textcolor{comment}{//\ Check\ if\ current\ player\ has\ legal\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08516}08516\ \ \ \textcolor{keywordtype}{bool}\ has\_moves\ =\ \mbox{\hyperlink{game__task_8c_a90e272f6928e9145d30671ce523ff35e}{game\_has\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08517}08517\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08518}08518\ \ \ \textcolor{keywordflow}{if}\ (in\_check\ \&\&\ !has\_moves)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08519}08519\ \ \ \ \ \textcolor{comment}{//\ Checkmate\ -\/\ určit\ typ\ podle\ posledního\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08520}08520\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08521}08521\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08522}08522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08523}08523\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08524}08524\ \ \ \ \ \textcolor{comment}{//\ ✅\ Rozlišit\ typ\ šachmatu\ podle\ posledního\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08525}08525\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08526}08526\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{LAST\_MOVE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08527}08527\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08528}08528\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ EN\ PASSANT!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08529}08529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08530}08530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08531}08531\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08532}08532\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08533}08533\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08534}08534\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ CASTLING!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08535}08535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08536}08536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08537}08537\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08538}08538\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{LAST\_MOVE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08539}08539\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08540}08540\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ PROMOTION!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08541}08541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08542}08542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08543}08543\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08544}08544\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a1f704b3fdc9edf5defa5ca3f23fef635}{LAST\_MOVE\_DISCOVERED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08545}08545\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08546}08546\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08547}08547\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08548}08548\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ DISCOVERED\ CHECK!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08549}08549\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08550}08550\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08551}08551\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08552}08552\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08553}08553\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08554}08554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08555}08555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08556}08556\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08557}08557\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08558}08558\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08559}08559\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08560}08560\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ ✅\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08561}08561\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08562}08562\ \ \ \ \ \textcolor{comment}{//\ ✅\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08563}08563\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08564}08564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08565}08565\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08566}08566\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!in\_check\ \&\&\ !has\_moves)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08567}08567\ \ \ \ \ \textcolor{comment}{//\ Stalemate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08568}08568\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08569}08569\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08570}08570\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08571}08571\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ stalemate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08572}08572\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08573}08573\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ ✅\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08574}08574\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08575}08575\ \ \ \ \ \textcolor{comment}{//\ ✅\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08576}08576\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08577}08577\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08578}08578\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ STALEMATE!\ Game\ drawn\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08579}08579\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08580}08580\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08581}08581\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08582}08582\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA\ BUG\ \#13:\ Check\ for\ draw\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08583}08583\ \ \ \textcolor{comment}{//\ 50-\/move\ rule:\ 50\ plných\ tahů\ =\ 100\ půltahů\ (half-\/moves/ply)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08584}08584\ \ \ \textcolor{comment}{//\ moves\_without\_capture\ počítá\ půltahy,\ takže\ >=\ 100}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08585}08585\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ >=\ 100)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08586}08586\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08587}08587\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08588}08588\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08589}08589\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ 50-\/move\ rule}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08590}08590\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08591}08591\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ ✅\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08592}08592\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08593}08593\ \ \ \ \ \textcolor{comment}{//\ ✅\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08594}08594\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08595}08595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08596}08596\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ 50\ moves\ without\ capture\ (50-\/move\ rule)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08597}08597\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08598}08598\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08599}08599\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08600}08600\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{game\_is\_position\_repeated}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08601}08601\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08602}08602\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0486ad918f30f8bb5d8db5d92f72c208}{RESULT\_DRAW\_REPETITION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08603}08603\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08604}08604\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ threefold\ repetition}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08605}08605\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08606}08606\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ ✅\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08607}08607\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08608}08608\ \ \ \ \ \textcolor{comment}{//\ ✅\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08609}08609\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08610}08610\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08611}08611\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Position\ repeated\ (draw\ by\ repetition)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08612}08612\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08613}08613\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08614}08614\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08615}08615\ \ \ \textcolor{comment}{//\ Check\ for\ insufficient\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08616}08616\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a93a1f0d6a82af5e13f78ebecc8a5ed8c}{game\_is\_insufficient\_material}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08617}08617\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08618}08618\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08619}08619\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08620}08620\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ insufficient\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08621}08621\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08622}08622\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ ✅\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08623}08623\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08624}08624\ \ \ \ \ \textcolor{comment}{//\ ✅\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08625}08625\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08626}08626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08627}08627\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Insufficient\ material\ to\ checkmate"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08628}08628\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08629}08629\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08630}08630\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08631}08631\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08632}08632\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08633}08633\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08634}08634\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08635}08635\ \textcolor{comment}{//\ GAME\ CONTROL\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08636}08636\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08637}08637\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08642}\mbox{\hyperlink{game__task_8c_a92c446eef9cfeb30bdcdbf87546c561b}{08642}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a92c446eef9cfeb30bdcdbf87546c561b}{game\_toggle\_timer}}(\textcolor{keywordtype}{bool}\ enabled)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08643}08643\ \ \ \mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{timer\_enabled}}\ =\ enabled;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08644}08644\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ timer\ \%s"{}},\ enabled\ ?\ \textcolor{stringliteral}{"{}enabled"{}}\ :\ \textcolor{stringliteral}{"{}disabled"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08645}08645\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08646}08646\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08651}\mbox{\hyperlink{game__task_8c_a6710818895e93c8a7b6852ab80ad59bb}{08651}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6710818895e93c8a7b6852ab80ad59bb}{game\_save\_game}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_name)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08652}08652\ \ \ \textcolor{keywordflow}{if}\ (game\_name\ ==\ NULL\ ||\ strlen(game\_name)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08653}08653\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ game\ name\ for\ save"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08654}08654\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08655}08655\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08656}08656\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08657}08657\ \ \ \textcolor{comment}{//\ This\ is\ a\ placeholder\ -\/\ in\ a\ real\ implementation\ you\ would:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08658}08658\ \ \ \textcolor{comment}{//\ 1.\ Save\ board\ state\ to\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08659}08659\ \ \ \textcolor{comment}{//\ 2.\ Save\ move\ history\ to\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08660}08660\ \ \ \textcolor{comment}{//\ 3.\ Save\ game\ statistics\ to\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08661}08661\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08662}08662\ \ \ strncpy(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}},\ game\_name,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}})\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08663}08663\ \ \ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[\textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}})\ -\/\ 1]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08664}08664\ \ \ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08665}08665\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08666}08666\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💾\ Game\ saved\ as:\ \%s"{}},\ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08667}08667\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08668}08668\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08673}\mbox{\hyperlink{game__task_8c_a6d7435b0a21ea4d6d2791e2a7cb665b5}{08673}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6d7435b0a21ea4d6d2791e2a7cb665b5}{game\_load\_game}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_name)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08674}08674\ \ \ \textcolor{keywordflow}{if}\ (game\_name\ ==\ NULL\ ||\ strlen(game\_name)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08675}08675\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ game\ name\ for\ load"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08676}08676\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08677}08677\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08678}08678\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08679}08679\ \ \ \textcolor{comment}{//\ This\ is\ a\ placeholder\ -\/\ in\ a\ real\ implementation\ you\ would:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08680}08680\ \ \ \textcolor{comment}{//\ 1.\ Load\ board\ state\ from\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08681}08681\ \ \ \textcolor{comment}{//\ 2.\ Load\ move\ history\ from\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08682}08682\ \ \ \textcolor{comment}{//\ 3.\ Load\ game\ statistics\ from\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08683}08683\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08684}08684\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📂\ Loading\ game:\ \%s"{}},\ game\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08685}08685\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Game\ loading\ not\ yet\ implemented"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08686}08686\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08687}08687\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08693}\mbox{\hyperlink{game__task_8c_a0a4948efe62eece9f97fd6eef22db6e8}{08693}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0a4948efe62eece9f97fd6eef22db6e8}{game\_export\_pgn}}(\textcolor{keywordtype}{char}\ *pgn\_buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08694}08694\ \ \ \textcolor{keywordflow}{if}\ (pgn\_buffer\ ==\ NULL\ ||\ buffer\_size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08695}08695\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ PGN\ buffer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08696}08696\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08697}08697\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08698}08698\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08699}08699\ \ \ \textcolor{comment}{//\ Start\ PGN\ with\ metadata}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08700}08700\ \ \ \textcolor{keywordtype}{int}\ pos\ =\ snprintf(pgn\_buffer,\ buffer\_size,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08701}08701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Event\ \(\backslash\)"{}ESP32\ Chess\ Game\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08702}08702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Site\ \(\backslash\)"{}ESP32-\/C6\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08703}08703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Date\ \(\backslash\)"{}\%s\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08704}08704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Round\ \(\backslash\)"{}1\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08705}08705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[White\ \(\backslash\)"{}Player\ 1\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08706}08706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Black\ \(\backslash\)"{}Player\ 2\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08707}08707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Result\ \(\backslash\)"{}*\(\backslash\)"{}]\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08708}08708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2025-\/01-\/01"{}});\ \textcolor{comment}{//\ TODO:\ Get\ actual\ date}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08709}08709\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08710}08710\ \ \ \textcolor{comment}{//\ Add\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08711}08711\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ \&\&\ pos\ <\ buffer\_size\ -\/\ 50;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08712}08712\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08713}08713\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_square[4],\ to\_square[4];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08714}08714\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08715}08715\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08716}08716\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08717}08717\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ \%\ 2\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08718}08718\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08719}08719\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}.\ \%s\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08720}08720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (i\ /\ 2)\ +\ 1,\ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08721}08721\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08722}08722\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08723}08723\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ \%s\%s\ "{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08724}08724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08725}08725\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08726}08726\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08727}08727\ \ \ \ \ \textcolor{comment}{//\ Add\ newline\ every\ 10\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08728}08728\ \ \ \ \ \textcolor{keywordflow}{if}\ ((i\ +\ 1)\ \%\ 20\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08729}08729\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08730}08730\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08731}08731\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08732}08732\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08733}08733\ \ \ \textcolor{comment}{//\ Add\ result}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08734}08734\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08735}08735\ \ \ \ \ \textcolor{keywordflow}{if}\ (strstr(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}},\ \textcolor{stringliteral}{"{}CHECKMATE"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08736}08736\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ 1-\/0"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08737}08737\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strstr(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}},\ \textcolor{stringliteral}{"{}STALEMATE"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08738}08738\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ 1/2-\/1/2"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08739}08739\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08740}08740\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ 1/2-\/1/2"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08741}08741\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08742}08742\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08743}08743\ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ *"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08744}08744\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08745}08745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08746}08746\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📄\ PGN\ export\ completed\ (\%d\ characters)"{}},\ pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08747}08747\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08748}08748\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08755}\mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{08755}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(uint8\_t\ row,\ uint8\_t\ col,\ \textcolor{keywordtype}{char}\ *square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08756}08756\ \ \ \textcolor{keywordflow}{if}\ (square\ ==\ NULL)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08757}08757\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08758}08758\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08759}08759\ \ \ \textcolor{comment}{//\ Convert\ column\ to\ file\ (a-\/h)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08760}08760\ \ \ square[0]\ =\ \textcolor{charliteral}{'a'}\ +\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08761}08761\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08762}08762\ \ \ \textcolor{comment}{//\ Convert\ row\ to\ rank\ (1-\/8)\ -\/\ row\ 0\ =\ rank\ 1,\ row\ 7\ =\ rank\ 8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08763}08763\ \ \ square[1]\ =\ \textcolor{charliteral}{'1'}\ +\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08764}08764\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08765}08765\ \ \ square[2]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08766}08766\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08767}08767\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08768}\mbox{\hyperlink{game__task_8c_a138dd79d240e644870a7d53580720206}{08768}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a138dd79d240e644870a7d53580720206}{game\_print\_status}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08769}08769\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Status:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08770}08770\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ State:\ \%d"{}},\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08771}08771\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Current\ player:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08772}08772\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08773}08773\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Move\ count:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08774}08774\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Game\ active:\ \%s"{}},\ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ ?\ \textcolor{stringliteral}{"{}Yes"{}}\ :\ \textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08775}08775\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Total\ games:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08776}08776\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ White\ wins:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08777}08777\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Black\ wins:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08778}08778\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Draws:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08779}08779\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08780}08780\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08781}08781\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08782}08782\ \textcolor{comment}{//\ MAIN\ TASK\ FUNCTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08783}08783\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08784}08784\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08785}\mbox{\hyperlink{game__task_8c_ab26d022ec766e04addd46d9b6da9768a}{08785}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ab26d022ec766e04addd46d9b6da9768a}{game\_task\_start}}(\textcolor{keywordtype}{void}\ *pvParameters)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08786}08786\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ task\ started\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08787}08787\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08788}08788\ \ \ \textcolor{comment}{//\ ✅\ CRITICAL:\ Register\ with\ TWDT\ from\ within\ task}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08789}08789\ \ \ esp\_err\_t\ wdt\_ret\ =\ esp\_task\_wdt\_add(NULL);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08790}08790\ \ \ \textcolor{keywordflow}{if}\ (wdt\_ret\ !=\ ESP\_OK\ \&\&\ wdt\_ret\ !=\ ESP\_ERR\_INVALID\_ARG)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08791}08791\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ register\ Game\ task\ with\ TWDT:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08792}08792\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(wdt\_ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08793}08793\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08794}08794\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Game\ task\ registered\ with\ TWDT"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08795}08795\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08796}08796\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08797}08797\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Features:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08798}08798\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Standard\ chess\ rules"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08799}08799\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Move\ validation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08800}08800\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Game\ state\ management"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08801}08801\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Move\ history\ tracking"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08802}08802\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Board\ visualization"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08803}08803\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Timer\ system\ integration"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08804}08804\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ 100ms\ command\ cycle"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08805}08805\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08806}08806\ \ \ \mbox{\hyperlink{animation__task_8c_a35141cb45623cb3b7b4d96da35ed1831}{task\_running}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08807}08807\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08808}08808\ \ \ \textcolor{comment}{//\ Initialize\ timer\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08809}08809\ \ \ esp\_err\_t\ timer\_ret\ =\ \mbox{\hyperlink{game__task_8c_a917f1907b236e1476e75bb033e2a3165}{game\_init\_timer\_system}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08810}08810\ \ \ \textcolor{keywordflow}{if}\ (timer\_ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08811}08811\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08812}08812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Timer\ system\ initialization\ failed,\ continuing\ without\ timer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08813}08813\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08814}08814\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08815}08815\ \ \ \textcolor{comment}{//\ Initialize\ game}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08816}08816\ \ \ \mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{game\_initialize\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08817}08817\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08818}08818\ \ \ \textcolor{comment}{//\ Main\ task\ loop}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08819}08819\ \ \ uint32\_t\ loop\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08820}08820\ \ \ TickType\_t\ last\_wake\_time\ =\ xTaskGetTickCount();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08821}08821\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08822}08822\ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08823}08823\ \ \ \ \ \textcolor{comment}{//\ CRITICAL:\ Reset\ watchdog\ for\ game\ task\ in\ every\ iteration\ (only\ if}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08824}08824\ \ \ \ \ \textcolor{comment}{//\ registered)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08825}08825\ \ \ \ \ esp\_err\_t\ wdt\_ret\ =\ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08826}08826\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdt\_ret\ !=\ ESP\_OK\ \&\&\ wdt\_ret\ !=\ ESP\_ERR\_NOT\_FOUND)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08827}08827\ \ \ \ \ \ \ \textcolor{comment}{//\ Task\ not\ registered\ with\ TWDT\ yet\ -\/\ this\ is\ normal\ during\ startup}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08828}08828\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08829}08829\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08830}08830\ \ \ \ \ \textcolor{comment}{//\ Process\ game\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08831}08831\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac4ac5416414272fb1942f0269ea572c7}{game\_process\_commands}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08832}08832\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08833}08833\ \ \ \ \ \textcolor{comment}{//\ Process\ matrix\ events\ (moves)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08834}08834\ \ \ \ \ \textcolor{comment}{//\ ✅\ DEPRECATED:\ Matrix\ events\ are\ now\ processed\ via\ game\_command\_queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08835}08835\ \ \ \ \ \textcolor{comment}{//\ game\_process\_matrix\_events();\ \ //\ No\ longer\ needed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08836}08836\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08837}08837\ \ \ \ \ \textcolor{comment}{//\ Update\ timer\ display\ and\ check\ for\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08838}08838\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aab2504466c50dfa9455e1414810bc073}{game\_update\_timer\_display}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08839}08839\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08840}08840\ \ \ \ \ \textcolor{comment}{//\ ✅\ FIX:\ Zpracovat\ endgame\ report\ request\ (s\ dostatečným\ stackem\ 10KB)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08841}08841\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08842}08842\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Reset\ flag}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08843}08843\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08844}08844\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08845}08845\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08846}08846\ \ \ \ \ \textcolor{comment}{//\ Auto\ new\ game\ detection\ (kdyz\ jsou\ figurky\ v\ pocatecni\ pozici\ 2s)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08847}08847\ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_start\_pos\ =\ \mbox{\hyperlink{game__task_8c_a3534f1702346800f3c81568d62f497bc}{game\_is\_board\_in\_starting\_position}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08848}08848\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_start\_pos\ \&\&\ !\mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08849}08849\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08850}08850\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08851}08851\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{auto\_new\_game\_timer\_start}}\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08852}08852\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08853}08853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Auto\ new\ game:\ Starting\ position\ detected,\ waiting\ 2s..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08854}08854\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((esp\_timer\_get\_time()\ /\ 1000\ -\/\ \mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{auto\_new\_game\_timer\_start}})\ >}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08855}08855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab5d37ae881c4c3c8d9ac1a35e00e7b71}{AUTO\_NEW\_GAME\_CONFIRMATION\_TIME\_MS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08856}08856\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08857}08857\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08858}08858\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Auto\ new\ game:\ Position\ confirmed\ for\ 2s\ -\/\ triggering\ new\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08859}08859\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08860}08860\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a9cdd3824f45d61a774ab6868e898e1c0}{GAME\_CMD\_NEW\_GAME}},\ .player\ =\ 0,\ .response\_queue\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08861}08861\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08862}08862\ \ \ \ \ \ \ \ \ \ \ xQueueSend(\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}},\ \&cmd,\ pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08863}08863\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08864}08864\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08865}08865\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08866}08866\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08867}08867\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!in\_start\_pos)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08868}08868\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08869}08869\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08870}08870\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08871}08871\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08872}08872\ \ \ \ \ \textcolor{comment}{//\ Periodic\ status\ update}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08873}08873\ \ \ \ \ \textcolor{keywordflow}{if}\ (loop\_count\ \%\ 5000\ ==\ 0)\ \{\ \textcolor{comment}{//\ Every\ 5\ seconds}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08874}08874\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Task\ Status:\ loop=\%d,\ state=\%d,\ player=\%d,\ moves=\%lu"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08875}08875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ loop\_count,\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}},\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08876}08876\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08877}08877\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08878}08878\ \ \ \ \ loop\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08879}08879\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08880}08880\ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ next\ cycle\ (100ms)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08881}08881\ \ \ \ \ vTaskDelayUntil(\&last\_wake\_time,\ pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08882}08882\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08883}08883\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08884}08884\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08892}\mbox{\hyperlink{game__task_8c_a502098cd25ad56400beb2339a1bfb84c}{08892}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a502098cd25ad56400beb2339a1bfb84c}{game\_process\_matrix\_events}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08893}08893\ \ \ \textcolor{comment}{//\ Matrix\ events\ are\ now\ processed\ via\ game\_command\_queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08894}08894\ \ \ \textcolor{comment}{//\ This\ function\ is\ kept\ for\ compatibility\ but\ does\ nothing}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08895}08895\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08896}08896\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08897}08897\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08898}08898\ \textcolor{comment}{//\ ENHANCED\ CHESS\ LOGIC\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08899}08899\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08900}08900\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08901}08901\ \textcolor{comment}{//\ Direction\ vectors\ for\ piece\ movement\ (knight\_moves\ moved\ to\ top\ of\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08902}08902\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08903}\mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{08903}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[8][2]\ =\ \{\{-\/1,\ -\/1\},\ \{-\/1,\ 0\},\ \{-\/1,\ 1\},\ \{0,\ -\/1\},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08904}08904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{0,\ 1\},\ \ \ \{1,\ -\/1\},\ \{1,\ 0\},\ \ \{1,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08905}08905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08906}\mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{08906}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}}[4][2]\ =\ \{\{-\/1,\ -\/1\},\ \{-\/1,\ 1\},\ \{1,\ -\/1\},\ \{1,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08907}08907\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08908}\mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{08908}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}}[4][2]\ =\ \{\{-\/1,\ 0\},\ \{1,\ 0\},\ \{0,\ -\/1\},\ \{0,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08909}08909\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08910}08910\ \textcolor{comment}{//\ Castling\ flags\ (moved\ to\ top\ of\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08911}08911\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08912}08912\ \textcolor{comment}{//\ En\ passant\ state\ (moved\ to\ top\ of\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08913}08913\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08914}08914\ \textcolor{comment}{//\ Lifted\ piece\ state\ tracking\ (already\ defined\ above)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08915}08915\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08916}08916\ \textcolor{comment}{//\ Move\ generation\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08917}\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{08917}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ \mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08918}\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{08918}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08919}08919\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08920}08920\ \textcolor{comment}{//\ Game\ position\ history\ for\ draw\ detection\ (declared\ earlier\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08921}08921\ \textcolor{comment}{//\ static\ uint32\_t\ position\_hashes[100];}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08922}08922\ \textcolor{comment}{//\ static\ uint32\_t\ position\_history\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08923}08923\ \textcolor{comment}{//\ fifty\_move\_counter\ is\ now\ declared\ in\ GAME\ STATE\ VARIABLES\ section}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08924}08924\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08925}08925\ \textcolor{comment}{//\ Promotion\ state\ (for\ future\ use)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08926}08926\ \textcolor{comment}{//\ static\ bool\ promotion\_pending\ =\ false;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08927}08927\ \textcolor{comment}{//\ static\ chess\_move\_extended\_t\ promotion\_move;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08928}08928\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08929}08929\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08930}08930\ \textcolor{comment}{//\ BASIC\ UTILITY\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08931}08931\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08932}08932\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08936}\mbox{\hyperlink{chess__types_8h_ad58024344b5777da494b4a35f8250c32}{08936}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08937}08937\ \ \ \textcolor{keywordflow}{return}\ (row\ >=\ 0\ \&\&\ row\ <\ 8\ \&\&\ col\ >=\ 0\ \&\&\ col\ <\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08938}08938\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08939}08939\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08943}\mbox{\hyperlink{chess__types_8h_a7f31b3ea42f40399386306ba3d88cb9c}{08943}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08944}08944\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08945}08945\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08946}08946\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08947}08947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08948}08948\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08949}08949\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08950}08950\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08951}08951\ \textcolor{comment}{//\ ATTACK\ AND\ CHECK\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08952}08952\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08953}08953\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08957}\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{08957}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(uint8\_t\ row,\ uint8\_t\ col,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ by\_player)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08958}08958\ \ \ \textcolor{comment}{//\ Check\ pawn\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08959}08959\ \ \ \textcolor{keywordtype}{int}\ pawn\_dir\ =\ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08960}08960\ \ \ \textcolor{keywordtype}{int}\ pawn\_row\ =\ row\ -\/\ pawn\_dir;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08961}08961\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_pawn\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08962}08962\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08963}08963\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08964}08964\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(pawn\_row,\ col\ -\/\ 1)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08965}08965\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[pawn\_row][col\ -\/\ 1]\ ==\ attacking\_pawn)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08966}08966\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08967}08967\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(pawn\_row,\ col\ +\ 1)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08968}08968\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[pawn\_row][col\ +\ 1]\ ==\ attacking\_pawn)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08969}08969\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08970}08970\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08971}08971\ \ \ \textcolor{comment}{//\ Check\ knight\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08972}08972\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_knight\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08973}08973\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08974}08974\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08975}08975\ \ \ \ \ \textcolor{keywordtype}{int}\ nr\ =\ row\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08976}08976\ \ \ \ \ \textcolor{keywordtype}{int}\ nc\ =\ col\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08977}08977\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc)\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc]\ ==\ attacking\_knight)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08978}08978\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08979}08979\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08980}08980\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08981}08981\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08982}08982\ \ \ \textcolor{comment}{//\ Check\ bishop/queen\ diagonal\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08983}08983\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_bishop\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08984}08984\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08985}08985\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_queen\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08986}08986\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08987}08987\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08988}08988\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ 4;\ d++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08989}08989\ \ \ \ \ \textcolor{keywordtype}{int}\ dr\ =\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}}[d][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08990}08990\ \ \ \ \ \textcolor{keywordtype}{int}\ dc\ =\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}}[d][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08991}08991\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08992}08992\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ nr\ =\ row\ +\ dr,\ nc\ =\ col\ +\ dc;\ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08993}08993\ \ \ \ \ \ \ \ \ \ nr\ +=\ dr,\ nc\ +=\ dc)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08994}08994\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08995}08995\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08996}08996\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08997}08997\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08998}08998\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ attacking\_bishop\ ||\ piece\ ==\ attacking\_queen)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08999}08999\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09000}09000\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09001}09001\ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Blocked\ by\ any\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09002}09002\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09003}09003\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09004}09004\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09005}09005\ \ \ \textcolor{comment}{//\ Check\ rook/queen\ orthogonal\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09006}09006\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_rook\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09007}09007\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09008}09008\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09009}09009\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ 4;\ d++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09010}09010\ \ \ \ \ \textcolor{keywordtype}{int}\ dr\ =\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}}[d][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09011}09011\ \ \ \ \ \textcolor{keywordtype}{int}\ dc\ =\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}}[d][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09012}09012\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09013}09013\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ nr\ =\ row\ +\ dr,\ nc\ =\ col\ +\ dc;\ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09014}09014\ \ \ \ \ \ \ \ \ \ nr\ +=\ dr,\ nc\ +=\ dc)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09015}09015\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09016}09016\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09017}09017\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09018}09018\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09019}09019\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ attacking\_rook\ ||\ piece\ ==\ attacking\_queen)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09020}09020\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09021}09021\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09022}09022\ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Blocked\ by\ any\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09023}09023\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09024}09024\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09025}09025\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09026}09026\ \ \ \textcolor{comment}{//\ Check\ king\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09027}09027\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_king\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09028}09028\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09029}09029\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09030}09030\ \ \ \ \ \textcolor{keywordtype}{int}\ nr\ =\ row\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09031}09031\ \ \ \ \ \textcolor{keywordtype}{int}\ nc\ =\ col\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09032}09032\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc)\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc]\ ==\ attacking\_king)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09033}09033\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09034}09034\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09035}09035\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09036}09036\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09037}09037\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09038}09038\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09039}09039\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09040}09040\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09041}09041\ \textcolor{comment}{//\ MOVE\ VALIDATION\ AND\ SIMULATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09042}09042\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09043}09043\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09047}\mbox{\hyperlink{chess__types_8h_a3d771c47f735ab5e75fee68915b073fc}{09047}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(\mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09048}09048\ \ \ \textcolor{comment}{//\ Save\ original\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09049}09049\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09050}09050\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_en\_passant\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09051}09051\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09052}09052\ \ \ \textcolor{comment}{//\ Handle\ en\ passant\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09053}09053\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09054}09054\ \ \ \ \ original\_en\_passant\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09055}09055\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09056}09056\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09057}09057\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09058}09058\ \ \ \textcolor{comment}{//\ Make\ the\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09059}09059\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09060}09060\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09061}09061\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09062}09062\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check\ after\ this\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09063}09063\ \ \ \textcolor{keywordtype}{bool}\ king\_in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09064}09064\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09065}09065\ \ \ \textcolor{comment}{//\ Restore\ original\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09066}09066\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09067}09067\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ original\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09068}09068\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09069}09069\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09070}09070\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ original\_en\_passant;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09071}09071\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09072}09072\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09073}09073\ \ \ \textcolor{keywordflow}{return}\ !king\_in\_check;\ \textcolor{comment}{//\ Return\ true\ if\ move\ is\ legal\ (doesn't\ leave\ king\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09074}09074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ check)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09075}09075\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09076}09076\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09077}09077\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09078}09078\ \textcolor{comment}{//\ MOVE\ GENERATION\ -\/\ INDIVIDUAL\ PIECES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09079}09079\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09080}09080\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09084}\mbox{\hyperlink{game__task_8c_aba34fdb2616d1c154dadc9d122338c80}{09084}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aba34fdb2616d1c154dadc9d122338c80}{game\_generate\_pawn\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09085}09085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09086}09086\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ pawn\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09087}09087\ \ \ \textcolor{keywordtype}{bool}\ is\_white\ =\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09088}09088\ \ \ \textcolor{keywordtype}{int}\ direction\ =\ is\_white\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09089}09089\ \ \ \textcolor{keywordtype}{int}\ start\_row\ =\ is\_white\ ?\ 1\ :\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09090}09090\ \ \ \textcolor{keywordtype}{int}\ promotion\_row\ =\ is\_white\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09091}09091\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09092}09092\ \ \ \textcolor{comment}{//\ Forward\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09093}09093\ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ direction;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09094}09094\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ from\_col)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09095}09095\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][from\_col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09096}09096\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09097}09097\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ promotion\_row)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09098}09098\ \ \ \ \ \ \ \textcolor{comment}{//\ Promotion\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09099}09099\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ promo\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}};\ promo\ <=\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}};\ promo++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09100}09100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09101}09101\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09102}09102\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09103}09103\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09104}09104\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09105}09105\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09106}09106\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09107}09107\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09108}09108\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09109}09109\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09110}09110\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09111}09111\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}}\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})promo;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09112}09112\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09113}09113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09114}09114\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09115}09115\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09116}09116\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09117}09117\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09118}09118\ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ forward\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09119}09119\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09120}09120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09121}09121\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09122}09122\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09123}09123\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09124}09124\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09125}09125\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09126}09126\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09127}09127\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09128}09128\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09129}09129\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09130}09130\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09131}09131\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09132}09132\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09133}09133\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09134}09134\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09135}09135\ \ \ \ \ \ \ \textcolor{comment}{//\ Double\ move\ from\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09136}09136\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_row\ ==\ start\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09137}09137\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row\ +\ direction][from\_col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09138}09138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09139}09139\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09140}09140\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09141}09141\ \ \ \ \ \ \ \ \ move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09142}09142\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09143}09143\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09144}09144\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row\ +\ direction;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09145}09145\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09146}09146\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09147}09147\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09148}09148\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09149}09149\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09150}09150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09151}09151\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09152}09152\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09153}09153\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09154}09154\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09155}09155\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09156}09156\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09157}09157\ \ \ \textcolor{comment}{//\ Captures\ (diagonal)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09158}09158\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dc\ =\ -\/1;\ dc\ <=\ 1;\ dc\ +=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09159}09159\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ from\_col\ +\ dc;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09160}09160\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09161}09161\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09162}09162\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09163}09163\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4a1fae8d66a8db2dd28a091a3b11279c}{game\_is\_enemy\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09164}09164\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ promotion\_row)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09165}09165\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Capture\ with\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09166}09166\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ promo\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}};\ promo\ <=\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09167}09167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ promo++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09168}09168\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09169}09169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09170}09170\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09171}09171\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09172}09172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09173}09173\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09174}09174\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09175}09175\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09176}09176\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09177}09177\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09178}09178\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09179}09179\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09180}09180\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}}\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})promo;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09181}09181\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09182}09182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09183}09183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09184}09184\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09185}09185\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09186}09186\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09187}09187\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09188}09188\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09189}09189\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09190}09190\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09191}09191\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09192}09192\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09193}09193\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09194}09194\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09195}09195\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09196}09196\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09197}09197\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09198}09198\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09199}09199\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09200}09200\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09201}09201\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09202}09202\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09203}09203\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09204}09204\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09205}09205\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09206}09206\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09207}09207\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09208}09208\ \ \ \textcolor{comment}{//\ En\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09209}09209\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ \&\&\ from\_row\ ==\ (is\_white\ ?\ 4\ :\ 3))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09210}09210\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dc\ =\ -\/1;\ dc\ <=\ 1;\ dc\ +=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09211}09211\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_col\ +\ dc\ ==\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09212}09212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09213}09213\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09214}09214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09215}09215\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09216}09216\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09217}09217\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09218}09218\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09219}09219\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09220}09220\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09221}09221\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09222}09222\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09223}09223\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09224}09224\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09225}09225\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09226}09226\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09227}09227\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09228}09228\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09229}09229\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09230}09230\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09231}09231\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09232}09232\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09236}\mbox{\hyperlink{game__task_8c_a62e1a3f62089cca625cf6121749115b1}{09236}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a62e1a3f62089cca625cf6121749115b1}{game\_generate\_knight\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09237}09237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09238}09238\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ knight\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09239}09239\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09240}09240\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09241}09241\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09242}09242\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ from\_col\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09243}09243\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09244}09244\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09245}09245\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09246}09246\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09247}09247\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09248}09248\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09249}09249\ \ \ \ \ \textcolor{comment}{//\ Skip\ if\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09250}09250\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09251}09251\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09252}09252\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09253}09253\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09254}09254\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09255}09255\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09256}09256\ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09257}09257\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09258}09258\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09259}09259\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09260}09260\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09261}09261\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ knight;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09262}09262\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09263}09263\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09264}09264\ \ \ \ \ \ \ \ \ (target\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}}\ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09265}09265\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09266}09266\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09267}09267\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09268}09268\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09269}09269\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09270}09270\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09271}09271\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09275}\mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{09275}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09276}09276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \textcolor{keyword}{const}\ int8\_t\ directions[][2],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09277}09277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_directions)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09278}09278\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09279}09279\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09280}09280\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ num\_directions;\ d++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09281}09281\ \ \ \ \ \textcolor{keywordtype}{int}\ dr\ =\ directions[d][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09282}09282\ \ \ \ \ \textcolor{keywordtype}{int}\ dc\ =\ directions[d][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09283}09283\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09284}09284\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ dr,\ to\_col\ =\ from\_col\ +\ dc;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09285}09285\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col);\ to\_row\ +=\ dr,\ to\_col\ +=\ dc)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09286}09286\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09287}09287\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09288}09288\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09289}09289\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ move\ to\ square\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09290}09290\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09291}09291\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09292}09292\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09293}09293\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09294}09294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09295}09295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09296}09296\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09297}09297\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09298}09298\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09299}09299\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09300}09300\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09301}09301\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09302}09302\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09303}09303\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09304}09304\ \ \ \ \ \ \ \ \ \ \ (target\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}}\ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09305}09305\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09306}09306\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09307}09307\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09308}09308\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09309}09309\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09310}09310\ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ if\ we\ hit\ any\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09311}09311\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (target\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09312}09312\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09313}09313\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09314}09314\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09315}09315\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09316}09316\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09320}\mbox{\hyperlink{game__task_8c_adb84cfa34e63ffebf55a5fc8784eb0a9}{09320}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_adb84cfa34e63ffebf55a5fc8784eb0a9}{game\_generate\_king\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09321}09321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09322}09322\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09323}09323\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09324}09324\ \ \ \textcolor{comment}{//\ Normal\ king\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09325}09325\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09326}09326\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09327}09327\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ from\_col\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09328}09328\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09329}09329\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09330}09330\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09331}09331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09332}09332\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09333}09333\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09334}09334\ \ \ \ \ \textcolor{comment}{//\ Skip\ if\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09335}09335\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09336}09336\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09337}09337\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09338}09338\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09339}09339\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09340}09340\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09341}09341\ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09342}09342\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09343}09343\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09344}09344\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09345}09345\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09346}09346\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09347}09347\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09348}09348\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09349}09349\ \ \ \ \ \ \ \ \ (target\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}}\ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09350}09350\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09351}09351\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09352}09352\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09353}09353\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09354}09354\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09355}09355\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09356}09356\ \ \ \textcolor{comment}{//\ Castling\ -\/\ FIXED:\ Use\ proper\ bounds\ checking\ and\ correct\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09357}09357\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09358}09358\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Can't\ castle\ when\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09359}09359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09360}09360\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09361}09361\ \ \ \ \ \textcolor{comment}{//\ White\ kingside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09362}09362\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][5]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09363}09363\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][6]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09364}09364\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 5,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09365}09365\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 6,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09366}09366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09367}09367\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09368}09368\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ FIXED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09369}09369\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09370}09370\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09371}09371\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ FIXED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09372}09372\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09373}09373\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09374}09374\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09375}09375\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09376}09376\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09377}09377\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09378}09378\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09379}09379\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09380}09380\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09381}09381\ \ \ \ \ \textcolor{comment}{//\ White\ queenside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09382}09382\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][1]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09383}09383\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][2]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][3]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09384}09384\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 2,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09385}09385\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 3,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09386}09386\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09387}09387\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09388}09388\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ FIXED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09389}09389\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09390}09390\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09391}09391\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ FIXED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09392}09392\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09393}09393\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09394}09394\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09395}09395\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09396}09396\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09397}09397\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09398}09398\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09399}09399\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09400}09400\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09401}09401\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09402}09402\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09403}09403\ \ \ \ \ \textcolor{comment}{//\ Black\ kingside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09404}09404\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][5]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09405}09405\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][6]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09406}09406\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 5,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09407}09407\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 6,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09408}09408\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09409}09409\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09410}09410\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ FIXED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09411}09411\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09412}09412\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09413}09413\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ FIXED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09414}09414\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09415}09415\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09416}09416\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09417}09417\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09418}09418\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09419}09419\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09420}09420\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09421}09421\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09422}09422\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09423}09423\ \ \ \ \ \textcolor{comment}{//\ Black\ queenside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09424}09424\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][1]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09425}09425\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][2]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][3]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09426}09426\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 2,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09427}09427\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 3,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09428}09428\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09429}09429\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09430}09430\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ FIXED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09431}09431\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09432}09432\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09433}09433\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ FIXED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09434}09434\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09435}09435\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09436}09436\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09437}09437\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09438}09438\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09439}09439\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09440}09440\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09441}09441\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09442}09442\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09443}09443\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09444}09444\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09445}09445\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09446}09446\ \textcolor{comment}{//\ MAIN\ MOVE\ GENERATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09447}09447\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09448}09448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09452}\mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{09452}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09453}09453\ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09454}09454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09455}09455\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09456}09456\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09457}09457\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09458}09458\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09459}09459\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(piece,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09460}09460\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09461}09461\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09462}09462\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09463}09463\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09464}09464\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09465}09465\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aba34fdb2616d1c154dadc9d122338c80}{game\_generate\_pawn\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09466}09466\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09467}09467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09468}09468\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09469}09469\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09470}09470\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a62e1a3f62089cca625cf6121749115b1}{game\_generate\_knight\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09471}09471\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09472}09472\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09473}09473\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09474}09474\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09475}09475\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09476}09476\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09477}09477\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09478}09478\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09479}09479\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09480}09480\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09481}09481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09482}09482\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09483}09483\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09484}09484\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09485}09485\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09486}09486\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09487}09487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09488}09488\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09489}09489\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09490}09490\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09491}09491\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adb84cfa34e63ffebf55a5fc8784eb0a9}{game\_generate\_king\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09492}09492\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09493}09493\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09494}09494\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09495}09495\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09496}09496\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09497}09497\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09498}09498\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09499}09499\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09500}09500\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09501}09501\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09502}09502\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09503}09503\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09504}09504\ \textcolor{comment}{//\ MOVE\ EXECUTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09505}09505\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09506}09506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09510}\mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{09510}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{game\_execute\_move\_enhanced}}(\mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09511}09511\ \ \ \textcolor{keywordflow}{if}\ (move\ ==\ NULL)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09512}09512\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09513}09513\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09514}09514\ \ \ \textcolor{comment}{//\ ✅\ Nastavit\ typ\ posledního\ tahu\ pro\ detekci\ speciálních\ šachmatů}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09515}09515\ \ \ \textcolor{keywordflow}{switch}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09516}09516\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09517}09517\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ captured\ pawn}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09518}09518\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09519}09519\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{LAST\_MOVE\_EN\_PASSANT}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09520}09520\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚔️\ En\ passant\ move\ executed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09521}09521\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09522}09522\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09523}09523\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09524}09524\ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Věž\ se\ nepřesunuje\ automaticky\ -\/\ hráč\ ji\ musí\ přesunout\ sám}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09525}09525\ \ \ \ \ \textcolor{comment}{//\ Věž\ zůstává\ na\ původní\ pozici,\ animace\ donutí\ hráče\ ji\ přesunout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09526}09526\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09527}09527\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Kingside\ castling\ -\/\ rook\ stays\ in\ place,\ waiting\ for\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09528}09528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}player\ to\ move\ it"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09529}09529\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09530}09530\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09531}09531\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09532}09532\ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Věž\ se\ nepřesunuje\ automaticky\ -\/\ hráč\ ji\ musí\ přesunout\ sám}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09533}09533\ \ \ \ \ \textcolor{comment}{//\ Věž\ zůstává\ na\ původní\ pozici,\ animace\ donutí\ hráče\ ji\ přesunout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09534}09534\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09535}09535\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Queenside\ castling\ -\/\ rook\ stays\ in\ place,\ waiting\ for\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09536}09536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}player\ to\ move\ it"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09537}09537\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09538}09538\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09539}09539\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09540}09540\ \ \ \ \ \textcolor{comment}{//\ Handle\ promotion\ -\/\ the\ piece\ will\ be\ set\ below}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09541}09541\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{LAST\_MOVE\_PROMOTION}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09542}09542\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09543}09543\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09544}09544\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09545}09545\ \ \ \ \ \textcolor{comment}{//\ Normal\ move\ or\ capture\ -\/\ nothing\ special\ needed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09546}09546\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}};\ \textcolor{comment}{//\ ✅\ Resetovat\ na\ normální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09547}09547\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09548}09548\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09549}09549\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09550}09550\ \ \ \textcolor{comment}{//\ Make\ the\ basic\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09551}09551\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09552}09552\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09553}09553\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09554}09554\ \ \ \textcolor{comment}{//\ Handle\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09555}09555\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09556}09556\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09557}09557\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09558}09558\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09559}09559\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09560}09560\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09561}09561\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09562}09562\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09563}09563\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09564}09564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09565}09565\ \ \ \textcolor{comment}{//\ Update\ castling\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09566}09566\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09567}09567\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09568}09568\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09569}09569\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09570}09570\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09571}09571\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09572}09572\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09573}09573\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09574}09574\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09575}09575\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09576}09576\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09577}09577\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09578}09578\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09579}09579\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09580}09580\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09581}09581\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09582}09582\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09583}09583\ \ \ \textcolor{comment}{//\ Update\ en\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09584}09584\ \ \ \mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09585}09585\ \ \ \textcolor{keywordflow}{if}\ ((move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09586}09586\ \ \ \ \ \ \ abs(move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}})\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09587}09587\ \ \ \ \ \textcolor{comment}{//\ Pawn\ made\ a\ double\ move\ -\/\ enable\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09588}09588\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09589}09589\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ =\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}})\ /\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09590}09590\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09591}09591\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09592}09592\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09593}09593\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09594}09594\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09595}09595\ \ \ \textcolor{comment}{//\ Update\ fifty-\/move\ counter}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09596}09596\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09597}09597\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09598}09598\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09599}09599\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09600}09600\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09601}09601\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09602}09602\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09603}09603\ \ \ \textcolor{comment}{//\ Update\ move\ counters\ and\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09604}09604\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09605}09605\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09606}09606\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09607}09607\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09608}09608\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09609}09609\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09610}09610\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ NEMĚNIT\ HRÁČE\ ZDE\ -\/\ hráč\ se\ mění\ v\ game\_execute\_move()\ po}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09611}09611\ \ \ \textcolor{comment}{//\ dokončení\ tahu\ Switch\ players\ -\/\ REMOVED:\ player\ is\ switched\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09612}09612\ \ \ \textcolor{comment}{//\ game\_execute\_move()\ after\ move\ execution}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09613}09613\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09614}09614\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09615}09615\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09616}09616\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09617}09617\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09618}09618\ \textcolor{comment}{//\ ENHANCED\ BOARD\ DISPLAY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09619}09619\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09620}09620\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09624}\mbox{\hyperlink{game__task_8c_aee07708800ca9d9eee519b40b78f71d3}{09624}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aee07708800ca9d9eee519b40b78f71d3}{game\_print\_board\_enhanced}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09625}09625\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╔═══════════════════════════════╗"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09626}09626\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ \ \ \ \ \ \ \ CHESS\ BOARD\ \ \ \ \ \ \ \ \ \ \ \ ║"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09627}09627\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╚═══════════════════════════════╝"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09628}09628\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09629}09629\ \ \ \textcolor{comment}{//\ Print\ board\ from\ rank\ 8\ to\ rank\ 1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09630}09630\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09631}09631\ \ \ \ \ \textcolor{keywordtype}{char}\ line[64]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09632}09632\ \ \ \ \ \textcolor{keywordtype}{char}\ *ptr\ =\ line;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09633}09633\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09634}09634\ \ \ \ \ ptr\ +=\ sprintf(ptr,\ \textcolor{stringliteral}{"{}\ \%d\ │"{}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09635}09635\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09636}09636\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09637}09637\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09638}09638\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *symbol;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09639}09639\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09640}09640\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09641}09641\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09642}09642\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♙"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09643}09643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09644}09644\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09645}09645\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♘"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09646}09646\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09647}09647\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09648}09648\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♗"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09649}09649\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09650}09650\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09651}09651\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♖"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09652}09652\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09653}09653\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09654}09654\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♕"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09655}09655\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09656}09656\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09657}09657\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♔"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09658}09658\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09659}09659\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09660}09660\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♟"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09661}09661\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09662}09662\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09663}09663\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♞"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09664}09664\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09665}09665\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09666}09666\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♝"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09667}09667\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09668}09668\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09669}09669\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♜"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09670}09670\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09671}09671\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09672}09672\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♛"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09673}09673\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09674}09674\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09675}09675\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♚"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09676}09676\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09677}09677\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09678}09678\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}·"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09679}09679\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09680}09680\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09681}09681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09682}09682\ \ \ \ \ \ \ ptr\ +=\ sprintf(ptr,\ \textcolor{stringliteral}{"{}\ \%s\ │"{}},\ symbol);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09683}09683\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09684}09684\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09685}09685\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\%s"{}},\ line);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09686}09686\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09687}09687\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ ├───┼───┼───┼───┼───┼───┼───┼───┤"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09688}09688\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09689}09689\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09690}09690\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09691}09691\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ └───┴───┴───┴───┴───┴───┴───┴───┘"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09692}09692\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h\ \ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09693}09693\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09694}09694\ \ \ \textcolor{comment}{//\ Print\ game\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09695}09695\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09696}09696\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Status:\ \%s\ to\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09697}09697\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09698}09698\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Move\ \#\%lu"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09699}09699\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09700}09700\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09701}09701\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ CHECK!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09702}09702\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09703}09703\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09704}09704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09705}09705\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09706}09706\ \textcolor{comment}{//\ INTEGRATION\ WITH\ EXISTING\ GAME\ TASK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09707}09707\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09708}09708\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09712}\mbox{\hyperlink{game__task_8c_ac096591c429faefd9993ddcc3d87bf11}{09712}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_ac096591c429faefd9993ddcc3d87bf11}{game\_validate\_move\_enhanced}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09713}09713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09714}09714\ \ \ \textcolor{comment}{//\ Basic\ coordinate\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09715}09715\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(from\_row,\ from\_col)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09716}09716\ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09717}09717\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ad0f6ecbd8e5bf7852d4298269a812f33}{MOVE\_ERROR\_INVALID\_COORDINATES}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09718}09718\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09719}09719\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09720}09720\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ piece\ at\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09721}09721\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09722}09722\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09723}09723\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09724}09724\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09725}09725\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09726}09726\ \ \ \textcolor{comment}{//\ Check\ if\ it's\ player's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09727}09727\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(piece,\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09728}09728\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09729}09729\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09730}09730\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09731}09731\ \ \ \textcolor{comment}{//\ Generate\ all\ legal\ moves\ and\ check\ if\ this\ move\ is\ in\ the\ list}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09732}09732\ \ \ uint32\_t\ num\_legal\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09733}09733\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09734}09734\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ num\_legal;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09735}09735\ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09736}09736\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ ==\ from\_row\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09737}09737\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ ==\ to\_row\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ ==\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09738}09738\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};\ \textcolor{comment}{//\ Move\ is\ legal}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09739}09739\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09740}09740\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09741}09741\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09742}09742\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1adbc56938feb4f9a70401c3190d77f9de}{MOVE\_ERROR\_ILLEGAL\_MOVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09743}09743\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09744}09744\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09745}09745\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09746}09746\ \textcolor{comment}{//\ MATRIX\ LED\ WORKFLOW\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09747}09747\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09748}09748\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09753}\mbox{\hyperlink{game__task_8c_ad6aef74bc8447dabf92abcb081340931}{09753}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad6aef74bc8447dabf92abcb081340931}{game\_detect\_new\_game\_setup}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09754}09754\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ jestli\ jsou\ řádky\ 1,\ 2,\ 7,\ 8\ obsazené\ figurkami}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09755}09755\ \ \ \textcolor{comment}{//\ a\ řádky\ 3,\ 4,\ 5,\ 6\ jsou\ prázdné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09756}09756\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09757}09757\ \ \ \textcolor{comment}{//\ Zkontrolovat\ řádky\ 0,\ 1\ (bílé\ figurky)\ a\ 6,\ 7\ (černé\ figurky)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09758}09758\ \ \ \textcolor{keywordtype}{bool}\ rows\_0\_1\_6\_7\_occupied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09759}09759\ \ \ \textcolor{keywordtype}{bool}\ rows\_2\_3\_4\_5\_empty\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09760}09760\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09761}09761\ \ \ \textcolor{comment}{//\ Zkontrolovat\ řádky\ 0,\ 1,\ 6,\ 7\ -\/\ musí\ být\ obsazené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09762}09762\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09763}09763\ \ \ \ \ \textcolor{keywordtype}{bool}\ row\_has\_pieces\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09764}09764\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09765}09765\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09766}09766\ \ \ \ \ \ \ \ \ row\_has\_pieces\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09767}09767\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09768}09768\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09769}09769\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09770}09770\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09771}09771\ \ \ \ \ \textcolor{keywordflow}{if}\ ((row\ ==\ 0\ ||\ row\ ==\ 1\ ||\ row\ ==\ 6\ ||\ row\ ==\ 7))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09772}09772\ \ \ \ \ \ \ \textcolor{comment}{//\ Tyto\ řádky\ musí\ být\ obsazené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09773}09773\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!row\_has\_pieces)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09774}09774\ \ \ \ \ \ \ \ \ rows\_0\_1\_6\_7\_occupied\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09775}09775\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09776}09776\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09777}09777\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (row\ >=\ 2\ \&\&\ row\ <=\ 5)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09778}09778\ \ \ \ \ \ \ \textcolor{comment}{//\ Tyto\ řádky\ musí\ být\ prázdné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09779}09779\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_has\_pieces)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09780}09780\ \ \ \ \ \ \ \ \ rows\_2\_3\_4\_5\_empty\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09781}09781\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09782}09782\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09783}09783\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09784}09784\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09785}09785\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09786}09786\ \ \ \textcolor{keywordtype}{bool}\ is\_starting\_setup\ =\ rows\_0\_1\_6\_7\_occupied\ \&\&\ rows\_2\_3\_4\_5\_empty;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09787}09787\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09788}09788\ \ \ \textcolor{keywordflow}{if}\ (is\_starting\_setup)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09789}09789\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎮\ Starting\ position\ detected:\ rows\ 0,1,6,7\ occupied,\ rows\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09790}09790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2,3,4,5\ empty"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09791}09791\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09792}09792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09793}09793\ \ \ \textcolor{keywordflow}{return}\ is\_starting\_setup;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09794}09794\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09795}09795\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09804}\mbox{\hyperlink{game__task_8c_a33f0d04999a0cc77d79d2e529a227be1}{09804}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a33f0d04999a0cc77d79d2e529a227be1}{game\_handle\_piece\_lifted}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09805}09805\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🖐️\ Matrix:\ Piece\ lifted\ from\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09806}09806\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09807}09807\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ piece\ at\ the\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09808}09808\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09809}09809\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09810}09810\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ piece\ to\ lift\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09811}09811\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09812}09812\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09813}09813\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09814}09814\ \ \ \textcolor{comment}{//\ Check\ if\ it's\ the\ current\ player's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09815}09815\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09816}09816\ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09817}09817\ \ \ \textcolor{keywordtype}{bool}\ is\_current\_player\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ is\_white\_piece)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09818}09818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !is\_white\_piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09819}09819\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09820}09820\ \ \ \textcolor{keywordflow}{if}\ (!is\_current\_player)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09821}09821\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Cannot\ lift\ opponent's\ piece\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09822}09822\ \ \ \ \ \ \ \ \ \ \ \ \ \ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09823}09823\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09824}09824\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09825}09825\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09826}09826\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Check\ if\ castle\ animation\ is\ active\ and\ this\ is\ a\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09827}09827\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09828}09828\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_rook\ =\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09829}09829\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09830}09830\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_rook)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09831}09831\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ rook\ is\ being\ lifted\ from\ the\ correct\ position\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09832}09832\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ ==\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09833}09833\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Rook\ lifted\ from\ correct\ position\ for\ castling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09834}09834\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Continue\ with\ normal\ move\ highlighting}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09835}09835\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09836}09836\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rook\ lifted\ from\ wrong\ position\ -\/\ show\ error\ and\ valid\ moves\ from}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09837}09837\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ correct\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09838}09838\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09839}09839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Rook\ lifted\ from\ wrong\ position\ for\ castling:\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09840}09840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(expected:\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09841}09841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09842}09842\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09843}09843\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ error\ animation\ -\/\ blink\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09844}09844\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09845}09845\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09846}09846\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09847}09847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09848}09848\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09849}09849\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09850}09850\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09851}09851\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09852}09852\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09853}09853\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ valid\ moves\ from\ the\ correct\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09854}09854\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09855}09855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09856}09856\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}),\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09857}09857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09858}09858\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09859}09859\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09860}09860\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09861}09861\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09862}09862\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castle\ animation\ active\ -\/\ only\ rook\ can\ be\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09863}09863\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09864}09864\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09865}09865\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09866}09866\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09867}09867\ \ \ \textcolor{comment}{//\ Show\ possible\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09868}09868\ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09869}09869\ \ \ uint32\_t\ valid\_moves\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09870}09870\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09871}09871\ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09872}09872\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Found\ \%lu\ valid\ moves\ for\ piece\ at\ \%c\%d"{}},\ valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09873}09873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09874}09874\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09875}09875\ \ \ \ \ \textcolor{comment}{//\ Send\ LED\ commands\ to\ highlight\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09876}09876\ \ \ \ \ \textcolor{comment}{//\ Highlight\ source\ square\ in\ yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09877}09877\ \ \ \ \ \textcolor{comment}{//\ Highlight\ source\ square\ (yellow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09878}09878\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09879}09879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09880}09880\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09881}09881\ \ \ \ \ \textcolor{comment}{//\ Highlight\ possible\ destinations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09882}09882\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09883}09883\ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09884}09884\ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09885}09885\ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09886}09886\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09887}09887\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ destination\ has\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09888}09888\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09889}09889\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09890}09890\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09891}09891\ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09892}09892\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09893}09893\ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09894}09894\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09895}09895\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09896}09896\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09897}09897\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09898}09898\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09899}09899\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09900}09900\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09901}09901\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09902}09902\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09903}09903\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09904}09904\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ No\ valid\ moves\ for\ piece\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09905}09905\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09906}09906\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09907}09907\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Po\ zvednutí\ figurky\ spustit\ animaci\ změny\ hráče\ a\ zobrazit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09908}09908\ \ \ \textcolor{comment}{//\ pohyblivé\ figurky\ (pouze\ pokud\ není\ aktivní\ animace\ rosady\ a\ není\ očekávána}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09909}09909\ \ \ \textcolor{comment}{//\ rosada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09910}09910\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09911}09911\ \ \ \ \ \textcolor{comment}{//\ After\ piece\ is\ lifted,\ show\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09912}09912\ \ \ \ \ \textcolor{comment}{//\ This\ completes\ the\ cycle\ as\ requested\ by\ the\ user}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09913}09913\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09914}09914\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09915}09915\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09916}09916\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09925}\mbox{\hyperlink{game__task_8c_a696a56f72aa0226d23952ccbdfd20cd7}{09925}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a696a56f72aa0226d23952ccbdfd20cd7}{game\_handle\_piece\_placed}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09926}09926\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✋\ Matrix:\ Piece\ placed\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09927}09927\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09928}09928\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Detekce\ nové\ hry\ po\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09929}09929\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ jestli\ se\ figurky\ rozestavily\ na\ startovní\ pozice\ (řádky\ 1,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09930}09930\ \ \ \textcolor{comment}{//\ 2,\ 7,\ 8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09931}09931\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad6aef74bc8447dabf92abcb081340931}{game\_detect\_new\_game\_setup}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09932}09932\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09933}09933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ NEW\ GAME\ DETECTED!\ Pieces\ arranged\ in\ starting\ positions"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09934}09934\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09935}09935\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ všechny\ animace}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09936}09936\ \ \ \ \ \mbox{\hyperlink{unified__animation__manager_8h_a00e3ed0913caba4f42ed8749b9e41d6f}{unified\_animation\_stop\_all}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09937}09937\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09938}09938\ \ \ \ \ \textcolor{comment}{//\ Spustit\ novou\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09939}09939\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{game\_start\_new\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09940}09940\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09941}09941\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Ukončit\ -\/\ nová\ hra\ byla\ spuštěna}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09942}09942\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09943}09943\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09944}09944\ \ \ \textcolor{comment}{//\ Check\ if\ castle\ animation\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09945}09945\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09946}09946\ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09947}09947\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09948}09948\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castle\ animation\ active\ -\/\ checking\ if\ rook\ was\ placed\ correctly"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09949}09949\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09950}09950\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ a\ rook\ piece\ being\ placed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09951}09951\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09952}09952\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_rook\ =\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09953}09953\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09954}09954\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_rook)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09955}09955\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ rook\ was\ placed\ on\ correct\ position\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09956}09956\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ ==\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09957}09957\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Rook\ placed\ on\ correct\ position\ for\ castling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09958}09958\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ move\ will\ be\ completed\ in\ game\_handle\_matrix\_move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09959}09959\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09960}09960\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09961}09961\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rook\ placed\ on\ wrong\ position\ -\/\ show\ error}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09962}09962\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09963}09963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Rook\ placed\ on\ wrong\ position\ for\ castling:\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09964}09964\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(expected:\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09965}09965\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09966}09966\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09967}09967\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ error\ animation\ -\/\ blink\ red\ then\ show\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09968}09968\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09969}09969\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09970}09970\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Blink\ the\ wrong\ position\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09971}09971\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09972}09972\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09973}09973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09974}09974\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09975}09975\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09976}09976\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09977}09977\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09978}09978\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09979}09979\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ correct\ rook\ position\ and\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09980}09980\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09981}09981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09982}09982\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}),\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09983}09983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09984}09984\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09985}09985\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09986}09986\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09987}09987\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09988}09988\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09989}09989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castle\ animation\ active\ -\/\ waiting\ for\ rook\ to\ be\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09990}09990\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09991}09991\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09992}09992\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09993}09993\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09994}09994\ \ \ \textcolor{comment}{//\ Clear\ only\ board\ LEDs}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09995}09995\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09996}09996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09997}09997\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Po\ umístění\ figurky\ spustit\ animaci\ změny\ hráče\ a\ zobrazit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09998}09998\ \ \ \textcolor{comment}{//\ pohyblivé\ figurky\ (pouze\ pokud\ není\ aktivní\ animace\ rosady\ a\ není\ očekávána}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09999}09999\ \ \ \textcolor{comment}{//\ rosada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10000}10000\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10001}10001\ \ \ \ \ \textcolor{comment}{//\ After\ piece\ is\ placed,\ show\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10002}10002\ \ \ \ \ \textcolor{comment}{//\ This\ completes\ the\ cycle\ as\ requested\ by\ the\ user}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10003}10003\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10004}10004\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10005}10005\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10006}10006\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10017}\mbox{\hyperlink{game__task_8c_a73c95d04856c50d53520e346abedf4da}{10017}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a73c95d04856c50d53520e346abedf4da}{game\_handle\_matrix\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,\ uint8\_t\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10018}10018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10019}10019\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Matrix:\ Complete\ move\ \%c\%d\ -\/>\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10020}10020\ \ \ \ \ \ \ \ \ \ \ \ from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10021}10021\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10022}10022\ \ \ \textcolor{comment}{//\ Check\ if\ castle\ animation\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10023}10023\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10024}10024\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{game\_complete\_castle\_animation}}(from\_row,\ from\_col,\ to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10025}10025\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Castle\ animation\ completed\ via\ matrix\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10026}10026\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10027}10027\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10028}10028\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10029}10029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ rook\ move\ for\ castling\ -\/\ waiting\ for\ correct\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10030}10030\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10031}10031\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10032}10032\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10033}10033\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10034}10034\ \ \ \textcolor{comment}{//\ Convert\ matrix\ event\ to\ chess\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10035}10035\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ move\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10036}10036\ \ \ \ \ \ \ .from\_row\ =\ from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10037}10037\ \ \ \ \ \ \ .from\_col\ =\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10038}10038\ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10039}10039\ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10040}10040\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10041}10041\ \ \ \ \ \ \ .piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10042}10042\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row]}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10043}10043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [from\_col],\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Skutečná\ figurka\ ze\ zdrojového\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10044}10044\ \ \ \ \ \ \ .captured\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10045}10045\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Skutečná\ figurka\ z\ cílového\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10046}10046\ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10047}10047\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10048}10048\ \ \ \textcolor{comment}{//\ ✅\ KRITICKÁ\ OPRAVA:\ Validace\ tahu\ před\ voláním\ game\_execute\_move\ (stejně}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10049}10049\ \ \ \textcolor{comment}{//\ jako\ UART\ flow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10050}10050\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10051}10051\ \ \ \textcolor{keywordflow}{if}\ (error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10052}10052\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ matrix\ move\ rejected:\ \%c\%d\ -\/>\ \%c\%d\ (error:\ \%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10053}10053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ from\_col,\ from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10054}10054\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10055}10055\ \ \ \ \ \textcolor{comment}{//\ Clear\ LEDs\ on\ invalid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10056}10056\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10057}10057\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10058}10058\ \ \ \ \ \textcolor{comment}{//\ Show\ error\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10059}10059\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10060}10060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10061}10061\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(to\_row,\ to\_col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10062}10062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10063}10063\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10064}10064\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Reject\ invalid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10065}10065\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10066}10066\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10067}10067\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Detekce\ rosady\ před\ voláním\ game\_execute\_move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10068}10068\ \ \ \textcolor{keywordtype}{bool}\ is\_castling\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10069}10069\ \ \ \ \ \ \ (move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10070}10070\ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10071}10071\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10072}10072\ \ \ \textcolor{keywordflow}{if}\ (is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10073}10073\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ CASTLING\ DETECTED\ in\ matrix\ move:\ \%c\%d\ -\/>\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10074}10074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10075}10075\ \ \ \ \ \ \ \ \ \ \ \ \ \ move.\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10076}10076\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10077}10077\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10078}10078\ \ \ \textcolor{comment}{//\ Execute\ move\ (already\ validated)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10079}10079\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10080}10080\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Matrix\ move\ executed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10081}10081\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10082}10082\ \ \ \ \ \textcolor{comment}{//\ ✅\ KRITICKÁ\ OPRAVA:\ Kontrola\ checkmate/stalemate\ po\ každém\ tahu!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10083}10083\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10084}10084\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10085}10085\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10086}10086\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10087}10087\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎉\ Game\ finished\ detected\ in\ matrix\ move!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10088}10088\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10089}10089\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10090}10090\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10091}10091\ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Pro\ rosadu\ nespouštět\ game\_highlight\_opponent\_pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10092}10092\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ move\ completed\ -\/\ waiting\ for\ rook\ animation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10093}10093\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10094}10094\ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Po\ úspěšném\ tahu\ spustit\ animaci\ změny\ hráče\ a\ zobrazit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10095}10095\ \ \ \ \ \ \ \textcolor{comment}{//\ pohyblivé\ figurky\ (pouze\ pokud\ není\ aktivní\ animace\ rosady\ a\ není}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10096}10096\ \ \ \ \ \ \ \textcolor{comment}{//\ očekávána\ rosada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10097}10097\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10098}10098\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ After\ successful\ move,\ show\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10099}10099\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10100}10100\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10101}10101\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10102}10102\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10103}10103\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ matrix\ move\ rejected"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10104}10104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10105}10105\ \ \ \ \ \textcolor{comment}{//\ Clear\ LEDs\ on\ invalid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10106}10106\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10107}10107\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10108}10108\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10109}10109\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10113}\mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{10113}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10114}10114\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Highlighting\ opponent\ pieces\ that\ can\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10115}10115\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10116}10116\ \ \ \textcolor{comment}{//\ LED\ command\ queue\ removed\ -\/\ using\ direct\ LED\ calls\ now}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10117}10117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10118}10118\ \ \ \textcolor{comment}{//\ Switch\ to\ opponent's\ perspective\ temporarily}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10119}10119\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ opponent\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10120}10120\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10121}10121\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10122}10122\ \ \ \textcolor{comment}{//\ Find\ all\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10123}10123\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10124}10124\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10125}10125\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10126}10126\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10127}10127\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10128}10128\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10129}10129\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ it's\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10130}10130\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10131}10131\ \ \ \ \ \ \ \ \ \ \ (opponent\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10132}10132\ \ \ \ \ \ \ \ \ \ \ \ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10133}10133\ \ \ \ \ \ \ \ \ \ \ (opponent\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10134}10134\ \ \ \ \ \ \ \ \ \ \ \ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10135}10135\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10136}10136\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10137}10137\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ piece\ has\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10138}10138\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10139}10139\ \ \ \ \ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10140}10140\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10141}10141\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10142}10142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10143}10143\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Highlight\ this\ piece\ in\ blue\ (indicating\ it\ can\ move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10144}10144\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 0,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10145}10145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255);\ \textcolor{comment}{//\ Blue\ for\ pieces\ that\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10146}10146\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10147}10147\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10148}10148\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10149}10149\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10150}10150\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10151}10151\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10156}\mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{10156}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{game\_process\_promotion\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10157}10157\ \ \ \textcolor{keywordflow}{if}\ (!cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10158}10158\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ promotion\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10159}10159\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10160}10160\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10161}10161\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10162}10162\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Processing\ promotion\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10163}10163\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10164}10164\ \ \ \textcolor{comment}{//\ Check\ if\ we're\ in\ a\ promotion\ state\ (7\ =\ GAME\_STATE\_PROMOTION)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10165}10165\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ !=\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10166}10166\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Not\ in\ promotion\ state,\ ignoring\ promotion\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10167}10167\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10168}10168\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10169}10169\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10170}10170\ \ \ \textcolor{comment}{//\ Execute\ the\ promotion\ (default\ to\ queen\ for\ now)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10171}10171\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10172}10172\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promotion\ executed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10173}10173\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10174}10174\ \ \ \ \ \textcolor{comment}{//\ Clear\ promotion\ state\ (6\ =\ GAME\_STATE\_PLAYING)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10175}10175\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10176}10176\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10177}10177\ \ \ \ \ \textcolor{comment}{//\ Switch\ to\ next\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10178}10178\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10179}10179\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10180}10180\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10181}10181\ \ \ \ \ \textcolor{comment}{//\ ✅\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10182}10182\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10183}10183\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10184}10184\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10185}10185\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10186}10186\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10187}10187\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10188}10188\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10189}10189\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10190}10190\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10191}10191\ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10192}10192\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10193}10193\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10194}10194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10195}10195\ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10196}10196\ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10197}10197\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10198}10198\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10199}10199\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10200}10200\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10201}10201\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10202}10202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ promotion\ command!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10203}10203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10204}10204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10205}10205\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10206}10206\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10207}10207\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10208}10208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10209}10209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10210}10210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10211}10211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10212}10212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10213}10213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10214}10214\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10215}10215\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10216}10216\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10217}10217\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10218}10218\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10219}10219\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10220}10220\ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10221}10221\ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10222}10222\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10223}10223\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10224}10224\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10225}10225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10226}10226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10227}10227\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10228}10228\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10229}10229\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10230}10230\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10231}10231\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10232}10232\ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10233}10233\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10234}10234\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10235}10235\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10236}10236\ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ updated\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10237}10237\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{game\_print\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10238}10238\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10239}10239\ \ \ \ \ \ \ \textcolor{comment}{//\ Highlight\ pieces\ that\ the\ new\ current\ player\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10240}10240\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10241}10241\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10242}10242\ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10243}10243\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10244}10244\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10245}10245\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10246}10246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10247}10247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10248}10248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10249}10249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10250}10250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10251}10251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10252}10252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10253}10253\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10254}10254\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10255}10255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10256}10256\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10257}10257\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10258}10258\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10259}10259\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10260}10260\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ execute\ promotion"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10261}10261\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10262}10262\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10263}10263\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10287}\mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{10287}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10288}10288\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Executing\ pawn\ promotion:\ \%d"{}},\ choice);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10289}10289\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10290}10290\ \ \ \textcolor{comment}{//\ Find\ the\ pawn\ that\ needs\ to\ be\ promoted}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10291}10291\ \ \ \textcolor{comment}{//\ This\ should\ be\ set\ when\ a\ pawn\ reaches\ the\ promotion\ rank}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10292}10292\ \ \ \textcolor{comment}{//\ For\ now,\ we'll\ implement\ a\ basic\ version}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10293}10293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10294}10294\ \ \ \textcolor{comment}{//\ Convert\ promotion\ choice\ to\ piece\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10295}10295\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10296}10296\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10297}10297\ \ \ \ \ \textcolor{keywordflow}{switch}\ (choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10298}10298\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10299}10299\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10300}10300\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10301}10301\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10302}10302\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10303}10303\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10304}10304\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10305}10305\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10306}10306\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10307}10307\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10308}10308\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10309}10309\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10310}10310\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10311}10311\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10312}10312\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10313}10313\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10314}10314\ \ \ \ \ \textcolor{keywordflow}{switch}\ (choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10315}10315\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10316}10316\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10317}10317\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10318}10318\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10319}10319\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10320}10320\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10321}10321\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10322}10322\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10323}10323\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10324}10324\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10325}10325\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10326}10326\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10327}10327\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10328}10328\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10329}10329\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10330}10330\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10331}10331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10332}10332\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA\ BUG\ \#10:\ Find\ the\ pawn\ to\ promote\ (this\ should\ be\ stored\ when}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10333}10333\ \ \ \textcolor{comment}{//\ promotion\ is\ needed)\ KRITICKÁ\ OPRAVA:\ row\ indexing\ byl\ OBRÁCENÝ!\ row\ 0\ =\ 1.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10334}10334\ \ \ \textcolor{comment}{//\ řada\ (a1-\/h1),\ row\ 7\ =\ 8.\ řada\ (a8-\/h8)\ Bílý\ pěšec\ povyšuje\ na\ row\ 7\ (8.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10335}10335\ \ \ \textcolor{comment}{//\ řada),\ černý\ na\ row\ 0\ (1.\ řada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10336}10336\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10337}10337\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10338}10338\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10339}10339\ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVENO:\ Bílý\ pěšec\ povyšuje\ na\ row\ 7\ (8.\ řada\ a8-\/h8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10340}10340\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10341}10341\ \ \ \ \ \ \ \ \ \ \ row\ ==\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10342}10342\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ White\ pawn\ on\ rank\ 8\ (row\ 7)\ -\/\ promote}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10343}10343\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10344}10344\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promoted\ white\ pawn\ at\ \%c\%d\ to\ \%s"{}},\ \textcolor{charliteral}{'a'}\ +\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10345}10345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10346}10346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}\ \ \ \ ?\ \textcolor{stringliteral}{"{}Queen"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10347}10347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}\ \ \ ?\ \textcolor{stringliteral}{"{}Rook"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10348}10348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}\ ?\ \textcolor{stringliteral}{"{}Bishop"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10349}10349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Knight"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10350}10350\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10351}10351\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ Spustit\ promotion\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10352}10352\ \ \ \ \ \ \ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10353}10353\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10354}10354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ promotion\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10355}10355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10356}10356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10357}10357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10358}10358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10359}10359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10360}10360\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10361}10361\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10362}10362\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10363}10363\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10364}10364\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10365}10365\ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVENO:\ Černý\ pěšec\ povyšuje\ na\ row\ 0\ (1.\ řada\ a1-\/h1)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10366}10366\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10367}10367\ \ \ \ \ \ \ \ \ \ \ row\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10368}10368\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ pawn\ on\ rank\ 1\ (row\ 0)\ -\/\ promote}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10369}10369\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10370}10370\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promoted\ black\ pawn\ at\ \%c\%d\ to\ \%s"{}},\ \textcolor{charliteral}{'a'}\ +\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10371}10371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10372}10372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}\ \ \ \ ?\ \textcolor{stringliteral}{"{}Queen"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10373}10373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}\ \ \ ?\ \textcolor{stringliteral}{"{}Rook"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10374}10374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}\ ?\ \textcolor{stringliteral}{"{}Bishop"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10375}10375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Knight"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10376}10376\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10377}10377\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ✅\ Spustit\ promotion\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10378}10378\ \ \ \ \ \ \ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10379}10379\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10380}10380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ promotion\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10381}10381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10382}10382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10383}10383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10384}10384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10385}10385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10386}10386\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10387}10387\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10388}10388\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10389}10389\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10390}10390\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10391}10391\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10392}10392\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10393}10393\ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ pawn\ found\ for\ promotion"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10394}10394\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10395}10395\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10396}10396\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10400}\mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{10400}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10401}10401\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🟡\ Highlighting\ movable\ pieces\ for\ \%s\ player"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10402}10402\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}white"{}}\ :\ \textcolor{stringliteral}{"{}black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10403}10403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10404}10404\ \ \ \textcolor{comment}{//\ Endgame\ detection\ is\ handled\ in\ game\_analyze\_position()\ called\ from}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10405}10405\ \ \ \textcolor{comment}{//\ game\_execute\_move()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10406}10406\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10407}10407\ \ \ \textcolor{comment}{//\ LED\ command\ queue\ removed\ -\/\ using\ direct\ LED\ calls\ now}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10408}10408\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10409}10409\ \ \ uint32\_t\ highlighted\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10410}10410\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10411}10411\ \ \ \textcolor{comment}{//\ Scan\ all\ squares\ for\ current\ player's\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10412}10412\ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10413}10413\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10414}10414\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10415}10415\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10416}10416\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10417}10417\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_current\_player\_piece\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10418}10418\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10419}10419\ \ \ \ \ \ \ \ \ is\_current\_player\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10420}10420\ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10421}10421\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10422}10422\ \ \ \ \ \ \ \ \ is\_current\_player\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10423}10423\ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10424}10424\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10425}10425\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10426}10426\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_current\_player\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10427}10427\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ piece\ has\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10428}10428\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10429}10429\ \ \ \ \ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10430}10430\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10431}10431\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10432}10432\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10433}10433\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Highlight\ movable\ piece\ in\ yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10434}10434\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10435}10435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10436}10436\ \ \ \ \ \ \ \ \ \ \ highlighted\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10437}10437\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10438}10438\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10439}10439\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10440}10440\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10441}10441\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10442}10442\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🟡\ Highlighted\ \%lu\ movable\ pieces"{}},\ highlighted\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10443}10443\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10444}10444\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10445}10445\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10446}10446\ \textcolor{comment}{//\ PUZZLE\ COMMAND\ IMPLEMENTATIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10447}10447\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10448}10448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10449}10449\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10450}10450\ \textcolor{comment}{//\ ENHANCED\ CASTLING\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10451}10451\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10452}10452\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10457}\mbox{\hyperlink{game__task_8c_a1bab09959bb451eacb7eadf20da5aff1}{10457}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1bab09959bb451eacb7eadf20da5aff1}{game\_detect\_and\_handle\_castling}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10458}10458\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10459}10459\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10460}10460\ \ \ \textcolor{comment}{//\ Je\ to\ král\ a\ pohybuje\ se\ o\ 2\ pole?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10461}10461\ \ \ \textcolor{keywordflow}{if}\ ((piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10462}10462\ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10463}10463\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10464}10464\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ CASTLING\ DETECTED!\ King\ moved\ 2\ squares"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10465}10465\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10466}10466\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ stav\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10467}10467\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10468}10468\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10469}10469\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10470}10470\ \ \ \ \ \textcolor{comment}{//\ Vypočítat\ pozice\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10471}10471\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_kingside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ 6);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10472}10472\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10473}10473\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ =\ is\_kingside\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10474}10474\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10475}10475\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col\ =\ is\_kingside\ ?\ 5\ :\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10476}10476\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10477}10477\ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ LED\ guidance\ pro\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10478}10478\ \ \ \ \ \mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{game\_show\_castling\_rook\_guidance}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10479}10479\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10480}10480\ \ \ \ \ \textcolor{comment}{//\ NEZMĚNIT\ HRÁČE\ -\/\ čekat\ na\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10481}10481\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏳\ Waiting\ for\ rook\ move\ to\ complete\ castling..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10482}10482\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10483}10483\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10484}10484\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10488}\mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{10488}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{game\_show\_castling\_rook\_guidance}}()\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10489}10489\ \ \ \textcolor{comment}{//\ Vyčistit\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10490}10490\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10491}10491\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10492}10492\ \ \ \textcolor{comment}{//\ Postupná\ animace\ od\ věže\ k\ cíli}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10493}10493\ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10494}10494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10495}10495\ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10496}10496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10497}10497\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10498}10498\ \ \ \textcolor{comment}{//\ Zvýraznit\ věž\ (žlutá)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10499}10499\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Žlutá\ -\/\ zvedni\ odtud}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10500}10500\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10501}10501\ \ \ \textcolor{comment}{//\ Postupně\ rozsvítit\ pole\ od\ věže\ k\ cíli}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10502}10502\ \ \ \textcolor{keywordtype}{int}\ from\_col\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10503}10503\ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10504}10504\ \ \ \textcolor{keywordtype}{int}\ step\ =\ (to\_col\ >\ from\_col)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10505}10505\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10506}10506\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ from\_col\ +\ step;\ col\ !=\ to\_col\ +\ step;\ col\ +=\ step)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10507}10507\ \ \ \ \ uint8\_t\ led\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10508}10508\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10509}10509\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ -\/\ cesta}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10510}10510\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(300));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10511}10511\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10512}10512\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10513}10513\ \ \ \textcolor{comment}{//\ Zvýraznit\ cíl\ (zelená)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10514}10514\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ -\/\ polož\ sem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10515}10515\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10516}10516\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Move\ rook\ from\ \%c\%d\ to\ \%c\%d\ to\ complete\ castling"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10517}10517\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10518}10518\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10519}10519\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10520}10520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10526}\mbox{\hyperlink{game__task_8c_a6974209fc82de9bbb764a014d9badec0}{10526}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a6974209fc82de9bbb764a014d9badec0}{game\_check\_castling\_completion}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10527}10527\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10528}10528\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10529}10529\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10530}10530\ \ \ \textcolor{comment}{//\ Je\ to\ správný\ tah\ věže?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10531}10531\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10532}10532\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10533}10533\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10534}10534\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10535}10535\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10536}10536\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ CASTLING\ COMPLETED!\ Rook\ moved\ correctly"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10537}10537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10538}10538\ \ \ \ \ \textcolor{comment}{//\ Provedeme\ posun\ věže\ v\ board[][]}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10539}10539\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10540}10540\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row][\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10541}10541\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10542}10542\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10543}10543\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ příznaky\ pro\ krále\ a\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10544}10544\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10545}10545\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10546}10546\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10547}10547\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10548}10548\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10549}10549\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10550}10550\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10551}10551\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10552}10552\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10553}10553\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10554}10554\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10555}10555\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10556}10556\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10557}10557\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10558}10558\ \ \ \ \ \textcolor{comment}{//\ Zlatá\ animace\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10559}10559\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{show\_castling\_completion\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10560}10560\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10561}10561\ \ \ \ \ \textcolor{comment}{//\ Změnit\ hráče\ TEPRVE\ TEĎ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10562}10562\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10563}10563\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10564}10564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10565}10565\ \ \ \ \ \textcolor{comment}{//\ ✅\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10566}10566\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10567}10567\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10568}10568\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10569}10569\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10570}10570\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10571}10571\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10572}10572\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10573}10573\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10574}10574\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10575}10575\ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10576}10576\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10577}10577\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10578}10578\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10579}10579\ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10580}10580\ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10581}10581\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10582}10582\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10583}10583\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10584}10584\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10585}10585\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10586}10586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ castling\ completion!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10587}10587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10588}10588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10589}10589\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10590}10590\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10591}10591\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10592}10592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10593}10593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10594}10594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10595}10595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10596}10596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10597}10597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10598}10598\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10599}10599\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10600}10600\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10601}10601\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10602}10602\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10603}10603\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10604}10604\ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10605}10605\ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10606}10606\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10607}10607\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10608}10608\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ ✅\ OPRAVA:\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10609}10609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10610}10610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10611}10611\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10612}10612\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10613}10613\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10614}10614\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10615}10615\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10616}10616\ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10617}10617\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10618}10618\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10619}10619\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10620}10620\ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ stav\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10621}10621\ \ \ \ \ \ \ memset(\&\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10622}10622\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10623}10623\ \ \ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figury\ pro\ nového\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10624}10624\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10625}10625\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10626}10626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10627}10627\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ completed!\ \%s\ to\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10628}10628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10629}10629\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10630}10630\ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10631}10631\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10632}10632\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10633}10633\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10634}10634\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10635}10635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10636}10636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10637}10637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10638}10638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10639}10639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10640}10640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10641}10641\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10642}10642\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10643}10643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10644}10644\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10645}10645\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10646}10646\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10647}10647\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10648}10648\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10649}10649\ \ \ \ \ \textcolor{comment}{//\ Nesprávný\ tah\ věže\ -\/\ ukázat\ znovu\ guidance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10650}10650\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Incorrect\ rook\ move\ for\ castling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10651}10651\ \ \ \ \ \mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{game\_show\_castling\_rook\_guidance}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10652}10652\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10653}10653\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10654}10654\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10655}10655\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10659}\mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{10659}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{show\_castling\_completion\_animation}}()\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10660}10660\ \ \ \textcolor{comment}{//\ Zlatá\ animace\ úspěšné\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10661}10661\ \ \ uint8\_t\ rook\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10662}10662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10663}10663\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10664}10664\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10665}10665\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Zlatá}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10666}10666\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10667}10667\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_led,\ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10668}10668\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10669}10669\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10670}10670\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10671}10671\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰✨\ CASTLING\ ANIMATION\ COMPLETED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10672}10672\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10673}10673\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10674}10674\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10675}10675\ \textcolor{comment}{//\ CASTLING\ ANIMATION\ SYSTEM\ (LEGACY)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10676}10676\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10677}10677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10682}\mbox{\hyperlink{game__task_8c_a5163d6404ac51406bdeffbe99262725c}{10682}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5163d6404ac51406bdeffbe99262725c}{game\_start\_castle\_animation}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10683}10683\ \ \ \textcolor{keywordflow}{if}\ (!move)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10684}10684\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10685}10685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10686}10686\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Starting\ castle\ animation\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10687}10687\ \ \ \ \ \ \ \ \ \ \ \ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}})\ ?\ \textcolor{stringliteral}{"{}kingside"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10688}10688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}queenside"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10689}10689\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10690}10690\ \ \ \textcolor{comment}{//\ Calculate\ rook\ positions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10691}10691\ \ \ uint8\_t\ king\_row\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 0\ :\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10692}10692\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10693}10693\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10694}10694\ \ \ \ \ \textcolor{comment}{//\ Kingside:\ rook\ from\ h-\/file\ to\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10695}10695\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10696}10696\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 7;\ \textcolor{comment}{//\ h-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10697}10697\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10698}10698\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 5;\ \textcolor{comment}{//\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10699}10699\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10700}10700\ \ \ \ \ \textcolor{comment}{//\ Queenside:\ rook\ from\ a-\/file\ to\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10701}10701\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10702}10702\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 0;\ \textcolor{comment}{//\ a-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10703}10703\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10704}10704\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 3;\ \textcolor{comment}{//\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10705}10705\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10706}10706\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10707}10707\ \ \ \textcolor{comment}{//\ Store\ castle\ move\ for\ completion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10708}10708\ \ \ \mbox{\hyperlink{game__task_8c_aec956796e1629a92f299b1725070b1c2}{pending\_castle\_move}}\ =\ *move;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10709}10709\ \ \ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10710}10710\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10711}10711\ \ \ \textcolor{comment}{//\ Clear\ board\ and\ start\ repeating\ rook\ move\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10712}10712\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10713}10713\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10714}10714\ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Spustit\ opakující\ se\ animaci\ pohybu\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10715}10715\ \ \ \mbox{\hyperlink{game__task_8c_afbd09cfaddffe4661015d92975561bd2}{game\_start\_repeating\_rook\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10716}10716\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10717}10717\ \ \ \textcolor{comment}{//\ Show\ initial\ animation\ immediately}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10718}10718\ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10719}10719\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10720}10720\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Yellow\ for\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10721}10721\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);\ \ \ \ \ \textcolor{comment}{//\ Green\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10722}10722\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10723}10723\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Rook\ at\ \%c\%d\ needs\ to\ move\ to\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10724}10724\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10725}10725\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10726}10726\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10731}\mbox{\hyperlink{game__task_8c_af26d73c4a9e269473827e4d4497b21b3}{10731}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_af26d73c4a9e269473827e4d4497b21b3}{rook\_animation\_timer\_callback}}(TimerHandle\_t\ xTimer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10732}10732\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ ||\ !\mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10733}10733\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10734}10734\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10735}10735\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10736}10736\ \ \ \textcolor{comment}{//\ Simple\ pulsing\ animation\ -\/\ show\ rook\ position\ and\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10737}10737\ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10738}10738\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10739}10739\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10740}10740\ \ \ \textcolor{comment}{//\ Clear\ board\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10741}10741\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10742}10742\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10743}10743\ \ \ \textcolor{comment}{//\ Show\ rook\ position\ in\ yellow\ (pulsing)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10744}10744\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ pulse\_state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10745}10745\ \ \ pulse\_state\ =\ !pulse\_state;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10746}10746\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10747}10747\ \ \ \textcolor{keywordflow}{if}\ (pulse\_state)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10748}10748\ \ \ \ \ \textcolor{comment}{//\ Bright\ yellow\ for\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10749}10749\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10750}10750\ \ \ \ \ \textcolor{comment}{//\ Bright\ green\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10751}10751\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10752}10752\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10753}10753\ \ \ \ \ \textcolor{comment}{//\ Dim\ yellow\ for\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10754}10754\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 128,\ 128,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10755}10755\ \ \ \ \ \textcolor{comment}{//\ Dim\ green\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10756}10756\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 128,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10757}10757\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10758}10758\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10759}10759\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Rook\ animation:\ \%c\%d\ -\/>\ \%c\%d\ (\%s)"{}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10760}10760\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10761}10761\ \ \ \ \ \ \ \ \ \ \ \ pulse\_state\ ?\ \textcolor{stringliteral}{"{}bright"{}}\ :\ \textcolor{stringliteral}{"{}dim"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10762}10762\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10763}10763\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10767}\mbox{\hyperlink{game__task_8c_afbd09cfaddffe4661015d92975561bd2}{10767}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afbd09cfaddffe4661015d92975561bd2}{game\_start\_repeating\_rook\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10768}10768\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10769}10769\ \ \ \ \ \textcolor{comment}{//\ Create\ timer\ for\ rook\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10770}10770\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10771}10771\ \ \ \ \ \ \ \ \ xTimerCreate(\textcolor{stringliteral}{"{}rook\_anim\_timer"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10772}10772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(2000),\ \textcolor{comment}{//\ 2\ second\ interval}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10773}10773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdTRUE,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Auto-\/reload}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10774}10774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NULL,\ \mbox{\hyperlink{game__task_8c_af26d73c4a9e269473827e4d4497b21b3}{rook\_animation\_timer\_callback}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10775}10775\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10776}10776\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10777}10777\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ create\ rook\ animation\ timer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10778}10778\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10779}10779\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10780}10780\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10781}10781\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10782}10782\ \ \ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10783}10783\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10784}10784\ \ \ \textcolor{comment}{//\ Start\ the\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10785}10785\ \ \ \textcolor{keywordflow}{if}\ (xTimerStart(\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}},\ 0)\ !=\ pdPASS)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10786}10786\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ start\ rook\ animation\ timer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10787}10787\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10788}10788\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10789}10789\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10790}10790\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10791}10791\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Started\ repeating\ rook\ animation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10792}10792\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10793}10793\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10797}\mbox{\hyperlink{game__task_8c_a400c845a7ea99010ffc662d32fc20147}{10797}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a400c845a7ea99010ffc662d32fc20147}{game\_stop\_repeating\_rook\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10798}10798\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10799}10799\ \ \ \ \ xTimerStop(\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}},\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10800}10800\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10801}10801\ \ \ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10802}10802\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Stopped\ repeating\ rook\ animation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10803}10803\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10804}10804\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10809}\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{10809}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10810}10810\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10816}\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{10816}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10817}10817\ \ \ \textcolor{comment}{//\ Check\ if\ a\ king\ is\ lifted\ and\ about\ to\ be\ placed\ 2\ squares\ away}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10818}10818\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10819}10819\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10820}10820\ \ \ \ \ \textcolor{comment}{//\ This\ function\ is\ called\ from\ game\_handle\_piece\_placed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10821}10821\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ check\ if\ the\ king\ is\ being\ placed\ 2\ squares\ away\ from\ its}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10822}10822\ \ \ \ \ \textcolor{comment}{//\ original\ position\ But\ we\ don't\ have\ access\ to\ the\ destination\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10823}10823\ \ \ \ \ \textcolor{comment}{//\ here\ So\ we\ return\ true\ to\ prevent\ premature\ opponent\ piece\ highlighting}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10824}10824\ \ \ \ \ \textcolor{comment}{//\ The\ actual\ castling\ detection\ will\ happen\ in\ game\_handle\_matrix\_move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10825}10825\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ King\ is\ lifted\ -\/\ castling\ might\ be\ expected"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10826}10826\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10827}10827\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10828}10828\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10829}10829\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10830}10830\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10839}\mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{10839}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{game\_complete\_castle\_animation}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10840}10840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10841}10841\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10842}10842\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10843}10843\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10844}10844\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10845}10845\ \ \ \textcolor{comment}{//\ Check\ if\ rook\ was\ moved\ to\ correct\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10846}10846\ \ \ \textcolor{keywordflow}{if}\ (from\_row\ ==\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ \&\&\ from\_col\ ==\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10847}10847\ \ \ \ \ \ \ to\_row\ ==\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10848}10848\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10849}10849\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Castle\ animation\ completed!\ Rook\ moved\ correctly."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10850}10850\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10851}10851\ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Skutečně\ přesunout\ věž\ až\ když\ hráč\ udělá\ správný\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10852}10852\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ rook\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10853}10853\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10854}10854\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}][\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}]\ =\ rook\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10855}10855\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10856}10856\ \ \ \ \ \textcolor{comment}{//\ Stop\ repeating\ rook\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10857}10857\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a400c845a7ea99010ffc662d32fc20147}{game\_stop\_repeating\_rook\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10858}10858\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10859}10859\ \ \ \ \ \textcolor{comment}{//\ Complete\ the\ castle\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10860}10860\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10861}10861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10862}10862\ \ \ \ \ \textcolor{comment}{//\ Switch\ players\ now\ that\ castle\ is\ complete}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10863}10863\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10864}10864\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10865}10865\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10866}10866\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10867}10867\ \ \ \ \ \textcolor{comment}{//\ ✅\ OPRAVA:\ Po\ úspěšné\ rošádě\ spustit\ animaci\ změny\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10868}10868\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{game\_show\_player\_change\_animation}}(previous\_player,\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10869}10869\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10870}10870\ \ \ \ \ \textcolor{comment}{//\ Clear\ board\ and\ show\ movable\ pieces\ for\ new\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10871}10871\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10872}10872\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10873}10873\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10874}10874\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ completed!\ \%s\ to\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10875}10875\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10876}10876\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10877}10877\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10878}10878\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10879}10879\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10880}10880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ rook\ move\ for\ castling:\ \%c\%d\ -\/>\ \%c\%d\ (expected:\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10881}10881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/>\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10882}10882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ from\_col,\ from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10883}10883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10884}10884\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10885}10885\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10886}10886\ \ \ \ \ \textcolor{comment}{//\ Keep\ castle\ animation\ active,\ wait\ for\ correct\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10887}10887\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10888}10888\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10889}10889\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10890}10890\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10891}10891\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10892}10892\ \textcolor{comment}{//\ WEB\ SERVER\ JSON\ EXPORT\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10893}10893\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10894}10894\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10895}\mbox{\hyperlink{game__task_8c_a6199d3c51c2ba715c27b7be7428c61b7}{10895}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a6199d3c51c2ba715c27b7be7428c61b7}{game\_get\_board\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10896}10896\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10897}10897\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10898}10898\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10899}10899\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10900}10900\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10901}10901\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10902}10902\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10903}10903\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10904}10904\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10905}10905\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10906}10906\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10907}10907\ \ \ \textcolor{comment}{//\ Build\ JSON\ string\ manually\ (more\ efficient\ than\ cJSON)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10908}10908\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10909}10909\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10910}10910\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}board\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10911}10911\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10912}10912\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10913}10913\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10914}10914\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10915}10915\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10916}10916\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\%c\(\backslash\)"{}"{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10917}10917\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (col\ <\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10918}10918\ \ \ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10919}10919\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10920}10920\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10921}10921\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}]"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10922}10922\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ <\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10923}10923\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10924}10924\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10925}10925\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10926}10926\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10927}10927\ \ \ uint64\_t\ timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10928}10928\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}],\(\backslash\)"{}timestamp\(\backslash\)"{}:\%llu\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10929}10929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ timestamp);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10930}10930\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10931}10931\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10932}10932\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10933}10933\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10934}10934\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10935}10935\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10936}10936\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10937}10937\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10938}\mbox{\hyperlink{game__task_8c_abdf3ba446d87db43c26b6c51275a521e}{10938}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_abdf3ba446d87db43c26b6c51275a521e}{game\_get\_status\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10939}10939\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10940}10940\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10941}10941\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10942}10942\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10943}10943\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10944}10944\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10945}10945\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10946}10946\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10947}10947\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10948}10948\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10949}10949\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10950}10950\ \ \ \textcolor{comment}{//\ Build\ JSON\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10951}10951\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10952}10952\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10953}10953\ \ \ \textcolor{comment}{//\ Game\ state\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10954}10954\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_state\_str\ =\ \textcolor{stringliteral}{"{}idle"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10955}10955\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10956}10956\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10957}10957\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}active"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10958}10958\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10959}10959\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10960}10960\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}paused"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10961}10961\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10962}10962\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10963}10963\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}finished"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10964}10964\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10965}10965\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10966}10966\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}promotion"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10967}10967\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10968}10968\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10969}10969\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}idle"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10970}10970\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10971}10971\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10972}10972\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10973}10973\ \ \ \textcolor{comment}{//\ Check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10974}10974\ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10975}10975\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10976}10976\ \ \ \textcolor{comment}{//\ Checkmate\ detection\ (simplified\ -\/\ king\ in\ check\ and\ no\ legal\ moves)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10977}10977\ \ \ \textcolor{keywordtype}{bool}\ checkmate\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10978}10978\ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10979}10979\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ generate\ legal\ moves\ -\/\ if\ none,\ it's\ checkmate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10980}10980\ \ \ \ \ uint32\_t\ legal\_moves\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10981}10981\ \ \ \ \ checkmate\ =\ (legal\_moves\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10982}10982\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10983}10983\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10984}10984\ \ \ \textcolor{comment}{//\ Stalemate\ detection\ (simplified\ -\/\ not\ in\ check\ but\ no\ legal\ moves)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10985}10985\ \ \ \textcolor{keywordtype}{bool}\ stalemate\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10986}10986\ \ \ \textcolor{keywordflow}{if}\ (!in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10987}10987\ \ \ \ \ uint32\_t\ legal\_moves\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10988}10988\ \ \ \ \ stalemate\ =\ (legal\_moves\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10989}10989\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10990}10990\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10991}10991\ \ \ offset\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10992}10992\ \ \ \ \ \ \ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10993}10993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}game\_state\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10994}10994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}current\_player\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10995}10995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}move\_count\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10996}10996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}white\_time\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10997}10997\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}black\_time\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10998}10998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}in\_check\(\backslash\)"{}:\%s,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10999}10999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}checkmate\(\backslash\)"{}:\%s,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11000}11000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}stalemate\(\backslash\)"{}:\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11001}11001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_state\_str,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11002}11002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}white"{}}\ :\ \textcolor{stringliteral}{"{}black"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11003}11003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}},\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}},\ in\_check\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11004}11004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkmate\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}},\ stalemate\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11005}11005\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11006}11006\ \ \ \textcolor{comment}{//\ Piece\ lifted\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11007}11007\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11008}11008\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11009}11009\ \ \ \ \ \textcolor{keywordtype}{char}\ notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11010}11010\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11011}11011\ \ \ \ \ offset\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11012}11012\ \ \ \ \ \ \ \ \ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11013}11013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}piece\_lifted\(\backslash\)"{}:\{\(\backslash\)"{}lifted\(\backslash\)"{}:true,\(\backslash\)"{}row\(\backslash\)"{}:\%d,\(\backslash\)"{}col\(\backslash\)"{}:\%d,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11014}11014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}piece\(\backslash\)"{}:\(\backslash\)"{}\%c\(\backslash\)"{},\(\backslash\)"{}notation\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{}\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11015}11015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ piece\_char,\ notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11016}11016\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11017}11017\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11018}11018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}piece\_lifted\(\backslash\)"{}:\{\(\backslash\)"{}lifted\(\backslash\)"{}:false,\(\backslash\)"{}row\(\backslash\)"{}:0,\(\backslash\)"{}col\(\backslash\)"{}:"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11019}11019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}0,\(\backslash\)"{}piece\(\backslash\)"{}:\(\backslash\)"{}\ \(\backslash\)"{},\(\backslash\)"{}notation\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11020}11020\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11021}11021\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11022}11022\ \ \ \textcolor{comment}{//\ ✅\ Game\ end\ information\ -\/\ použít\ current\_endgame\_reason\ pro\ přesné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11023}11023\ \ \ \textcolor{comment}{//\ rozlišení}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11024}11024\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11025}11025\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *end\_reason\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11026}11026\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\ =\ \textcolor{stringliteral}{"{}None"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11027}11027\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *loser\ =\ \textcolor{stringliteral}{"{}None"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11028}11028\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11029}11029\ \ \ \ \ \textcolor{comment}{//\ Nejprve\ určit\ vítěze}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11030}11030\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11031}11031\ \ \ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11032}11032\ \ \ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11033}11033\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11034}11034\ \ \ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11035}11035\ \ \ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11036}11036\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11037}11037\ \ \ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11038}11038\ \ \ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11039}11039\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11040}11040\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11041}11041\ \ \ \ \ \textcolor{comment}{//\ Pak\ určit\ důvod\ podle\ current\_endgame\_reason}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11042}11042\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11043}11043\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11044}11044\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11045}11045\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11046}11046\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11047}11047\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (En\ Passant)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11048}11048\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11049}11049\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11050}11050\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Castling)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11051}11051\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11052}11052\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11053}11053\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Promotion)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11054}11054\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11055}11055\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11056}11056\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Discovered\ Check)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11057}11057\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11058}11058\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11059}11059\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Resignation"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11060}11060\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11061}11061\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11062}11062\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Timeout"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11063}11063\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11064}11064\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11065}11065\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Stalemate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11066}11066\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11067}11067\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11068}11068\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}50-\/move\ rule"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11069}11069\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11070}11070\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11071}11071\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Threefold\ repetition"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11072}11072\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11073}11073\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11074}11074\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Insufficient\ material"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11075}11075\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11076}11076\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11077}11077\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11078}11078\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11079}11079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}game\_end\(\backslash\)"{}:\{\(\backslash\)"{}ended\(\backslash\)"{}:true,\(\backslash\)"{}reason\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11080}11080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}winner\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}loser\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{}\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11081}11081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ end\_reason,\ winner,\ loser);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11082}11082\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11083}11083\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11084}11084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}game\_end\(\backslash\)"{}:\{\(\backslash\)"{}ended\(\backslash\)"{}:false,\(\backslash\)"{}reason\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11085}11085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}winner\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{},\(\backslash\)"{}loser\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11086}11086\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11087}11087\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11088}11088\ \ \ \textcolor{comment}{//\ ✅\ Error\ recovery\ state\ pro\ vizuální\ indikaci\ na\ webu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11089}11089\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11090}11090\ \ \ \ \ \textcolor{keywordtype}{char}\ invalid\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11091}11091\ \ \ \ \ \textcolor{keywordtype}{char}\ original\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11092}11092\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11093}11093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11094}11094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ invalid\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11095}11095\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11096}11096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11097}11097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11098}11098\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11099}11099\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11100}11100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}error\_state\(\backslash\)"{}:\{\(\backslash\)"{}active\(\backslash\)"{}:true,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11101}11101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}invalid\_pos\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11102}11102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}original\_pos\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11103}11103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}error\_count\(\backslash\)"{}:\%d\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11104}11104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ invalid\_notation,\ original\_notation,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11105}11105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11106}11106\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11107}11107\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11108}11108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}error\_state\(\backslash\)"{}:\{\(\backslash\)"{}active\(\backslash\)"{}:false\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11109}11109\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11110}11110\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11111}11111\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11112}11112\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11113}11113\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11114}11114\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11115}11115\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11116}11116\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11117}11117\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11118}11118\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11119}11119\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11120}\mbox{\hyperlink{game__task_8c_a5d08ec12c99532e3819abb072385a921}{11120}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a5d08ec12c99532e3819abb072385a921}{game\_get\_history\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11121}11121\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11122}11122\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11123}11123\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11124}11124\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11125}11125\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11126}11126\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11127}11127\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11128}11128\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11129}11129\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11130}11130\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11131}11131\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11132}11132\ \ \ \textcolor{comment}{//\ Build\ JSON\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11133}11133\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11134}11134\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}moves\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11135}11135\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11136}11136\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11137}11137\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11138}11138\ \ \ \ \ \textcolor{keywordtype}{char}\ to\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11139}11139\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11140}11140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].from\_col,\ from\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11141}11141\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].to\_row,\ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11142}11142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11143}11143\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11144}11144\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11145}11145\ \ \ \ \ offset\ +=\ snprintf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11146}11146\ \ \ \ \ \ \ \ \ buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11147}11147\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}from\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}to\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}piece\(\backslash\)"{}:\(\backslash\)"{}\%c\(\backslash\)"{},\(\backslash\)"{}timestamp\(\backslash\)"{}:\%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11148}11148\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11149}11149\ \ \ \ \ \ \ \ \ from\_notation,\ to\_notation,\ piece\_char,\ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].timestamp);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11150}11150\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11151}11151\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ -\/\ 1\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11152}11152\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11153}11153\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11154}11154\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11155}11155\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11156}11156\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}]\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11157}11157\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11158}11158\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11159}11159\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11160}11160\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11161}11161\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11162}11162\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11163}11163\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11164}11164\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11165}\mbox{\hyperlink{game__task_8c_aa442a40b76d56106f726f76bc210b84e}{11165}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_aa442a40b76d56106f726f76bc210b84e}{game\_get\_captured\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11166}11166\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11167}11167\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11168}11168\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11169}11169\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11170}11170\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11171}11171\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11172}11172\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11173}11173\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11174}11174\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11175}11175\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11176}11176\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11177}11177\ \ \ \textcolor{comment}{//\ Build\ JSON\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11178}11178\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11179}11179\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}white\_captured\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11180}11180\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11181}11181\ \ \ \textcolor{comment}{//\ Add\ white\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11182}11182\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11183}11183\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11184}11184\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\%c\(\backslash\)"{}"{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11185}11185\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11186}11186\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11187}11187\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11188}11188\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11189}11189\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11190}11190\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}],\(\backslash\)"{}black\_captured\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11191}11191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11192}11192\ \ \ \textcolor{comment}{//\ Add\ black\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11193}11193\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11194}11194\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11195}11195\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\%c\(\backslash\)"{}"{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11196}11196\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11197}11197\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11198}11198\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11199}11199\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11200}11200\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11201}11201\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}]\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11202}11202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11203}11203\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11204}11204\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11205}11205\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11206}11206\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11207}11207\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11208}11208\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11209}11209\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11216}\mbox{\hyperlink{game__task_8c_a8aacf784d572f6de13c441c564d8037e}{11216}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a8aacf784d572f6de13c441c564d8037e}{game\_get\_advantage\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11217}11217\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11218}11218\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11219}11219\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11220}11220\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11221}11221\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11222}11222\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11223}11223\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11224}11224\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11225}11225\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11226}11226\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11227}11227\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11228}11228\ \ \ \textcolor{comment}{//\ Build\ JSON:\ \{"{}history"{}:[0,1,2,-\/1,0,...],\ "{}count"{}:42,\ "{}white\_checks"{}:5,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11229}11229\ \ \ \textcolor{comment}{//\ "{}black\_checks"{}:3,\ ...\}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11230}11230\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11231}11231\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}history\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11232}11232\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11233}11233\ \ \ \textcolor{comment}{//\ Add\ advantage\ values}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11234}11234\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11235}11235\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11236}11236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11237}11237\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11238}11238\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11239}11239\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11240}11240\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11241}11241\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11242}11242\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}],\(\backslash\)"{}count\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11243}11243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11244}11244\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11245}11245\ \ \ \textcolor{comment}{//\ Přidat\ další\ statistiky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11246}11246\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11247}11247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}white\_checks\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\(\backslash\)"{}black\_checks\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11248}11248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11249}11249\ \ \ offset\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11250}11250\ \ \ \ \ \ \ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11251}11251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}white\_castles\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\(\backslash\)"{}black\_castles\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11252}11252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11253}11253\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11254}11254\ \ \ \textcolor{comment}{//\ Průměrný\ čas\ na\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11255}11255\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11256}11256\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11257}11257\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11258}11258\ \ \ uint32\_t\ avg\_time\_per\_move\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11259}11259\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ >\ 0)\ ?\ (game\_duration\ /\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11260}11260\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11261}11261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}game\_duration\_ms\(\backslash\)"{}:\%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11262}11262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}avg\_time\_per\_move\_ms\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11263}11263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ avg\_time\_per\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11264}11264\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11265}11265\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11266}11266\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11267}11267\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11268}11268\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11269}11269\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11270}11270\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11271}11271\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11272}11272\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11273}11273\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11274}11274\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11275}11275\ \textcolor{comment}{//\ TIMER\ SYSTEM\ INTEGRATION\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11276}11276\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11277}11277\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11278}\mbox{\hyperlink{game__task_8c_a4373558ca8d873f8a649ab8436720807}{11278}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a4373558ca8d873f8a649ab8436720807}{game\_get\_timer\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11279}11279\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11280}11280\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ buffer\ parameters"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11281}11281\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11282}11282\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11283}11283\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11284}11284\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a902602a46b245d091fd3d474ecde0e82}{timer\_get\_json}}(buffer,\ size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11285}11285\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11286}11286\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11287}\mbox{\hyperlink{game__task_8c_a3784bb9de91bf60f6bff17c25c220c37}{11287}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a3784bb9de91bf60f6bff17c25c220c37}{game\_set\_time\_control}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structtime__control__config__t}{time\_control\_config\_t}}\ *config)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11288}11288\ \ \ \textcolor{keywordflow}{if}\ (config\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11289}11289\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ config\ parameter"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11290}11290\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11291}11291\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11292}11292\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11293}11293\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a158cdf2baa4bc74c696f82e8c610737d}{timer\_set\_time\_control}}(config);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11294}11294\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11295}11295\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Time\ control\ set:\ \%s"{}},\ config-\/>\mbox{\hyperlink{structtime__control__config__t_ac5f05a43dfc9af7383b21d26235c8425}{name}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11296}11296\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11297}11297\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ hra\ aktivní,\ spustit\ timer\ pro\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11298}11298\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11299}11299\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ is\ active,\ starting\ timer\ for\ current\ player"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11300}11300\ \ \ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a23265b63c17ea7990a7362a4d497d6d9}{timer\_start\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11301}11301\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11302}11302\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11303}11303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Game\ state\ is\ \%d\ (not\ active),\ timer\ will\ start\ on\ first\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11304}11304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11305}11305\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11306}11306\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11307}11307\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11308}11308\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11309}11309\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11310}11310\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11311}\mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{11311}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\textcolor{keywordtype}{bool}\ is\_white\_turn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11312}11312\ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11313}11313\ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11314}11314\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ game\_start\_timer\_move\ called:\ is\_white\_turn=\%s,\ current\_player=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11315}11315\ \ \ \ \ \ \ is\_white\_turn\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11316}11316\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11317}11317\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a23265b63c17ea7990a7362a4d497d6d9}{timer\_start\_move}}(is\_white\_turn);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11318}11318\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11319}11319\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Timer\ started\ successfully\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11320}11320\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_turn\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11321}11321\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11322}11322\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ start\ timer\ for\ \%s:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11323}11323\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_turn\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11324}11324\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11325}11325\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11326}11326\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11327}11327\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11328}11328\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11329}\mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{11329}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11330}11330\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a89c7235662a4eeb08b1d5e8b77c58492}{timer\_end\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11331}11331\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11332}11332\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ ended\ for\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11333}11333\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11334}11334\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11335}11335\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11336}11336\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11337}11337\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11338}\mbox{\hyperlink{game__task_8c_a25364833eb80653b4d30414376f3fe35}{11338}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a25364833eb80653b4d30414376f3fe35}{game\_pause\_timer}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11339}11339\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11340}11340\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11341}11341\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ paused"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11342}11342\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11343}11343\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11344}11344\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11345}11345\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11346}11346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11347}\mbox{\hyperlink{game__task_8c_aa1855cbe07e70ad38d0fbd163e7e9746}{11347}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_aa1855cbe07e70ad38d0fbd163e7e9746}{game\_resume\_timer}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11348}11348\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a48d538badd51ca6eca88b2f54ae3f7fe}{timer\_resume}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11349}11349\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11350}11350\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ resumed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11351}11351\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11352}11352\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11353}11353\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11354}11354\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11355}11355\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11356}\mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{11356}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{game\_reset\_timer}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11357}11357\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_ac52afa2de7a6af69f2f67d86af351a05}{timer\_reset}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11358}11358\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11359}11359\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ reset"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11360}11360\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11361}11361\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11362}11362\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11363}11363\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11364}11364\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11365}\mbox{\hyperlink{game__task_8c_aac9b313d5314a9f9c948b466052c1e06}{11365}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aac9b313d5314a9f9c948b466052c1e06}{game\_check\_timer\_timeout}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_aaa24fcf316f295f7a17bf2ff5ed8dd5e}{timer\_check\_timeout}}();\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11366}11366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11367}\mbox{\hyperlink{game__task_8c_a58b489e87078e33ccf75b35d892bb4fe}{11367}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a58b489e87078e33ccf75b35d892bb4fe}{game\_get\_remaining\_time}}(\textcolor{keywordtype}{bool}\ is\_white\_turn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11368}11368\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a3129dee6f4627aead1732185abca4395}{timer\_get\_remaining\_time}}(is\_white\_turn);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11369}11369\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11370}11370\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11371}\mbox{\hyperlink{game__task_8c_af09ae67f3a64e8d2865bac5eb0d7e3ca}{11371}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_af09ae67f3a64e8d2865bac5eb0d7e3ca}{game\_get\_timer\_state}}(\mbox{\hyperlink{structchess__timer__t}{chess\_timer\_t}}\ *timer\_data)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11372}11372\ \ \ \textcolor{keywordflow}{if}\ (timer\_data\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11373}11373\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ timer\_data\ parameter"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11374}11374\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11375}11375\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11376}11376\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11377}11377\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a10198b60b509490f91eee1685ba0d980}{timer\_get\_state}}(timer\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11378}11378\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11379}11379\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11380}\mbox{\hyperlink{game__task_8c_a917f1907b236e1476e75bb033e2a3165}{11380}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a917f1907b236e1476e75bb033e2a3165}{game\_init\_timer\_system}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11381}11381\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Initializing\ timer\ system\ in\ game\ task..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11382}11382\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11383}11383\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a8ad517573ace8a78289a8305b9acb3ea}{timer\_system\_init}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11384}11384\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11385}11385\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ system\ initialized\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11386}11386\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11387}11387\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ initialize\ timer\ system:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11388}11388\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11389}11389\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11390}11390\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11391}11391\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11392}11392\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11393}11393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11394}\mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{11394}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11395}11395\ \ \ \textcolor{keywordflow}{if}\ (cmd\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11396}11396\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ command\ parameter"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11397}11397\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11398}11398\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11399}11399\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11400}11400\ \ \ esp\_err\_t\ ret\ =\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11401}11401\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11402}11402\ \ \ \textcolor{keywordflow}{switch}\ (cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11403}11403\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a0ba09395c8b55913ce75adb28ac19003}{GAME\_CMD\_SET\_TIME\_CONTROL}}:\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11404}11404\ \ \ \ \ \mbox{\hyperlink{structtime__control__config__t}{time\_control\_config\_t}}\ config;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11405}11405\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97}{time\_control\_type\_t}}\ type\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11406}11406\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97}{time\_control\_type\_t}})cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a2e078f65d1fab8a9ebd51547cd733fd9}{timer\_data}}.\mbox{\hyperlink{structchess__move__command__t_ae05888f64383039d1414ffa36ae22aa9}{timer\_config}}.\mbox{\hyperlink{structchess__move__command__t_a19b5d713be6ea325b1121180f0382263}{time\_control\_type}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11407}11407\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11408}11408\ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97ad913e6fe488ef15d0d74676c2f09cef0}{TIME\_CONTROL\_CUSTOM}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11409}11409\ \ \ \ \ \ \ \textcolor{comment}{//\ Vlastní\ časová\ kontrola}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11410}11410\ \ \ \ \ \ \ ret\ =\ \mbox{\hyperlink{timer__system_8h_a11ab1bc968801095ba83fad279c4d282}{timer\_set\_custom\_time\_control}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11411}11411\ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a2e078f65d1fab8a9ebd51547cd733fd9}{timer\_data}}.\mbox{\hyperlink{structchess__move__command__t_ae05888f64383039d1414ffa36ae22aa9}{timer\_config}}.\mbox{\hyperlink{structchess__move__command__t_ab1469d3613ac521e6521da4c7fabad75}{custom\_minutes}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11412}11412\ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a2e078f65d1fab8a9ebd51547cd733fd9}{timer\_data}}.\mbox{\hyperlink{structchess__move__command__t_ae05888f64383039d1414ffa36ae22aa9}{timer\_config}}.\mbox{\hyperlink{structchess__move__command__t_aa66efcd3b24e2c130ede000aca79466d}{custom\_increment}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11413}11413\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11414}11414\ \ \ \ \ \ \ \textcolor{comment}{//\ Předdefinovaná\ časová\ kontrola}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11415}11415\ \ \ \ \ \ \ ret\ =\ \mbox{\hyperlink{timer__system_8h_acc36d1000e481c6d6062135a9f115d40}{timer\_get\_config\_by\_type}}(type,\ \&config);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11416}11416\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11417}11417\ \ \ \ \ \ \ \ \ ret\ =\ \mbox{\hyperlink{timer__system_8h_a158cdf2baa4bc74c696f82e8c610737d}{timer\_set\_time\_control}}(\&config);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11418}11418\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11419}11419\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11420}11420\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11421}11421\ \ \ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11422}11422\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Time\ control\ command\ processed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11423}11423\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11424}11424\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ process\ time\ control\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11425}11425\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11426}11426\ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11427}11427\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11428}11428\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a04714aa90de7f3ace2585fe01cf67659}{GAME\_CMD\_PAUSE\_TIMER}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11429}11429\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_a25364833eb80653b4d30414376f3fe35}{game\_pause\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11430}11430\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11431}11431\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11432}11432\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a19a04a30f9a17d5a85cd43db2b1e298a}{GAME\_CMD\_RESUME\_TIMER}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11433}11433\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_aa1855cbe07e70ad38d0fbd163e7e9746}{game\_resume\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11434}11434\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11435}11435\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11436}11436\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4aee7fca1d1758d39255d3b023f569313d}{GAME\_CMD\_RESET\_TIMER}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11437}11437\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{game\_reset\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11438}11438\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11439}11439\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11440}11440\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ae152c62fc7eae57cbf8fc14a3ff749e2}{GAME\_CMD\_GET\_TIMER\_STATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11441}11441\ \ \ \ \ \textcolor{comment}{//\ Timer\ state\ je\ získáván\ přes\ JSON\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11442}11442\ \ \ \ \ ret\ =\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11443}11443\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11444}11444\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11445}11445\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a1963a76107560b25595a00d47b103534}{GAME\_CMD\_TIMER\_TIMEOUT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11446}11446\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{game\_handle\_time\_expiration}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11447}11447\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11448}11448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11449}11449\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11450}11450\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Unknown\ timer\ command:\ \%d"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11451}11451\ \ \ \ \ ret\ =\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11452}11452\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11453}11453\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11454}11454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11455}11455\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11456}11456\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11457}11457\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11458}\mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{11458}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{game\_handle\_time\_expiration}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11459}11459\ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏰\ Time\ expired!\ Handling\ timeout..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11460}11460\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11461}11461\ \ \ \textcolor{comment}{//\ Získat\ stav\ timeru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11462}11462\ \ \ \mbox{\hyperlink{structchess__timer__t}{chess\_timer\_t}}\ timer\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11463}11463\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a10198b60b509490f91eee1685ba0d980}{timer\_get\_state}}(\&timer\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11464}11464\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11465}11465\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ get\ timer\ state"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11466}11466\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11467}11467\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11468}11468\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11469}11469\ \ \ \textcolor{comment}{//\ Určit\ vítěze}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11470}11470\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =\ timer\_data.\mbox{\hyperlink{structchess__timer__t_a5fbbe88e66de5ea14c6570f5526a39ae}{is\_white\_turn}}\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11471}11471\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\_name\ =\ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11472}11472\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *loser\_name\ =\ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11473}11473\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11474}11474\ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ \%s\ wins\ by\ timeout!\ \%s\ ran\ out\ of\ time."{}},\ winner\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11475}11475\ \ \ \ \ \ \ \ \ \ \ \ loser\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11476}11476\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11477}11477\ \ \ \textcolor{comment}{//\ Ukončit\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11478}11478\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11479}11479\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11480}11480\ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11481}11481\ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}}\ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11482}11482\ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}};\ \textcolor{comment}{//\ ✅\ Označit\ jako\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11483}11483\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11484}11484\ \ \ \textcolor{comment}{//\ ✅\ FIX:\ Požadavek\ na\ endgame\ report\ (stejný\ fix\ jako\ u\ resignation)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11485}11485\ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11486}11486\ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11487}11487\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11488}11488\ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11489}11489\ \ \ \textcolor{keywordflow}{if}\ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11490}11490\ \ \ \ \ \mbox{\hyperlink{game__led__animations_8c_a512b0ba5745a638b00545a16423c4e17}{start\_endgame\_animation}}(\mbox{\hyperlink{game__led__animations_8h_a30603ef39ed3a32a5ae1be1274874159a7559cb124fcc149b6ba6375635c70757}{ENDGAME\_ANIM\_VICTORY\_WAVE}},\ 27);\ \textcolor{comment}{//\ d4\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11491}11491\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11492}11492\ \ \ \ \ \mbox{\hyperlink{game__led__animations_8c_a512b0ba5745a638b00545a16423c4e17}{start\_endgame\_animation}}(\mbox{\hyperlink{game__led__animations_8h_a30603ef39ed3a32a5ae1be1274874159a7559cb124fcc149b6ba6375635c70757}{ENDGAME\_ANIM\_VICTORY\_WAVE}},\ 27);\ \textcolor{comment}{//\ d4\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11493}11493\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11494}11494\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11495}11495\ \ \ \textcolor{comment}{//\ Zobrazit\ výsledek\ na\ LED\ (použít\ existující\ LED\ funkce)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11496}11496\ \ \ \textcolor{comment}{//\ led\_show\_game\_result(game\_result);\ //\ Funkce\ neexistuje}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11497}11497\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11498}11498\ \ \ \textcolor{comment}{//\ Pozastavit\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11499}11499\ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11500}11500\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11501}11501\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ ended\ due\ to\ timeout.\ Winner:\ \%s"{}},\ winner\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11502}11502\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11503}11503\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11504}11504\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11505}11505\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11506}\mbox{\hyperlink{game__task_8c_aab2504466c50dfa9455e1414810bc073}{11506}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_aab2504466c50dfa9455e1414810bc073}{game\_update\_timer\_display}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11507}11507\ \ \ \textcolor{comment}{//\ Kontrola\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11508}11508\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{timer__system_8h_aaa24fcf316f295f7a17bf2ff5ed8dd5e}{timer\_check\_timeout}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11509}11509\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{game\_handle\_time\_expiration}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11510}11510\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11511}11511\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11512}11512\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11513}11513\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11514}11514\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11515}\mbox{\hyperlink{game__task_8c_a7d42316d2411ec24cc4ccbae29fa3cd9}{11515}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a7d42316d2411ec24cc4ccbae29fa3cd9}{game\_get\_available\_time\_controls}}(\mbox{\hyperlink{structtime__control__config__t}{time\_control\_config\_t}}\ *controls,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11516}11516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ max\_count)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11517}11517\ \ \ \textcolor{keywordflow}{if}\ (controls\ ==\ NULL\ ||\ max\_count\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11518}11518\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11519}11519\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11520}11520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11521}11521\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a737397401ab70e21a2979653e14837e6}{timer\_get\_available\_controls}}(controls,\ max\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11522}11522\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11523}11523\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11524}\mbox{\hyperlink{game__task_8c_a66ce03930668ef5869101bef9e2a8474}{11524}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a66ce03930668ef5869101bef9e2a8474}{game\_set\_custom\_time\_control}}(uint32\_t\ minutes,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11525}11525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ increment\_seconds)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11526}11526\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a11ab1bc968801095ba83fad279c4d282}{timer\_set\_custom\_time\_control}}(minutes,\ increment\_seconds);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11527}11527\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11528}11528\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11529}\mbox{\hyperlink{game__task_8c_af61ca7975c281efd16bd95628b65bd5e}{11529}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_af61ca7975c281efd16bd95628b65bd5e}{game\_get\_timer\_stats}}(uint32\_t\ *total\_moves,\ uint32\_t\ *avg\_move\_time)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11530}11530\ \ \ \textcolor{keywordflow}{if}\ (total\_moves\ ==\ NULL\ ||\ avg\_move\_time\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11531}11531\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ parameters"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11532}11532\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11533}11533\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11534}11534\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11535}11535\ \ \ *total\_moves\ =\ \mbox{\hyperlink{timer__system_8h_a1e23fdb509bdce625a0de3e5ce093fba}{timer\_get\_total\_moves}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11536}11536\ \ \ *avg\_move\_time\ =\ \mbox{\hyperlink{timer__system_8h_a918dfb50c8da934336dc81cf36c28a08}{timer\_get\_average\_move\_time}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11537}11537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11538}11538\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11539}11539\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11540}11540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11541}\mbox{\hyperlink{game__task_8c_a2f01e5a8d282157e3cd8bd5a03b9c8b5}{11541}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a2f01e5a8d282157e3cd8bd5a03b9c8b5}{game\_is\_timer\_active}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a0812f137aa77d3f66c950c1b98505e20}{timer\_is\_active}}();\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11542}11542\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11543}\mbox{\hyperlink{game__task_8c_a7fb22aa3cdacc593dccf7d95db908750}{11543}}\ \mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97}{time\_control\_type\_t}}\ \mbox{\hyperlink{game__task_8c_a7fb22aa3cdacc593dccf7d95db908750}{game\_get\_current\_time\_control\_type}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11544}11544\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_af9ad41921ea1477b929f7dd703b71adc}{timer\_get\_current\_type}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11545}11545\ \}}

\end{DoxyCode}
