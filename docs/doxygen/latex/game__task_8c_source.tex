\doxysection{game\+\_\+task.\+c}
\hypertarget{game__task_8c_source}{}\label{game__task_8c_source}\index{game\_task.c@{game\_task.c}}
\mbox{\hyperlink{game__task_8c}{Zobrazit dokumentaci tohoto souboru.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00159}00159\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00160}00160\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{game__task_8h}{game\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00161}00161\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{button__task_8h}{../button\_task/include/button\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00162}00162\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{chess__types_8h}{../freertos\_chess/include/chess\_types.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00163}00163\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{streaming__output_8h}{../freertos\_chess/include/streaming\_output.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00164}00164\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{led__task_8h}{../led\_task/include/led\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00165}00165\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{matrix__task_8h}{../matrix\_task/include/matrix\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00166}00166\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{unified__animation__manager_8h}{../unified\_animation\_manager/include/unified\_animation\_manager.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00167}00167\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{freertos__chess_8h}{freertos\_chess.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00168}00168\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{game__led__animations_8h}{game\_led\_animations.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00169}00169\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{led__mapping_8h}{led\_mapping.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00170}00170\ \textcolor{comment}{//\ Timer\ system\ integration}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00171}00171\ \textcolor{preprocessor}{\#include\ "{}../../timer\_system/include/timer\_system.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00172}00172\ \textcolor{comment}{//\ ANSI\ color\ formatting\ macros}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00173}00173\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{game__colors_8h}{game\_colors.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00174}00174\ \textcolor{comment}{//\ HA\ Light\ Task\ integration}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00175}00175\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ha__light__task_8h}{../ha\_light\_task/include/ha\_light\_task.h}}"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00176}00176\ \textcolor{comment}{//\ Note:\ animation\_task.h\ is\ not\ included\ to\ avoid\ type\ conflicts\ with}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00177}00177\ \textcolor{comment}{//\ unified\_animation\_manager}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00178}00178\ \textcolor{preprocessor}{\#include\ "{}esp\_log.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00179}00179\ \textcolor{preprocessor}{\#include\ "{}esp\_task\_wdt.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00180}00180\ \textcolor{preprocessor}{\#include\ "{}esp\_timer.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00181}00181\ \textcolor{preprocessor}{\#include\ "{}freertos/queue.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00182}00182\ \textcolor{preprocessor}{\#include\ "{}freertos/semphr.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00183}00183\ \textcolor{preprocessor}{\#include\ "{}freertos/task.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00184}00184\ \textcolor{preprocessor}{\#include\ "{}freertos/timers.h"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00185}00185\ \textcolor{preprocessor}{\#include\ <inttypes.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00186}00186\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00187}00187\ \textcolor{preprocessor}{\#include\ <stdbool.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00188}00188\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00189}00189\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00190}00190\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00191}00191\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00193}\mbox{\hyperlink{game__task_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{00193}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}}\ =\ \textcolor{stringliteral}{"{}GAME\_TASK"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00194}00194\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00195}00195\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00196}00196\ \textcolor{comment}{//\ WDT\ WRAPPER\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00197}00197\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00198}00198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00213}\mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{00213}}\ \textcolor{keyword}{static}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00214}00214\ \ \ esp\_err\_t\ ret\ =\ esp\_task\_wdt\_reset();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00215}00215\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00216}00216\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_ERR\_NOT\_FOUND)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00217}00217\ \ \ \ \ \textcolor{comment}{//\ Log\ as\ WARNING\ instead\ of\ ERROR\ -\/\ task\ not\ registered\ yet}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00218}00218\ \ \ \ \ ESP\_LOGW(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00219}00219\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00220}00220\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}WDT\ reset:\ task\ not\ registered\ yet\ (this\ is\ normal\ during\ startup)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00221}00221\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;\ \textcolor{comment}{//\ Treat\ as\ success\ for\ our\ purposes}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00222}00222\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00223}00223\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}WDT\ reset\ failed:\ \%s"{}},\ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00224}00224\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00225}00225\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00227}00227\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00228}00228\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00229}00229\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00230}00230\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00231}00231\ \textcolor{comment}{//\ LOCAL\ VARIABLES\ AND\ CONSTANTS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00232}00232\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00234}00234\ \textcolor{comment}{//\ Direction\ vectors\ for\ piece\ movement}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00235}\mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{00235}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[8][2]\ =\ \{\{-\/2,\ -\/1\},\ \{-\/2,\ 1\},\ \{-\/1,\ -\/2\},\ \{-\/1,\ 2\},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00236}00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{1,\ -\/2\},\ \ \{1,\ 2\},\ \ \{2,\ -\/1\},\ \ \{2,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00237}00237\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00238}00238\ \textcolor{comment}{//\ Game\ configuration}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00239}\mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{00239}}\ \textcolor{preprocessor}{\#define\ MAX\_MOVES\_HISTORY\ 200\ }\textcolor{comment}{//\ Maximum\ moves\ to\ remember}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00240}00240\ \textcolor{comment}{//\ \#define\ GAME\_TIMEOUT\_MS\ 300000\ //\ 5\ minutes\ per\ move\ timeout\ \ \ not\ used\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00241}00241\ \textcolor{comment}{//\ this\ version}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00242}\mbox{\hyperlink{game__task_8c_a2e965abc7c554be97017710630e9e0b7}{00242}}\ \textcolor{preprocessor}{\#define\ MOVE\_VALIDATION\_MS\ 100\ }\textcolor{comment}{//\ Move\ validation\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00244}00244\ \textcolor{comment}{//\ Game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00245}\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{00245}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00246}\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{00246}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00247}\mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{00247}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00248}00248\ \textcolor{comment}{//\ New\ logic:\ Block\ auto-\/new\ game\ until\ at\ least\ one\ move\ is\ made}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00249}\mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{00249}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00250}00250\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00251}00251\ \textcolor{comment}{//\ Simplified\ castling\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00252}\mbox{\hyperlink{structcastling__state__t}{00252}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00253}\mbox{\hyperlink{structcastling__state__t_a1705abfdc6a05d4bec2293871b7b7fd1}{00253}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structcastling__state__t_a1705abfdc6a05d4bec2293871b7b7fd1}{in\_progress}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rošáda\ probíhá}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00254}\mbox{\hyperlink{structcastling__state__t_afde7ce6130b7476c3bc926c09e267d10}{00254}}\ \ \ uint8\_t\ \mbox{\hyperlink{structcastling__state__t_a5487d6de95e717db3a49bf0ed4aed5fd}{rook\_from\_row}},\ \mbox{\hyperlink{structcastling__state__t_afde7ce6130b7476c3bc926c09e267d10}{rook\_from\_col}};\ \textcolor{comment}{//\ Pozice\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00255}\mbox{\hyperlink{structcastling__state__t_a3f6d980f0e18ee2f5df5907b82d500a0}{00255}}\ \ \ uint8\_t\ \mbox{\hyperlink{structcastling__state__t_a4744be90f6da3461a00f214616844512}{rook\_to\_row}},\ \mbox{\hyperlink{structcastling__state__t_a3f6d980f0e18ee2f5df5907b82d500a0}{rook\_to\_col}};\ \ \ \ \ \textcolor{comment}{//\ Cíl\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00256}\mbox{\hyperlink{structcastling__state__t_ac32cc33e24d53fff7f4bca524ceceb1d}{00256}}\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{structcastling__state__t_ac32cc33e24d53fff7f4bca524ceceb1d}{player}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hráč,\ který\ provádí\ rošádu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00257}\mbox{\hyperlink{structcastling__state__t_aae2796ad5c3e40911c0c4002c77190ff}{00257}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structcastling__state__t_aae2796ad5c3e40911c0c4002c77190ff}{is\_kingside}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ to\ kingside\ rošáda?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00258}00258\ \}\ \mbox{\hyperlink{structcastling__state__t}{castling\_state\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00260}\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{00260}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structcastling__state__t}{castling\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00261}00261\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00262}00262\ \textcolor{comment}{//\ Active\ castling\ state\ (simplified\ implementation)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00263}\mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{00263}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00264}\mbox{\hyperlink{game__task_8c_aec956796e1629a92f299b1725070b1c2}{00264}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ \mbox{\hyperlink{game__task_8c_aec956796e1629a92f299b1725070b1c2}{pending\_castle\_move}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00265}00265\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00266}00266\ \textcolor{comment}{//\ Rook\ animation\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00267}\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{00267}}\ \textcolor{keyword}{static}\ TimerHandle\_t\ \mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00268}\mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{00268}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00269}\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{00269}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00271}00271\ \textcolor{comment}{//\ Board\ representation\ (8x8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00272}\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{00272}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[8][8]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00273}\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{00273}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[8][8]\ =\ \{\textcolor{keyword}{false}\};\ \textcolor{comment}{//\ Track\ if\ pieces\ have\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00274}00274\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00275}00275\ \textcolor{comment}{//\ Global\ variables\ for\ tracking\ lifted\ piece\ (UP/DN\ commands)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00276}\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{00276}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00277}\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{00277}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00278}\mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{00278}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00279}\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{00279}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00280}00280\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00281}00281\ \textcolor{comment}{//\ 3-\/step\ capture\ flow\ state.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00282}\mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{00282}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Je\ rozpracovaný\ capture?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00283}\mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{00283}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ 0;\ \ \ \textcolor{comment}{//\ Kam\ se\ má\ položit\ vlastní\ figurka}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00284}\mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{00284}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00285}\mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{00285}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00286}00286\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};\ \textcolor{comment}{//\ Jaká\ figurka\ byla\ odebrána}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00287}00287\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00288}00288\ \textcolor{comment}{//\ Proměnné\ pro\ tracking\ opponent\ piece\ (když\ se\ zvedne\ figurka}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00289}00289\ \textcolor{comment}{//\ nehrajícího\ hráče)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00290}\mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{00290}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00291}\mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{00291}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00292}\mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{00292}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00293}\mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{00293}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00294}\mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{00294}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00295}\mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{00295}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00296}00296\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00297}00297\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00298}00298\ \textcolor{comment}{//\ AUTO\ NEW\ GAME\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00299}00299\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00300}00300\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00307}\mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{00307}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00308}\mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{00308}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{auto\_new\_game\_timer\_start}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00309}\mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{00309}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Flag\ aby\ se\ neopakoval\ reset}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00310}00310\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00311}\mbox{\hyperlink{game__task_8c_ab5d37ae881c4c3c8d9ac1a35e00e7b71}{00311}}\ \textcolor{preprocessor}{\#define\ AUTO\_NEW\_GAME\_CONFIRMATION\_TIME\_MS\ 2000\ }\textcolor{comment}{//\ 2\ sekundy}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00312}00312\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00313}00313\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00314}00314\ \textcolor{comment}{//\ DEMO\ MODE\ STATE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00315}00315\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00323}00323\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00324}00324\ \textcolor{comment}{//\ Castling\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00325}\mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{00325}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00326}\mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{00326}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ a1\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00327}\mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{00327}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ h1\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00328}\mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{00328}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00329}\mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{00329}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ a8\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00330}\mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{00330}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ h8\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00331}00331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00332}00332\ \textcolor{comment}{//\ En\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00333}\mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{00333}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00334}\mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{00334}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00335}\mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{00335}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00336}\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{00336}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00337}\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{00337}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00338}00338\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00339}00339\ \textcolor{comment}{//\ Move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00340}\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{00340}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00341}\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{00341}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00342}00342\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00343}00343\ \textcolor{comment}{//\ Task\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00344}\mbox{\hyperlink{game__task_8c_a35141cb45623cb3b7b4d96da35ed1831}{00344}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{animation__task_8c_a35141cb45623cb3b7b4d96da35ed1831}{task\_running}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00345}\mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{00345}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00346}00346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00347}00347\ \textcolor{comment}{//\ \ Error\ handling\ -\/\ pamatování\ posledního\ validního\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00348}00348\ \textcolor{comment}{//\ Enhanced\ error\ recovery\ state\ for\ smart\ error\ handling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00349}00349\ \textcolor{keyword}{static}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00350}\mbox{\hyperlink{game__task_8c_aaf8f442c7b06c825971fa6dc67e06e66}{00350}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aaf8f442c7b06c825971fa6dc67e06e66}{has\_invalid\_piece}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ figurka\ na\ neplatném\ poli?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00351}\mbox{\hyperlink{game__task_8c_a571899e94ee6d82dbb7aae2c9038279d}{00351}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a3bc97aa032f065584d497d64d124632e}{invalid\_row}},\ \mbox{\hyperlink{game__task_8c_a571899e94ee6d82dbb7aae2c9038279d}{invalid\_col}};\ \textcolor{comment}{//\ Aktuální\ neplatná\ pozice\ (červené\ pole)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00352}\mbox{\hyperlink{game__task_8c_ae084bf0ad7337f75ef248cbeffa96672}{00352}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_ae084bf0ad7337f75ef248cbeffa96672}{original\_valid\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00353}\mbox{\hyperlink{game__task_8c_ad7a22cba87b0f065d0e829f5e2ce887f}{00353}}\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad7a22cba87b0f065d0e829f5e2ce887f}{original\_valid\_col}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PŮVODNÍ\ validní\ pozice\ (nikdy\ se\ nezmění)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00354}\mbox{\hyperlink{game__task_8c_a60252451b47846f576a0ceb38633b917}{00354}}\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a60252451b47846f576a0ceb38633b917}{piece\_type}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Typ\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00355}\mbox{\hyperlink{game__task_8c_a0d6232ac151a791249d00522a315fdb3}{00355}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a0d6232ac151a791249d00522a315fdb3}{waiting\_for\_move\_correction}};\ \textcolor{comment}{//\ Čekáme\ na\ opravu\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00356}\mbox{\hyperlink{game__task_8c_a2029e9c9788de523ece2dabbc7ffe2c7}{00356}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a2029e9c9788de523ece2dabbc7ffe2c7}{error\_count}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Počítadlo\ chyb\ za\ sebou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00357}\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{00357}}\ \}\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}\ =\ \{\textcolor{keyword}{false},\ 0,\ 0,\ 0,\ 0,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}},\ \textcolor{keyword}{false},\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00358}00358\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00359}00359\ \textcolor{comment}{//\ NON-\/BLOCKING\ BLINK\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00360}\mbox{\hyperlink{structnon__blocking__blink__state__t}{00360}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00361}\mbox{\hyperlink{structnon__blocking__blink__state__t_ab2f4b6e5b386172f4152b49577696639}{00361}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structnon__blocking__blink__state__t_ab2f4b6e5b386172f4152b49577696639}{active}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00362}\mbox{\hyperlink{structnon__blocking__blink__state__t_a3d80bb44fac9c31373935f46b262978d}{00362}}\ \ \ uint8\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_a3d80bb44fac9c31373935f46b262978d}{led\_index}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00363}\mbox{\hyperlink{structnon__blocking__blink__state__t_a2cf6726c9629b2c9bd5ca4e34c368c01}{00363}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_a2cf6726c9629b2c9bd5ca4e34c368c01}{blink\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00364}\mbox{\hyperlink{structnon__blocking__blink__state__t_aecbf1a19f84e9e158e66165b9eb949cc}{00364}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_aecbf1a19f84e9e158e66165b9eb949cc}{max\_blinks}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00365}\mbox{\hyperlink{structnon__blocking__blink__state__t_aa4a0712510b6821b0a1367da1149b74f}{00365}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_aa4a0712510b6821b0a1367da1149b74f}{last\_toggle\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00366}\mbox{\hyperlink{structnon__blocking__blink__state__t_a3ff35a22d08f76595b205492b88c0409}{00366}}\ \ \ uint32\_t\ \mbox{\hyperlink{structnon__blocking__blink__state__t_a3ff35a22d08f76595b205492b88c0409}{blink\_interval\_ms}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00367}\mbox{\hyperlink{structnon__blocking__blink__state__t_ac30c937f5ac9092e85e8a313fb94830c}{00367}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structnon__blocking__blink__state__t_ac30c937f5ac9092e85e8a313fb94830c}{led\_state}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00368}00368\ \}\ \mbox{\hyperlink{structnon__blocking__blink__state__t}{non\_blocking\_blink\_state\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00369}00369\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00370}\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{00370}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structnon__blocking__blink__state__t}{non\_blocking\_blink\_state\_t}}\ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}\ =\ \{\textcolor{keyword}{false},\ 0,\ \ \ 0,\ \ \ \ 10,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00371}00371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \ \ \ \ 300,\ \textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00372}00372\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00373}00373\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00374}00374\ \textcolor{comment}{//\ PROMOTION\ STATE\ -\/\ PHYSICAL\ BUTTON\ SUPPORT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00375}00375\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00376}00376\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00383}00383\ \textcolor{keyword}{static}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00384}\mbox{\hyperlink{game__task_8c_a39f16d585c4531d2bf2562631a775d73}{00384}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a39f16d585c4531d2bf2562631a775d73}{pending}};\ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ promoce\ mozna/ceka\ se\ na\ ni?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00385}\mbox{\hyperlink{game__task_8c_a6ff5d035c17e8a98f013994186eca92b}{00385}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a6ff5d035c17e8a98f013994186eca92b}{square\_row}};\ \textcolor{comment}{//\ Radek\ s\ pescem\ k\ promoci\ (0\ nebo\ 7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00386}\mbox{\hyperlink{game__task_8c_a196aae5a38f9e4efbf2b30c0958d62cd}{00386}}\ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a196aae5a38f9e4efbf2b30c0958d62cd}{square\_col}};\ \textcolor{comment}{//\ Sloupec\ s\ pescem\ k\ promoci\ (0-\/7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00387}\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{00387}}\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}};\ \ \ \ \textcolor{comment}{//\ Hrac\ ktery\ ma\ promovat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00388}\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{00388}}\ \}\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}\ =\ \{\textcolor{keyword}{false},\ 0,\ 0,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00389}00389\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00390}00390\ \textcolor{comment}{//\ Mutex\ to\ protect\ promotion\_state\ from\ race\ conditions.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00391}00391\ \textcolor{comment}{//\ Prevents\ concurrent\ access\ from\ web,\ UART,\ button,\ and\ matrix\ tasks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00392}\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{00392}}\ \textcolor{keyword}{static}\ SemaphoreHandle\_t\ \mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00393}00393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00394}00394\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00395}00395\ \textcolor{comment}{//\ KING\ RESIGNATION\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00396}00396\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00397}00397\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00398}\mbox{\hyperlink{structking__resignation__state__t}{00398}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00399}\mbox{\hyperlink{structking__resignation__state__t_a1186d33a02c7b828ad090842484f8f8c}{00399}}\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structking__resignation__state__t_a1186d33a02c7b828ad090842484f8f8c}{active}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ resignation\ timer\ aktivní?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00400}\mbox{\hyperlink{structking__resignation__state__t_aae1c259379dddc3435700259e5bebe8a}{00400}}\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{structking__resignation__state__t_aae1c259379dddc3435700259e5bebe8a}{player}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Který\ hráč\ drží\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00401}\mbox{\hyperlink{structking__resignation__state__t_a37e62616ed1e01e5461649b7fbe074e2}{00401}}\ \ \ uint8\_t\ \mbox{\hyperlink{structking__resignation__state__t_a8aa2d198aefd1c851caa794ed1c1af41}{king\_row}},\ \mbox{\hyperlink{structking__resignation__state__t_a37e62616ed1e01e5461649b7fbe074e2}{king\_col}};\ \ \ \ \textcolor{comment}{//\ Pozice\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00402}\mbox{\hyperlink{structking__resignation__state__t_ad466ba868c959c1683c6d3a8545380d0}{00402}}\ \ \ TimerHandle\_t\ \mbox{\hyperlink{structking__resignation__state__t_ad466ba868c959c1683c6d3a8545380d0}{main\_timer}};\ \ \ \ \ \ \textcolor{comment}{//\ Hlavní\ 10s\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00403}\mbox{\hyperlink{structking__resignation__state__t_a1c717d8def9f7fdab3de11b94f78fd8a}{00403}}\ \ \ TimerHandle\_t\ \mbox{\hyperlink{structking__resignation__state__t_a1c717d8def9f7fdab3de11b94f78fd8a}{animation\_timer}};\ \textcolor{comment}{//\ LED\ animation\ timer\ (50ms\ periodic)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00404}\mbox{\hyperlink{structking__resignation__state__t_a3405dda1390652be995ba6af7ad4db56}{00404}}\ \ \ uint64\_t\ \mbox{\hyperlink{structking__resignation__state__t_a3405dda1390652be995ba6af7ad4db56}{start\_time\_ms}};\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Čas\ startu\ (pro\ výpočet\ elapsed)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00405}\mbox{\hyperlink{structking__resignation__state__t_aaf4fec46a7bd11bc464a3a3b22d21c9d}{00405}}\ \ \ uint8\_t\ \mbox{\hyperlink{structking__resignation__state__t_aaf4fec46a7bd11bc464a3a3b22d21c9d}{last\_countdown\_sec}};\ \ \ \ \textcolor{comment}{//\ Poslední\ vypsaná\ sekunda\ (pro\ countdown)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00406}00406\ \}\ \mbox{\hyperlink{structking__resignation__state__t}{king\_resignation\_state\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00407}00407\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00408}\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{00408}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structking__resignation__state__t}{king\_resignation\_state\_t}}\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}\ =\ \{.active\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .king\_row\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .king\_col\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .main\_timer\ =\ NULL,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .animation\_timer\ =\ NULL,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .start\_time\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_countdown\_sec\ =\ 10\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00416}00416\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00417}00417\ \textcolor{comment}{//\ Forward\ declarations\ pro\ resignation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00418}00418\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{resignation\_main\_timer\_callback}}(TimerHandle\_t\ xTimer)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00419}00419\ \ \ \ \ \mbox{\hyperlink{freertos__chess_8c_a43c4623c2553d09a59385aabe971d75d}{\_\_attribute\_\_}}((unused));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00420}00420\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{resignation\_animation\_timer\_callback}}(TimerHandle\_t\ xTimer)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00421}00421\ \ \ \ \ \mbox{\hyperlink{freertos__chess_8c_a43c4623c2553d09a59385aabe971d75d}{\_\_attribute\_\_}}((unused));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00422}00422\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{resignation\_start}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ uint8\_t\ row,\ uint8\_t\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00423}00423\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keywordtype}{bool}\ finalize);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00424}00424\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{resignation\_update\_button\_leds}}(uint32\_t\ elapsed\_ms);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00425}00425\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a3bf81752bb1e6c0587cfdb9804f883be}{resignation\_tick}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00426}00426\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5e2939300449fca26ad46d2a04e6ec08}{resignation\_finalize\_timeout}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00427}00427\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00428}00428\ \textcolor{comment}{//\ Forward\ declarations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00429}00429\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00430}00430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00431}00431\ \textcolor{comment}{//\ Game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00432}\mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{00432}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00433}\mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{00433}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00434}\mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{00434}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00435}\mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{00435}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00436}00436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00437}00437\ \textcolor{comment}{//\ Flag\ pro\ endgame\ report\ request\ (místo\ volání\ z\ timer\ callbacku)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00438}\mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{00438}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00439}00439\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00440}00440\ \textcolor{comment}{//\ Typ\ konce\ hry\ pro\ lepší\ rozlišení\ v\ reportu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00441}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63ca}{00441}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00442}00442\ \ \ \textcolor{comment}{//\ Checkmate\ variations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00443}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{00443}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}}\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00444}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{00444}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}}\ =\ 1,\ \textcolor{comment}{//\ Šachmat\ pomocí\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00445}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{00445}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}}\ =\ 2,\ \ \ \textcolor{comment}{//\ Šachmat\ pomocí\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00446}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{00446}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}}\ =\ 3,\ \ \textcolor{comment}{//\ Šachmat\ po\ promoci\ pěšce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00447}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{00447}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}}\ =\ 4,\ \textcolor{comment}{//\ Šachmat\ odkrytým\ šachem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00448}00448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00449}00449\ \ \ \textcolor{comment}{//\ Draw\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00450}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{00450}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}}\ =\ 10,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00451}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{00451}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}}\ =\ 11,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00452}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{00452}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}}\ =\ 12,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00453}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{00453}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}}\ =\ 13,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00454}00454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00455}00455\ \ \ \textcolor{comment}{//\ Player\ actions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00456}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{00456}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}}\ =\ 20,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00457}\mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{00457}}\ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}}\ =\ 21}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00458}00458\ \}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63ca}{endgame\_reason\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00459}00459\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00460}\mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{00460}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63ca}{endgame\_reason\_t}}\ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00461}00461\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00462}00462\ \textcolor{comment}{//\ Typ\ posledního\ tahu\ pro\ detekci\ speciálních\ šachmatů}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00463}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428}{00463}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00464}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{00464}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}}\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00465}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{00465}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{LAST\_MOVE\_EN\_PASSANT}}\ =\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00466}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{00466}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}}\ =\ 2,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00467}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{00467}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{LAST\_MOVE\_PROMOTION}}\ =\ 3,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00468}\mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a1f704b3fdc9edf5defa5ca3f23fef635}{00468}}\ \ \ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a1f704b3fdc9edf5defa5ca3f23fef635}{LAST\_MOVE\_DISCOVERED}}\ =\ 4}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00469}00469\ \}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428}{last\_move\_type\_t}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00470}00470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00471}\mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{00471}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428}{last\_move\_type\_t}}\ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00472}00472\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00473}00473\ \textcolor{comment}{//\ Extended\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00474}\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{00474}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00475}\mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{00475}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00476}\mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{00476}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00477}\mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{00477}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00478}\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{00478}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00479}\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{00479}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00480}\mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{00480}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00481}\mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{00481}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00482}\mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{00482}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00483}\mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{00483}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00484}\mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{00484}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00485}\mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{00485}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00486}00486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00487}00487\ \textcolor{comment}{//\ Captured\ pieces\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00488}\mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{00488}}\ \textcolor{preprocessor}{\#define\ MAX\_CAPTURED\_PIECES\ 16}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00489}\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{00489}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00490}\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{00490}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00491}\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{00491}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00492}\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{00492}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00493}\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{00493}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00494}\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{00494}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00495}00495\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00496}00496\ \textcolor{comment}{//\ Material\ advantage\ tracking\ (pro\ graf\ výhody\ v\ průběhu\ hry)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00497}\mbox{\hyperlink{game__task_8c_a80792d272b6a0d629d67d2a0cf00f55a}{00497}}\ \textcolor{preprocessor}{\#define\ MAX\_ADVANTAGE\_HISTORY\ 200}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00498}\mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{00498}}\ \textcolor{keyword}{static}\ int8\_t\ \mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00499}00499\ \ \ \ \ [\mbox{\hyperlink{game__task_8c_a80792d272b6a0d629d67d2a0cf00f55a}{MAX\_ADVANTAGE\_HISTORY}}];\ \textcolor{comment}{//\ -\/127\ až\ +127\ (White\ positive,\ Black\ negative)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00500}\mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{00500}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00501}00501\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00505}\mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{00505}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00506}00506\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00507}00507\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00508}00508\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00509}00509\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00510}00510\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'P'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00511}00511\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00512}00512\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'N'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00513}00513\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00514}00514\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'B'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00515}00515\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00516}00516\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'R'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00517}00517\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00518}00518\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'Q'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00519}00519\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00520}00520\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'K'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00521}00521\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00522}00522\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'p'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00523}00523\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00524}00524\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'n'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00525}00525\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00526}00526\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'b'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00527}00527\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00528}00528\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'r'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00529}00529\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00530}00530\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'q'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00531}00531\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00532}00532\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'k'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00533}00533\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00534}00534\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00535}00535\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00536}00536\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00537}00537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00542}\mbox{\hyperlink{game__task_8c_af3188c30ca0951b2b2e762ab26cb0a4b}{00542}}\ \textcolor{keyword}{static}\ int8\_t\ \mbox{\hyperlink{game__task_8c_af3188c30ca0951b2b2e762ab26cb0a4b}{game\_calculate\_material\_advantage}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00543}00543\ \ \ \textcolor{keywordtype}{int}\ white\_material\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00544}00544\ \ \ \textcolor{keywordtype}{int}\ black\_material\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00545}00545\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00546}00546\ \ \ \textcolor{comment}{//\ Hodnoty\ figur}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00547}00547\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ pawn\_value\ =\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00548}00548\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ knight\_value\ =\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00549}00549\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ bishop\_value\ =\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00550}00550\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ rook\_value\ =\ 5;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00551}00551\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ queen\_value\ =\ 9;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00552}00552\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00553}00553\ \ \ \textcolor{comment}{//\ Spocitat\ material\ na\ boardu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00554}00554\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00555}00555\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00556}00556\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00557}00557\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00558}00558\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00559}00559\ \ \ \ \ \ \ \ \ white\_material\ +=\ pawn\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00560}00560\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00561}00561\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00562}00562\ \ \ \ \ \ \ \ \ white\_material\ +=\ knight\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00563}00563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00564}00564\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00565}00565\ \ \ \ \ \ \ \ \ white\_material\ +=\ bishop\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00566}00566\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00567}00567\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00568}00568\ \ \ \ \ \ \ \ \ white\_material\ +=\ rook\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00569}00569\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00570}00570\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00571}00571\ \ \ \ \ \ \ \ \ white\_material\ +=\ queen\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00572}00572\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00573}00573\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00574}00574\ \ \ \ \ \ \ \ \ black\_material\ +=\ pawn\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00575}00575\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00576}00576\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00577}00577\ \ \ \ \ \ \ \ \ black\_material\ +=\ knight\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00578}00578\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00579}00579\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00580}00580\ \ \ \ \ \ \ \ \ black\_material\ +=\ bishop\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00581}00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00582}00582\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00583}00583\ \ \ \ \ \ \ \ \ black\_material\ +=\ rook\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00584}00584\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00585}00585\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00586}00586\ \ \ \ \ \ \ \ \ black\_material\ +=\ queen\_value;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00587}00587\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00588}00588\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00589}00589\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00590}00590\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00591}00591\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00592}00592\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00593}00593\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00594}00594\ \ \ \textcolor{keywordtype}{int}\ advantage\ =\ white\_material\ -\/\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00595}00595\ \ \ \textcolor{comment}{//\ Omezit\ na\ int8\_t\ rozsah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00596}00596\ \ \ \textcolor{keywordflow}{if}\ (advantage\ >\ 127)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00597}00597\ \ \ \ \ advantage\ =\ 127;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00598}00598\ \ \ \textcolor{keywordflow}{if}\ (advantage\ <\ -\/127)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00599}00599\ \ \ \ \ advantage\ =\ -\/127;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00600}00600\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00601}00601\ \ \ \textcolor{keywordflow}{return}\ (int8\_t)advantage;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00602}00602\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00603}00603\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00607}\mbox{\hyperlink{game__task_8c_abd6d559fc6b46a6a06f830b5c5cec56a}{00607}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_abd6d559fc6b46a6a06f830b5c5cec56a}{game\_record\_material\_advantage}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00608}00608\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ >=\ \mbox{\hyperlink{game__task_8c_a80792d272b6a0d629d67d2a0cf00f55a}{MAX\_ADVANTAGE\_HISTORY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00609}00609\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Historie\ plna}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00610}00610\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00611}00611\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00612}00612\ \ \ int8\_t\ advantage\ =\ \mbox{\hyperlink{game__task_8c_af3188c30ca0951b2b2e762ab26cb0a4b}{game\_calculate\_material\_advantage}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00613}00613\ \ \ \mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}[\mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}++]\ =\ advantage;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00614}00614\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00615}00615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00619}\mbox{\hyperlink{game__task_8c_a9f117ec973e2706358d99dfe843cd6ae}{00619}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a9f117ec973e2706358d99dfe843cd6ae}{add\_captured\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00620}00620\ \ \ \textcolor{comment}{//\ Determine\ which\ array\ to\ use\ based\ on\ piece\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00621}00621\ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00622}00622\ \ \ \ \ \textcolor{comment}{//\ White\ piece\ captured\ by\ black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00623}00623\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00624}00624\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}++]\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00625}00625\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00626}00626\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00627}00627\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00628}00628\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00629}00629\ \ \ \ \ \textcolor{comment}{//\ Black\ piece\ captured\ by\ white}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00630}00630\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00631}00631\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}++]\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00632}00632\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00633}00633\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00634}00634\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00635}00635\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00636}00636\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00637}00637\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00638}\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{00638}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00639}\mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{00639}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00640}\mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{00640}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[100];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00641}\mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{00641}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00642}00642\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00643}00643\ \textcolor{comment}{//\ Game\ state\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00644}\mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{00644}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{timer\_enabled}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00645}\mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{00645}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00646}\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{00646}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[32]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00647}\mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{00647}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00648}\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{00648}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00649}00649\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};\ \textcolor{comment}{//\ Aktuální\ typ\ konce\ hry}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00650}00650\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00651}00651\ \textcolor{comment}{//\ Castling\ flags\ and\ en\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00652}00652\ \textcolor{comment}{//\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00653}00653\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00654}00654\ \textcolor{comment}{//\ Move\ generation\ buffers\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00655}00655\ \textcolor{comment}{//\ static\ chess\_move\_extended\_t\ legal\_moves\_buffer[128];}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00656}00656\ \textcolor{comment}{//\ static\ uint32\_t\ legal\_moves\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00657}00657\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00658}00658\ \textcolor{comment}{//\ Include\ ctype.h\ for\ tolower\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00659}00659\ \textcolor{preprocessor}{\#include\ <ctype.h>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00660}00660\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00661}00661\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00662}00662\ \textcolor{comment}{//\ FORWARD\ DECLARATIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00663}00663\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00664}00664\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00665}00665\ \textcolor{comment}{//\ Promotion\ functions\ -\/\ MUST\ BE\ FIRST\ (called\ from\ game\_initialize\_board)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00666}00666\ \textcolor{comment}{//\ Note:\ These\ are\ defined\ later\ in\ the\ file\ (around\ line\ 3800)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00667}00667\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00668}00668\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5b0ea1f9a91c492a93d4ad9b2afcdb59}{game\_update\_promotion\_anchor\_led}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00669}00669\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{game\_process\_promotion\_button}}(uint8\_t\ button\_id);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00670}00670\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00671}00671\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00672}00672\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aee07708800ca9d9eee519b40b78f71d3}{game\_print\_board\_enhanced}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00673}00673\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{game\_execute\_move\_enhanced}}(\mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00674}00674\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00675}00675\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a5d48aea6f905097dca8c53e1c2a057b1}{game\_analyze\_position}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00676}00676\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00677}00677\ \textcolor{comment}{//\ Error\ recovery\ functions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00678}00678\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00679}00679\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00680}00680\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00681}00681\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00682}00682\ \textcolor{comment}{//\ POSITION\ HASHING\ AND\ DRAW\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00683}00683\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00684}00684\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00689}\mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{00689}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{game\_calculate\_position\_hash}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00690}00690\ \ \ uint32\_t\ hash\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00691}00691\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00692}00692\ \ \ \textcolor{comment}{//\ Hash\ board\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00693}00693\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00694}00694\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00695}00695\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00696}00696\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00697}00697\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Combine\ piece\ type,\ position,\ and\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00698}00698\ \ \ \ \ \ \ \ \ uint32\_t\ piece\_hash\ =\ (piece\ <<\ 16)\ |\ (row\ <<\ 8)\ |\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00699}00699\ \ \ \ \ \ \ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ piece\_hash;\ \textcolor{comment}{//\ Simple\ hash\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00700}00700\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00701}00701\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00702}00702\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00703}00703\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00704}00704\ \ \ \textcolor{comment}{//\ Include\ current\ player\ in\ hash}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00705}00705\ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00706}00706\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00707}00707\ \ \ \textcolor{comment}{//\ Include\ castling\ rights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00708}00708\ \ \ uint32\_t\ castling\_rights\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00709}00709\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[0][4])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00710}00710\ \ \ \ \ castling\_rights\ |=\ 0x01;\ \textcolor{comment}{//\ White\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00711}00711\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[0][0])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00712}00712\ \ \ \ \ castling\_rights\ |=\ 0x02;\ \textcolor{comment}{//\ White\ rook\ a1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00713}00713\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[0][7])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00714}00714\ \ \ \ \ castling\_rights\ |=\ 0x04;\ \textcolor{comment}{//\ White\ rook\ h1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00715}00715\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[7][4])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00716}00716\ \ \ \ \ castling\_rights\ |=\ 0x08;\ \textcolor{comment}{//\ Black\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00717}00717\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[7][0])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00718}00718\ \ \ \ \ castling\_rights\ |=\ 0x10;\ \textcolor{comment}{//\ Black\ rook\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00719}00719\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}[7][7])}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00720}00720\ \ \ \ \ castling\_rights\ |=\ 0x20;\ \textcolor{comment}{//\ Black\ rook\ h8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00721}00721\ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ castling\_rights;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00722}00722\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00723}00723\ \ \ \textcolor{comment}{//\ Include\ en\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00724}00724\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00725}00725\ \ \ \ \ uint32\_t\ en\_passant\_hash\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00726}00726\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ <<\ 8)\ |\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00727}00727\ \ \ \ \ hash\ =\ ((hash\ <<\ 5)\ +\ hash)\ \string^\ en\_passant\_hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00728}00728\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00729}00729\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00730}00730\ \ \ \textcolor{keywordflow}{return}\ hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00731}00731\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00732}00732\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00738}\mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{00738}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{game\_is\_position\_repeated}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00739}00739\ \ \ uint32\_t\ current\_hash\ =\ \mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{game\_calculate\_position\_hash}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00740}00740\ \ \ \textcolor{keywordtype}{int}\ repetition\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00741}00741\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00742}00742\ \ \ \textcolor{comment}{//\ Count\ how\ many\ times\ current\ position\ appears\ in\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00743}00743\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00744}00744\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[i]\ ==\ current\_hash)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00745}00745\ \ \ \ \ \ \ repetition\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00746}00746\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (repetition\_count\ >=\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00747}00747\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Threefold\ repetition\ detected}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00748}00748\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00749}00749\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00750}00750\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00751}00751\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00752}00752\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00753}00753\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00754}00754\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00758}\mbox{\hyperlink{game__task_8c_a7d059ee1bbc8427968feaf95af032112}{00758}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a7d059ee1bbc8427968feaf95af032112}{game\_add\_position\_to\_history}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00759}00759\ \ \ uint32\_t\ current\_hash\ =\ \mbox{\hyperlink{game__task_8c_a2e80d005401f27a295b3f2b440d4bb88}{game\_calculate\_position\_hash}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00760}00760\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00761}00761\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ <\ 100)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00762}00762\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[\mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}++]\ =\ current\_hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00763}00763\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00764}00764\ \ \ \ \ \textcolor{comment}{//\ Shift\ history\ and\ add\ new\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00765}00765\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 99;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00766}00766\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[i]\ =\ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[i\ +\ 1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00767}00767\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00768}00768\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aacd4de9dfd40491ca20038a933dfdda4}{position\_history}}[99]\ =\ current\_hash;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00769}00769\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00770}00770\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00771}00771\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00772}00772\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00773}00773\ \textcolor{comment}{//\ MATERIAL\ CALCULATION\ AND\ SCORING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00774}00774\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00775}00775\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00776}00776\ \textcolor{comment}{//\ Standard\ piece\ values}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00777}\mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{00777}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{piece\_values}}[]\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00778}00778\ \ \ \ \ 0,\ \textcolor{comment}{//\ PIECE\_EMPTY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00779}00779\ \ \ \ \ 1,\ \textcolor{comment}{//\ PIECE\_WHITE\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00780}00780\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_WHITE\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00781}00781\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_WHITE\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00782}00782\ \ \ \ \ 5,\ \textcolor{comment}{//\ PIECE\_WHITE\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00783}00783\ \ \ \ \ 9,\ \textcolor{comment}{//\ PIECE\_WHITE\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00784}00784\ \ \ \ \ 0,\ \textcolor{comment}{//\ PIECE\_WHITE\_KING\ (infinite\ value)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00785}00785\ \ \ \ \ 1,\ \textcolor{comment}{//\ PIECE\_BLACK\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00786}00786\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_BLACK\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00787}00787\ \ \ \ \ 3,\ \textcolor{comment}{//\ PIECE\_BLACK\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00788}00788\ \ \ \ \ 5,\ \textcolor{comment}{//\ PIECE\_BLACK\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00789}00789\ \ \ \ \ 9,\ \textcolor{comment}{//\ PIECE\_BLACK\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00790}00790\ \ \ \ \ 0\ \ \textcolor{comment}{//\ PIECE\_BLACK\_KING\ (infinite\ value)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00791}00791\ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00792}00792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00800}\mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{00800}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\textcolor{keywordtype}{int}\ *white\_material,\ \textcolor{keywordtype}{int}\ *black\_material)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00801}00801\ \ \ \textcolor{keywordtype}{int}\ white\_total\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00802}00802\ \ \ \textcolor{keywordtype}{int}\ black\_total\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00803}00803\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00804}00804\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00805}00805\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00806}00806\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00807}00807\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00808}00808\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00809}00809\ \ \ \ \ \ \ \ \ \ \ white\_total\ +=\ \mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{piece\_values}}[piece];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00810}00810\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00811}00811\ \ \ \ \ \ \ \ \ \ \ black\_total\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00812}00812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0f99785951affb36a4998ea958983b86}{piece\_values}}[piece\ -\/\ 6];\ \textcolor{comment}{//\ Adjust\ index\ for\ black\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00813}00813\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00814}00814\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00815}00815\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00816}00816\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00817}00817\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00818}00818\ \ \ \textcolor{keywordflow}{if}\ (white\_material)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00819}00819\ \ \ \ \ *white\_material\ =\ white\_total;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00820}00820\ \ \ \textcolor{keywordflow}{if}\ (black\_material)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00821}00821\ \ \ \ \ *black\_material\ =\ black\_total;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00822}00822\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00823}00823\ \ \ \textcolor{keywordflow}{return}\ white\_total\ -\/\ black\_total;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00824}00824\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00825}00825\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00831}\mbox{\hyperlink{game__task_8c_a13f42aca89279614ea9159dec44ae36c}{00831}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a13f42aca89279614ea9159dec44ae36c}{game\_get\_material\_string}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00832}00832\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00833}00833\ \ \ \textcolor{keywordtype}{int}\ balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00834}00834\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00835}00835\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00836}00836\ \ \ \textcolor{keywordflow}{if}\ (balance\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00837}00837\ \ \ \ \ snprintf(buffer,\ buffer\_size,\ \textcolor{stringliteral}{"{}White\ +\%d"{}},\ balance);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00838}00838\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (balance\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00839}00839\ \ \ \ \ snprintf(buffer,\ buffer\_size,\ \textcolor{stringliteral}{"{}Black\ +\%d"{}},\ -\/balance);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00840}00840\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00841}00841\ \ \ \ \ snprintf(buffer,\ buffer\_size,\ \textcolor{stringliteral}{"{}Even\ (+0)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00842}00842\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00843}00843\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00844}00844\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00845}00845\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00846}00846\ \textcolor{comment}{//\ GAME\ STATISTICS\ DISPLAY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00847}00847\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00848}00848\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00853}\mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{00853}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ result\_type)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00854}00854\ \ \ \textcolor{keywordflow}{switch}\ (result\_type)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00855}00855\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00856}00856\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00857}00857\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Statistics:\ White\ wins!\ (Total:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00858}00858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00859}00859\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00860}00860\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00861}00861\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00862}00862\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Statistics:\ Black\ wins!\ (Total:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00863}00863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00864}00864\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00865}00865\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00866}00866\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00867}00867\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0486ad918f30f8bb5d8db5d92f72c208}{RESULT\_DRAW\_REPETITION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00868}00868\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00869}00869\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00870}00870\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Statistics:\ Draw!\ (Total:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00871}00871\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00872}00872\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00873}00873\ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00874}00874\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📊\ Total\ games:\ \%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00875}00875\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00876}00876\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00881}00881\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00882}00882\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00883}00883\ \textcolor{comment}{//\ ENDGAME\ REPORT\ FORMATTING\ HELPERS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00884}00884\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00885}00885\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00895}\mbox{\hyperlink{game__task_8c_a195ade6830068f1a49821f3d0e8f24db}{00895}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a195ade6830068f1a49821f3d0e8f24db}{print\_report\_header}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *title)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00896}00896\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00897}00897\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00898}00898\ \ \ printf(\textcolor{stringliteral}{"{}\%s\(\backslash\)r\(\backslash\)n"{}},\ title);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00899}00899\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00900}00900\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00901}00901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00908}\mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{00908}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00909}00909\ \ \ printf(\textcolor{stringliteral}{"{}───────────────────────────────────────────────────────────────\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00910}00910\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00911}00911\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00927}\mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{00927}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *label,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *fmt,\ ...)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00928}00928\ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ \%s:\ "{}},\ label);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00929}00929\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00930}00930\ \ \ va\_list\ args;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00931}00931\ \ \ va\_start(args,\ fmt);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00932}00932\ \ \ vprintf(fmt,\ args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00933}00933\ \ \ va\_end(args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00934}00934\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00935}00935\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00936}00936\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00937}00937\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00938}\mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{00938}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ result\_type)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00939}00939\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00940}00940\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00941}00941\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00942}00942\ \ \ uint32\_t\ minutes\ =\ game\_duration\ /\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00943}00943\ \ \ uint32\_t\ seconds\ =\ game\_duration\ \%\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00944}00944\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00945}00945\ \ \ \textcolor{comment}{//\ Print\ endgame\ announcement}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00946}00946\ \ \ \mbox{\hyperlink{game__task_8c_a195ade6830068f1a49821f3d0e8f24db}{print\_report\_header}}(\textcolor{stringliteral}{"{}🏆\ ENDGAME\ REPORT"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00947}00947\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00948}00948\ \ \ \textcolor{comment}{//\ Určit\ výsledek\ a\ typ\ ukončení\ podle\ current\_endgame\_reason}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00949}00949\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00950}00950\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *loser\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00951}00951\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *end\_reason\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00952}00952\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00953}00953\ \ \ \textcolor{comment}{//\ Nejprve\ určíme\ vítěze\ z\ result\_type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00954}00954\ \ \ \textcolor{keywordflow}{if}\ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00955}00955\ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00956}00956\ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00957}00957\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00958}00958\ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00959}00959\ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00960}00960\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00961}00961\ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00962}00962\ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00963}00963\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00964}00964\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00965}00965\ \ \ \textcolor{comment}{//\ Pak\ určíme\ důvod\ konce\ hry\ a\ vytiskneme\ výsledek}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00966}00966\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00967}00967\ \ \ \textcolor{comment}{//\ ===\ CHECKMATE\ VARIATIONS\ ===}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00968}00968\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00969}00969\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎯\ Game\ Result:\ \%s\ WINS\ BY\ CHECKMATE\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00970}00970\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00971}00971\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00972}00972\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00973}00973\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00974}00974\ \ \ \ \ printf(\textcolor{stringliteral}{"{}⚔️\ Game\ Result:\ \%s\ WINS\ BY\ EN\ PASSANT\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00975}00975\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00976}00976\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (En\ Passant)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00977}00977\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00978}00978\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00979}00979\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🏰\ Game\ Result:\ \%s\ WINS\ BY\ CASTLING\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00980}00980\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00981}00981\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Castling)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00982}00982\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00983}00983\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00984}00984\ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ Game\ Result:\ \%s\ WINS\ BY\ PROMOTION\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00985}00985\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00986}00986\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Promotion)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00987}00987\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00988}00988\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00989}00989\ \ \ \ \ printf(\textcolor{stringliteral}{"{}💥\ Game\ Result:\ \%s\ WINS\ BY\ DISCOVERED\ CHECK\ CHECKMATE!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00990}00990\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00991}00991\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Discovered\ Check)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00992}00992\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00993}00993\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00994}00994\ \ \ \textcolor{comment}{//\ ===\ PLAYER\ ACTIONS\ ===}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00995}00995\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00996}00996\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🏳️\ Game\ Result:\ \%s\ WINS\ BY\ RESIGNATION\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00997}00997\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00998}00998\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Resignation"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l00999}00999\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01000}01000\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01001}01001\ \ \ \ \ printf(\textcolor{stringliteral}{"{}⏰\ Game\ Result:\ \%s\ WINS\ BY\ TIMEOUT\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01002}01002\ \ \ \ \ \ \ \ \ \ \ \ (result\_type\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01003}01003\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Timeout"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01004}01004\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01005}01005\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01006}01006\ \ \ \textcolor{comment}{//\ ===\ DRAW\ CONDITIONS\ ===}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01007}01007\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01008}01008\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ Stalemate\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01009}01009\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Stalemate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01010}01010\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01011}01011\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01012}01012\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ 50-\/move\ rule\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01013}01013\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}50-\/move\ rule"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01014}01014\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01015}01015\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01016}01016\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ Three-\/fold\ repetition\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01017}01017\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Threefold\ repetition"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01018}01018\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01019}01019\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01020}01020\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🤝\ Game\ Result:\ DRAW\ -\/\ Insufficient\ material\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01021}01021\ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Insufficient\ material"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01022}01022\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01023}01023\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01024}01024\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01025}01025\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01026}01026\ \ \ printf(\textcolor{stringliteral}{"{}📋\ Game\ Summary:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01027}01027\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Winner"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ winner);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01028}01028\ \ \ \textcolor{keywordflow}{if}\ (result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01029}01029\ \ \ \ \ \ \ result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01030}01030\ \ \ \ \ \ \ result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0486ad918f30f8bb5d8db5d92f72c208}{RESULT\_DRAW\_REPETITION}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01031}01031\ \ \ \ \ \ \ result\_type\ !=\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01032}01032\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Loser"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ loser);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01033}01033\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01034}01034\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}End\ Reason"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ end\_reason);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01035}01035\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Total\ Moves"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01036}01036\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Game\ Duration"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}:\%02"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (mm:ss)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01037}01037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ minutes,\ seconds);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01038}01038\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01039}01039\ \ \ \textcolor{comment}{//\ Vypočítat\ material\ advantage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01040}01040\ \ \ \textcolor{keywordtype}{int}\ white\_material\ =\ 0,\ black\_material\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01041}01041\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01042}01042\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ p\ =\ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01043}01043\ \ \ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01044}01044\ \ \ \ \ \ \ white\_material\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01045}01045\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}\ ||\ p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01046}01046\ \ \ \ \ \ \ white\_material\ +=\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01047}01047\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01048}01048\ \ \ \ \ \ \ white\_material\ +=\ 5;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01049}01049\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01050}01050\ \ \ \ \ \ \ white\_material\ +=\ 9;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01051}01051\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01052}01052\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01053}01053\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ p\ =\ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01054}01054\ \ \ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01055}01055\ \ \ \ \ \ \ black\_material\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01056}01056\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ ||\ p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01057}01057\ \ \ \ \ \ \ black\_material\ +=\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01058}01058\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01059}01059\ \ \ \ \ \ \ black\_material\ +=\ 5;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01060}01060\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01061}01061\ \ \ \ \ \ \ black\_material\ +=\ 9;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01062}01062\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01063}01063\ \ \ \textcolor{keywordtype}{int}\ material\_diff\ =\ white\_material\ -\/\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01064}01064\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01065}01065\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01066}01066\ \ \ printf(\textcolor{stringliteral}{"{}📊\ Game\ Statistics:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01067}01067\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Moves"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ (\mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ +\ 1)\ /\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01068}01068\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Moves"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ /\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01069}01069\ \ \ \textcolor{keywordflow}{if}\ (game\_duration\ >\ 0\ \&\&\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01070}01070\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Avg\ Time\ per\ Move"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01071}01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration\ /\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01072}01072\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01073}01073\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01074}01074\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01075}01075\ \ \ printf(\textcolor{stringliteral}{"{}⚔️\ \ Combat\ Statistics:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01076}01076\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Captures"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\ (\%d\ points)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01077}01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}},\ white\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01078}01078\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Captures"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\ (\%d\ points)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01079}01079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}},\ black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01080}01080\ \ \ \textcolor{keywordflow}{if}\ (material\_diff\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01081}01081\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Material\ Advantage"{}},\ \textcolor{stringliteral}{"{}White\ +\%d"{}},\ material\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01082}01082\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (material\_diff\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01083}01083\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Material\ Advantage"{}},\ \textcolor{stringliteral}{"{}Black\ +\%d"{}},\ -\/material\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01084}01084\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01085}01085\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Material\ Advantage"{}},\ \textcolor{stringliteral}{"{}Equal\ (0)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01086}01086\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01087}01087\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Checks"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01088}01088\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Checks"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01089}01089\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01090}01090\ \ \ \textcolor{comment}{//\ Captured\ pieces\ vizuálně}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01091}01091\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01092}01092\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ White\ Captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01093}01093\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01094}01094\ \ \ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01095}01095\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01096}01096\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%c\ "{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01097}01097\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01098}01098\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01099}01099\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01100}01100\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01101}01101\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Black\ Captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01102}01102\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a22be28ff1955061a9bd8d64006fe6115}{MAX\_CAPTURED\_PIECES}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01103}01103\ \ \ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01104}01104\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01105}01105\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%c\ "{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01106}01106\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01107}01107\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01108}01108\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01109}01109\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01110}01110\ \ \ \textcolor{comment}{//\ Castling\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01111}01111\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Castling"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ >\ 0\ ?\ \textcolor{stringliteral}{"{}Yes"{}}\ :\ \textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01112}01112\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Castling"{}},\ \textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ >\ 0\ ?\ \textcolor{stringliteral}{"{}Yes"{}}\ :\ \textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01113}01113\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01114}01114\ \ \ \mbox{\hyperlink{game__task_8c_a1ec13300bc78171b6fcd9dd28e89ecb5}{print\_separator}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01115}01115\ \ \ printf(\textcolor{stringliteral}{"{}📈\ Overall\ Statistics:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01116}01116\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Total\ Games\ Played"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01117}01117\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}White\ Wins"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (\%.0f\%\%)"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01118}01118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}\ *\ 100.0f\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01119}01119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01120}01120\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Black\ Wins"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (\%.0f\%\%)"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01121}01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}\ *\ 100.0f\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01122}01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01123}01123\ \ \ \mbox{\hyperlink{game__task_8c_ae0a6f0bdd7eec3bac8e5f7c50d811214}{print\_report\_line}}(\textcolor{stringliteral}{"{}Draws"{}},\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (\%.0f\%\%)"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01124}01124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}}\ *\ 100.0f\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}})\ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01125}01125\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01126}01126\ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01127}01127\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01128}01128\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01129}01129\ \ \ \textcolor{comment}{//\ Flush\ stdout\ pro\ okamžité\ zobrazení}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01130}01130\ \ \ fflush(stdout);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01131}01131\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01132}01132\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01136}\mbox{\hyperlink{game__task_8c_ac06b42b52fc2abf90b66dcbd73ecd4a0}{01136}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_ac06b42b52fc2abf90b66dcbd73ecd4a0}{game\_get\_white\_wins}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01137}01137\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01141}\mbox{\hyperlink{game__task_8c_a4c5423c283319ea94779b79682ca9b98}{01141}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a4c5423c283319ea94779b79682ca9b98}{game\_get\_black\_wins}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01142}01142\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01146}\mbox{\hyperlink{game__task_8c_a49a6874590b30a62f04f7ca6d3efcf05}{01146}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a49a6874590b30a62f04f7ca6d3efcf05}{game\_get\_draws}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01147}01147\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01151}\mbox{\hyperlink{game__task_8c_aed140b5d1ea696aa8fcd53aacc2303a9}{01151}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aed140b5d1ea696aa8fcd53aacc2303a9}{game\_get\_total\_games}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01152}01152\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01156}\mbox{\hyperlink{game__task_8c_a870a53ed0d150a3c293bcbcb76986fb2}{01156}}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{game__task_8c_a870a53ed0d150a3c293bcbcb76986fb2}{game\_get\_game\_state\_string}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01157}01157\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01158}01158\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01159}01159\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Active"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01160}01160\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01161}01161\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Paused"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01162}01162\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01163}01163\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Finished"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01164}01164\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01165}01165\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Promotion"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01166}01166\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01167}01167\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Idle"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01168}01168\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01169}01169\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01170}01170\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01171}01171\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01172}01172\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01176}\mbox{\hyperlink{game__task_8c_a605e2e1374b4e7090941389e6a581a24}{01176}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a605e2e1374b4e7090941389e6a581a24}{game\_print\_game\_stats}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01177}01177\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01178}01178\ \ \ uint32\_t\ game\_duration\ =\ current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01179}01179\ \ \ uint32\_t\ minutes\ =\ game\_duration\ /\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01180}01180\ \ \ uint32\_t\ seconds\ =\ game\_duration\ \%\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01181}01181\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01182}01182\ \ \ \textcolor{comment}{//\ Calculate\ average\ time\ per\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01183}01183\ \ \ uint32\_t\ white\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01184}01184\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01185}01185\ \ \ uint32\_t\ black\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01186}01186\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01187}01187\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01188}01188\ \ \ \textcolor{comment}{//\ Get\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01189}01189\ \ \ \textcolor{keywordtype}{char}\ material\_str[32];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01190}01190\ \ \ \mbox{\hyperlink{game__task_8c_a13f42aca89279614ea9159dec44ae36c}{game\_get\_material\_string}}(material\_str,\ \textcolor{keyword}{sizeof}(material\_str));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01191}01191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01192}01192\ \ \ \textcolor{comment}{//\ Print\ atmospheric\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01193}01193\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╔═══════════════════════════════╗"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01194}01194\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ ESP32\ CHESS\ v2.4\ ║"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01195}01195\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ Move\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ -\/\ \%s\ to\ play\ ║"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01196}01196\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01197}01197\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ Material:\ \%s\ ║"{}},\ material\_str);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01198}01198\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╚═══════════════════════════════╝"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01199}01199\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01200}01200\ \ \ \textcolor{comment}{//\ Game\ duration\ and\ move\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01201}01201\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01202}01202\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Game\ duration:\ \%02"{}}\ PRIu32\ \textcolor{stringliteral}{"{}:\%02"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\ Move\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01203}01203\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ (\%s\ to\ play)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01204}01204\ \ \ \ \ \ \ \ \ \ \ \ minutes,\ seconds,\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01205}01205\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01206}01206\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01207}01207\ \ \ \textcolor{comment}{//\ Capture\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01208}01208\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Captures:\ White\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces,\ Black\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01209}01209\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}},\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01210}01210\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01211}01211\ \ \ \textcolor{comment}{//\ Check\ and\ castle\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01212}01212\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01213}01213\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Checks:\ White\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\ Black\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01214}01214\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ |\ Castles:\ White\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\ Black\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01215}01215\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01216}01216\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01217}01217\ \ \ \textcolor{comment}{//\ Material\ breakdown}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01218}01218\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01219}01219\ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01220}01220\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Material:\ White\ \%d\ points,\ Black\ \%d\ points\ (\%s)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01221}01221\ \ \ \ \ \ \ \ \ \ \ \ white\_material,\ black\_material,\ material\_str);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01222}01222\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01223}01223\ \ \ \textcolor{comment}{//\ Time\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01224}01224\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{timer\_enabled}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01225}01225\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01226}01226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Time\ per\ move:\ White\ avg\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}s,\ Black\ avg\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01227}01227\ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_avg\_time,\ black\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01228}01228\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01229}01229\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01230}01230\ \ \ \textcolor{comment}{//\ Draw\ detection\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01231}01231\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ >\ 30)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01232}01232\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01233}01233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ \ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves\ without\ capture\ (50-\/move\ rule\ approaching)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01234}01234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01235}01235\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01236}01236\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01237}01237\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{game\_is\_position\_repeated}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01238}01238\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Position\ repeated\ (potential\ draw\ by\ repetition)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01239}01239\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01240}01240\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01241}01241\ \ \ \textcolor{comment}{//\ Game\ save\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01242}01242\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01243}01243\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💾\ Game\ saved\ as:\ \%s"{}},\ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01244}01244\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01245}01245\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01246}01246\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}═══════════════════════════════"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01247}01247\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01248}01248\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01249}01249\ \textcolor{comment}{//\ Last\ move\ tracking\ for\ board\ display}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01250}\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{01250}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01251}\mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{01251}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01252}\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{01252}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01253}\mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{01253}}\ \textcolor{keyword}{static}\ uint8\_t\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01254}\mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{01254}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01255}01255\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01256}01256\ \textcolor{comment}{//\ Captured\ pieces\ counter\ (removed\ -\/\ already\ declared\ above\ with\ char\ arrays)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01257}01257\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01258}01258\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01259}01259\ \textcolor{comment}{//\ ENHANCED\ MOVE\ VALIDATION\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01260}01260\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01261}01261\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01262}01262\ \textcolor{comment}{//\ Tutorial\ mode\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01263}\mbox{\hyperlink{game__task_8c_a53e9e83a9003c07651e45d0f0c7cc594}{01263}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a53e9e83a9003c07651e45d0f0c7cc594}{tutorial\_mode\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01264}\mbox{\hyperlink{game__task_8c_afae0eab069ccc976d3057e2faaef476b}{01264}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_afae0eab069ccc976d3057e2faaef476b}{show\_hints}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01265}01265\ \textcolor{comment}{//\ Game\ analysis\ flags\ (for\ future\ use)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01266}01266\ \textcolor{comment}{//\ static\ bool\ show\_warnings\ =\ true;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01267}01267\ \textcolor{comment}{//\ static\ bool\ show\_analysis\ =\ true;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01268}01268\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01269}01269\ \textcolor{comment}{//\ Move\ analysis\ cache\ (for\ future\ use)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01270}01270\ \textcolor{comment}{//\ static\ move\_suggestion\_t\ move\_suggestions[100];}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01271}01271\ \textcolor{comment}{//\ static\ uint32\_t\ suggestion\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01272}01272\ \textcolor{comment}{//\ static\ uint32\_t\ last\_analysis\_time\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01273}01273\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01274}01274\ \textcolor{comment}{//\ Piece\ symbols\ for\ display\ (ASCII)\ -\/\ FIXED\ INDEXES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01275}\mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{01275}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[]\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01276}01276\ \ \ \ \ \textcolor{stringliteral}{"{}\ "{}},\ \textcolor{comment}{//\ 0:\ PIECE\_EMPTY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01277}01277\ \ \ \ \ \textcolor{stringliteral}{"{}p"{}},\ \textcolor{comment}{//\ 1:\ PIECE\_WHITE\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01278}01278\ \ \ \ \ \textcolor{stringliteral}{"{}n"{}},\ \textcolor{comment}{//\ 2:\ PIECE\_WHITE\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01279}01279\ \ \ \ \ \textcolor{stringliteral}{"{}b"{}},\ \textcolor{comment}{//\ 3:\ PIECE\_WHITE\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01280}01280\ \ \ \ \ \textcolor{stringliteral}{"{}r"{}},\ \textcolor{comment}{//\ 4:\ PIECE\_WHITE\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01281}01281\ \ \ \ \ \textcolor{stringliteral}{"{}q"{}},\ \textcolor{comment}{//\ 5:\ PIECE\_WHITE\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01282}01282\ \ \ \ \ \textcolor{stringliteral}{"{}k"{}},\ \textcolor{comment}{//\ 6:\ PIECE\_WHITE\_KING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01283}01283\ \ \ \ \ \textcolor{stringliteral}{"{}P"{}},\ \textcolor{comment}{//\ 7:\ PIECE\_BLACK\_PAWN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01284}01284\ \ \ \ \ \textcolor{stringliteral}{"{}N"{}},\ \textcolor{comment}{//\ 8:\ PIECE\_BLACK\_KNIGHT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01285}01285\ \ \ \ \ \textcolor{stringliteral}{"{}B"{}},\ \textcolor{comment}{//\ 9:\ PIECE\_BLACK\_BISHOP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01286}01286\ \ \ \ \ \textcolor{stringliteral}{"{}R"{}},\ \textcolor{comment}{//\ 10:\ PIECE\_BLACK\_ROOK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01287}01287\ \ \ \ \ \textcolor{stringliteral}{"{}Q"{}},\ \textcolor{comment}{//\ 11:\ PIECE\_BLACK\_QUEEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01288}01288\ \ \ \ \ \textcolor{stringliteral}{"{}K"{}}\ \ \textcolor{comment}{//\ 12:\ PIECE\_BLACK\_KING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01289}01289\ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01290}01290\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01291}01291\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01292}01292\ \textcolor{comment}{//\ GAME\ INITIALIZATION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01293}01293\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01294}01294\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01304}\mbox{\hyperlink{game__task_8c_a3534f1702346800f3c81568d62f497bc}{01304}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a3534f1702346800f3c81568d62f497bc}{game\_is\_board\_in\_starting\_position}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01305}01305\ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_ab30ba07e2a0bd07a15e45a92c32db9c5}{state}}[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01306}01306\ \ \ \textcolor{comment}{//\ Retrieve\ raw\ sensor\ state\ (1=occupied,\ 0=empty)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01307}01307\ \ \ \mbox{\hyperlink{matrix__task_8h_a62798e0c14260b016d8d1739dedc2056}{matrix\_get\_state}}(\mbox{\hyperlink{ha__light__task_8c_ab30ba07e2a0bd07a15e45a92c32db9c5}{state}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01308}01308\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01309}01309\ \ \ \textcolor{comment}{//\ Check\ Rows\ 2,\ 3,\ 4,\ 5\ must\ be\ EMPTY\ (0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01310}01310\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 2;\ row\ <\ 6;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01311}01311\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01312}01312\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ha__light__task_8c_ab30ba07e2a0bd07a15e45a92c32db9c5}{state}}[row\ *\ 8\ +\ col]\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01313}01313\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01314}01314\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01315}01315\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01316}01316\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01317}01317\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01318}01318\ \ \ \textcolor{comment}{//\ Check\ Rows\ 0,\ 1\ (White\ side)\ must\ be\ FULL\ (1)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01319}01319\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 2;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01320}01320\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01321}01321\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ha__light__task_8c_ab30ba07e2a0bd07a15e45a92c32db9c5}{state}}[row\ *\ 8\ +\ col]\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01322}01322\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01323}01323\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01324}01324\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01325}01325\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01326}01326\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01327}01327\ \ \ \textcolor{comment}{//\ Check\ Rows\ 6,\ 7\ (Black\ side)\ must\ be\ FULL\ (1)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01328}01328\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 6;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01329}01329\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01330}01330\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ha__light__task_8c_ab30ba07e2a0bd07a15e45a92c32db9c5}{state}}[row\ *\ 8\ +\ col]\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01331}01331\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01332}01332\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01333}01333\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01334}01334\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01335}01335\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01336}01336\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01337}01337\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01338}01338\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01352}\mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{01352}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{game\_initialize\_board}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01353}01353\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Initializing\ enhanced\ chess\ board..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01354}01354\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01355}01355\ \ \ \textcolor{comment}{//\ Clear\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01356}01356\ \ \ memset(\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01357}01357\ \ \ memset(\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a32ed58d8bde5af2ffdbdb87e51758601}{piece\_moved}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01358}01358\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01359}01359\ \ \ \textcolor{comment}{//\ Set\ up\ white\ pieces\ (bottom\ rank\ -\/\ row\ 1,\ index\ 0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01360}01360\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][0]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}};\ \ \ \textcolor{comment}{//\ a1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01361}01361\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][1]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}};\ \textcolor{comment}{//\ b1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01362}01362\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][2]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}};\ \textcolor{comment}{//\ c1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01363}01363\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][3]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}};\ \ \textcolor{comment}{//\ d1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01364}01364\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}};\ \ \ \textcolor{comment}{//\ e1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01365}01365\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][5]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}};\ \textcolor{comment}{//\ f1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01366}01366\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][6]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}};\ \textcolor{comment}{//\ g1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01367}01367\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][7]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}};\ \ \ \textcolor{comment}{//\ h1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01368}01368\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01369}01369\ \ \ \textcolor{comment}{//\ Set\ up\ white\ pawns\ (row\ 2,\ index\ 1)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01370}01370\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01371}01371\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[1][col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01372}01372\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01373}01373\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01374}01374\ \ \ \textcolor{comment}{//\ Rows\ 3-\/6\ (indices\ 2-\/5)\ remain\ empty}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01375}01375\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01376}01376\ \ \ \textcolor{comment}{//\ Set\ up\ black\ pawns\ (row\ 7,\ index\ 6)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01377}01377\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01378}01378\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[6][col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01379}01379\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01380}01380\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01381}01381\ \ \ \textcolor{comment}{//\ Set\ up\ black\ pieces\ (top\ rank\ -\/\ row\ 8,\ index\ 7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01382}01382\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][0]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};\ \ \ \textcolor{comment}{//\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01383}01383\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][1]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};\ \textcolor{comment}{//\ b8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01384}01384\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][2]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};\ \textcolor{comment}{//\ c8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01385}01385\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][3]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};\ \ \textcolor{comment}{//\ d8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01386}01386\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};\ \ \ \textcolor{comment}{//\ e8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01387}01387\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][5]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};\ \textcolor{comment}{//\ f8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01388}01388\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][6]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};\ \textcolor{comment}{//\ g8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01389}01389\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][7]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};\ \ \ \textcolor{comment}{//\ h8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01390}01390\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01391}01391\ \ \ \textcolor{comment}{//\ Reset\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01392}01392\ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01393}01393\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01394}01394\ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01395}01395\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01396}01396\ \ \ \textcolor{comment}{//\ Reset\ castling\ flags\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01397}01397\ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01398}01398\ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01399}01399\ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01400}01400\ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01401}01401\ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01402}01402\ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01403}01403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01404}01404\ \ \ \textcolor{comment}{//\ Reset\ internal\ castling\ state\ machine.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01405}01405\ \ \ memset(\&\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01406}01406\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01407}01407\ \ \ \textcolor{comment}{//\ Reset\ en\ passant\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01408}01408\ \ \ \textcolor{comment}{//\ en\_passant\_available\ =\ false;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01409}01409\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01410}01410\ \ \ \textcolor{comment}{//\ Reset\ other\ counters\ (declared\ later\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01411}01411\ \ \ \textcolor{comment}{//\ fifty\_move\_counter\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01412}01412\ \ \ \textcolor{comment}{//\ position\_history\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01413}01413\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01414}01414\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Enhanced\ chess\ board\ initialized\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01415}01415\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01416}01416\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Initial\ position:\ White\ pieces\ at\ bottom,\ Black\ pieces\ at\ top"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01417}01417\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01418}01418\ \ \ \textcolor{comment}{//\ Update\ promotion\ LED\ indications.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01419}01419\ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01420}01420\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01421}01421\ \ \ \textcolor{comment}{//\ Board\ will\ be\ displayed\ after\ all\ tasks\ are\ initialized}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01422}01422\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01423}01423\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01440}\mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{01440}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01441}01441\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Resetting\ game..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01442}01442\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01443}01443\ \ \ \textcolor{comment}{//\ Zastavit\ resignation\ timer\ pokud\ běží\ (tichý\ cleanup,\ hra\ se\ resetuje)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01444}01444\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01445}01445\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01446}01446\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01447}01447\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01448}01448\ \ \ \textcolor{comment}{//\ Reset\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01449}01449\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01450}01450\ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01451}01451\ \ \ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01452}01452\ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01453}01453\ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01454}01454\ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01455}01455\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01456}01456\ \ \ \textcolor{comment}{//\ Reset\ extended\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01457}01457\ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01458}01458\ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01459}01459\ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01460}01460\ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01461}01461\ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01462}01462\ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01463}01463\ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01464}01464\ \ \ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01465}01465\ \ \ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01466}01466\ \ \ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01467}01467\ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01468}01468\ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01469}01469\ \ \ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01470}01470\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01471}01471\ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ pro\ novou\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01472}01472\ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}};\ \textcolor{comment}{//\ Reset\ endgame\ reason.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01473}01473\ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ last\ move\ type.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01474}01474\ \ \ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01475}01475\ \ \ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[0]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01476}01476\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01477}01477\ \ \ \textcolor{comment}{//\ Clear\ move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01478}01478\ \ \ memset(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01479}01479\ \ \ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01480}01480\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01481}01481\ \ \ \textcolor{comment}{//\ Clear\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01482}01482\ \ \ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01483}01483\ \ \ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01484}01484\ \ \ \mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01485}01485\ \ \ \mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01486}01486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01487}01487\ \ \ \textcolor{comment}{//\ Clear\ material\ advantage\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01488}01488\ \ \ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01489}01489\ \ \ memset(\mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01490}01490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01491}01491\ \ \ \textcolor{comment}{//\ Clear\ last\ move\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01492}01492\ \ \ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01493}01493\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01494}01494\ \ \ \textcolor{comment}{//\ Kompletní\ reset\ error\ recovery\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01495}01495\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01496}01496\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01497}01497\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01498}01498\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01499}01499\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01500}01500\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01501}01501\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01502}01502\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01503}01503\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01504}01504\ \ \ \textcolor{comment}{//\ Reset\ opponent\ piece\ recovery\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01505}01505\ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01506}01506\ \ \ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01507}01507\ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01508}01508\ \ \ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01509}01509\ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01510}01510\ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01511}01511\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01512}01512\ \ \ \textcolor{comment}{//\ Reset\ capture\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01513}01513\ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01514}01514\ \ \ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01515}01515\ \ \ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01516}01516\ \ \ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01517}01517\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01518}01518\ \ \ \textcolor{comment}{//\ Reset\ promotion\ state\ to\ prevent\ blocking\ moves\ in\ a\ new\ game.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01519}01519\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01520}01520\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01521}01521\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01522}01522\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01523}01523\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01524}01524\ \ \ \textcolor{comment}{//\ Reset\ lifted\ piece\ state.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01525}01525\ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01526}01526\ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01527}01527\ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01528}01528\ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01529}01529\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01530}01530\ \ \ \textcolor{comment}{//\ Reset\ auto-\/new\ game\ detection\ flags.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01531}01531\ \ \ \textcolor{comment}{//\ This\ allows\ auto-\/new\ game\ to\ work\ after\ manual\ resets\ or\ when\ pieces\ are}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01532}01532\ \ \ \textcolor{comment}{//\ manually\ arranged\ into\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01533}01533\ \ \ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01534}01534\ \ \ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01535}01535\ \ \ \mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Reset\ block\ flag\ too}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01536}01536\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Auto\ new\ game\ detection\ flags\ reset\ in\ game\_reset\_game()"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01537}01537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01538}01538\ \ \ \textcolor{comment}{//\ Zastavit\ endgame\ animaci\ při\ resetu\ hry}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01539}01539\ \ \ \mbox{\hyperlink{led__task_8h_a081382ca7f7a773156291851fdbe6f5f}{led\_stop\_endgame\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01540}01540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01541}01541\ \ \ \textcolor{comment}{//\ Reinitialize\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01542}01542\ \ \ \mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{game\_initialize\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01543}01543\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01544}01544\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ reset\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01545}01545\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01546}01546\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01562}\mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{01562}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{game\_start\_new\_game}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01563}01563\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Starting\ new\ game..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01564}01564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01565}01565\ \ \ \textcolor{comment}{//\ Reset\ game}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01566}01566\ \ \ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01567}01567\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01568}01568\ \ \ \textcolor{comment}{//\ Reset\ timer\ před\ novou\ hrou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01569}01569\ \ \ \mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{game\_reset\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01570}01570\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ reset\ for\ new\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01571}01571\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01572}01572\ \ \ \textcolor{comment}{//\ Set\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01573}01573\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01574}01574\ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01575}01575\ \ \ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01576}01576\ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01577}01577\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01578}01578\ \ \ \textcolor{comment}{//\ Start\ timer\ for\ white\ player\ if\ time\ control\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01579}01579\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f01e5a8d282157e3cd8bd5a03b9c8b5}{game\_is\_timer\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01580}01580\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Starting\ timer\ for\ white\ player\ at\ game\ start"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01581}01581\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\textcolor{keyword}{true});\ \textcolor{comment}{//\ Start\ timer\ for\ white}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01582}01582\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01583}01583\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01584}01584\ \ \ \textcolor{comment}{//\ Initialize\ extended\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01585}01585\ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01586}01586\ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01587}01587\ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01588}01588\ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01589}01589\ \ \ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01590}01590\ \ \ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01591}01591\ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01592}01592\ \ \ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01593}01593\ \ \ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01594}01594\ \ \ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01595}01595\ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01596}01596\ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01597}01597\ \ \ \mbox{\hyperlink{game__task_8c_aa2cf15d7d0808a9a22c4eb6462c9153d}{position\_history\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01598}01598\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01599}01599\ \ \ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01600}01600\ \ \ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[0]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01601}01601\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01602}01602\ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01603}01603\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01604}01604\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}New\ game\ started\ -\/\ White\ to\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01605}01605\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Total\ games:\ \%"{}}\ PRIu32,\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01606}01606\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01607}01607\ \ \ \textcolor{comment}{//\ Boot\ sequence:\ first\ game\ vs.\ restart.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01608}01608\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01609}01609\ \ \ \ \ \textcolor{comment}{//\ Restart\ hry\ -\/\ zastavit\ všechny\ animace}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01610}01610\ \ \ \ \ \mbox{\hyperlink{unified__animation__manager_8h_a00e3ed0913caba4f42ed8749b9e41d6f}{unified\_animation\_stop\_all}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01611}01611\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a081382ca7f7a773156291851fdbe6f5f}{led\_stop\_endgame\_animation}}();\ \textcolor{comment}{//\ Legacy\ endgame\ animations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01612}01612\ \ \ \ \ \mbox{\hyperlink{game__led__animations_8c_ad8316144bc70b897342c47d341b52b5b}{stop\_endgame\_animation}}();\ \ \ \ \ \textcolor{comment}{//\ Stop\ NEW\ endgame\ animations\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01613}01613\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ All\ animations\ stopped\ for\ new\ game\ (restart)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01614}01614\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01615}01615\ \ \ \ \ \textcolor{comment}{//\ První\ hra\ -\/\ boot\ sequence\ stále\ probíhá}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01616}01616\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏸️\ \ Boot\ sequence:\ Skipping\ animation\ stop\ (first\ game)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01617}01617\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01618}01618\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01619}01619\ \ \ \textcolor{comment}{//\ Wait\ for\ boot\ animation\ to\ finish\ if\ running\ (critical\ for\ button\ LEDs)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01620}01620\ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{led__task_8h_a006a24ec8e7f302c4a6f8481675803d1}{led\_is\_booting}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01621}01621\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01622}01622\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01623}01623\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01624}01624\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01625}01625\ \ \ \textcolor{comment}{//\ Update\ promotion\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01626}01626\ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01627}01627\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Updated\ promotion\ button\ LED\ indications"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01628}01628\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01629}01629\ \ \ \textcolor{comment}{//\ Reset\ auto-\/new\ game\ flags\ for\ all\ games\ (not\ just\ the\ first).}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01630}01630\ \ \ \textcolor{comment}{//\ This\ allows\ auto-\/new\ game\ detection\ to\ work\ after\ manual\ resets}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01631}01631\ \ \ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01632}01632\ \ \ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01633}01633\ \ \ \mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Reset\ block\ flag\ too}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01634}01634\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Auto\ new\ game\ detection\ flags\ reset\ for\ new\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01635}01635\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01636}01636\ \ \ \textcolor{comment}{//\ Boot\ sequence:\ first\ game\ vs.\ restart.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01637}01637\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >=\ 1)\ \{\ \textcolor{comment}{//\ Povolit\ highlight\ i\ pro\ první\ hru!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01638}01638\ \ \ \ \ \textcolor{comment}{//\ Restart\ hry\ -\/\ zvýraznit\ pohyblivé\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01639}01639\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));\ \textcolor{comment}{//\ Krátká\ pauza\ pro\ stabilizaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01640}01640\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01641}01641\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01642}01642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Highlighted\ movable\ pieces\ for\ starting\ player\ (restart)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01643}01643\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01644}01644\ \ \ \ \ \textcolor{comment}{//\ První\ hra\ -\/\ boot\ sequence\ stále\ probíhá,\ skipnout\ highlight}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01645}01645\ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01646}01646\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01647}01647\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Boot\ sequence:\ Skipping\ movable\ pieces\ highlight\ (first\ game)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01648}01648\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01649}01649\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01650}01650\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01651}01651\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01652}01652\ \textcolor{comment}{//\ BOARD\ UTILITY\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01653}01653\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01654}01654\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01655}\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{01655}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01656}01656\ \ \ \textcolor{keywordflow}{return}\ (row\ >=\ 0\ \&\&\ row\ <\ 8\ \&\&\ col\ >=\ 0\ \&\&\ col\ <\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01657}01657\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01658}01658\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01659}\mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{01659}}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01660}01660\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(row,\ col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01661}01661\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01662}01662\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01663}01663\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01664}01664\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01665}01665\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01666}\mbox{\hyperlink{game__task_8c_a3fc7b98c71a5a479e4f1965cb8229074}{01666}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a3fc7b98c71a5a479e4f1965cb8229074}{game\_set\_piece}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01667}01667\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(row,\ col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01668}01668\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01669}01669\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01670}01670\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01671}01671\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01672}01672\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01673}\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{01673}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01674}01674\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(row,\ col)\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01675}01675\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01676}01676\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01677}\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{01677}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01678}01678\ \ \ \textcolor{keywordflow}{return}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01679}01679\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01680}01680\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01681}\mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{01681}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01682}01682\ \ \ \textcolor{keywordflow}{return}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01683}01683\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01684}01684\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01685}\mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{01685}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{game\_is\_same\_color}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece1,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01686}01686\ \ \ \textcolor{keywordflow}{if}\ (piece1\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ ||\ piece2\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01687}01687\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01688}01688\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01689}01689\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece1)\ \&\&\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece2))\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01690}01690\ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece1)\ \&\&\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece2));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01691}01691\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01692}01692\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01693}\mbox{\hyperlink{game__task_8c_a7f6d6a865d66f62cfe46e3e29212f872}{01693}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a7f6d6a865d66f62cfe46e3e29212f872}{game\_is\_opponent\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01694}01694\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01695}01695\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01696}01696\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01697}01697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01698}01698\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01699}01699\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01700}01700\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01701}01701\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01702}01702\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01703}01703\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01704}01704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01705}01705\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01706}01706\ \textcolor{comment}{//\ MOVE\ VALIDATION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01707}01707\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01708}01708\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01709}\mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{01709}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01710}01710\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01711}01711\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae99b00ccc116996ee3eb7886d97f72e1}{MOVE\_ERROR\_INVALID\_MOVE\_STRUCTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01712}01712\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01713}01713\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01714}01714\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01715}01715\ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a93dee8ccd518ae0092501007a420e4bb}{game\_is\_valid\_position}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01716}01716\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a0d51fa502a0284e356d4c196152a9165}{MOVE\_ERROR\_OUT\_OF\_BOUNDS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01717}01717\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01718}01718\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01719}01719\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01720}01720\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a98e7980c293506d89bac9ef4fae9e237}{MOVE\_ERROR\_GAME\_NOT\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01721}01721\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01722}01722\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01723}01723\ \ \ \textcolor{comment}{//\ Check\ if\ source\ position\ has\ a\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01724}01724\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ source\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01725}01725\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01726}01726\ \ \ \textcolor{comment}{//\ Pokud\ je\ source\_piece\ prázdné\ (král\ je\ zvednutý\ během\ resignation\ timeru),}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01727}01727\ \ \ \textcolor{comment}{//\ použít\ move-\/>piece\ místo\ source\_piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01728}01728\ \ \ \textcolor{keywordflow}{if}\ (source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01729}01729\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ resignation\ timer\ aktivní\ a\ move-\/>piece\ je\ král,\ použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01730}01730\ \ \ \ \ \textcolor{comment}{//\ move-\/>piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01731}01731\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01732}01732\ \ \ \ \ \ \ \ \ (move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01733}01733\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row\ ==\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01734}01734\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col\ ==\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01735}01735\ \ \ \ \ \ \ source\_piece\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01736}01736\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01737}01737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ game\_is\_valid\_move:\ Using\ move-\/>piece\ (\%d)\ because\ king\ is\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01738}01738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}lifted\ (resignation\ timer\ active)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01739}01739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01740}01740\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01741}01741\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01742}01742\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01743}01743\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01744}01744\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01745}01745\ \ \ \textcolor{comment}{//\ Check\ if\ source\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01746}01746\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(source\_piece))\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01747}01747\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(source\_piece)))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01748}01748\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01749}01749\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01750}01750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01751}01751\ \ \ \textcolor{comment}{//\ Check\ if\ destination\ is\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01752}01752\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01753}01753\ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01754}01754\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{game\_is\_same\_color}}(source\_piece,\ dest\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01755}01755\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4dab65373947ddaa9d99838441f3fcff}{MOVE\_ERROR\_DESTINATION\_OCCUPIED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01756}01756\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01757}01757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01758}01758\ \ \ \textcolor{comment}{//\ KONTROLA\ ROŠÁDY\ V\ PROGRESS\ -\/\ PŘED\ validací\ pohybu\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01759}01759\ \ \ \textcolor{comment}{//\ Pokud\ je\ to\ správný\ rošáda\ tah\ věže,\ přeskočit\ standardní\ validaci\ pohybu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01760}01760\ \ \ \textcolor{comment}{//\ figurky\ (která\ by\ jinak\ zjistila,\ že\ cesta\ je\ blokovaná\ králem)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01761}01761\ \ \ \textcolor{keywordtype}{bool}\ is\_castling\_rook\_move\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01762}01762\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01763}01763\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ game\_is\_valid\_move:\ Castling\ in\ progress\ -\/\ checking\ if\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01764}01764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}this\ is\ the\ expected\ rook\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01765}01765\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Expected:\ from\ \%c\%d\ to\ \%c\%d,\ actual:\ from\ \%c\%d\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01766}01766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01767}01767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01768}01768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01769}01769\ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01770}01770\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01771}01771\ \ \ \ \ \textcolor{comment}{//\ Očekáváme\ tah\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01772}01772\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01773}01773\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01774}01774\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling\ in\ progress\ -\/\ expected\ rook\ move\ from\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01775}01775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01776}01776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01777}01777\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};\ \textcolor{comment}{//\ Použijeme\ existující\ error\ code}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01778}01778\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01779}01779\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01780}01780\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01781}01781\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ !=\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01782}01782\ \ \ \ \ \ \ ESP\_LOGE(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01783}01783\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Incorrect\ rook\ destination\ during\ castling\ -\/\ expected\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01784}01784\ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01785}01785\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};\ \textcolor{comment}{//\ Použijeme\ existující\ error\ code}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01786}01786\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01787}01787\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01788}01788\ \ \ \ \ \textcolor{comment}{//\ Toto\ je\ správný\ rošáda\ tah\ věže\ -\/\ přeskočit\ standardní\ validaci\ pohybu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01789}01789\ \ \ \ \ \textcolor{comment}{//\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01790}01790\ \ \ \ \ is\_castling\_rook\_move\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01791}01791\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Correct\ rook\ move\ for\ castling\ completion\ -\/\ skipping\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01792}01792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}standard\ piece\ validation\ (path\ would\ be\ blocked\ by\ king)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01793}01793\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01794}01794\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01795}01795\ \ \ \textcolor{comment}{//\ Validate\ move\ based\ on\ piece\ type\ (POUZE\ pokud\ NENÍ\ rošáda\ tah\ věže)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01796}01796\ \ \ \textcolor{keywordflow}{if}\ (!is\_castling\_rook\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01797}01797\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ piece\_error\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01798}01798\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(move,\ source\_piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01799}01799\ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\_error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01800}01800\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ piece\_error;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01801}01801\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01802}01802\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01803}01803\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01804}01804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Skipping\ standard\ piece\ validation\ for\ castling\ rook\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01805}01805\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01806}01806\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01807}01807\ \ \ \textcolor{comment}{//\ Check\ if\ move\ would\ leave\ king\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01808}01808\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{game\_would\_move\_leave\_king\_in\_check}}(move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01809}01809\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a1efb8e4fd12884711d5de2950e74f087}{MOVE\_ERROR\_KING\_IN\_CHECK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01810}01810\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01811}01811\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01812}01812\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01813}01813\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01814}01814\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01815}01815\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01816}\mbox{\hyperlink{game__task_8c_aefd2619f5dc787e72db00b8c24ecc405}{01816}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aefd2619f5dc787e72db00b8c24ecc405}{game\_is\_valid\_move\_bool}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01817}01817\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01818}01818\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01819}01819\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01820}\mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{01820}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01821}01821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01822}01822\ \ \ \textcolor{comment}{//\ int\ row\_diff\ =\ move-\/>to\_row\ -\/\ move-\/>from\_row;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01823}01823\ \ \ \textcolor{comment}{//\ int\ col\_diff\ =\ move-\/>to\_col\ -\/\ move-\/>from\_col;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01824}01824\ \ \ \textcolor{comment}{//\ int\ abs\_row\_diff\ =\ abs(row\_diff);}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01825}01825\ \ \ \textcolor{comment}{//\ int\ abs\_col\_diff\ =\ abs(col\_diff);}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01826}01826\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01827}01827\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01828}01828\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01829}01829\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01830}01830\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{game\_validate\_pawn\_move\_enhanced}}(move,\ piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01831}01831\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01832}01832\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01833}01833\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01834}01834\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{game\_validate\_knight\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01835}01835\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01836}01836\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01837}01837\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01838}01838\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01839}01839\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01840}01840\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01841}01841\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01842}01842\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01843}01843\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01844}01844\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01845}01845\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01846}01846\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{game\_validate\_queen\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01847}01847\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01848}01848\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01849}01849\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01850}01850\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{game\_validate\_king\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01851}01851\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01852}01852\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01853}01853\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01854}01854\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01855}01855\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01856}01856\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01857}01857\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01858}\mbox{\hyperlink{game__task_8c_ae7cbb1bf49cc0ab8394c2015b2adbaa1}{01858}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ae7cbb1bf49cc0ab8394c2015b2adbaa1}{game\_validate\_piece\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01859}01859\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(move,\ piece)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01860}01860\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01861}01861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01886}\mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{01886}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{game\_validate\_pawn\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01887}01887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01888}01888\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01889}01889\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01890}01890\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01891}01891\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01892}01892\ \ \ \textcolor{keywordtype}{bool}\ is\_white\ =\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01893}01893\ \ \ \textcolor{keywordtype}{int}\ direction\ =\ is\_white\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01894}01894\ \ \ \textcolor{keywordtype}{int}\ start\_row\ =\ is\_white\ ?\ 1\ :\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01895}01895\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01896}01896\ \ \ \textcolor{comment}{//\ \ Logovani\ validace\ pesce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01897}01897\ \ \ \textcolor{keywordtype}{char}\ from\_sq[3],\ to\_sq[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01898}01898\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ from\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01899}01899\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01900}01900\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01901}01901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01902}01902\ \ \ \textcolor{comment}{//\ Forward\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01903}01903\ \ \ \textcolor{keywordflow}{if}\ (col\_diff\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01904}01904\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ moving\ backwards\ (invalid\ for\ pawns)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01905}01905\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ *\ direction\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01906}01906\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ cannot\ move\ backwards"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01907}01907\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01908}01908\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01909}01909\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01910}01910\ \ \ \ \ \textcolor{comment}{//\ Single\ square\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01911}01911\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ direction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01912}01912\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01913}01913\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01914}01914\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01915}01915\ \ \ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Pawn\ \%s-\/>\%s:\ blocked\ by\ piece"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01916}01916\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01917}01917\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01918}01918\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01919}01919\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01920}01920\ \ \ \ \ \textcolor{comment}{//\ Double\ square\ move\ from\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01921}01921\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ 2\ *\ direction\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ ==\ start\_row)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01922}01922\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ direction,\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01923}01923\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01924}01924\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01925}01925\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01926}01926\ \ \ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Pawn\ \%s-\/>\%s:\ blocked\ path\ double\ move"{}},\ from\_sq,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01927}01927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01928}01928\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01929}01929\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01930}01930\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01931}01931\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01932}01932\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Pawn\ \%s-\/>\%s:\ invalid\ forward\ distance"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01933}01933\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01934}01934\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01935}01935\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01936}01936\ \ \ \textcolor{comment}{//\ Capture\ move\ (diagonal)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01937}01937\ \ \ \textcolor{keywordflow}{if}\ (abs\_col\_diff\ ==\ 1\ \&\&\ row\_diff\ ==\ direction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01938}01938\ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_afd3cb102b201b005212505e9fcc86612}{game\_is\_same\_color}}(piece,\ dest\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01939}01939\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Pawn\ \%s→\%s:\ valid\ capture\ of\ \%s"{}},\ from\_sq,\ to\_sq,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01940}01940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01941}01941\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01942}01942\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01943}01943\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01944}01944\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01945}01945\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01946}01946\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Pawn\ \%s→\%s:\ valid\ en\ passant"{}},\ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01947}01947\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01948}01948\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01949}01949\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01950}01950\ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01951}01951\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ diagonal\ to\ empty\ square\ (not\ en\ passant)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01952}01952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_sq,\ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01953}01953\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01954}01954\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ trying\ to\ capture\ own\ piece"{}},\ from\_sq,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01955}01955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01956}01956\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01957}01957\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01958}01958\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01959}01959\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01960}01960\ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01961}01961\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Pawn\ \%s→\%s:\ invalid\ move\ pattern\ (col\_diff=\%d,\ row\_diff=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01962}01962\ \ \ \ \ \ \ \ \ \ \ \ from\_sq,\ to\_sq,\ col\_diff,\ row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01963}01963\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01964}01964\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01965}01965\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01966}01966\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01967}\mbox{\hyperlink{game__task_8c_a9cd825eb0de3ca38648e5543dad28d45}{01967}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a9cd825eb0de3ca38648e5543dad28d45}{game\_validate\_pawn\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01968}01968\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a9fd338ce879b00b98ddb9d6b6988e5a1}{game\_validate\_pawn\_move\_enhanced}}(move,\ piece)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01969}01969\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01970}01970\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01971}\mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{01971}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{game\_validate\_knight\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01972}01972\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01973}01973\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01974}01974\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01975}01975\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01976}01976\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01977}01977\ \ \ \textcolor{comment}{//\ Knight\ moves\ in\ L-\/shape:\ 2\ squares\ in\ one\ direction,\ 1\ square\ perpendicular}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01978}01978\ \ \ \textcolor{keywordflow}{if}\ ((abs\_row\_diff\ ==\ 2\ \&\&\ abs\_col\_diff\ ==\ 1)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01979}01979\ \ \ \ \ \ \ (abs\_row\_diff\ ==\ 1\ \&\&\ abs\_col\_diff\ ==\ 2))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01980}01980\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01981}01981\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01982}01982\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01983}01983\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01984}01984\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01985}01985\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01986}01986\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01987}\mbox{\hyperlink{game__task_8c_a5d3594a8fc5be27b2309559f535ed67d}{01987}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a5d3594a8fc5be27b2309559f535ed67d}{game\_validate\_knight\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01988}01988\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a530c17b05f532aeaaa64d8bdb77ca665}{game\_validate\_knight\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01989}01989\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l01990}01990\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02009}\mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{02009}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02010}02010\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02011}02011\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02012}02012\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02013}02013\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02014}02014\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02015}02015\ \ \ \textcolor{comment}{//\ Bishop\ moves\ diagonally}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02016}02016\ \ \ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ !=\ abs\_col\_diff)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02017}02017\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02018}02018\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02019}02019\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02020}02020\ \ \ \textcolor{comment}{//\ Check\ if\ path\ is\ blocked}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02021}02021\ \ \ \textcolor{comment}{//\ Původně:\ while\ (...\&\&\ ...)\ -\/\ končilo\ předčasně}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02022}02022\ \ \ \textcolor{comment}{//\ Nově:\ while\ (...||\ ...)\ -\/\ kontroluje\ až\ do\ cíle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02023}02023\ \ \ \textcolor{keywordtype}{int}\ row\_step\ =\ (row\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02024}02024\ \ \ \textcolor{keywordtype}{int}\ col\_step\ =\ (col\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02025}02025\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02026}02026\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02027}02027\ \ \ \textcolor{keywordtype}{int}\ current\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ +\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02028}02028\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02029}02029\ \ \ \textcolor{comment}{//\ SAFETY:\ Prevent\ infinite\ loop\ (max\ 8\ squares\ on\ diagonal)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02030}02030\ \ \ \textcolor{keywordtype}{int}\ steps\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02031}02031\ \ \ \textcolor{keywordflow}{while}\ ((\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ||\ current\_col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02032}02032\ \ \ \ \ \ \ \ \ \ steps\ <\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02033}02033\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}},\ current\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02034}02034\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Bishop\ blocked\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ current\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02035}02035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02036}02036\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02037}02037\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02038}02038\ \ \ \ \ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ +=\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02039}02039\ \ \ \ \ current\_col\ +=\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02040}02040\ \ \ \ \ steps++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02041}02041\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02042}02042\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02043}02043\ \ \ \textcolor{comment}{//\ Safety\ check:\ if\ loop\ ended\ without\ reaching\ target,\ something\ is\ wrong}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02044}02044\ \ \ \textcolor{keywordflow}{if}\ (steps\ >=\ 8\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02045}02045\ \ \ \ \ \ \ (\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ||\ current\_col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02046}02046\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Bishop\ validation\ error:\ loop\ exceeded\ max\ steps"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02047}02047\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02048}02048\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02049}02049\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02050}02050\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02051}02051\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02052}02052\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02053}02053\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02054}\mbox{\hyperlink{game__task_8c_a6d303839b2a0088558c5b56452232f4b}{02054}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a6d303839b2a0088558c5b56452232f4b}{game\_validate\_bishop\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02055}02055\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02056}02056\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02057}02057\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02058}\mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{02058}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02059}02059\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02060}02060\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02061}02061\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02062}02062\ \ \ \textcolor{comment}{//\ Rook\ moves\ horizontally\ or\ vertically}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02063}02063\ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ !=\ 0\ \&\&\ col\_diff\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02064}02064\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02065}02065\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02066}02066\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02067}02067\ \ \ \textcolor{comment}{//\ Check\ if\ path\ is\ blocked}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02068}02068\ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02069}02069\ \ \ \ \ \textcolor{comment}{//\ Horizontal\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02070}02070\ \ \ \ \ \textcolor{keywordtype}{int}\ col\_step\ =\ (col\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02071}02071\ \ \ \ \ \textcolor{keywordtype}{int}\ current\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ +\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02072}02072\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02073}02073\ \ \ \ \ \textcolor{keywordflow}{while}\ (current\_col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02074}02074\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ current\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02075}02075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02076}02076\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02077}02077\ \ \ \ \ \ \ current\_col\ +=\ col\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02078}02078\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02079}02079\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02080}02080\ \ \ \ \ \textcolor{comment}{//\ Vertical\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02081}02081\ \ \ \ \ \textcolor{keywordtype}{int}\ row\_step\ =\ (row\_diff\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02082}02082\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02083}02083\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02084}02084\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02085}02085\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(\mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02086}02086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02087}02087\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02088}02088\ \ \ \ \ \ \ \mbox{\hyperlink{matrix__task_8c_aeccb1670596f160cce0ab5caec367e05}{current\_row}}\ +=\ row\_step;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02089}02089\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02090}02090\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02091}02091\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02092}02092\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02093}02093\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02094}02094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02095}02095\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02096}\mbox{\hyperlink{game__task_8c_ad41adafacc7ea4384a6b7337ddea7299}{02096}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad41adafacc7ea4384a6b7337ddea7299}{game\_validate\_rook\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02097}02097\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02098}02098\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02099}02099\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02100}\mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{02100}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{game\_validate\_queen\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02101}02101\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02102}02102\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02103}02103\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02104}02104\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02105}02105\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02106}02106\ \ \ \textcolor{comment}{//\ Queen\ moves\ like\ rook\ (horizontally/vertically)\ or\ bishop\ (diagonally)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02107}02107\ \ \ \textcolor{keywordflow}{if}\ (row\_diff\ ==\ 0\ ||\ col\_diff\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02108}02108\ \ \ \ \ \textcolor{comment}{//\ Rook-\/like\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02109}02109\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a4b858d85c199815887890cf595969c75}{game\_validate\_rook\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02110}02110\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ ==\ abs\_col\_diff)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02111}02111\ \ \ \ \ \textcolor{comment}{//\ Bishop-\/like\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02112}02112\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a94bb4afd94650885459c130f6c3a811d}{game\_validate\_bishop\_move\_enhanced}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02113}02113\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02114}02114\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02115}02115\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02116}02116\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02117}02117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02118}02118\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02119}\mbox{\hyperlink{game__task_8c_a29083b28e0ddc03048382e5c8e73c200}{02119}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a29083b28e0ddc03048382e5c8e73c200}{game\_validate\_queen\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02120}02120\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_acb3d6c97b1ab4160a2ed398cfa3b5b52}{game\_validate\_queen\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02121}02121\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02122}02122\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02139}\mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{02139}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{game\_validate\_king\_move\_enhanced}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02140}02140\ \ \ \textcolor{keywordtype}{int}\ row\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02141}02141\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02142}02142\ \ \ \textcolor{keywordtype}{int}\ abs\_row\_diff\ =\ abs(row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02143}02143\ \ \ \textcolor{keywordtype}{int}\ abs\_col\_diff\ =\ abs(col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02144}02144\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02145}02145\ \ \ \textcolor{comment}{//\ King\ moves\ one\ square\ in\ any\ direction}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02146}02146\ \ \ \textcolor{comment}{//\ Musi\ se\ pohnout\ alespon\ o\ 1\ pole\ (ne\ 0,0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02147}02147\ \ \ \textcolor{comment}{//\ Puvodni:\ povoloval\ tah\ na\ stejne\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02148}02148\ \ \ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ <=\ 1\ \&\&\ abs\_col\_diff\ <=\ 1\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02149}02149\ \ \ \ \ \ \ (abs\_row\_diff\ >\ 0\ ||\ abs\_col\_diff\ >\ 0))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02150}02150\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02151}02151\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02152}02152\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02153}02153\ \ \ \textcolor{comment}{//\ Check\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02154}02154\ \ \ \textcolor{keywordflow}{if}\ (abs\_row\_diff\ ==\ 0\ \&\&\ abs\_col\_diff\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02155}02155\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a7169001872522d780e6e67a15d86a47e}{game\_validate\_castling}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02156}02156\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02157}02157\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02158}02158\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02159}02159\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02160}02160\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02161}02161\ \textcolor{comment}{//\ Keep\ the\ old\ function\ for\ backward\ compatibility}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02162}\mbox{\hyperlink{game__task_8c_ab0a42f4f2685e64e790a1eb2a5df5530}{02162}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ab0a42f4f2685e64e790a1eb2a5df5530}{game\_validate\_king\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02163}02163\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_a210042709363b26c91b23a04ccac022a}{game\_validate\_king\_move\_enhanced}}(move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02164}02164\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02165}02165\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02183}\mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{02183}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{game\_would\_move\_leave\_king\_in\_check}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02184}02184\ \ \ \textcolor{keywordflow}{if}\ (!move)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02185}02185\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Safety\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02186}02186\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02187}02187\ \ \ \textcolor{comment}{//\ Save\ original\ board\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02188}02188\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_from\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02189}02189\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_to\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02190}02190\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02191}02191\ \ \ \textcolor{comment}{//\ Pokud\ je\ from\_piece\ prázdné\ (král\ je\ zvednutý\ během\ resignation\ timeru),}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02192}02192\ \ \ \textcolor{comment}{//\ použít\ move-\/>piece\ místo\ original\_from\_piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02193}02193\ \ \ \textcolor{keywordflow}{if}\ (original\_from\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02194}02194\ \ \ \ \ original\_from\_piece\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02195}02195\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02196}02196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ game\_would\_move\_leave\_king\_in\_check:\ Using\ move-\/>piece\ (\%d)\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02197}02197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}because\ from\ square\ is\ empty\ (king\ lifted)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02198}02198\ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02199}02199\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02200}02200\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02201}02201\ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ an\ en\ passant\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02202}02202\ \ \ \textcolor{keywordtype}{bool}\ is\_en\_passant\ =\ \mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02203}02203\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_en\_passant\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02204}02204\ \ \ uint8\_t\ en\_passant\_victim\_row\_local\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02205}02205\ \ \ uint8\_t\ en\_passant\_victim\_col\_local\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02206}02206\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02207}02207\ \ \ \textcolor{comment}{//\ If\ en\ passant,\ save\ the\ victim\ pawn\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02208}02208\ \ \ \textcolor{keywordflow}{if}\ (is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02209}02209\ \ \ \ \ original\_en\_passant\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02210}02210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02211}02211\ \ \ \ \ en\_passant\_victim\_row\_local\ =\ \mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02212}02212\ \ \ \ \ en\_passant\_victim\_col\_local\ =\ \mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02213}02213\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ victim\ pawn\ for\ simulation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02214}02214\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02215}02215\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02216}02216\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02217}02217\ \ \ \textcolor{comment}{//\ Make\ the\ move\ temporarily}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02218}02218\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ original\_from\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02219}02219\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02220}02220\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02221}02221\ \ \ \textcolor{comment}{//\ Determine\ which\ player's\ king\ to\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02222}02222\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02223}02223\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(original\_from\_piece))\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02224}02224\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02225}02225\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check\ after\ this\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02226}02226\ \ \ \textcolor{keywordtype}{bool}\ king\_in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02227}02227\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02228}02228\ \ \ \textcolor{comment}{//\ Undo\ the\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02229}02229\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}]\ =\ original\_from\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02230}02230\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ original\_to\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02231}02231\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02232}02232\ \ \ \textcolor{comment}{//\ Restore\ en\ passant\ victim\ if\ it\ was\ removed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02233}02233\ \ \ \textcolor{keywordflow}{if}\ (is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02234}02234\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[en\_passant\_victim\_row\_local][en\_passant\_victim\_col\_local]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02235}02235\ \ \ \ \ \ \ \ \ original\_en\_passant\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02236}02236\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02237}02237\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02238}02238\ \ \ \textcolor{keywordflow}{return}\ king\_in\_check;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02239}02239\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02240}02240\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02255}\mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{02255}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02256}02256\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02257}02257\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ no\ last\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02258}02258\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02259}02259\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02260}02260\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02261}02261\ \ \ \textcolor{comment}{//\ Check\ if\ the\ last\ move\ was\ a\ pawn\ moving\ two\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02262}02262\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ last\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}][\mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02263}02263\ \ \ \textcolor{keywordtype}{bool}\ last\_was\_pawn\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02264}02264\ \ \ \ \ \ \ (last\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ last\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02265}02265\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02266}02266\ \ \ \textcolor{keywordflow}{if}\ (!last\_was\_pawn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02267}02267\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ last\ move\ was\ not\ pawn"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02268}02268\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02269}02269\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02270}02270\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02271}02271\ \ \ \textcolor{comment}{//\ Check\ if\ last\ move\ was\ a\ double\ square\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02272}02272\ \ \ \textcolor{keywordtype}{int}\ last\_row\_diff\ =\ abs((\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ -\/\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02273}02273\ \ \ \textcolor{keywordflow}{if}\ (last\_row\_diff\ !=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02274}02274\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ last\ move\ was\ not\ 2\ squares\ (diff=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02275}02275\ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_row\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02276}02276\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02277}02277\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02278}02278\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02279}02279\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ útočící\ pěšec\ je\ na\ stejném\ řádku\ jako\ právě}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02280}02280\ \ \ \textcolor{comment}{//\ pohnutý\ pěšec}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02281}02281\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ !=\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02282}02282\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02283}02283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ attacking\ pawn\ not\ on\ same\ row\ (from\_row=\%d,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02284}02284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}last\_to\_row=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02285}02285\ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02286}02286\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02287}02287\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02288}02288\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02289}02289\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ útočící\ pěšec\ je\ přesně\ vedle\ právě\ pohnutého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02290}02290\ \ \ \textcolor{comment}{//\ pěšce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02291}02291\ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ abs((\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ -\/\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02292}02292\ \ \ \textcolor{keywordflow}{if}\ (col\_diff\ !=\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02293}02293\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ En\ passant:\ pawn\ not\ adjacent\ (col\_diff=\%d)"{}},\ col\_diff);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02294}02294\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02295}02295\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02296}02296\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02297}02297\ \ \ \textcolor{comment}{//\ En\ passant\ pole\ je\ vždy\ uprostřed\ mezi\ from\ a\ to\ (prostý\ průměr)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02298}02298\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ =\ (\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ +\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}})\ /\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02299}02299\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02300}02300\ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02301}02301\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ En\ passant\ check:\ last=\%c\%d→\%c\%d,\ target=\%c\%d,\ move=\%c\%d→\%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02302}02302\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}},\ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02303}02303\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}},\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02304}02304\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02305}02305\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02306}02306\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02307}02307\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02308}02308\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02309}02309\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ En\ passant\ VALID!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02310}02310\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02311}02311\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02312}02312\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02313}02313\ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02314}02314\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ En\ passant:\ target\ mismatch\ (to\_row=\%d\ vs\ target=\%d,\ to\_col=\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02315}02315\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}vs\ last\_col=\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02316}02316\ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02317}02317\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02318}02318\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02319}02319\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02342}\mbox{\hyperlink{game__task_8c_a7169001872522d780e6e67a15d86a47e}{02342}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_a7169001872522d780e6e67a15d86a47e}{game\_validate\_castling}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02343}02343\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02344}02344\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae99b00ccc116996ee3eb7886d97f72e1}{MOVE\_ERROR\_INVALID\_MOVE\_STRUCTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02345}02345\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02346}02346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02347}02347\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02348}02348\ \ \ \textcolor{keywordtype}{bool}\ is\_white\ =\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02349}02349\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02350}02350\ \ \ \textcolor{comment}{//\ Check\ if\ it's\ a\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02351}02351\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02352}02352\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02353}02353\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02354}02354\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02355}02355\ \ \ \textcolor{comment}{//\ Check\ if\ king\ has\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02356}02356\ \ \ \textcolor{keywordflow}{if}\ ((is\_white\ \&\&\ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}})\ ||\ (!is\_white\ \&\&\ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02357}02357\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ king\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02358}02358\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02359}02359\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02360}02360\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02361}02361\ \ \ \textcolor{comment}{//\ Pokud\ je\ resignation\ timer\ aktivní\ a\ král\ je\ zvednutý,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02362}02362\ \ \ \textcolor{comment}{//\ použít\ uloženou\ pozici\ krále\ z\ resignation\_state\ místo\ kontroly\ desky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02363}02363\ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ is\_white\ ?\ 0\ :\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02364}02364\ \ \ \textcolor{keywordtype}{int}\ expected\_king\_col\ =\ 4;\ \textcolor{comment}{//\ e-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02365}02365\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02366}02366\ \ \ \textcolor{comment}{//\ Pokud\ je\ resignation\ timer\ aktivní\ a\ král\ patří\ aktuálnímu\ hráči,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02367}02367\ \ \ \textcolor{comment}{//\ použít\ uloženou\ pozici\ krále\ z\ resignation\_state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02368}02368\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02369}02369\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ (is\_white\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02370}02370\ \ \ \ \ \textcolor{comment}{//\ Král\ je\ zvednutý\ -\/\ použít\ uloženou\ pozici\ z\ resignation\_state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02371}02371\ \ \ \ \ king\_row\ =\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02372}02372\ \ \ \ \ expected\_king\_col\ =\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02373}02373\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02374}02374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castling\ validation:\ Using\ stored\ king\ position\ from\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02375}02375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}resignation\_state:\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02376}02376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ expected\_king\_col,\ king\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02377}02377\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02378}02378\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02379}02379\ \ \ \textcolor{comment}{//\ Kontrola,\ zda\ from\_row/from\_col\ odpovídá\ očekávané\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02380}02380\ \ \ \textcolor{comment}{//\ (buď\ z\ desky,\ nebo\ z\ resignation\_state)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02381}02381\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ !=\ king\_row\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ !=\ expected\_king\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02382}02382\ \ \ \ \ ESP\_LOGD(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02383}02383\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02384}02384\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Castling:\ king\ not\ in\ starting\ position\ (from\ \%c\%d,\ expected\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02385}02385\ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ expected\_king\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02386}02386\ \ \ \ \ \ \ \ \ king\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02387}02387\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02388}02388\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02389}02389\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02390}02390\ \ \ \textcolor{comment}{//\ Determine\ castling\ direction}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02391}02391\ \ \ \textcolor{keywordtype}{bool}\ is\_kingside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ 6);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02392}02392\ \ \ \textcolor{keywordtype}{bool}\ is\_queenside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02393}02393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02394}02394\ \ \ \textcolor{keywordflow}{if}\ (!is\_kingside\ \&\&\ !is\_queenside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02395}02395\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02396}02396\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02397}02397\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02398}02398\ \ \ \textcolor{comment}{//\ Determine\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02399}02399\ \ \ \textcolor{keywordtype}{int}\ rook\_col\ =\ is\_kingside\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02400}02400\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02401}02401\ \ \ \textcolor{comment}{//\ Check\ if\ rook\ exists\ at\ expected\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02402}02402\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ expected\_rook\ =\ is\_white\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02403}02403\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ rook\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][rook\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02404}02404\ \ \ \textcolor{keywordflow}{if}\ (rook\_piece\ !=\ expected\_rook)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02405}02405\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ rook\ not\ found\ at\ expected\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02406}02406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ rook\_col,\ king\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02407}02407\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02408}02408\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02409}02409\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02410}02410\ \ \ \textcolor{comment}{//\ Check\ if\ corresponding\ rook\ has\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02411}02411\ \ \ \textcolor{keywordflow}{if}\ (is\_white)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02412}02412\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside\ \&\&\ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02413}02413\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ kingside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02414}02414\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02415}02415\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02416}02416\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_queenside\ \&\&\ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02417}02417\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ queenside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02418}02418\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02419}02419\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02420}02420\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02421}02421\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside\ \&\&\ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02422}02422\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ kingside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02423}02423\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02424}02424\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02425}02425\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_queenside\ \&\&\ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02426}02426\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Castling:\ queenside\ rook\ has\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02427}02427\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02428}02428\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02429}02429\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02430}02430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02431}02431\ \ \ \textcolor{comment}{//\ Check\ if\ squares\ between\ king\ and\ rook\ are\ empty}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02432}02432\ \ \ \textcolor{comment}{//\ rook\_col\ již\ definováno\ výše}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02433}02433\ \ \ \textcolor{keywordtype}{int}\ start\_col\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02434}02434\ \ \ \ \ \ \ (move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ <\ rook\_col)\ ?\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ +\ 1\ :\ rook\_col\ +\ 1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02435}02435\ \ \ \textcolor{keywordtype}{int}\ end\_col\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ <\ rook\_col)\ ?\ rook\_col\ :\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02436}02436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02437}02437\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ start\_col;\ col\ <\ end\_col;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02438}02438\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a2f77ab43a39a2a3ebc640df092f9cdc1}{game\_is\_empty}}(king\_row,\ col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02439}02439\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02440}02440\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02441}02441\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02442}02442\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02443}02443\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ currently\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02444}02444\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(is\_white\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02445}02445\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02446}02446\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02447}02447\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02448}02448\ \ \ \textcolor{comment}{//\ Check\ if\ king\ would\ move\ through\ check\ or\ end\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02449}02449\ \ \ \textcolor{keywordtype}{int}\ step\ =\ is\_kingside\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02450}02450\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};\ col\ !=\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ +\ step;\ col\ +=\ step)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02451}02451\ \ \ \ \ \textcolor{keywordflow}{if}\ (col\ ==\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02452}02452\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};\ \textcolor{comment}{//\ Skip\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02453}02453\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02454}02454\ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ to\ test\ this\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02455}02455\ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02456}02456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02457}02457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02458}02458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02459}02459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02460}02460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02461}02461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02462}02462\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02463}02463\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af6d73d7ab8a4c7b188d690a5177a0072}{game\_would\_move\_leave\_king\_in\_check}}(\&temp\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02464}02464\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02465}02465\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02466}02466\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02467}02467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02468}02468\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02469}02469\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02470}02470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02471}02471\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02472}02472\ \textcolor{comment}{//\ ERROR\ FORMATTING\ HELPER}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02473}02473\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02474}02474\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02486}\mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{02486}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *label,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *fmt,\ ...)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02487}02487\ \ \ va\_list\ args;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02488}02488\ \ \ \textcolor{keywordtype}{char}\ buffer[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02489}02489\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02490}02490\ \ \ va\_start(args,\ fmt);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02491}02491\ \ \ vsnprintf(buffer,\ \textcolor{keyword}{sizeof}(buffer),\ fmt,\ args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02492}02492\ \ \ va\_end(args);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02493}02493\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02494}02494\ \ \ \textcolor{comment}{//\ Format\ based\ on\ label\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02495}02495\ \ \ \textcolor{keywordflow}{if}\ (strcmp(label,\ \textcolor{stringliteral}{"{}Reason"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02496}02496\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a7f026776e12ac1b5e7736c24b756085d}{ANSI\_RED}}\ \textcolor{stringliteral}{"{}\ \ \ •\ \%s:\ "{}}\ \mbox{\hyperlink{game__colors_8h_a46587b83544b8e9be045bb93f644ac82}{ANSI\_BOLD}}\ \textcolor{stringliteral}{"{}\%s"{}}\ \mbox{\hyperlink{game__colors_8h_af77a445894f2f750d43cf2182cd29e55}{ANSI\_RESET}}\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ label,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02497}02497\ \ \ \ \ \ \ \ \ \ \ \ buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02498}02498\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcmp(label,\ \textcolor{stringliteral}{"{}Hint"{}})\ ==\ 0\ ||\ strcmp(label,\ \textcolor{stringliteral}{"{}Solution"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02499}02499\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a3bfaa4ef17d08f922b975ab28af9b499}{FMT\_HINT}}(\textcolor{stringliteral}{"{}\ \ \ •\ \%s:\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ label,\ buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02500}02500\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02501}02501\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ \%s:\ \%s\(\backslash\)r\(\backslash\)n"{}},\ label,\ buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02502}02502\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02503}02503\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02504}02504\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02524}\mbox{\hyperlink{game__task_8c_a8d2513928ede14f22023e22c775c3033}{02524}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8d2513928ede14f22023e22c775c3033}{game\_display\_move\_error}}(\mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02525}02525\ \ \ \textcolor{keywordtype}{char}\ from\_square[3],\ to\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02526}02526\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02527}02527\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02528}02528\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02529}02529\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name\ =\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02530}02530\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *player\_name\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02531}02531\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02532}02532\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ source\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02533}02533\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02534}02534\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02535}02535\ \ \ \textcolor{comment}{//\ Enhanced\ error\ messages\ with\ colors\ and\ detailed\ reasoning}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02536}02536\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02537}02537\ \ \ printf(\mbox{\hyperlink{game__colors_8h_a60d4e1d55cc7102123ffe5c3539ec165}{FMT\_ERROR}}(\textcolor{stringliteral}{"{}❌\ INVALID\ MOVE!"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02538}02538\ \ \ printf(\mbox{\hyperlink{game__colors_8h_abd9912e75415821ab3192e7cf4542b6d}{FMT\_INFO}}(\textcolor{stringliteral}{"{}\ \ \ •\ Move:\ \%s\ →\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02539}02539\ \ \ printf(\mbox{\hyperlink{game__colors_8h_abd9912e75415821ab3192e7cf4542b6d}{FMT\_INFO}}(\textcolor{stringliteral}{"{}\ \ \ •\ Piece:\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02540}02540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02541}02541\ \ \ \textcolor{keywordflow}{switch}\ (error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02542}02542\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02543}02543\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}No\ piece\ at\ \%s"{}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02544}02544\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Choose\ a\ square\ with\ your\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02545}02545\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02546}02546\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02547}02547\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02548}02548\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}\%s\ cannot\ move\ \%s's\ piece"{}},\ player\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02549}02549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02550}02550\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Move\ only\ your\ own\ pieces"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02551}02551\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02552}02552\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02553}02553\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02554}02554\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Path\ from\ \%s\ to\ \%s\ is\ blocked"{}},\ from\_square,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02555}02555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02556}02556\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}Another\ piece\ is\ blocking\ the\ way"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02557}02557\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02558}02558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Clear\ the\ path\ or\ choose\ different\ destination"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02559}02559\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02560}02560\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02561}02561\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a6dc786a7e8aea2d1f178c80c73848675}{MOVE\_ERROR\_INVALID\_PATTERN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02562}02562\ \ \ \ \ \textcolor{comment}{//\ VYLEPŠENÉ\ REASONING\ pro\ pěšce}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02563}02563\ \ \ \ \ \textcolor{keywordflow}{if}\ (source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02564}02564\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ col\_diff\ =\ abs((\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02565}02565\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_diagonal\ =\ (col\_diff\ ==\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02566}02566\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02567}02567\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_diagonal\ \&\&\ dest\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02568}02568\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02569}02569\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Reason"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02570}02570\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Pawn\ can\ only\ capture\ diagonally\ when\ enemy\ piece\ is\ present"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02571}02571\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02572}02572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Square\ \%s\ is\ empty\ -\/\ pawns\ cannot\ move\ diagonally\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02573}02573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}to\ empty\ squares"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02574}02574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02575}02575\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02576}02576\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02577}02577\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Move\ pawn\ forward\ or\ capture\ diagonally\ where\ enemy\ piece\ is"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02578}02578\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!is\_diagonal\ \&\&\ dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02579}02579\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Pawn\ cannot\ capture\ straight\ ahead"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02580}02580\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02581}02581\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}Square\ \%s\ is\ occupied\ -\/\ pawns\ can\ only\ capture\ diagonally"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02582}02582\ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02583}02583\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02584}02584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Capture\ the\ piece\ diagonally,\ not\ forward"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02585}02585\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02586}02586\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Pawn\ cannot\ move\ in\ this\ pattern"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02587}02587\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}Pawns\ move\ forward\ 1\ square\ (or\ 2\ from\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02588}02588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}start),\ capture\ diagonally"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02589}02589\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Follow\ pawn\ movement\ rules"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02590}02590\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02591}02591\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02592}02592\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}\%s\ cannot\ move\ from\ \%s\ to\ \%s"{}},\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02593}02593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02594}02594\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Follow\ the\ piece's\ movement\ rules"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02595}02595\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02596}02596\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02597}02597\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02598}02598\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a1efb8e4fd12884711d5de2950e74f087}{MOVE\_ERROR\_KING\_IN\_CHECK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02599}02599\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02600}02600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}This\ move\ would\ leave/keep\ your\ king\ in\ check"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02601}02601\ \ \ \ \ \textcolor{comment}{//\ Find\ and\ display\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02602}02602\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a3bfaa4ef17d08f922b975ab28af9b499}{FMT\_HINT}}(\textcolor{stringliteral}{"{}\ \ \ •\ Hint:\ Your\ king\ at\ "{}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02603}02603\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02604}02604\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02605}02605\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ =\ 0;\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ <\ 8;\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02606}02606\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ c\ =\ 0;\ c\ <\ 8;\ c++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02607}02607\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}][c]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02608}02608\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ king\_sq[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02609}02609\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(\mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}},\ c,\ king\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02610}02610\ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s\ would\ be\ under\ attack\(\backslash\)r\(\backslash\)n"{}},\ king\_sq);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02611}02611\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ king\_found;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02612}02612\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02613}02613\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02614}02614\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02615}02615\ \ \ \ \ printf(\textcolor{stringliteral}{"{}is\ under\ attack\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02616}02616\ \ \ king\_found:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02617}02617\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02618}02618\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02619}02619\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Protect\ your\ king\ by\ blocking,\ capturing\ attacker,\ or\ moving\ king"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02620}02620\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02621}02621\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02622}02622\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02623}02623\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Castling\ is\ not\ allowed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02624}02624\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02625}02625\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}King/Rook\ moved,\ squares\ under\ attack,\ or\ path\ blocked"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02626}02626\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02627}02627\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Castling\ requires\ unmoved\ king\ and\ rook\ with\ clear\ path"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02628}02628\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02629}02629\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02630}02630\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ac71919eb046ab42ba1e6a622b914863a}{MOVE\_ERROR\_EN\_PASSANT\_INVALID}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02631}02631\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}En\ passant\ is\ not\ possible\ here"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02632}02632\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}En\ passant\ only\ works\ immediately\ after\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02633}02633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}opponent's\ 2-\/square\ pawn\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02634}02634\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Capture\ normally\ or\ make\ different\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02635}02635\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02636}02636\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02637}02637\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4dab65373947ddaa9d99838441f3fcff}{MOVE\_ERROR\_DESTINATION\_OCCUPIED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02638}02638\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Destination\ \%s\ is\ occupied\ by\ your\ own\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02639}02639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square,\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02640}02640\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Hint"{}},\ \textcolor{stringliteral}{"{}You\ cannot\ capture\ your\ own\ pieces"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02641}02641\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02642}02642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Choose\ empty\ square\ or\ capture\ opponent's\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02643}02643\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02644}02644\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02645}02645\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a0d51fa502a0284e356d4c196152a9165}{MOVE\_ERROR\_OUT\_OF\_BOUNDS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02646}02646\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Coordinates\ are\ out\ of\ board\ bounds"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02647}02647\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Use\ valid\ chess\ notation\ (a1-\/h8)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02648}02648\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02649}02649\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02650}02650\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a98e7980c293506d89bac9ef4fae9e237}{MOVE\_ERROR\_GAME\_NOT\_ACTIVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02651}02651\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Game\ is\ not\ active"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02652}02652\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02653}02653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Start\ a\ new\ game\ first\ (use\ GAME\_NEW\ command)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02654}02654\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02655}02655\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02656}02656\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae99b00ccc116996ee3eb7886d97f72e1}{MOVE\_ERROR\_INVALID\_MOVE\_STRUCTURE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02657}02657\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Move\ structure\ is\ invalid"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02658}02658\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02659}02659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Use\ proper\ move\ format\ (e.g.,\ e2e4\ or\ e2-\/e4)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02660}02660\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02661}02661\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02662}02662\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02663}02663\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Reason"{}},\ \textcolor{stringliteral}{"{}Unknown\ error\ occurred\ (code:\ \%d)"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02664}02664\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8025d8136c027e3884d5e8cbe8ee147a}{print\_error\_detail}}(\textcolor{stringliteral}{"{}Solution"{}},\ \textcolor{stringliteral}{"{}Try\ a\ different\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02665}02665\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02666}02666\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02667}02667\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02668}02668\ \ \ \textcolor{comment}{//\ Zobrazit\ stav\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02669}02669\ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02670}02670\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a4c5526bcd50bcf745bcbebcd4bc1b1e4}{FMT\_DATA}}(\textcolor{stringliteral}{"{}\ \ \ •\ Target:\ \%s\ at\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02671}02671\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece),\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02672}02672\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02673}02673\ \ \ \ \ printf(\mbox{\hyperlink{game__colors_8h_a4c5526bcd50bcf745bcbebcd4bc1b1e4}{FMT\_DATA}}(\textcolor{stringliteral}{"{}\ \ \ •\ Target:\ Empty\ square\ at\ \%s"{}})\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02674}02674\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02675}02675\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02676}02676\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02677}02677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02678}02678\ \ \ \textcolor{comment}{//\ Show\ helpful\ suggestions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02679}02679\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a53e9e83a9003c07651e45d0f0c7cc594}{tutorial\_mode\_active}}\ \&\&\ \mbox{\hyperlink{game__task_8c_afae0eab069ccc976d3057e2faaef476b}{show\_hints}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02680}02680\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6e5f0e6f61004c63b6da0114e626c68b}{game\_show\_move\_suggestions}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02681}02681\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02682}02682\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02683}02683\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02689}\mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{02689}}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02690}02690\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02691}02691\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02692}02692\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Empty"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02693}02693\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02694}02694\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Pawn"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02695}02695\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02696}02696\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02697}02697\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02698}02698\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02699}02699\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02700}02700\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02701}02701\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02702}02702\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02703}02703\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02704}02704\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}White\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02705}02705\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02706}02706\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Pawn"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02707}02707\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02708}02708\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02709}02709\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02710}02710\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02711}02711\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02712}02712\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02713}02713\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02714}02714\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02715}02715\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02716}02716\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Black\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02717}02717\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02718}02718\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02719}02719\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02720}02720\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02721}02721\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02722}02722\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02723}02723\ \textcolor{comment}{//\ STRING\ BUILDING\ HELPER}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02724}02724\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02725}02725\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02739}\mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{02739}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{int}\ pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02740}02740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02741}02741\ \ \ \textcolor{comment}{//\ Pridat\ separator\ pokud\ uz\ neco\ v\ bufferu\ je}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02742}02742\ \ \ \textcolor{keywordflow}{if}\ (pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02743}02743\ \ \ \ \ pos\ +=\ snprintf(buffer\ +\ pos,\ size\ -\/\ pos,\ \textcolor{stringliteral}{"{},\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02744}02744\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02745}02745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02746}02746\ \ \ \textcolor{comment}{//\ Pridat\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02747}02747\ \ \ pos\ +=\ snprintf(buffer\ +\ pos,\ size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\%s"{}},\ square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02748}02748\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02749}02749\ \ \ \textcolor{keywordflow}{return}\ pos;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02750}02750\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02751}02751\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02757}\mbox{\hyperlink{game__task_8c_a6e5f0e6f61004c63b6da0114e626c68b}{02757}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6e5f0e6f61004c63b6da0114e626c68b}{game\_show\_move\_suggestions}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02758}02758\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02759}02759\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02760}02760\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Hint:\ No\ piece\ at\ this\ position"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02761}02761\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02762}02762\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02763}02763\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02764}02764\ \ \ \textcolor{comment}{//\ Get\ available\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02765}02765\ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[50];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02766}02766\ \ \ uint32\_t\ count\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 50);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02767}02767\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02768}02768\ \ \ \textcolor{keywordflow}{if}\ (count\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02769}02769\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02770}02770\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(row,\ col,\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02771}02771\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Hint:\ \%s\ at\ \%s\ has\ no\ legal\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02772}02772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(piece),\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02773}02773\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02774}02774\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02775}02775\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02776}02776\ \ \ \textcolor{keywordtype}{char}\ from\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02777}02777\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(row,\ col,\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02778}02778\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Hint:\ \%s\ at\ \%s\ can\ move\ to:"{}},\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(piece),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02779}02779\ \ \ \ \ \ \ \ \ \ \ \ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02780}02780\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02781}02781\ \ \ \textcolor{comment}{//\ Group\ moves\ by\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02782}02782\ \ \ \textcolor{keywordtype}{char}\ normal\_moves[128]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02783}02783\ \ \ \textcolor{keywordtype}{char}\ capture\_moves[128]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02784}02784\ \ \ \textcolor{keywordtype}{char}\ special\_moves[128]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02785}02785\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02786}02786\ \ \ \textcolor{keywordtype}{int}\ normal\_pos\ =\ 0,\ capture\_pos\ =\ 0,\ special\_pos\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02787}02787\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02788}02788\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ count\ \&\&\ i\ <\ 20;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02789}02789\ \ \ \ \ \ \ \ i++)\ \{\ \textcolor{comment}{//\ Limit\ to\ 20\ moves\ for\ display}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02790}02790\ \ \ \ \ \textcolor{keywordtype}{char}\ to\_square[3];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02791}02791\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(suggestions[i].to\_row,\ suggestions[i].to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02792}02792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02793}02793\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02794}02794\ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[i].is\_capture)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02795}02795\ \ \ \ \ \ \ capture\_pos\ =\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(capture\_moves,\ \textcolor{keyword}{sizeof}(capture\_moves),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02796}02796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ capture\_pos,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02797}02797\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (suggestions[i].is\_castling\ ||\ suggestions[i].is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02798}02798\ \ \ \ \ \ \ special\_pos\ =\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(special\_moves,\ \textcolor{keyword}{sizeof}(special\_moves),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02799}02799\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ special\_pos,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02800}02800\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02801}02801\ \ \ \ \ \ \ normal\_pos\ =\ \mbox{\hyperlink{game__task_8c_ad6648c67da9dcf078bc2e9a5b3eed081}{append\_square}}(normal\_moves,\ \textcolor{keyword}{sizeof}(normal\_moves),\ normal\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02802}02802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02803}02803\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02804}02804\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02805}02805\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02806}02806\ \ \ \textcolor{keywordflow}{if}\ (normal\_pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02807}02807\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Normal\ moves:\ \%s"{}},\ normal\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02808}02808\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02809}02809\ \ \ \textcolor{keywordflow}{if}\ (capture\_pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02810}02810\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Capture\ moves:\ \%s"{}},\ capture\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02811}02811\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02812}02812\ \ \ \textcolor{keywordflow}{if}\ (special\_pos\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02813}02813\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Special\ moves:\ \%s"{}},\ special\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02814}02814\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02815}02815\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02816}02816\ \ \ \textcolor{keywordflow}{if}\ (count\ >\ 20)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02817}02817\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ ...\ and\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ more\ moves"{}},\ count\ -\/\ 20);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02818}02818\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02819}02819\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02820}02820\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02829}\mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{02829}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(uint8\_t\ row,\ uint8\_t\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02830}02830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ *suggestions,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02831}02831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ max\_suggestions)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02832}02832\ \ \ \textcolor{keywordflow}{if}\ (suggestions\ ==\ NULL\ ||\ max\_suggestions\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02833}02833\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02834}02834\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02835}02835\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02836}02836\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02837}02837\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02838}02838\ \ \ \textcolor{comment}{//\ Pokud\ je\ piece\ prázdné\ a\ resignation\ timer\ je\ aktivní\ pro\ tuto\ pozici,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02839}02839\ \ \ \textcolor{comment}{//\ použít\ uloženou\ pozici\ krále\ z\ resignation\_state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02840}02840\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02841}02841\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row\ ==\ row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02842}02842\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col\ ==\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02843}02843\ \ \ \ \ \ \ \textcolor{comment}{//\ Král\ je\ zvednutý\ během\ resignation\ timeru\ -\/\ použít\ typ\ krále\ z}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02844}02844\ \ \ \ \ \ \ \textcolor{comment}{//\ resignation\_state.player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02845}02845\ \ \ \ \ \ \ piece\ =\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02846}02846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02847}02847\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02848}02848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ game\_get\_available\_moves:\ Using\ stored\ king\ piece\ (\%d)\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02849}02849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}because\ king\ is\ lifted\ (resignation\ timer\ active)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02850}02850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02851}02851\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02852}02852\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02853}02853\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02854}02854\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02855}02855\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02856}02856\ \ \ uint32\_t\ count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02857}02857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02858}02858\ \ \ \textcolor{comment}{//\ Pokud\ je\ rošáda\ v\ progress\ a\ zvedá\ se\ věž\ z\ rook\_from,\ přidat\ tah\ na}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02859}02859\ \ \ \textcolor{comment}{//\ rook\_to\ jako\ valid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02860}02860\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02861}02861\ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02862}02862\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02863}02863\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ game\_get\_available\_moves:\ castling\_state.in\_progress=true,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02864}02864\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}checking\ row=\%d\ col=\%d\ piece=\%d,\ rook\_from\_row=\%d\ rook\_from\_col=\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02865}02865\ \ \ \ \ \ \ \ \ row,\ col,\ piece,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02866}02866\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02867}02867\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02868}02868\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02869}02869\ \ \ \ \ \ \ \ \ col\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02870}02870\ \ \ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02871}02871\ \ \ \ \ \ \ \textcolor{comment}{//\ Toto\ je\ věž\ pro\ rošádu\ -\/\ přidat\ tah\ na\ rook\_to\ jako\ valid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02872}02872\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02873}02873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castling\ rook\ detected\ at\ \%c\%d\ -\/\ adding\ valid\ move\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02874}02874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02875}02875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02876}02876\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02877}02877\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (count\ <\ max\_suggestions)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02878}02878\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a940eca031248f8df49031c483af30f13}{from\_row}}\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02879}02879\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a5805172608c1e85601ee674644b69fe7}{from\_col}}\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02880}02880\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}}\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02881}02881\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}}\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02882}02882\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a95bfdc4963cc77122f941663554a8a67}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02883}02883\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02884}02884\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a39763b8b278db010f5dfff7a4beb264a}{is\_check}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02885}02885\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_aa9a5da748efa93feb7e3f7c4f06e7839}{is\_castling}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02886}02886\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a77114011b2edb38b0218c36ce67cf0e6}{is\_en\_passant}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02887}02887\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a96c798a72d6ed66a18c8b2d1e840e604}{score}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02888}02888\ \ \ \ \ \ \ \ \ count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02889}02889\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02890}02890\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02891}02891\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castling\ rook:\ Added\ valid\ move\ from\ \%c\%d\ to\ \%c\%d\ (count=\%u)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02892}02892\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02893}02893\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1,\ count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02894}02894\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ count;\ \textcolor{comment}{//\ Vrátit\ pouze\ tento\ tah\ -\/\ ostatní\ tahy\ jsou\ blokované}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02895}02895\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02896}02896\ \ \ \ \ \ \ \ \ ESP\_LOGW(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02897}02897\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02898}02898\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castling\ rook:\ max\_suggestions=\%lu\ reached,\ cannot\ add\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02899}02899\ \ \ \ \ \ \ \ \ \ \ \ \ max\_suggestions);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02900}02900\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02901}02901\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02902}02902\ \ \ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02903}02903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ game\_get\_available\_moves:\ Not\ castling\ rook\ -\/\ row=\%d\ col=\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02904}02904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}piece=\%d\ vs\ rook\_from\_row=\%d\ rook\_from\_col=\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02905}02905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ row,\ col,\ piece,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02906}02906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02907}02907\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02908}02908\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02909}02909\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02910}02910\ \ \ \textcolor{comment}{//\ Optimized\ move\ generation\ based\ on\ piece\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02911}02911\ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02912}02912\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02913}02913\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02914}02914\ \ \ \ \ \textcolor{comment}{//\ Knight\ moves\ in\ L-\/shape:\ 8\ possible\ positions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02915}02915\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8\ \&\&\ count\ <\ max\_suggestions;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02916}02916\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ row\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02917}02917\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ col\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02918}02918\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02919}02919\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02920}02920\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02921}02921\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02922}02922\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02923}02923\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02924}02924\ \ \ \ \ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02925}02925\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02926}02926\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ if\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02927}02927\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02928}02928\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02929}02929\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02930}02930\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02931}02931\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02932}02932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02933}02933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02934}02934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02935}02935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02936}02936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ target,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02937}02937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02938}02938\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02939}02939\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ move\ is\ valid\ (including\ check\ validation)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02940}02940\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&temp\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02941}02941\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02942}02942\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a940eca031248f8df49031c483af30f13}{from\_row}}\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02943}02943\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a5805172608c1e85601ee674644b69fe7}{from\_col}}\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02944}02944\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02945}02945\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02946}02946\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a95bfdc4963cc77122f941663554a8a67}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02947}02947\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =\ (target\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02948}02948\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a39763b8b278db010f5dfff7a4beb264a}{is\_check}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ TODO:\ Implement\ check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02949}02949\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_aa9a5da748efa93feb7e3f7c4f06e7839}{is\_castling}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02950}02950\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a77114011b2edb38b0218c36ce67cf0e6}{is\_en\_passant}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02951}02951\ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a96c798a72d6ed66a18c8b2d1e840e604}{score}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02952}02952\ \ \ \ \ \ \ \ \ count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02953}02953\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02954}02954\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02955}02955\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02956}02956\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02957}02957\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02958}02958\ \ \ \ \ \textcolor{comment}{//\ For\ other\ pieces,\ use\ the\ original\ method\ (less\ efficient\ but\ works)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02959}02959\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_row\ =\ 0;\ to\_row\ <\ 8\ \&\&\ count\ <\ max\_suggestions;\ to\_row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02960}02960\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_col\ =\ 0;\ to\_col\ <\ 8\ \&\&\ count\ <\ max\_suggestions;\ to\_col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02961}02961\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ same\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02962}02962\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ row\ \&\&\ to\_col\ ==\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02963}02963\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02964}02964\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02965}02965\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02966}02966\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02967}02967\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02968}02968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02969}02969\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02970}02970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02971}02971\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02972}02972\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02973}02973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02974}02974\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02975}02975\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ move\ is\ valid}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02976}02976\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&temp\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02977}02977\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02978}02978\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ to\ suggestions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02979}02979\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a940eca031248f8df49031c483af30f13}{from\_row}}\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02980}02980\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a5805172608c1e85601ee674644b69fe7}{from\_col}}\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02981}02981\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02982}02982\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02983}02983\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a95bfdc4963cc77122f941663554a8a67}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02984}02984\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02985}02985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02986}02986\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a39763b8b278db010f5dfff7a4beb264a}{is\_check}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02987}02987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false};\ \textcolor{comment}{//\ TODO:\ Implement\ check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02988}02988\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02989}02989\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Detect\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02990}02990\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_aa9a5da748efa93feb7e3f7c4f06e7839}{is\_castling}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02991}02991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02992}02992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (abs((\textcolor{keywordtype}{int})to\_col\ -\/\ (\textcolor{keywordtype}{int})col)\ ==\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02993}02993\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02994}02994\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Detect\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02995}02995\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a77114011b2edb38b0218c36ce67cf0e6}{is\_en\_passant}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02996}02996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(\&temp\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02997}02997\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02998}02998\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ capture\ flag\ for\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l02999}02999\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[count].is\_en\_passant)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03000}03000\ \ \ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a58f2cd5416633410aebfa8f80320e3aa}{is\_capture}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03001}03001\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03002}03002\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03003}03003\ \ \ \ \ \ \ \ \ \ \ suggestions[count].\mbox{\hyperlink{structmove__suggestion__t_a96c798a72d6ed66a18c8b2d1e840e604}{score}}\ =\ 0;\ \textcolor{comment}{//\ TODO:\ Implement\ move\ scoring}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03004}03004\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03005}03005\ \ \ \ \ \ \ \ \ \ \ count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03006}03006\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03007}03007\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03008}03008\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03009}03009\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03010}03010\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03011}03011\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03012}03012\ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03013}03013\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03014}03014\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03015}03015\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03016}03016\ \textcolor{comment}{//\ GAME\ STATE\ VARIABLES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03017}03017\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03018}03018\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03019}03019\ \textcolor{comment}{//\ Fifty-\/move\ rule\ counter}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03020}\mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{03020}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03021}03021\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03022}03022\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03023}03023\ \textcolor{comment}{//\ MOVE\ EXECUTION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03024}03024\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03025}03025\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03029}\mbox{\hyperlink{game__task_8c_a5d48aea6f905097dca8c53e1c2a057b1}{03029}}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a5d48aea6f905097dca8c53e1c2a057b1}{game\_analyze\_position}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03030}03030\ \ \ \textcolor{keywordtype}{bool}\ king\_in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03031}03031\ \ \ uint32\_t\ legal\_moves\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03032}03032\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03033}03033\ \ \ \textcolor{keywordflow}{if}\ (legal\_moves\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03034}03034\ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03035}03035\ \ \ \ \ \ \ \textcolor{comment}{//\ Checkmate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03036}03036\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03037}03037\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10}{game\_result\_type\_t}}\ result\_type\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03038}03038\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}\ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03039}03039\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ result\_type;\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03040}03040\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(result\_type);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03041}03041\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(result\_type);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03042}03042\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE!\ \%s\ wins!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03043}03043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03044}03044\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03045}03045\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03046}03046\ \ \ \ \ \ \ \textcolor{comment}{//\ Stalemate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03047}03047\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03048}03048\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}};\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03049}03049\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03050}03050\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03051}03051\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ STALEMATE!\ Game\ drawn!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03052}03052\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03053}03053\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03054}03054\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03055}03055\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03056}03056\ \ \ \textcolor{comment}{//\ Check\ for\ fifty-\/move\ rule}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03057}03057\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}\ >=\ 100)\ \{\ \textcolor{comment}{//\ 50\ moves\ per\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03058}03058\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03059}03059\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}};\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03060}03060\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03061}03061\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03062}03062\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Fifty-\/move\ rule!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03063}03063\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03064}03064\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03065}03065\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03066}03066\ \ \ \textcolor{comment}{//\ Check\ for\ insufficient\ material\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03067}03067\ \ \ \textcolor{keywordtype}{int}\ white\_pieces\ =\ 0,\ black\_pieces\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03068}03068\ \ \ \textcolor{keywordtype}{bool}\ white\_has\_major\ =\ \textcolor{keyword}{false},\ black\_has\_major\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03069}03069\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03070}03070\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03071}03071\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03072}03072\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03073}03073\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03074}03074\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03075}03075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03076}03076\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03077}03077\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03078}03078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03079}03079\ \ \ \ \ \ \ \ \ \ \ \ \ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03080}03080\ \ \ \ \ \ \ \ \ \ \ white\_has\_major\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03081}03081\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03082}03082\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03083}03083\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03084}03084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03085}03085\ \ \ \ \ \ \ \ \ \ \ \ \ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03086}03086\ \ \ \ \ \ \ \ \ \ \ black\_has\_major\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03087}03087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03088}03088\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03089}03089\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03090}03090\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03091}03091\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03092}03092\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ <=\ 2\ \&\&\ black\_pieces\ <=\ 2\ \&\&\ !white\_has\_major\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03093}03093\ \ \ \ \ \ \ !black\_has\_major)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03094}03094\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03095}03095\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}};\ \textcolor{comment}{//\ Uložit\ pro\ web\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03096}03096\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03097}03097\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03098}03098\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Insufficient\ material!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03099}03099\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03100}03100\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03101}03101\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03102}03102\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03103}03103\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03104}03104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03105}\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{03105}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03106}03106\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03107}03107\ \ \ \textcolor{keywordflow}{if}\ (error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03108}03108\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move\ attempted:\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03109}03109\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03110}03110\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03111}03111\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03112}03112\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Executing\ move:\ \%c\%d-\/\%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03113}03113\ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03114}03114\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03115}03115\ \ \ \textcolor{comment}{//\ Get\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03116}03116\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ source\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03117}03117\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_ab1f6294f23b24a27514d95c3b0ca0a4d}{game\_get\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03118}03118\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03119}03119\ \ \ \textcolor{comment}{//\ Create\ extended\ move\ for\ proper\ handling\ of\ special\ cases}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03120}03120\ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ extended\_move\ =\ \{.from\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03121}03121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03122}03122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03123}03123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03124}03124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ source\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03125}03125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ dest\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03126}03126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .move\_type\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03127}03127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .promotion\_piece\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03128}03128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03129}03129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03130}03130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .is\_check\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03131}03131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .is\_checkmate\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03132}03132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .is\_stalemate\ =\ \textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03133}03133\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03134}03134\ \ \ \textcolor{comment}{//\ Detect\ special\ move\ types}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03135}03135\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03136}03136\ \ \ \textcolor{comment}{//\ Disable\ special\ move\ detection\ during\ error\ recovery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03137}03137\ \ \ \textcolor{comment}{//\ \ During\ error\ recovery,\ ALL\ moves\ are\ treated\ as\ NORMAL\ moves\ to\ prevent}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03138}03138\ \ \ \textcolor{comment}{//\ \ state\ conflicts}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03139}03139\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03140}03140\ \ \ \ \ \textcolor{comment}{//\ 1.\ Check\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03141}03141\ \ \ \ \ \textcolor{keywordflow}{if}\ ((source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03142}03142\ \ \ \ \ \ \ \ \ \ source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03143}03143\ \ \ \ \ \ \ \ \ abs(move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03144}03144\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ >\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03145}03145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03146}03146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03147}03147\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03148}03148\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03149}03149\ \ \ \ \ \textcolor{comment}{//\ 2.\ Check\ for\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03150}03150\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03151}03151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03152}03152\ \ \ \ \ \ \ \ \ \ \ \ \ \ abs(move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 1\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03153}03153\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03154}03154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a175e65acc9f386834730a86b25d6190a}{game\_is\_en\_passant\_possible}}(move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03155}03155\ \ \ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03156}03156\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03157}03157\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03158}03158\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03159}03159\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03160}03160\ \ \ \ \ \textcolor{comment}{//\ 3.\ Check\ for\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03161}03161\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ 7)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03162}03162\ \ \ \ \ \ \ \ \ \ \ \ \ \ (source\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ 0))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03163}03163\ \ \ \ \ \ \ \textcolor{comment}{//\ Detekovat\ jako\ MOVE\_TYPE\_PROMOTION\ a\ OKAMŽITĚ\ nastavit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03164}03164\ \ \ \ \ \ \ \textcolor{comment}{//\ promotion\_state.pending}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03165}03165\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03166}03166\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03167}03167\ \ \ \ \ \ \ \textcolor{comment}{//\ OKAMŽITĚ\ nastavit\ promotion\_state\ před\ voláním}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03168}03168\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_execute\_move\_enhanced()\ Toto\ zajistí,\ že}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03169}03169\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_execute\_move\_enhanced()\ neprovádí\ auto-\/promoci\ Použít\ recursive}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03170}03170\ \ \ \ \ \ \ \textcolor{comment}{//\ mutex\ funkce\ (promotion\_mutex\ je\ recursive\ mutex)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03171}03171\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTakeRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}},\ pdMS\_TO\_TICKS(100))\ ==}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03172}03172\ \ \ \ \ \ \ \ \ \ \ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03173}03173\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03174}03174\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03175}03175\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03176}03176\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03177}03177\ \ \ \ \ \ \ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03178}03178\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03179}03179\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03180}03180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Promotion\ detected\ -\/\ setting\ pending\ state\ at\ \%c\%d\ for\ \%s\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03181}03181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}player"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03182}03182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03183}03183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03184}03184\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03185}03185\ \ \ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03186}03186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Failed\ to\ acquire\ promotion\ mutex\ during\ move\ detection!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03187}03187\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03188}03188\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03189}03189\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03190}03190\ \ \ \ \ \textcolor{comment}{//\ 4.\ Check\ for\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03191}03191\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03192}03192\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03193}03193\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Capture:\ \%s\ captures\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03194}03194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(source\_piece),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03195}03195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(dest\_piece));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03196}03196\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03197}03197\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ captured\ piece\ to\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03198}03198\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a9f117ec973e2706358d99dfe843cd6ae}{add\_captured\_piece}}(dest\_piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03199}03199\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03200}03200\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03201}03201\ \ \ \ \ \textcolor{comment}{//\ During\ error\ recovery,\ treat\ everything\ as\ NORMAL\ move\ (or\ CAPTURE\ if}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03202}03202\ \ \ \ \ \textcolor{comment}{//\ opponent\ piece\ present)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03203}03203\ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03204}03204\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03205}03205\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Error\ recovery:\ treating\ as\ simple\ capture"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03206}03206\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03207}03207\ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03208}03208\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Error\ recovery:\ treating\ as\ normal\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03209}03209\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03210}03210\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03211}03211\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03212}03212\ \ \ \textcolor{comment}{//\ Execute\ the\ enhanced\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03213}03213\ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{game\_execute\_move\_enhanced}}(\&extended\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03214}03214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03215}03215\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03216}03216\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ game\_execute\_move:\ success=\%d,\ current\_player\ before\ change=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03217}03217\ \ \ \ \ \ \ \ \ \ \ \ success,\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03218}03218\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03219}03219\ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03220}03220\ \ \ \ \ \textcolor{comment}{//\ Update\ last\ move\ tracking\ for\ future\ en\ passant\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03221}03221\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03222}03222\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03223}03223\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03224}03224\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03225}03225\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03226}03226\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03227}03227\ \ \ \ \ \textcolor{comment}{//\ Add\ to\ move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03228}03228\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ <\ \mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03229}03229\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}]\ =\ *move;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03230}03230\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}].piece\ =\ source\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03231}03231\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}].captured\_piece\ =\ dest\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03232}03232\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[\mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}].timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03233}03233\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03234}03234\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03235}03235\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03236}03236\ \ \ \ \ \textcolor{comment}{//\ Update\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03237}03237\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03238}03238\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03239}03239\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03240}03240\ \ \ \ \ \textcolor{comment}{//\ Record\ material\ advantage\ pro\ graf}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03241}03241\ \ \ \ \ \mbox{\hyperlink{game__task_8c_abd6d559fc6b46a6a06f830b5c5cec56a}{game\_record\_material\_advantage}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03242}03242\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03243}03243\ \ \ \ \ \textcolor{comment}{//\ ENHANCED\ CASTLING\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03244}03244\ \ \ \ \ \textcolor{keywordflow}{if}\ (extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03245}03245\ \ \ \ \ \ \ \ \ extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03246}03246\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ CASTLING\ DETECTED!\ King\ moved\ 2\ squares"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03247}03247\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03248}03248\ \ \ \ \ \ \ \textcolor{comment}{//\ Nastavit\ castling\ state\ pro\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03249}03249\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03250}03250\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03251}03251\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.is\_kingside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ >\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03252}03252\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03253}03253\ \ \ \ \ \ \ \textcolor{comment}{//\ Vypočítat\ očekávané\ pozice\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03254}03254\ \ \ \ \ \ \ uint8\_t\ rook\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03255}03255\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.is\_kingside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03256}03256\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03257}03257\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ =\ 7;\ \textcolor{comment}{//\ h-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03258}03258\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03259}03259\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col\ =\ 5;\ \textcolor{comment}{//\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03260}03260\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03261}03261\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03262}03262\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ =\ 0;\ \textcolor{comment}{//\ a-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03263}03263\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ =\ rook\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03264}03264\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col\ =\ 3;\ \textcolor{comment}{//\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03265}03265\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03266}03266\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03267}03267\ \ \ \ \ \ \ \textcolor{comment}{//\ Ukázat\ LED\ indikaci\ pro\ věž\ s\ pulzováním\ pro\ lepší\ viditelnost}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03268}03268\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03269}03269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03270}03270\ \ \ \ \ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03271}03271\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03272}03272\ \ \ \ \ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03273}03273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03274}03274\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03275}03275\ \ \ \ \ \ \ \textcolor{comment}{//\ Pulzování\ pro\ lepší\ viditelnost\ (3\ cykly\ s\ plynulým\ přechodem)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03276}03276\ \ \ \ \ \ \ \textcolor{comment}{//\ Použít\ správný\ výpočet\ brightness\ pro\ plynulé\ pulzování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03277}03277\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ pulse\ =\ 0;\ pulse\ <\ 3;\ pulse++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03278}03278\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plynulé\ pulzování:\ 0.5\ -\/>\ 1.0\ -\/>\ 0.5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03279}03279\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Použít\ sin()\ s\ normalizací\ -\/\ sin()\ vrací\ -\/1\ až\ 1,\ normalizujeme\ na}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03280}03280\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0-\/1,\ pak\ na\ 0.5-\/1.0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03281}03281\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ phase\ =\ (float)pulse\ *\ 2.0f\ *\ 3.14159f\ /\ 3.0f;\ \textcolor{comment}{//\ 0,\ 2π/3,\ 4π/3}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03282}03282\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03283}03283\ \ \ \ \ \ \ \ \ \ \ \ \ 0.5f\ +\ 0.5f\ *\ (1.0f\ +\ sin(phase))\ /}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03284}03284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2.0f;\ \textcolor{comment}{//\ Normalizace:\ sin()\ -\/>\ 0-\/1\ -\/>\ 0.5-\/1.0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03285}03285\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03286}03286\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stříbrná\ pro\ věž\ (source)\ s\ pulzováním}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03287}03287\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ (uint8\_t)(192\ *\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03288}03288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uint8\_t)(192\ *\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03289}03289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uint8\_t)(192\ *\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03290}03290\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03291}03291\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zelená\ pro\ cíl\ věže\ (destination)\ s\ pulzováním}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03292}03292\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ (uint8\_t)(255\ *\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}),\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03293}03293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03294}03294\ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03295}03295\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03296}03296\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03297}03297\ \ \ \ \ \ \ \textcolor{comment}{//\ Finální\ statické\ zobrazení}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03298}03298\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 192,\ 192,\ 192);\ \textcolor{comment}{//\ Stříbrná\ pro\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03299}03299\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \ \ \ \ \ \ \textcolor{comment}{//\ Zelená\ pro\ cíl\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03300}03300\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03301}03301\ \ \ \ \ \ \ \textcolor{comment}{//\ NEMĚNIT\ HRÁČE\ pro\ castling!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03302}03302\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03303}03303\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏳\ Waiting\ for\ rook\ move\ from\ \%c\%d\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03304}03304\ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03305}03305\ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03306}03306\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ in\ progress\ -\/\ player\ remains\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03307}03307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03308}03308\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;\ \textcolor{comment}{//\ Return\ success\ but\ don't\ change\ player\ -\/\ hráč\ se\ změní}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03309}03309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ až\ po\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03310}03310\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03311}03311\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03312}03312\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ promotion\ -\/\ start\ promotion\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03313}03313\ \ \ \ \ \textcolor{keywordflow}{if}\ (extended\_move.\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03314}03314\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ PROMOTION\ DETECTED!\ Starting\ promotion\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03315}03315\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03316}03316\ \ \ \ \ \ \ \textcolor{comment}{//\ \#2:\ Mutex\ protection\ for\ promotion\_state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03317}03317\ \ \ \ \ \ \ \textcolor{comment}{//\ Použít\ recursive\ mutex\ funkce\ (promotion\_mutex\ je\ recursive\ mutex)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03318}03318\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTakeRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}},\ pdMS\_TO\_TICKS(100))\ ==}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03319}03319\ \ \ \ \ \ \ \ \ \ \ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03320}03320\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ promotion\ state\ to\ pending}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03321}03321\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ blocks\ further\ moves\ and\ enables\ selection\ via\ buttons/UART/web}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03322}03322\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03323}03323\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03324}03324\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03325}03325\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03326}03326\ \ \ \ \ \ \ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03327}03327\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03328}03328\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏸️\ \ Promotion\ pending\ at\ \%c\%d\ for\ \%s\ player"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03329}03329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03330}03330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03331}03331\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03332}03332\ \ \ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ acquire\ promotion\ mutex!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03333}03333\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03334}03334\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03335}03335\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03336}03336\ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ promotion\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03337}03337\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03338}03338\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03339}03339\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03340}03340\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03341}03341\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03342}03342\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03343}03343\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03344}03344\ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03345}03345\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03346}03346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03347}03347\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ LED\ button\ indications\ (green\ for\ promotion\ buttons)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03348}03348\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03349}03349\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03350}03350\ \ \ \ \ \ \ \textcolor{comment}{//\ CRITICAL:\ Return\ here\ WITHOUT\ changing\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03351}03351\ \ \ \ \ \ \ \textcolor{comment}{//\ Player\ will\ change\ AFTER\ promotion\ selection\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03352}03352\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_process\_promotion\_command()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03353}03353\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03354}03354\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03355}03355\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏁\ Promotion\ flow\ started\ -\/\ awaiting\ selection\ (buttons/UART/web)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03356}03356\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;\ \textcolor{comment}{//\ Don't\ change\ player\ -\/\ wait\ for\ promotion\ choice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03357}03357\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03358}03358\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03359}03359\ \ \ \ \ \textcolor{comment}{//\ KONTROLA\ DOKONČENÍ\ ROŠÁDY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03360}03360\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03361}03361\ \ \ \ \ \ \ \textcolor{comment}{//\ Je\ to\ tah\ věže\ pro\ dokončení\ rošády?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03362}03362\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03363}03363\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03364}03364\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03365}03365\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03366}03366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03367}03367\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ CASTLING\ COMPLETED!\ Rook\ moved\ correctly"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03368}03368\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03369}03369\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Provedeme\ posun\ věže\ v\ board[][]}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03370}03370\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03371}03371\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row][\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03372}03372\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03373}03373\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03374}03374\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ příznaky\ pro\ krále\ a\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03375}03375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03376}03376\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03377}03377\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03378}03378\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03379}03379\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03380}03380\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03381}03381\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03382}03382\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03383}03383\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03384}03384\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03385}03385\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03386}03386\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03387}03387\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03388}03388\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03389}03389\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zlatá\ animace\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03390}03390\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{show\_castling\_completion\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03391}03391\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03392}03392\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TEPRVE\ NYÍ\ změnit\ hráče\ po\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03393}03393\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03394}03394\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03395}03395\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03396}03396\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03397}03397\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎉\ Castling\ completed!\ Player\ changed\ to\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03398}03398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03399}03399\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03400}03400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03401}03401\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03402}03402\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03403}03403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (castling):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03404}03404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03405}03405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03406}03406\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03407}03407\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03408}03408\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03409}03409\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03410}03410\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03411}03411\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03412}03412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03413}03413\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03414}03414\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03415}03415\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03416}03416\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03417}03417\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03418}03418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03419}03419\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03420}03420\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03421}03421\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03422}03422\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03423}03423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03424}03424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03425}03425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03426}03426\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03427}03427\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03428}03428\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03429}03429\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03430}03430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ castling!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03431}03431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03432}03432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03433}03433\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03434}03434\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03435}03435\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03436}03436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03437}03437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03438}03438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03439}03439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03440}03440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03441}03441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03442}03442\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03443}03443\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03444}03444\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03445}03445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03446}03446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03447}03447\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03448}03448\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03449}03449\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03450}03450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03451}03451\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03452}03452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03453}03453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03454}03454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03455}03455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03456}03456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03457}03457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03458}03458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03459}03459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03460}03460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03461}03461\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03462}03462\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03463}03463\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03464}03464\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ castling\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03465}03465\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03466}03466\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03467}03467\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figury\ pro\ nového\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03468}03468\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03469}03469\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03470}03470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03471}03471\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03472}03472\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03473}03473\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03474}03474\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03475}03475\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03476}03476\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03477}03477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03478}03478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03479}03479\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03480}03480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03481}03481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03482}03482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03483}03483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03484}03484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03485}03485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03486}03486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03487}03487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03488}03488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03489}03489\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03490}03490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03491}03491\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03492}03492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03493}03493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03494}03494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03495}03495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03496}03496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03497}03497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03498}03498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03499}03499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03500}03500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03501}03501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03502}03502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03503}03503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03504}03504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03505}03505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03506}03506\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03507}03507\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03508}03508\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03509}03509\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03510}03510\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ RETURN\ po\ dokončení\ rošády\ -\/\ hráč\ se\ už\ změnil}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03511}03511\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03512}03512\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03513}03513\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wrong\ move\ during\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03514}03514\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ user\ is\ aborting\ by\ moving\ King\ back\ or\ elsewhere}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03515}03515\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03516}03516\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03517}03517\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚫\ Castling\ ABORTED\ by\ King\ move\ \%c\%d-\/\%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03518}03518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03519}03519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03520}03520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03521}03521\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Abort\ castling\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03522}03522\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03523}03523\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ LEDs}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03524}03524\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03525}03525\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Treat\ as\ normal\ move\ (Undo\ usually)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03526}03526\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ return\ true\ (success)\ so\ the\ move\ is\ accepted\ update\ the\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03527}03527\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ we\ MUST\ ensure\ the\ player\ switches/unswitches\ correctly?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03528}03528\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actually,\ if\ they\ undo\ the\ move,\ they\ are\ just\ moving\ King\ back.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03529}03529\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ 'game\_execute\_move'\ logic\ for\ NORMAL\ moves\ switches\ player.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03530}03530\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ King\ G1-\/>E1\ (Undo),\ it\ switches\ to\ opponent?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03531}03531\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yes.\ That's\ fine.\ It's\ a\ move.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03532}03532\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03533}03533\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait,\ if\ it\ was\ G1-\/>E1,\ logic\ board\ updates\ G1-\/>E1.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03534}03534\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Player\ switches.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03535}03535\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Game\ continues.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03536}03536\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03537}03537\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ fall\ through\ to\ NORMAL\ move\ processing\ below?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03538}03538\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No,\ we\ are\ inside\ the\ 'if\ (castling\_state.in\_progress)'\ block\ which}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03539}03539\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ is\ BEFORE\ normal\ processing?\ Wait,\ the\ structure\ is:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03540}03540\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03541}03541\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ if\ (castling\_state.in\_progress)\ \{}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03542}03542\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ (is\_rook\_move)\ \{\ ...\ return\ success;\ \}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03543}03543\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ else\ \{\ ...\ return\ success;\ \}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03544}03544\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03545}03545\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03546}03546\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ So\ if\ we\ abort,\ we\ should\ probably\ fall\ through\ to\ normal\ logic?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03547}03547\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ 'castling\_state.in\_progress'\ block\ returns.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03548}03548\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03549}03549\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Let's\ just\ Execute\ the\ move\ here\ manually\ or\ modify\ logic\ to\ fall}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03550}03550\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ through.\ The\ cleanest\ way:\ Set\ in\_progress\ =\ false,\ then\ fall}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03551}03551\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ through?\ But\ the\ block\ wraps\ the\ return.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03552}03552\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03553}03553\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ I\ will\ Copy-\/Paste\ the\ 'Normal\ Move'\ logic\ essentially,\ or\ better:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03554}03554\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ fall\ through!\ I\ will\ remove\ the\ 'return\ success'\ and\ 'else'}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03555}03555\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ structure\ slightly.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03556}03556\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03557}03557\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ REWRITE:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03558}03558\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03559}03559\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ if\ (castling\_state.in\_progress)\ \{}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03560}03560\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ (is\_rook\_move)\ \{}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03561}03561\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ...}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03562}03562\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ success;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03563}03563\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03564}03564\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ Not\ rook\ move\ -\/\ Abort?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03565}03565\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ castling\_state.in\_progress\ =\ false;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03566}03566\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(TAG,\ "{}Castling\ aborted"{});}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03567}03567\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ led\_clear\_board\_only();}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03568}03568\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //\ Fall\ through\ to\ normal\ processing!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03569}03569\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03570}03570\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03571}03571\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03572}03572\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGE(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03573}03573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03574}03574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Wrong\ move\ during\ castling\ -\/\ expected\ rook\ from\ \%c\%d\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03575}03575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03576}03576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03577}03577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03578}03578\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nezměnit\ hráče\ -\/\ stále\ čekáme\ na\ správný\ tah\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03579}03579\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ success;\ \textcolor{comment}{//\ Return\ success\ but\ don't\ change\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03580}03580\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03581}03581\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03582}03582\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03583}03583\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03584}03584\ \ \ \ \ \textcolor{comment}{//\ Fallthrough\ for\ Aborted\ Castling\ (treat\ as\ normal\ move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03585}03585\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03586}03586\ \ \ \ \ \textcolor{comment}{//\ NORMÁLNÍ\ TAHY\ -\/\ změnit\ hráče\ (move\ animace\ se\ spouští\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03587}03587\ \ \ \ \ \textcolor{comment}{//\ game\_process\_drop\_command)\ Switch\ player\ BEFORE\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03588}03588\ \ \ \ \ \textcolor{comment}{//\ endgame\ conditions\ (podle\ starého\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03589}03589\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03590}03590\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Changing\ player\ from\ \%s\ to\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03591}03591\ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03592}03592\ \ \ \ \ \ \ \ \ \ \ \ \ \ (previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03593}03593\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03594}03594\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03595}03595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03596}03596\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03597}03597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Move\ executed\ successfully.\ \%s\ to\ move\ (current\_player=\%s)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03598}03598\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03599}03599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03600}03600\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03601}03601\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ endgame\ conditions\ after\ move\ execution\ (podle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03602}03602\ \ \ \ \ \textcolor{comment}{//\ starého\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03603}03603\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03604}03604\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03605}03605\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Endgame\ detected\ after\ move\ execution"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03606}03606\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03607}03607\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03608}03608\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03609}03609\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03610}03610\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03611}03611\ \ \ \textcolor{comment}{//\ Update\ promotion\ LED\ indications\ after\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03612}03612\ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03613}03613\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03614}03614\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03615}03615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03616}03616\ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03617}03617\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03618}03618\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03619}03619\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03620}03620\ \textcolor{comment}{//\ GAME\ STATUS\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03621}03621\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03622}03622\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03623}\mbox{\hyperlink{game__task_8c_ac8bfd19bdb7f1bbe6986c0f007713f73}{03623}}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_ac8bfd19bdb7f1bbe6986c0f007713f73}{game\_get\_state}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03624}03624\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03625}\mbox{\hyperlink{game__task_8c_a98c28bfe096e1b2f5dd819da477efbe1}{03625}}\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_a98c28bfe096e1b2f5dd819da477efbe1}{game\_get\_current\_player}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03626}03626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03627}\mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{03627}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{game\_print\_board}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03628}03628\ \ \ \textcolor{comment}{//\ Add\ spacing\ before\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03629}03629\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03630}03630\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03631}03631\ \textcolor{comment}{//\ Enhanced\ ANSI\ color\ codes}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03632}03632\ \textcolor{preprocessor}{\#define\ COLOR\_RESET\ "{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03633}03633\ \textcolor{preprocessor}{\#define\ COLOR\_BOLD\ "{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03634}03634\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_WHITE\ "{}\(\backslash\)033[97m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03635}03635\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_RED\ "{}\(\backslash\)033[91m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03636}03636\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_GREEN\ "{}\(\backslash\)033[92m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03637}03637\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_YELLOW\ "{}\(\backslash\)033[93m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03638}03638\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_BLUE\ "{}\(\backslash\)033[94m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03639}03639\ \textcolor{preprocessor}{\#define\ COLOR\_BRIGHT\_CYAN\ "{}\(\backslash\)033[96m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03640}03640\ \textcolor{preprocessor}{\#define\ BG\_WHITE\ "{}\(\backslash\)033[47m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03641}03641\ \textcolor{preprocessor}{\#define\ BG\_BLACK\ "{}\(\backslash\)033[40m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03642}03642\ \textcolor{preprocessor}{\#define\ BG\_YELLOW\ "{}\(\backslash\)033[43m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03643}03643\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03644}03644\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}===\ Chess\ Board\ ==="{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03645}03645\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03646}03646\ \ \ \textcolor{comment}{//\ Print\ board\ header\ with\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03647}03647\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03648}03648\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03649}03649\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03650}03650\ \ \ \textcolor{comment}{//\ Print\ board\ rows\ (8\ to\ 1)\ -\/\ FIXED:\ row\ 7\ =\ rank\ 8,\ row\ 0\ =\ rank\ 1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03651}03651\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03652}03652\ \ \ \ \ \textcolor{keywordtype}{char}\ row\_header[16];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03653}03653\ \ \ \ \ snprintf(row\_header,\ \textcolor{keyword}{sizeof}(row\_header),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03654}03654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \%d\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03655}03655\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s"{}},\ row\_header);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03656}03656\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03657}03657\ \ \ \ \ \textcolor{comment}{//\ Print\ pieces\ in\ this\ row}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03658}03658\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03659}03659\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03660}03660\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03661}03661\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ square\ is\ part\ of\ the\ last\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03662}03662\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_last\_move\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03663}03663\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03664}03664\ \ \ \ \ \ \ \ \ \ \ ((row\ ==\ \mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03665}03665\ \ \ \ \ \ \ \ \ \ \ \ (row\ ==\ \mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03666}03666\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03667}03667\ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ square\ color\ (white/black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03668}03668\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_white\_square\ =\ ((row\ +\ col)\ \%\ 2)\ ==\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03669}03669\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03670}03670\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03671}03671\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_last\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03672}03672\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03673}03673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ *\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});\ \textcolor{comment}{//\ Highlight\ empty\ square\ from\ last\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03674}03674\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03675}03675\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_white\_square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03676}03676\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a6beded3f171517df3902c52f79f6fea2}{BG\_WHITE}}\ \textcolor{stringliteral}{"{}\ \ \ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03677}03677\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03678}03678\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a0e5ebbe291d95cf1b8f1661252722fe0}{BG\_BLACK}}\ \textcolor{stringliteral}{"{}\ \ \ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03679}03679\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03680}03680\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03681}03681\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03682}03682\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ piece\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03683}03683\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03684}03684\ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03685}03685\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03686}03686\ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_piece\ ?\ \mbox{\hyperlink{game__task_8c_aa0977659d900017c4b65818c42a60a66}{COLOR\_BRIGHT\_WHITE}}\ :\ \mbox{\hyperlink{game__task_8c_a07544b84bb0b8d3c7b2580ca0b48a098}{COLOR\_BRIGHT\_RED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03687}03687\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03688}03688\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_last\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03689}03689\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}*"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03690}03690\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \textcolor{stringliteral}{"{}\%s\%s"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ piece\_color,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03691}03691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03692}03692\ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ab31fe3e74b1137650d30ede5c9b86218}{BG\_YELLOW}}\ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03693}03693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}*"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});\ \textcolor{comment}{//\ Highlight\ piece\ from\ last\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03694}03694\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03695}03695\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_white\_square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03696}03696\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a6beded3f171517df3902c52f79f6fea2}{BG\_WHITE}}\ \textcolor{stringliteral}{"{}\%s\%s\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ piece\_color,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03697}03697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03698}03698\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03699}03699\ \ \ \ \ \ \ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a0e5ebbe291d95cf1b8f1661252722fe0}{BG\_BLACK}}\ \textcolor{stringliteral}{"{}\%s\%s\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ piece\_color,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03700}03700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03701}03701\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03702}03702\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03703}03703\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03704}03704\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03705}03705\ \ \ \ \ \textcolor{keywordtype}{char}\ row\_footer[16];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03706}03706\ \ \ \ \ snprintf(row\_footer,\ \textcolor{keyword}{sizeof}(row\_footer),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03707}03707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \%d\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03708}03708\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s"{}},\ row\_footer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03709}03709\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03710}03710\ \ \ \ \ \textcolor{comment}{//\ Print\ row\ separator\ (except\ after\ last\ row)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03711}03711\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03712}03712\ \ \ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03713}03713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03714}03714\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03715}03715\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03716}03716\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03717}03717\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03718}03718\ \ \ printf(\mbox{\hyperlink{game__task_8c_ac45fac0dcefd97502824521c5f1d4c4d}{COLOR\_BRIGHT\_CYAN}}\ \textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03719}03719\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03720}03720\ \ \ \textcolor{comment}{//\ Print\ game\ status\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03721}03721\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03722}03722\ \ \ printf(\mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}\ \mbox{\hyperlink{game__task_8c_a30dd0aa7ae6b1f5ffbcdd51024ee6c47}{COLOR\_BRIGHT\_GREEN}}\ \textcolor{stringliteral}{"{}🎮\ GAME\ STATUS:\(\backslash\)r\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03723}03723\ \ \ printf(\mbox{\hyperlink{game__task_8c_a27c03232867e0e1d6477d73e4e385026}{COLOR\_BRIGHT\_YELLOW}}\ \textcolor{stringliteral}{"{}\ \ \ •\ Current\ player:\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03724}03724\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03725}03725\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_aa0977659d900017c4b65818c42a60a66}{COLOR\_BRIGHT\_WHITE}}\ \textcolor{stringliteral}{"{}♔\ WHITE"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03726}03726\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03727}03727\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a07544b84bb0b8d3c7b2580ca0b48a098}{COLOR\_BRIGHT\_RED}}\ \textcolor{stringliteral}{"{}♚\ BLACK"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03728}03728\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03729}03729\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03730}03730\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03731}03731\ \ \ printf(\mbox{\hyperlink{game__task_8c_a27c03232867e0e1d6477d73e4e385026}{COLOR\_BRIGHT\_YELLOW}}\ \textcolor{stringliteral}{"{}\ \ \ •\ Move\ number:\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}}\ \mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03732}03732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03733}03733\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03734}03734\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03735}03735\ \ \ \textcolor{comment}{//\ Print\ last\ move\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03736}03736\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aae58883f4e5761e9d840b243daf855a7}{has\_last\_move}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03737}03737\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_square[4],\ to\_square[4];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03738}03738\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(\mbox{\hyperlink{game__task_8c_a7f77e5e231fd9535d20f64f96ee418ba}{last\_move\_from\_row}},\ \mbox{\hyperlink{game__task_8c_a39aa6c3a7f8c8803266df3d726a125e3}{last\_move\_from\_col}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03739}03739\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(\mbox{\hyperlink{game__task_8c_a5b89325f96b3f1db097a5f20d0360672}{last\_move\_to\_row}},\ \mbox{\hyperlink{game__task_8c_aa9a6df76b92bfaac37043bfc352766c6}{last\_move\_to\_col}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03740}03740\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a27c03232867e0e1d6477d73e4e385026}{COLOR\_BRIGHT\_YELLOW}}\ \textcolor{stringliteral}{"{}\ \ \ •\ Last\ move:\ "{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}}\ \mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03741}03741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ →\ \%s\(\backslash\)r\(\backslash\)n"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03742}03742\ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03743}03743\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03744}03744\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03745}03745\ \ \ \textcolor{comment}{//\ Check\ for\ special\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03746}03746\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03747}03747\ \ \ \ \ printf(\mbox{\hyperlink{game__task_8c_a07544b84bb0b8d3c7b2580ca0b48a098}{COLOR\_BRIGHT\_RED}}\ \textcolor{stringliteral}{"{}\ \ \ ⚠️\ \ "{}}\ \mbox{\hyperlink{game__task_8c_a302607d6f585b7e9ba1c3eab8d2199d5}{COLOR\_BOLD}}\ \textcolor{stringliteral}{"{}CHECK!"{}}\ \mbox{\hyperlink{game__task_8c_a17f760256046df23dd0ab46602f04d02}{COLOR\_RESET}}\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03748}03748\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03749}03749\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03750}03750\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03751}03751\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03752}03752\ \ \ \textcolor{comment}{//\ Print\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03753}03753\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ >\ 0\ ||\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03754}03754\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Captured\ pieces:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03755}03755\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03756}03756\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ White\ captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03757}03757\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03758}03758\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s\ "{}},\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[(\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i]]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03759}03759\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03760}03760\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}(\%lu\ total)\(\backslash\)n"{}},\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03761}03761\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03762}03762\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03763}03763\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ Black\ captured:\ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03764}03764\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03765}03765\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%s\ "{}},\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[(\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i]]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03766}03766\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03767}03767\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}(\%lu\ total)\(\backslash\)n"{}},\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03768}03768\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03769}03769\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03770}03770\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03771}03771\ \ \ \textcolor{comment}{//\ Print\ piece\ legend}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03772}03772\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Piece\ Legend:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03773}03773\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ White:\ p=pawn,\ n=knight,\ b=bishop,\ r=rook,\ q=queen,\ k=king"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03774}03774\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Black:\ P=pawn,\ N=knight,\ B=bishop,\ R=rook,\ Q=queen,\ K=king"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03775}03775\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Empty:\ space,\ *\ =\ last\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03776}03776\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03777}03777\ \ \ \textcolor{comment}{//\ Print\ game\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03778}03778\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Status:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03779}03779\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Current\ player:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03780}03780\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03781}03781\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Move\ count:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03782}03782\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Game\ state:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03783}03783\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Active"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03784}03784\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Idle"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03785}03785\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}})\ ?\ \textcolor{stringliteral}{"{}Paused"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03786}03786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Finished"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03787}03787\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03788}03788\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03789}\mbox{\hyperlink{game__task_8c_a6852701612778b8ad618fa420a0b7dca}{03789}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6852701612778b8ad618fa420a0b7dca}{game\_print\_move\_history}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03790}03790\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Move\ history\ (\%lu\ moves):"{}},\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03791}03791\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03792}03792\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03793}03793\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03794}03794\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \%lu.\ \%c\%d-\/\%c\%d\ \%s"{}},\ i\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03795}03795\ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03796}03796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03797}03797\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03798}03798\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03799}03799\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03800}03800\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03801}03801\ \textcolor{comment}{//\ GENIUS\ COMPATIBILITY\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03802}03802\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03803}03803\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03807}\mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{03807}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *message,\ \textcolor{keywordtype}{bool}\ is\_error,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03808}03808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QueueHandle\_t\ response\_queue)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03809}03809\ \ \ \textcolor{keywordflow}{if}\ (response\_queue\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03810}03810\ \ \ \ \ \textcolor{comment}{//\ Fallback\ to\ logging\ if\ no\ response\ queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03811}03811\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03812}03812\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}GAME\_ERROR:\ \%s"{}},\ message\ ?\ message\ :\ \textcolor{stringliteral}{"{}Unknown\ error"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03813}03813\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03814}03814\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}GAME\_SUCCESS:\ \%s"{}},\ message\ ?\ message\ :\ \textcolor{stringliteral}{"{}Success"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03815}03815\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03816}03816\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03817}03817\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03818}03818\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03819}03819\ \ \ \textcolor{comment}{//\ Create\ simple\ response\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03820}03820\ \ \ \textcolor{keywordtype}{char}\ response\_message[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03821}03821\ \ \ \textcolor{keywordflow}{if}\ (message)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03822}03822\ \ \ \ \ strncpy(response\_message,\ message,\ \textcolor{keyword}{sizeof}(response\_message)\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03823}03823\ \ \ \ \ response\_message[\textcolor{keyword}{sizeof}(response\_message)\ -\/\ 1]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03824}03824\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03825}03825\ \ \ \ \ strcpy(response\_message,\ is\_error\ ?\ \textcolor{stringliteral}{"{}Unknown\ error"{}}\ :\ \textcolor{stringliteral}{"{}Success"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03826}03826\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03827}03827\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03828}03828\ \ \ \textcolor{comment}{//\ Send\ response\ to\ UART\ task\ as\ game\_response\_t}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03829}03829\ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03830}03830\ \ \ \ \ \ \ .type\ =\ is\_error\ ?\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a39ae193ecb15c805e19efa3c004cda8b}{GAME\_RESPONSE\_ERROR}}\ :\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03831}03831\ \ \ \ \ \ \ .command\_type\ =\ 0,\ \textcolor{comment}{//\ Will\ be\ set\ by\ caller\ if\ needed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03832}03832\ \ \ \ \ \ \ .error\_code\ =\ is\_error\ ?\ 1\ :\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03833}03833\ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03834}03834\ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03835}03835\ \ \ strcpy(response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}},\ response\_message);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03836}03836\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03837}03837\ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Use\ timeout\ instead\ of\ portMAX\_DELAY\ to\ prevent\ deadlocks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03838}03838\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03839}03839\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03840}03840\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ acquire\ game\_mutex\ -\/\ timeout!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03841}03841\ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Return\ early\ if\ mutex\ unavailable}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03842}03842\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03843}03843\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03844}03844\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03845}03845\ \ \ \textcolor{keywordflow}{if}\ (xQueueSend(response\_queue,\ \&response,\ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03846}03846\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03847}03847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Failed\ to\ send\ response\ to\ UART\ task\ (queue\ full\ or\ timeout)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03848}03848\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03849}03849\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Response\ sent\ to\ UART\ task:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03850}03850\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_error\ ?\ \textcolor{stringliteral}{"{}ERROR"{}}\ :\ \textcolor{stringliteral}{"{}SUCCESS"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03851}03851\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03852}03852\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03853}03853\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03854}03854\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03855}03855\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03856}03856\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03857}03857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03861}\mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{03861}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{game\_send\_board\_to\_uart}}(QueueHandle\_t\ response\_queue)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03862}03862\ \ \ \textcolor{keywordflow}{if}\ (response\_queue\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03863}03863\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}No\ response\ queue\ available\ for\ board\ data"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03864}03864\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03865}03865\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03866}03866\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03867}03867\ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ starting\ operation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03868}03868\ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03869}03869\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03870}03870\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ malloc(3072)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03871}03871\ \ \ \textcolor{comment}{//\ This\ eliminates\ heap\ fragmentation\ and\ reduces\ memory\ usage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03872}03872\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📡\ Using\ streaming\ output\ for\ board\ display\ (no\ malloc)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03873}03873\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03874}03874\ \ \ \textcolor{comment}{//\ Configure\ streaming\ for\ queue\ output}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03875}03875\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{streaming__output_8h_aca427711530c81651095df3f70106d66}{streaming\_set\_queue\_output}}(response\_queue);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03876}03876\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03877}03877\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ configure\ streaming\ output:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03878}03878\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03879}03879\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03880}03880\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03881}03881\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03882}03882\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ large\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03883}03883\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03884}03884\ \ \ \textcolor{comment}{//\ Stream\ board\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03885}03885\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03886}03886\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03887}03887\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03888}03888\ \ \ \textcolor{comment}{//\ Stream\ board\ rows}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03889}03889\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03890}03890\ \ \ \ \ \textcolor{comment}{//\ Reset\ watchdog\ every\ row\ to\ prevent\ timeouts}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03891}03891\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03892}03892\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03893}03893\ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\%d\ |"{}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03894}03894\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03895}03895\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03896}03896\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03897}03897\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *symbol;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03898}03898\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03899}03899\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03900}03900\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03901}03901\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}P"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03902}03902\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03903}03903\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03904}03904\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}N"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03905}03905\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03906}03906\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03907}03907\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}B"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03908}03908\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03909}03909\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03910}03910\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}R"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03911}03911\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03912}03912\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03913}03913\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}Q"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03914}03914\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03915}03915\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03916}03916\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}K"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03917}03917\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03918}03918\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03919}03919\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}p"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03920}03920\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03921}03921\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03922}03922\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}n"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03923}03923\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03924}03924\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03925}03925\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}b"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03926}03926\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03927}03927\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03928}03928\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}r"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03929}03929\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03930}03930\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03931}03931\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}q"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03932}03932\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03933}03933\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03934}03934\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}k"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03935}03935\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03936}03936\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03937}03937\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}·"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03938}03938\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03939}03939\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03940}03940\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03941}03941\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \%s\ |"{}},\ symbol);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03942}03942\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03943}03943\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03944}03944\ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \%d\(\backslash\)n"{}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03945}03945\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03946}03946\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03947}03947\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03948}03948\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03949}03949\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03950}03950\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03951}03951\ \ \ \textcolor{comment}{//\ Stream\ board\ footer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03952}03952\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ +-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+-\/-\/-\/+"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03953}03953\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03954}03954\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03955}03955\ \ \ \textcolor{comment}{//\ Stream\ game\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03956}03956\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\(\backslash\)nCurrent\ player:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03957}03957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03958}03958\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03959}03959\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}Move\ count:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03960}03960\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03961}03961\ \ \ \textcolor{comment}{//\ Stream\ helpful\ tip}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03962}03962\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}💡\ Use\ 'UP\ <square>'\ to\ lift\ piece,\ 'DN\ <square>'\ to\ place"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03963}03963\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03964}03964\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Streaming\ output\ handles\ data\ transmission}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03965}03965\ \ \ \textcolor{comment}{//\ Send\ completion\ message\ to\ response\ queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03966}03966\ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ completion\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03967}03967\ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03968}03968\ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03969}03969\ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03970}03970\ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Board\ display\ streaming\ completed\ successfully"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03971}03971\ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03972}03972\ \ \ strcpy(completion\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}},\ \textcolor{stringliteral}{"{}streaming\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03973}03973\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03974}03974\ \ \ \textcolor{keywordflow}{if}\ (response\_queue\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03975}03975\ \ \ \ \ xQueueSend(response\_queue,\ \&completion\_response,\ pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03976}03976\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03977}03977\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03978}03978\ \ \ \textcolor{comment}{//\ No\ need\ for\ manual\ queue\ management\ or\ large\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03979}03979\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Board\ display\ streaming\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03980}03980\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03981}03981\ \ \ \textcolor{comment}{//\ Final\ WDT\ reset}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03982}03982\ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03983}03983\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03984}03984\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03985}03985\ \textcolor{comment}{//\ Function\ removed\ -\/\ using\ game\_send\_board\_to\_uart(QueueHandle\_t)\ instead}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03986}03986\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03990}\mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{03990}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03991}03991\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03992}03992\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03993}03993\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03994}03994\ \ \ \textcolor{comment}{//\ PROMOTION\ (swap\_then\_choose,\ swap\ volitelný):}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03995}03995\ \ \ \textcolor{comment}{//\ -\/\ Povolit\ fyzický\ UP/DN\ pouze\ na\ promočním\ poli\ (bez\ běžného\ pickup\ flow).}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03996}03996\ \ \ \textcolor{comment}{//\ -\/\ Mimo\ promoční\ pole\ ignorovat\ (hra\ je\ logicky\ pozastavená)\ a\ poslat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03997}03997\ \ \ \textcolor{comment}{//\ krátkou\ hlášku.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03998}03998\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l03999}03999\ \ \ \ \ \textcolor{comment}{//\ Bezpečnostní\ kontrola\ notation\ stringu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04000}04000\ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04001}04001\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04002}04002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ or\ corrupted\ notation\ string\ (promotion\ pending)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04003}04003\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ notation\ format"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04004}04004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04005}04005\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04006}04006\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04007}04007\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04008}04008\ \ \ \ \ \textcolor{comment}{//\ Parse\ square\ i\ během\ promotion\ pending}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04009}04009\ \ \ \ \ uint8\_t\ p\_row,\ p\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04010}04010\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&p\_row,\ \&p\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04011}04011\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation\ during\ promotion:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04012}04012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04013}04013\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04014}04014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04015}04015\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04016}04016\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04017}04017\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04018}04018\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_promo\_square\ =\ (p\_row\ ==\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04019}04019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p\_col\ ==\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04020}04020\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04021}04021\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_promo\_square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04022}04022\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04023}04023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ pending:\ PICKUP\ on\ promo\ square\ \%c\%d\ allowed\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04024}04024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(swap\_then\_choose)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04025}04025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ p\_col,\ p\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04026}04026\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04027}04027\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04028}04028\ \ \ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04029}04029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ pending\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04030}04030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔁\ You\ can\ swap\ the\ pawn\ here\ now\ (optional)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04031}04031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}➡️\ Next:\ choose\ piece\ via\ green\ buttons\ /\ PROMOTE\ /\ web"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04032}04032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04033}04033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04034}04034\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04035}04035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04036}04036\ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Neprovádět\ standardní\ pickup\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04037}04037\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04038}04038\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04039}04039\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04040}04040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Promotion\ pending:\ PICKUP\ blocked\ outside\ promo\ square\ (\%s)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04041}04041\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04042}04042\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04043}04043\ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04044}04044\ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04045}04045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ Promotion\ pending\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04046}04046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔁\ Swap\ allowed\ only\ on\ \%c\%d\ (optional)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04047}04047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}➡️\ Then\ choose\ piece\ via\ green\ buttons\ /\ PROMOTE\ /\ web"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04048}04048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04049}04049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04050}04050\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04051}04051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04052}04052\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04053}04053\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04054}04054\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04055}04055\ \ \ \textcolor{comment}{//\ PŘERUŠIT\ BLIKÁNÍ\ při\ zvednutí\ figurky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04056}04056\ \ \ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04057}04057\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04058}04058\ \ \ \textcolor{comment}{//\ Bezpečnostní\ kontrola\ notation\ stringu\ (array\ je\ vždy\ !=\ NULL)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04059}04059\ \ \ \textcolor{keywordflow}{if}\ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04060}04060\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ or\ corrupted\ notation\ string"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04061}04061\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ notation\ format"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04062}04062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04063}04063\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04064}04064\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04065}04065\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04066}04066\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Processing\ PICKUP\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04067}04067\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04068}04068\ \ \ \textcolor{comment}{//\ Convert\ notation\ to\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04069}04069\ \ \ uint8\_t\ from\_row,\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04070}04070\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&from\_row,\ \&from\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04071}04071\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04072}04072\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04073}04073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04074}04074\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04075}04075\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04076}04076\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04077}04077\ \ \ \textcolor{comment}{//\ KONTROLA\ ERROR\ RECOVERY\ STAVU}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04078}04078\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04079}04079\ \ \ \ \ \textcolor{comment}{//\ KONTROLA:\ Je\ to\ správná\ neplatná\ pozice?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04080}04080\ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_row\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04081}04081\ \ \ \ \ \ \ \ \ from\_col\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04082}04082\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04083}04083\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Lifting\ piece\ from\ invalid\ position\ \%s\ (error\ \#\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04084}04084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04085}04085\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Showing\ valid\ moves\ from\ ORIGINAL\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04086}04086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04087}04087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04088}04088\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04089}04089\ \ \ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04090}04090\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04091}04091\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04092}04092\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04093}04093\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04094}04094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04095}04095\ \ \ \ \ \ \ \textcolor{comment}{//\ KLÍČOVÉ:\ Ukázat\ validní\ tahy\ z\ PŮVODNÍ\ pozice,\ ne\ z\ posledního}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04096}04096\ \ \ \ \ \ \ \textcolor{comment}{//\ pokusu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04097}04097\ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04098}04098\ \ \ \ \ \ \ uint32\_t\ valid\_moves\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04099}04099\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04100}04100\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04101}04101\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04102}04102\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Found\ \%lu\ valid\ moves\ from\ original\ position"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04103}04103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04104}04104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04105}04105\ \ \ \ \ \ \ \textcolor{comment}{//\ VYČISTIT\ A\ NASTAVIT\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04106}04106\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04107}04107\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04108}04108\ \ \ \ \ \ \ \textcolor{comment}{//\ Žlutá\ na\ aktuální\ pozici\ (kde\ je\ figurka\ nyní)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04109}04109\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04110}04110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04111}04111\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04112}04112\ \ \ \ \ \ \ \textcolor{comment}{//\ MODRÁ\ na\ původní\ validní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04113}04113\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04114}04114\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04115}04115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04116}04116\ \ \ \ \ \ \ \ \ \ \ 0,\ 0,\ 255);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04117}04117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04118}04118\ \ \ \ \ \ \ \textcolor{comment}{//\ ZELENÉ\ LED\ pro\ validní\ cílová\ pole\ (z\ původní\ pozice)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04119}04119\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04120}04120\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(suggestions[i].to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04121}04121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ suggestions[i].to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04122}04122\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04123}04123\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nepřepisovat\ žlutou\ (aktuální\ pozici)\ a\ modrou\ (původní\ pozici)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04124}04124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dest\_led\ !=\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04125}04125\ \ \ \ \ \ \ \ \ \ \ \ \ dest\_led\ !=\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04126}04126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04127}04127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04128}04128\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[i].is\_capture)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04129}04129\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(dest\_led,\ 255,\ 165,\ 0);\ \textcolor{comment}{//\ Oranžová\ pro\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04130}04130\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04131}04131\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(dest\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ pro\ normální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04132}04132\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04133}04133\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04134}04134\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04135}04135\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04136}04136\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04137}04137\ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04138}04138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Lifted\ from\ invalid\ position\ -\/\ \%u\ valid\ moves\ from\ ORIGINAL\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04139}04139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%c\%d\ (blue)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04140}04140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04141}04141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04142}04142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04143}04143\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04144}04144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04145}04145\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04146}04146\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04147}04147\ \ \ \ \ \ \ \textcolor{comment}{//\ UP\ z\ jiné\ pozice\ během\ error\ recovery\ -\/\ ignorovat\ nebo\ resetovat?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04148}04148\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04149}04149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ UP\ from\ different\ position\ during\ error\ recovery:\ \%s\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04150}04150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(expected\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04151}04151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04152}04152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04153}04153\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04154}04154\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ warning\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04155}04155\ \ \ \ \ \ \ snprintf(warning\_msg,\ \textcolor{keyword}{sizeof}(warning\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04156}04156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Error\ recovery\ active\ -\/\ lift\ piece\ from\ \%c\%d\ first"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04157}04157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04158}04158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04159}04159\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(warning\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04160}04160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04161}04161\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04162}04162\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04163}04163\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04164}04164\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04165}04165\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ piece\ at\ the\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04166}04166\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04167}04167\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04168}04168\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04169}04169\ \ \ \ \ \textcolor{comment}{//\ Bezpečný\ snprintf\ s\ kontrolou\ návratové\ hodnoty}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04170}04170\ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =\ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),\ \textcolor{stringliteral}{"{}❌\ No\ piece\ at\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04171}04171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04172}04172\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(error\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04173}04173\ \ \ \ \ \ \ strcpy(error\_msg,\ \textcolor{stringliteral}{"{}❌\ No\ piece\ at\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04174}04174\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04175}04175\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ piece\ at\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04176}04176\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04177}04177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04178}04178\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04179}04179\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04180}04180\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04181}04181\ \ \ \textcolor{comment}{//\ Check\ if\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04182}04182\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04183}04183\ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04184}04184\ \ \ \textcolor{keywordtype}{bool}\ is\_black\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04185}04185\ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04186}04186\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04187}04187\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !is\_white\_piece)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04188}04188\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !is\_black\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04189}04189\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04190}04190\ \ \ \ \ \textcolor{comment}{//\ 3-\/STEP\ CAPTURE\ FLOW:\ UP\ own\ →\ UP\ opponent\ (remove)\ →\ DN\ own\ (execute)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04191}04191\ \ \ \ \ \textcolor{comment}{//\ Rozlišit\ capture\ vs\ error}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04192}04192\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04193}04193\ \ \ \ \ \textcolor{comment}{//\ ISSUE\ 1:\ NESMÍ\ se\ povolit\ capture\ během\ error\ recovery!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04194}04194\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04195}04195\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04196}04196\ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04197}04197\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04198}04198\ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04199}04199\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04200}04200\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04201}04201\ \ \ \ \ \ \ \textcolor{comment}{//\ STEP\ 2\ of\ CAPTURE:\ Zkontrolovat\ zda\ lifted\ piece\ MŮŽE\ sebrat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04202}04202\ \ \ \ \ \ \ \textcolor{comment}{//\ opponent\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04203}04203\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ capture\_attempt\ =\ \{.from\_row\ =\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04204}04204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04205}04205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04206}04206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04207}04207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04208}04208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04209}04209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04210}04210\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04211}04211\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ capture\_valid\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&capture\_attempt);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04212}04212\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04213}04213\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (capture\_valid\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04214}04214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ VALIDNÍ\ CAPTURE:\ Remove\ opponent\ piece,\ wait\ for\ DN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04215}04215\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}♟️\ \ Step\ 2/3\ Capture:\ Removing\ opponent\ piece\ at\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04216}04216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04217}04217\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04218}04218\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Odstranit\ opponent\ piece\ z\ boardu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04219}04219\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04220}04220\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04221}04221\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nastavit\ capture\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04222}04222\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04223}04223\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04224}04224\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04225}04225\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04226}04226\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04227}04227\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Decentní\ LED\ feedback:\ Žlutá\ na\ lifted\ piece,\ FIALOVÁ\ na\ target\ (kde}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04228}04228\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ má\ polož\ it)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04229}04229\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04230}04230\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04231}04231\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}),\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04232}04232\ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04233}04233\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 128,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04234}04234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 128);\ \textcolor{comment}{//\ Purple\ =\ target}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04235}04235\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04236}04236\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Poslat\ info\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04237}04237\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04238}04238\ \ \ \ \ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04239}04239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}♟️\ \ Step\ 2/3:\ Opponent\ piece\ removed.\ Place\ \%s\ on\ PURPLE\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04240}04240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}square\ (\%s)\ to\ capture"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04241}04241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}),\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04242}04242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04243}04243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04244}04244\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04245}04245\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04246}04246\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ INVALID\ CAPTURE:\ Proceed\ to\ error\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04247}04247\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04248}04248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Invalid\ capture\ attempt:\ \%s\ from\ \%c\%d\ CANNOT\ capture\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04249}04249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}),\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04250}04250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ +\ 1,\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ capture\_valid);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04251}04251\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04252}04252\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04253}04253\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04254}04254\ \ \ \ \ \textcolor{comment}{//\ ERROR\ FLOW:\ Wrong\ color\ piece\ lifted\ inappropriately}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04255}04255\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *safe\_notation\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04256}04256\ \ \ \ \ \ \ \ \ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 0)\ ?\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}}\ :\ \textcolor{stringliteral}{"{}??"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04257}04257\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04258}04258\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04259}04259\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04260}04260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Cannot\ capture\ during\ error\ recovery\ -\/\ opponent\ piece\ at\ \%s\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04261}04261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}ignored"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04262}04262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ safe\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04263}04263\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04264}04264\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04265}04265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Cannot\ capture\ opponent\ piece\ at\ \%s\ -\/\ invalid\ move\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04266}04266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ safe\_notation,\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04267}04267\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04268}04268\ \ \ \ \ \ \ ESP\_LOGW(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04269}04269\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04270}04270\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Opponent's\ piece\ lifted\ WITHOUT\ own\ piece\ lifted\ at\ \%s\ -\/\ ERROR"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04271}04271\ \ \ \ \ \ \ \ \ \ \ safe\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04272}04272\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04273}04273\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04274}04274\ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Nastavit\ error\_recovery\_state\ pro\ proper\ recovery\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04275}04275\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04276}04276\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04277}04277\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04278}04278\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04279}04279\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04280}04280\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04281}04281\ \ \ \ \ \ \ \ \ from\_row;\ \textcolor{comment}{//\ Původní\ pozice\ =\ kde\ má\ být\ vrácena}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04282}04282\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04283}04283\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04284}04284\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04285}04285\ \ \ \ \ \textcolor{comment}{//\ Uložit\ informace\ o\ opponent\ piece\ (backward\ compatibility)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04286}04286\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04287}04287\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04288}04288\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04289}04289\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04290}04290\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04291}04291\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04292}04292\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04293}04293\ \ \ \ \ \textcolor{comment}{//\ Odstranit\ figurku\ z\ boardu\ (byla\ zvednuta)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04294}04294\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04295}04295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04296}04296\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ recovery\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04297}04297\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da8d38d078f83ba6d016773d797e914e80}{GAME\_STATE\_WAITING\_FOR\_RETURN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04298}04298\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04299}04299\ \ \ \ \ \textcolor{comment}{//\ LED:\ Spustit\ červené\ blikání\ na\ původní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04300}04300\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04301}04301\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(from\_row,\ from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04302}04302\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04303}04303\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ lifted\ piece\ state\ pro\ případné\ drop}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04304}04304\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04305}04305\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04306}04306\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04307}04307\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04308}04308\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04309}04309\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04310}04310\ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04311}04311\ \ \ \ \ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04312}04312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Wrong\ color\ piece!\ \%s\ belongs\ to\ opponent\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04313}04313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔴\ Return\ piece\ to\ BLINKING\ RED\ square\ (\%s)\ to\ continue\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04314}04314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ To\ capture:\ lift\ YOUR\ piece\ first,\ then\ opponent's\ piece"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04315}04315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ safe\_notation,\ safe\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04316}04316\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(error\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04317}04317\ \ \ \ \ \ \ strcpy(error\_msg,\ \textcolor{stringliteral}{"{}❌\ Return\ opponent's\ piece\ to\ RED\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04318}04318\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04319}04319\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04320}04320\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04321}04321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04322}04322\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04323}04323\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04324}04324\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04325}04325\ \ \ \textcolor{comment}{//\ CASTLING\ IN\ PROGRESS:\ User\ lifted\ the\ king\ (already\ moved).\ Do\ NOT\ start}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04326}04326\ \ \ \textcolor{comment}{//\ resignation\ –\ we\ are\ waiting\ for\ the\ rook\ move.\ Show\ guidance\ instead.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04327}04327\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04328}04328\ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04329}04329\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04330}04330\ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04331}04331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04332}04332\ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04333}04333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04334}04334\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);\ \ \ \textcolor{comment}{//\ Yellow\ –\ rook\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04335}04335\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);\ \ \ \ \ \ \textcolor{comment}{//\ Green\ –\ rook\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04336}04336\ \ \ \ \ \textcolor{keywordtype}{char}\ msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04337}04337\ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ snprintf(msg,\ \textcolor{keyword}{sizeof}(msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04338}04338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Dokončete\ rošádu:\ přesuňte\ věž\ z\ \%c\%d\ na\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04339}04339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{char})(\textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04340}04340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04341}04341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{char})(\textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04342}04342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04343}04343\ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ >=\ (\textcolor{keywordtype}{int})\textcolor{keyword}{sizeof}(msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04344}04344\ \ \ \ \ \ \ strcpy(msg,\ \textcolor{stringliteral}{"{}🏰\ Dokončete\ rošádu:\ přesuňte\ věž\ na\ zelené\ pole"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04345}04345\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04346}04346\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04347}04347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04348}04348\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Do\ not\ set\ piece\_lifted\ –\ king\ stays\ on\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04349}04349\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04350}04350\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04351}04351\ \ \ \textcolor{comment}{//\ KING\ RESIGNATION:\ Detekce\ zvednutí\ vlastního\ krále\ (skip\ v\ demo\ mode)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04352}04352\ \ \ \textcolor{keywordflow}{if}\ (!cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a43bd07ae3571e5c911bb94292a4cf6b3}{is\_demo\_mode}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04353}04353\ \ \ \ \ \ \ ((piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04354}04354\ \ \ \ \ \ \ \ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}})))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04355}04355\ \ \ \ \ \textcolor{comment}{//\ Nejdřív\ spustit\ resignation\ timer\ (nastaví\ oranžovo-\/červenou\ na\ source)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04356}04356\ \ \ \ \ \textcolor{comment}{//\ Pak\ zobrazit\ valid\ moves\ (včetně\ castling\ moves\ jako\ modré)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04357}04357\ \ \ \ \ \textcolor{comment}{//\ Clear\ previous\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04358}04358\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04359}04359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04360}04360\ \ \ \ \ \textcolor{comment}{//\ Spustit\ resignation\ timer\ PŘED\ zobrazením\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04361}04361\ \ \ \ \ \textcolor{comment}{//\ resignation\_start()\ nastaví\ oranžovo-\/červenou\ mix\ na\ source\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04362}04362\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{resignation\_start}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}},\ from\_row,\ from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04363}04363\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04364}04364\ \ \ \ \ \textcolor{comment}{//\ Get\ valid\ moves\ pro\ krále\ (PO\ odstranění\ z\ boardu\ v\ resignation\_start())}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04365}04365\ \ \ \ \ \textcolor{comment}{//\ Poznámka:\ game\_get\_available\_moves()\ musí\ fungovat\ i\ když\ je\ král}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04366}04366\ \ \ \ \ \textcolor{comment}{//\ odstraněn\ z\ boardu\ (použije\ resignation\_state.king\_row/col\ pokud\ je}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04367}04367\ \ \ \ \ \textcolor{comment}{//\ resignation\ aktivní)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04368}04368\ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04369}04369\ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04370}04370\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(from\_row,\ from\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04371}04371\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04372}04372\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Showing\ possible\ moves\ for\ king\ from\ \%s\ (\%lu\ moves)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04373}04373\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04374}04374\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04375}04375\ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ valid\ moves\ (zelená/oranžová/modrá\ pro\ castling)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04376}04376\ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04377}04377\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04378}04378\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04379}04379\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04380}04380\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04381}04381\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04382}04382\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ a\ castling\ move\ -\/\ zobrazit\ jako\ modré}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04383}04383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[i].is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04384}04384\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Blue\ for\ castling\ moves\ (special\ move\ -\/\ rošáda)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04385}04385\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 0,\ 255);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04386}04386\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04387}04387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castling\ move\ highlighted\ at\ \%c\%d\ (blue)\ during\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04388}04388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}resignation\ pickup"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04389}04389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ dest\_col,\ dest\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04390}04390\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04391}04391\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ move\ handling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04392}04392\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04393}04393\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04394}04394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04395}04395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04396}04396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04397}04397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04398}04398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04399}04399\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04400}04400\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04401}04401\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04402}04402\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04403}04403\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04404}04404\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04405}04405\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04406}04406\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04407}04407\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04408}04408\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04409}04409\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04410}04410\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04411}04411\ \ \ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04412}04412\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04413}04413\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04414}04414\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04415}04415\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04416}04416\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04417}04417\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04418}04418\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04419}04419\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04420}04420\ \ \ \ \ \textcolor{comment}{//\ Poznámka:\ resignation\_start()\ už\ nastaví\ oranžovo-\/červenou\ mix\ na\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04421}04421\ \ \ \ \ \textcolor{comment}{//\ square\ Valid\ moves\ (zelená/oranžová)\ zůstanou\ zobrazené,\ protože}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04422}04422\ \ \ \ \ \textcolor{comment}{//\ resignation\_start()\ nevolá\ led\_clear\_board\_only()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04423}04423\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04424}04424\ \ \ \ \ \textcolor{keywordtype}{char}\ msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04425}04425\ \ \ \ \ snprintf(msg,\ \textcolor{keyword}{sizeof}(msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04426}04426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ King\ lifted\ -\/\ resignation\ timer\ started\ (10s)\ -\/\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04427}04427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ valid\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04428}04428\ \ \ \ \ \ \ \ \ \ \ \ \ \ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04429}04429\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(msg,\ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04430}04430\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Nepokračovat\ s\ normálním\ pickup\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04431}04431\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04432}04432\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04433}04433\ \ \ \textcolor{comment}{//\ CASTLING\ INTERCEPTION:\ Re-\/lift\ of\ rook\ during\ active\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04434}04434\ \ \ \textcolor{comment}{//\ If\ we\ are\ in\ castling\ mode\ (standard\ timer\ based),\ suppress\ standard\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04435}04435\ \ \ \textcolor{comment}{//\ hints\ and\ just\ reinforce\ guidance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04436}04436\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04437}04437\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04438}04438\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04439}04439\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04440}04440\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04441}04441\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04442}04442\ \ \ \ \ \textcolor{comment}{//\ Force\ refresh\ of\ castling\ guidance\ immediately}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04443}04443\ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04444}04444\ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04445}04445\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04446}04446\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04447}04447\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);\ \ \ \ \ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04448}04448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04449}04449\ \ \ \ \ \textcolor{keywordtype}{char}\ msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04450}04450\ \ \ \ \ snprintf(msg,\ \textcolor{keyword}{sizeof}(msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04451}04451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Continue\ castling:\ Move\ to\ flashing\ GREEN\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04452}04452\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(msg,\ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04453}04453\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04454}04454\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ SKIP\ standard\ move\ calculation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04455}04455\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04456}04456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04457}04457\ \ \ \textcolor{comment}{//\ ED:\ No\ animation\ when\ lifting\ piece,\ just\ highlight\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04458}04458\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Piece\ lifted\ from\ \%s\ -\/\ showing\ possible\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04459}04459\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04460}04460\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04461}04461\ \ \ \textcolor{comment}{//\ Clear\ previous\ highlights\ before\ showing\ new\ ones}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04462}04462\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04463}04463\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04464}04464\ \ \ \textcolor{comment}{//\ Send\ LED\ command\ to\ highlight\ source\ square\ using\ new\ game\ state\ logic}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04465}04465\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04466}04466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04467}04467\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04468}04468\ \ \ \textcolor{comment}{//\ Track\ the\ lifted\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04469}04469\ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04470}04470\ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04471}04471\ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04472}04472\ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04473}04473\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04474}04474\ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04475}04475\ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04476}04476\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04477}04477\ \ \ \textcolor{comment}{//\ Show\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04478}04478\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Showing\ possible\ moves\ from\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04479}04479\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04480}04480\ \ \ \textcolor{comment}{//\ Get\ valid\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04481}04481\ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04482}04482\ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04483}04483\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(from\_row,\ from\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04484}04484\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04485}04485\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Found\ \%lu\ valid\ moves\ for\ piece\ at\ \%s"{}},\ valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04486}04486\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04487}04487\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04488}04488\ \ \ \textcolor{comment}{//\ Send\ LED\ commands\ to\ highlight\ possible\ destinations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04489}04489\ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04490}04490\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04491}04491\ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04492}04492\ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04493}04493\ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04494}04494\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04495}04495\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ a\ castling\ move\ -\/\ zobrazit\ jako\ speciální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04496}04496\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (suggestions[i].is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04497}04497\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Blue\ for\ castling\ moves\ (special\ move\ -\/\ rošáda)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04498}04498\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 0,\ 255);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04499}04499\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ move\ highlighted\ at\ \%c\%d\ (blue)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04500}04500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ dest\_col,\ dest\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04501}04501\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04502}04502\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ move\ handling\ (existing\ code)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04503}04503\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04504}04504\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04505}04505\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04506}04506\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04507}04507\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04508}04508\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04509}04509\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04510}04510\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04511}04511\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04512}04512\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04513}04513\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04514}04514\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04515}04515\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04516}04516\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04517}04517\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04518}04518\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04519}04519\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04520}04520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04521}04521\ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04522}04522\ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04523}04523\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04524}04524\ \ \ \textcolor{comment}{//\ MATRIX\ COMPATIBILITY:\ Show\ opponent\ pieces\ after\ pickup\ (same\ as\ matrix}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04525}04525\ \ \ \textcolor{comment}{//\ flow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04526}04526\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04527}04527\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04528}04528\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04529}04529\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04530}04530\ \ \ \textcolor{comment}{//\ Send\ success\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04531}04531\ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04532}04532\ \ \ \textcolor{comment}{//\ Bezpečný\ snprintf\ pro\ success\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04533}04533\ \ \ \textcolor{keywordtype}{int}\ written\ =\ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04534}04534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Piece\ lifted\ from\ \%s\ -\/\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ possible\ moves"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04535}04535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04536}04536\ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(success\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04537}04537\ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04538}04538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Piece\ lifted\ -\/\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves"{}},\ valid\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04539}04539\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04540}04540\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04541}04541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04542}04542\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04543}04543\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04548}04548\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04556}04556\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04560}\mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{04560}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04561}04561\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04562}04562\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04563}04563\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04564}04564\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Processing\ DROP\ command:\ \%s\ (START)"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04565}04565\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04566}04566\ \ \ \textcolor{comment}{//\ MOVED:\ New\ game\ detection\ moved\ to\ end\ of\ function\ to\ avoid\ false}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04567}04567\ \ \ \textcolor{comment}{//\ positives\ during\ move\ sequence}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04568}04568\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04569}04569\ \ \ \textcolor{comment}{//\ Convert\ notation\ to\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04570}04570\ \ \ uint8\_t\ to\_row,\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04571}04571\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \&to\_row,\ \&to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04572}04572\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04573}04573\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04574}04574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04575}04575\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04576}04576\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04577}04577\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04578}04578\ \ \ \textcolor{comment}{//\ Při\ každém\ položení\ figurky\ (DROP)\ vždy\ přerušit\ červené\ blikání\ –\ ať\ už}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04579}04579\ \ \ \textcolor{comment}{//\ uživatel\ položil\ během\ animace\ nebo\ po\ ní;\ zvednutí–položení\ rychle\ za}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04580}04580\ \ \ \textcolor{comment}{//\ sebou\ tak\ vždy\ zastaví\ blink\ před\ dalším\ překreslením.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04581}04581\ \ \ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04582}04582\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04583}04583\ \ \ \textcolor{comment}{//\ CASTLING\ INTERCEPTION:\ Handle\ rook\ moves\ during\ castling\ phase}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04584}04584\ \ \ \textcolor{comment}{//\ This\ logic\ must\ be\ BEFORE\ standard\ validation\ to\ avoid\ "{}Blocked\ by\ King"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04585}04585\ \ \ \textcolor{comment}{//\ errors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04586}04586\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04587}04587\ \ \ \ \ \textcolor{comment}{//\ 1.\ Check\ for\ completion\ (Drop\ on\ destination)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04588}04588\ \ \ \ \ \textcolor{comment}{//\ Use\ lifted\_piece\ position\ if\ available,\ otherwise\ assume\ auto-\/recovery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04589}04589\ \ \ \ \ \textcolor{comment}{//\ from\ rook\_from}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04590}04590\ \ \ \ \ uint8\_t\ effective\_from\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04591}04591\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ ?\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ :\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04592}04592\ \ \ \ \ uint8\_t\ effective\_from\_col\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04593}04593\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ ?\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ :\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04594}04594\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04595}04595\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{game\_complete\_castle\_animation}}(effective\_from\_row,\ effective\_from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04596}04596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04597}04597\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04598}04598\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04599}04599\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Castling\ completed"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04600}04600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04601}04601\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04602}04602\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04603}04603\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04604}04604\ \ \ \ \ \textcolor{comment}{//\ 2.\ Check\ for\ "{}put\ back"{}\ (Drop\ on\ source)\ -\/\ Allow\ retry}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04605}04605\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04606}04606\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Rook\ put\ back\ on\ start\ square\ -\/\ waiting\ for\ lift"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04607}04607\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04608}04608\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04609}04609\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04610}04610\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Rook\ put\ back\ -\/\ lift\ it\ again\ to\ complete\ castling"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04611}04611\ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04612}04612\ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Keep\ castling\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04613}04613\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04614}04614\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04615}04615\ \ \ \ \ \textcolor{comment}{//\ 3.\ Intermediate\ Move\ (Dynamic\ Source)\ -\/\ Robustness\ for\ "{}fumbled"{}\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04616}04616\ \ \ \ \ \textcolor{comment}{//\ If\ dropped\ on\ an\ empty\ square\ that\ is\ NOT\ the\ destination,\ move\ the\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04617}04617\ \ \ \ \ \textcolor{comment}{//\ there\ and\ update\ the\ animation\ source!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04618}04618\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04619}04619\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Intermediate\ rook\ move\ to\ \%c\%d\ (updating\ source)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04620}04620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04621}04621\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04622}04622\ \ \ \ \ \ \ \textcolor{comment}{//\ Move\ piece\ in\ board\ simulation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04623}04623\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04624}04624\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04625}04625\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04626}04626\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ Static\ Vars\ for\ animation\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04627}04627\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04628}04628\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04629}04629\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04630}04630\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ Lifted\ State}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04631}04631\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04632}04632\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04633}04633\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04634}04634\ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ LED\ indices\ for\ immediate\ feedback}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04635}04635\ \ \ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04636}04636\ \ \ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04637}04637\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Yellow\ (New\ Source)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04638}04638\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);\ \ \ \ \ \textcolor{comment}{//\ Green\ (Target)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04639}04639\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04640}04640\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04641}04641\ \ \ \ \ \ \ snprintf(msg,\ \textcolor{keyword}{sizeof}(msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04642}04642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Rook\ moved\ to\ \%c\%d\ -\/\ now\ move\ to\ GREEN\ pulsing\ square"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04643}04643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04644}04644\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04645}04645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04646}04646\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04647}04647\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04648}04648\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04649}04649\ \ \ \ \ \textcolor{comment}{//\ 4.\ Invalid\ move\ (Occupied\ square)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04650}04650\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ rook\ move\ during\ castling\ to\ \%c\%d\ (Occupied)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04651}04651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04652}04652\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04653}04653\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Square\ occupied\ -\/\ move\ rook\ to\ flashing\ green\ square"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04654}04654\ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04655}04655\ \ \ \ \ \textcolor{comment}{//\ Do\ not\ clear\ state,\ allow\ user\ to\ try\ again}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04656}04656\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04657}04657\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04658}04658\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04659}04659\ \ \ \textcolor{comment}{//\ PROMOTION\ (swap\_then\_choose,\ swap\ volitelný):}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04660}04660\ \ \ \textcolor{comment}{//\ -\/\ Povolit\ fyzický\ DN\ pouze\ na\ promočním\ poli\ (bez\ běžného\ drop/move\ flow).}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04661}04661\ \ \ \textcolor{comment}{//\ -\/\ Mimo\ promoční\ pole\ ignorovat\ a\ poslat\ krátkou\ hlášku.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04662}04662\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04663}04663\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_promo\_square\ =\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04664}04664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04665}04665\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04666}04666\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_promo\_square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04667}04667\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04668}04668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ pending:\ DROP\ on\ promo\ square\ \%c\%d\ allowed\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04669}04669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(swap\_then\_choose)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04670}04670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04671}04671\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04672}04672\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04673}04673\ \ \ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04674}04674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ pending\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04675}04675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Swap\ on\ promo\ square\ registered\ (optional)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04676}04676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}➡️\ Next:\ choose\ piece\ via\ green\ buttons\ /\ PROMOTE\ /\ web"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04677}04677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04678}04678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04679}04679\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04680}04680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04681}04681\ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Neprovádět\ standardní\ drop\ flow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04682}04682\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04683}04683\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04684}04684\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04685}04685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Promotion\ pending:\ DROP\ blocked\ outside\ promo\ square\ (\%s)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04686}04686\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04687}04687\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04688}04688\ \ \ \ \ \textcolor{keywordtype}{char}\ info\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04689}04689\ \ \ \ \ snprintf(info\_msg,\ \textcolor{keyword}{sizeof}(info\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04690}04690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ Promotion\ pending\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04691}04691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔁\ Swap\ allowed\ only\ on\ \%c\%d\ (optional)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04692}04692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}➡️\ Then\ choose\ piece\ via\ green\ buttons\ /\ PROMOTE\ /\ web"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04693}04693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04694}04694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04695}04695\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(info\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04696}04696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04697}04697\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04698}04698\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04699}04699\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04700}04700\ \ \ \textcolor{comment}{//\ KING\ RESIGNATION:\ Zrušit\ pouze\ když\ uživatel\ položí\ krále\ na\ jeho\ původní}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04701}04701\ \ \ \textcolor{comment}{//\ pole.\ Při\ vrácení\ soupeřovy\ figury\ (opponent\ return)\ NIKDY\ nerušit\ –\ král}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04702}04702\ \ \ \textcolor{comment}{//\ zůstává\ v\ ruce.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04703}04703\ \ \ \textcolor{keywordtype}{bool}\ in\_opponent\_return\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04704}04704\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da8d38d078f83ba6d016773d797e914e80}{GAME\_STATE\_WAITING\_FOR\_RETURN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04705}04705\ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04706}04706\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&\ in\_opponent\_return)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04707}04707\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04708}04708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ [STAGING]\ DROP\ during\ opponent\ return\ –\ keeping\ resignation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04709}04709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}timer\ (king\ still\ in\ hand)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04710}04710\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04711}04711\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&\ !in\_opponent\_return\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04712}04712\ \ \ \ \ \ \ to\_row\ ==\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04713}04713\ \ \ \ \ \ \ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04714}04714\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04715}04715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ DROP\ on\ king\ square\ \%c\%d\ –\ cancelling\ resignation\ (king\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04716}04716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}placed\ back)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04717}04717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04718}04718\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04719}04719\ \ \ \ \ \textcolor{comment}{//\ Po\ opponent-\/return\ jsme\ vyčistili\ piece\_lifted;\ král\ se\ vrací\ bez\ tracku.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04720}04720\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04721}04721\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04722}04722\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04723}04723\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ King\ placed\ -\/\ resignation\ cancelled"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04724}04724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04725}04725\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04726}04726\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04727}04727\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04728}04728\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04729}04729\ \ \ \textcolor{comment}{//\ POST-\/GAME\ PERSISTENCE:\ If\ game\ is\ finished,\ just\ update\ board\ visuals}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04730}04730\ \ \ \textcolor{comment}{//\ This\ handles\ the\ "{}King\ Resignation"{}\ scenario\ where\ the\ user\ puts\ the\ King}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04731}04731\ \ \ \textcolor{comment}{//\ down\ AFTER\ the\ timer\ has\ already\ ended\ the\ game.\ We\ must\ not\ lose\ the\ King!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04732}04732\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}}\ \&\&\ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04733}04733\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏁\ Game\ finished\ -\/\ preserving\ piece\ drop\ at\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04734}04734\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04735}04735\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04736}04736\ \ \ \ \ \textcolor{comment}{//\ Force\ update\ board\ to\ match\ physical\ reality}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04737}04737\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04738}04738\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04739}04739\ \ \ \ \ \textcolor{comment}{//\ Clear\ lifted\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04740}04740\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04741}04741\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04742}04742\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04743}04743\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04744}04744\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04745}04745\ \ \ \ \ \textcolor{comment}{//\ Update\ LED\ to\ show\ the\ piece\ is\ there\ (maybe\ gold/winner\ color?\ or\ just}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04746}04746\ \ \ \ \ \textcolor{comment}{//\ standard)\ For\ now,\ let\ the\ victory\ animation\ take\ over,\ or\ just\ clear.\ We}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04747}04747\ \ \ \ \ \textcolor{comment}{//\ send\ a\ generic\ response.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04748}04748\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Board\ synced\ (Game\ Over)"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04749}04749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04750}04750\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04751}04751\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04752}04752\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04753}04753\ \ \ \textcolor{comment}{//\ 3-\/STEP\ CAPTURE:\ Check\ if\ completing\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04754}04754\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04755}04755\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04756}04756\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}♟️\ \ Capture\ complete\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04757}04757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04758}04758\ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Pokud\ je\ resignation\ timer\ aktivní\ a\ král\ dělá\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04759}04759\ \ \ \ \ \ \ \textcolor{comment}{//\ tah,\ zrušit\ resignation\ timer\ PŘED\ voláním\ game\_execute\_move()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04760}04760\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&\ (\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04761}04761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04762}04762\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ King\ made\ a\ capture\ move\ during\ resignation\ timer\ -\/\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04763}04763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cancelling\ resignation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04764}04764\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04765}04765\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Resignation\ cancelled\ -\/\ king\ captured\ piece\ at\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04766}04766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04767}04767\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04768}04768\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04769}04769\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ capture\_move\ =\ \{.from\_row\ =\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04770}04770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04771}04771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04772}04772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04773}04773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04774}04774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04775}04775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04776}04776\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04777}04777\ \ \ \ \ \ \ \textcolor{comment}{//\ Temporarily\ restore\ captured\ piece\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04778}04778\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_is\_valid\_move\ needs\ to\ see\ the\ opponent\ piece\ to\ validate\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04779}04779\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04780}04780\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04781}04781\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&capture\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04782}04782\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04783}04783\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04784}04784\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04785}04785\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04786}04786\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04787}04787\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NO\ manual\ player\ switch\ -\/\ game\_execute\_move()\ already\ does\ it!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04788}04788\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Player\ is\ already\ switched\ by\ game\_execute\_move()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04789}04789\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04790}04790\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ already\ handled\ by\ game\_execute\_move()\ too}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04791}04791\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ do\ post-\/move\ cleanup}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04792}04792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04793}04793\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04794}04794\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04795}04795\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04796}04796\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04797}04797\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04798}04798\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ capture\ tah\ vyvolal\ promoci,\ NESPÍNAT\ normal\ post-\/move\ LED,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04799}04799\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ aby\ se\ nepřebil\ promotion\ UX\ (promo\ square\ anchor\ +\ zelená\ tlačítka).}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04800}04800\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04801}04801\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04802}04802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Capture\ resulted\ in\ promotion\ pending\ at\ \%c\%d\ -\/\ keeping\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04803}04803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}promotion\ UX"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04804}04804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04805}04805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04806}04806\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04807}04807\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Udržet\ promo\ square\ anchor\ (bez\ clear)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04808}04808\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b0ea1f9a91c492a93d4ad9b2afcdb59}{game\_update\_promotion\_anchor\_led}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04809}04809\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04810}04810\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ promo\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04811}04811\ \ \ \ \ \ \ \ \ \ \ snprintf(promo\_msg,\ \textcolor{keyword}{sizeof}(promo\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04812}04812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ required\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04813}04813\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔁\ You\ may\ swap\ on\ this\ square\ now\ (optional)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04814}04814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}➡️\ Next:\ choose\ piece\ via\ green\ buttons\ /\ PROMOTE\ /\ web"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04815}04815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04816}04816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04817}04817\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(promo\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04818}04818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04819}04819\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04820}04820\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04821}04821\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04822}04822\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04823}04823\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04824}04824\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04825}04825\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Capture\ complete!"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04826}04826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04827}04827\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04828}04828\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04829}04829\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04830}04830\ \ \ \ \ \ \ \textcolor{comment}{//\ Cancel\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04831}04831\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_acf3c29e0755d9839817e37766abf0841}{capture\_target\_row}}][\mbox{\hyperlink{game__task_8c_ac8abc30efd1065ba3e0ad3378ddedafe}{capture\_target\_col}}]\ =\ \mbox{\hyperlink{game__task_8c_a92739d92c8ffef161535f16fee1bbf44}{capture\_removed\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04832}04832\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af4bc372309f4e974d802cf688aaff7c9}{capture\_in\_progress}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04833}04833\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}⚠️\ Capture\ cancelled"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04834}04834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04835}04835\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04836}04836\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04837}04837\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04838}04838\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04839}04839\ \ \ \textcolor{comment}{//\ Kontrola\ opponent\ piece\ recovery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04840}04840\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da8d38d078f83ba6d016773d797e914e80}{GAME\_STATE\_WAITING\_FOR\_RETURN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04841}04841\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04842}04842\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Processing\ opponent\ piece\ return"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04843}04843\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04844}04844\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04845}04845\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Opponent\ piece\ returned\ to\ original\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04846}04846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04847}04847\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04848}04848\ \ \ \ \ \ \ \textcolor{comment}{//\ Vrátit\ figurku\ na\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04849}04849\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04850}04850\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04851}04851\ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ error\_recovery\_state\ (byl\ nastaven\ při\ PICKUP)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04852}04852\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04853}04853\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04854}04854\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04855}04855\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Clearing\ error\_recovery\_state\ after\ opponent\ piece\ return"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04856}04856\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04857}04857\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04858}04858\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04859}04859\ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ opponent\ piece\ recovery\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04860}04860\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a43cb8f21829cb4cc35a7335fdf1465c1}{opponent\_piece\_moved}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04861}04861\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04862}04862\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04863}04863\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04864}04864\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04865}04865\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04866}04866\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04867}04867\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04868}04868\ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04869}04869\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04870}04870\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04871}04871\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04872}04872\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04873}04873\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04874}04874\ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04875}04875\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04876}04876\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04877}04877\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04878}04878\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04879}04879\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04880}04880\ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ LED\ a\ ukázat\ normální\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04881}04881\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04882}04882\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04883}04883\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04884}04884\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Opponent\ piece\ returned\ -\/\ continue\ game"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04885}04885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04886}04886\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04887}04887\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04888}04888\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04889}04889\ \ \ \ \ \textcolor{comment}{//\ NESPRÁVNÉ\ POLOŽENÍ:\ Figurka\ se\ pokládá\ na\ jinou\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04890}04890\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04891}04891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Opponent\ piece\ placed\ at\ wrong\ position\ \%c\%d\ (should\ be\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04892}04892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04893}04893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04894}04894\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04895}04895\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ aktuální\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04896}04896\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5ad5daaa132c46754e7718518aac40fd}{opponent\_current\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04897}04897\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeb8179882039bb317d2467c1954ecf27}{opponent\_current\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04898}04898\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04899}04899\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ board\ (figurka\ je\ nyní\ na\ nové\ pozici)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04900}04900\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a229b05a8e7118cfca7f6bec35c02334b}{opponent\_piece\_type}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04901}04901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04902}04902\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ lifted\ piece\ state\ pro\ další\ pokus}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04903}04903\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04904}04904\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04905}04905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04906}04906\ \ \ \ \ \textcolor{comment}{//\ LED:\ Zobrazit\ červenou\ LED\ na\ původní\ pozici\ (kde\ má\ být\ figurka}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04907}04907\ \ \ \ \ \textcolor{comment}{//\ vrácena)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04908}04908\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04909}04909\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04910}04910\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}},\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04911}04911\ \ \ \ \ \ \ \ \ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Solid\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04912}04912\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04913}04913\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04914}04914\ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04915}04915\ \ \ \ \ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04916}04916\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Opponent\ piece\ at\ wrong\ position\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04917}04917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔴\ Return\ to\ RED\ square\ (\%c\%d)\ to\ continue"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04918}04918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a83b693be32848ae61a88d70f0c1eb629}{opponent\_original\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04919}04919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae11c7fc1300aa53228b21f38059bda32}{opponent\_original\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04920}04920\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >=\ \textcolor{keyword}{sizeof}(error\_msg))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04921}04921\ \ \ \ \ \ \ strcpy(error\_msg,\ \textcolor{stringliteral}{"{}⚠️\ Return\ opponent\ piece\ to\ RED\ square"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04922}04922\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04923}04923\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04924}04924\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04925}04925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04926}04926\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04927}04927\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04928}04928\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04929}04929\ \ \ \textcolor{comment}{//\ KONTROLA:\ Je\ figurka\ v\ error\ recovery\ stavu?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04930}04930\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04931}04931\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Processing\ move\ correction\ from\ error\ state"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04932}04932\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04933}04933\ \ \ \ \ \textcolor{comment}{//\ KONTROLA\ NÁVRATU\ NA\ PŮVODNÍ\ POZICI}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04934}04934\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04935}04935\ \ \ \ \ \ \ \ \ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04936}04936\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04937}04937\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}↩️\ Piece\ returned\ to\ ORIGINAL\ valid\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04938}04938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04939}04939\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04940}04940\ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Opravit\ board\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04941}04941\ \ \ \ \ \ \ \textcolor{comment}{//\ Odstranit\ figurku\ z\ neplatné\ pozice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04942}04942\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row]}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04943}04943\ \ \ \ \ \ \ \ \ \ \ \ [\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04944}04944\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04945}04945\ \ \ \ \ \ \ \textcolor{comment}{//\ Vrátit\ figurku\ na\ původní\ validní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04946}04946\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04947}04947\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04948}04948\ \ \ \ \ \ \ \textcolor{comment}{//\ RESETOVAT\ error\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04949}04949\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04950}04950\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04951}04951\ \ \ \ \ \ \ \textcolor{comment}{//\ RESETOVAT\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04952}04952\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04953}04953\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04954}04954\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04955}04955\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04956}04956\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04957}04957\ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ LED\ a\ ukázat\ normální\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04958}04958\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}();\ \textcolor{comment}{//\ STOP\ blinking\ red\ LED!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04959}04959\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04960}04960\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04961}04961\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04962}04962\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Piece\ returned\ to\ original\ valid\ position"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04963}04963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04964}04964\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04965}04965\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04966}04966\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04967}04967\ \ \ \ \ \textcolor{comment}{//\ Pokus\ o\ jiný\ tah\ z\ error\ pozice\ -\/\ validovat\ jako\ normální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04968}04968\ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ correction\_move\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04969}04969\ \ \ \ \ \ \ \ \ .from\_row\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04970}04970\ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04971}04971\ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04972}04972\ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04973}04973\ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04974}04974\ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04975}04975\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04976}04976\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04977}04977\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&correction\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04978}04978\ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04979}04979\ \ \ \ \ \ \ \textcolor{comment}{//\ Validní\ korekční\ tah!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04980}04980\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Valid\ correction\ move\ from\ error\ position"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04981}04981\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04982}04982\ \ \ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ board\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04983}04983\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row]}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04984}04984\ \ \ \ \ \ \ \ \ \ \ \ [\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04985}04985\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04986}04986\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04987}04987\ \ \ \ \ \ \ \textcolor{comment}{//\ Provést\ normální\ move\ execution}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04988}04988\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&correction\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04989}04989\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Úspěšný\ tah\ -\/\ resetovat\ error\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04990}04990\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04991}04991\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04992}04992\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Změnit\ hráče\ a\ přepnout\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04993}04993\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04994}04994\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04995}04995\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04996}04996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04997}04997\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04998}04998\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l04999}04999\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05000}05000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (correction):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05001}05001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05002}05002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05003}05003\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05004}05004\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05005}05005\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05006}05006\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Kontrola\ checkmate/stalemate\ po\ correction\ tahu!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05007}05007\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05008}05008\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05009}05009\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05010}05010\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05011}05011\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎉\ Game\ finished\ detected\ in\ correction\ move!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05012}05012\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05013}05013\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05014}05014\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resetovat\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05015}05015\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05016}05016\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05017}05017\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05018}05018\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05019}05019\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05020}05020\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ LED\ a\ ukázat\ nový\ stav\ (blikání\ už\ přerušeno\ na\ začátku\ DROP)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05021}05021\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05022}05022\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05023}05023\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05024}05024\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05025}05025\ \ \ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05026}05026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Correction\ move\ successful:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05027}05027\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05028}05028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05029}05029\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05030}05030\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05031}05031\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05032}05032\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05033}05033\ \ \ \ \ \textcolor{comment}{//\ Stále\ neplatný\ tah\ -\/\ pokračovat\ v\ error\ stavu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05034}05034\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Correction\ move\ still\ invalid:\ error\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05035}05035\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05036}05036\ \ \ \ \ \textcolor{comment}{//\ KRITICKÝ:\ Aktualizovat\ board\ stav\ a\ invalid\ pozici!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05037}05037\ \ \ \ \ \textcolor{comment}{//\ Figurka\ se\ FYZICKY\ přesunula\ z\ A5\ na\ H5,\ musíme\ to\ reflektovat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05038}05038\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05039}05039\ \ \ \ \ \textcolor{comment}{//\ 1.\ Přesunout\ figurku\ na\ boardu\ z\ old\ invalid\ na\ new\ invalid}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05040}05040\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row][\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05041}05041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05042}05042\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05043}05043\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05044}05044\ \ \ \ \ \textcolor{comment}{//\ 2.\ Aktualizovat\ invalid\ pozici\ na\ novou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05045}05045\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ to\_row;\ \textcolor{comment}{//\ H5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05046}05046\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05047}05047\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05048}05048\ \ \ \ \ \textcolor{comment}{//\ 3.\ Aktualizovat\ lifted\ piece\ tracking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05049}05049\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05050}05050\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05051}05051\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05052}05052\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05053}05053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔧\ Successive\ invalid\ move:\ updated\ invalid\ position\ to\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05054}05054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(original\_valid\ still\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05055}05055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05056}05056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05057}05057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05058}05058\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05059}05059\ \ \ \ \ \textcolor{comment}{//\ 4.\ Poslat\ odpověď\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05060}05060\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05061}05061\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05062}05062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Still\ invalid\ move\ to\ \%c\%d\ -\/\ return\ to\ ORIGINAL\ \%c\%d\ or\ find\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05063}05063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}valid\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05064}05064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05065}05065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05066}05066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05067}05067\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05068}05068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05069}05069\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05070}05070\ \ \ \ \ \textcolor{comment}{//\ 5.\ Blikat\ červeně\ na\ NOVÉ\ invalid\ pozici\ (H5,\ ne\ A5!)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05071}05071\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05072}05072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05073}05073\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05074}05074\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05075}05075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05076}05076\ \ \ \textcolor{comment}{//\ NORMÁLNÍ\ PROCESSING\ -\/\ kontrola\ jestli\ máme\ lifted\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05077}05077\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05078}05078\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ piece\ was\ lifted\ -\/\ use\ UP\ command\ first"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05079}05079\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ No\ piece\ was\ lifted\ -\/\ use\ UP\ command\ first"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05080}05080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{true},\ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05081}05081\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05082}05082\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05083}05083\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05084}05084\ \ \ \textcolor{comment}{//\ KONTROLA\ ZRUŠENÍ\ TAHU\ (drop\ na\ stejné\ pole)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05085}05085\ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05086}05086\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Move\ cancelled:\ piece\ placed\ on\ source\ square\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05087}05087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05088}05088\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05089}05089\ \ \ \ \ \textcolor{comment}{//\ Reset\ lifted\ piece\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05090}05090\ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05091}05091\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05092}05092\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05093}05093\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05094}05094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05095}05095\ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figurky\ (blikání\ už\ přerušeno\ na\ začátku\ DROP)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05096}05096\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05097}05097\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05098}05098\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05099}05099\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}✅\ Move\ cancelled"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05100}05100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05101}05101\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05102}05102\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05103}05103\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05104}05104\ \ \ \textcolor{comment}{//\ VALIDACE\ TAHU}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05105}05105\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ move\ =\ \{.from\_row\ =\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05106}05106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05107}05107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05108}05108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05109}05109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05110}05110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05111}05111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05112}05112\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05113}05113\ \ \ \textcolor{comment}{//\ Detekce\ castling\ PŘED\ validací\ (pro\ resignation\ timer\ handling)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05114}05114\ \ \ \textcolor{keywordtype}{bool}\ is\_castling\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05115}05115\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05116}05116\ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})to\_col\ -\/\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}})\ ==\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05117}05117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05118}05118\ \ \ \textcolor{comment}{//\ Pokud\ je\ castling\ tah\ a\ resignation\ timer\ je\ aktivní,\ zrušit\ resignation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05119}05119\ \ \ \textcolor{keywordflow}{if}\ (is\_castling\ \&\&\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05120}05120\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ detected\ during\ resignation\ timer\ -\/\ cancelling\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05121}05121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}resignation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05122}05122\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05123}05123\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Resignation\ cancelled\ -\/\ continuing\ with\ castling\ flow"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05124}05124\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05125}05125\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05126}05126\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05127}05127\ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05128}05128\ \ \ \ \ \textcolor{comment}{//\ VALIDNÍ\ TAH\ -\/\ normální\ processing}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05129}05129\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Valid\ move\ detected"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05130}05130\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05131}05131\ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Pokud\ je\ resignation\ timer\ aktivní\ a\ král\ udělá\ validní}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05132}05132\ \ \ \ \ \textcolor{comment}{//\ tah\ (ne\ castling,\ ne\ položití\ zpět),\ zrušit\ resignation\ timer\ Castling\ už}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05133}05133\ \ \ \ \ \textcolor{comment}{//\ je\ ošetřen\ výše,\ takže\ tady\ kontrolujeme\ normální\ tahy\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05134}05134\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05135}05135\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05136}05136\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05137}05137\ \ \ \ \ \ \ \ \ !is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05138}05138\ \ \ \ \ \ \ \textcolor{comment}{//\ Kontrola,\ zda\ se\ král\ nepokládá\ zpět\ na\ původní\ pozici\ (to\ je\ handled}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05139}05139\ \ \ \ \ \ \ \textcolor{comment}{//\ jinde)\ Pokud\ je\ to\ jiná\ pozice\ než\ původní,\ je\ to\ normální\ tah\ →\ zrušit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05140}05140\ \ \ \ \ \ \ \textcolor{comment}{//\ resignation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05141}05141\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ !=\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05142}05142\ \ \ \ \ \ \ \ \ \ \ to\_col\ !=\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05143}05143\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ King\ made\ a\ normal\ move\ during\ resignation\ timer\ -\/\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05144}05144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cancelling\ resignation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05145}05145\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05146}05146\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Resignation\ cancelled\ -\/\ king\ moved\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05147}05147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05148}05148\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05149}05149\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05150}05150\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05151}05151\ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Zkontrolovat\ castling\_state.in\_progress\ PŘED\ voláním}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05152}05152\ \ \ \ \ \textcolor{comment}{//\ game\_execute\_move()\ protože\ game\_execute\_move\_enhanced()\ resetuje}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05153}05153\ \ \ \ \ \textcolor{comment}{//\ castling\_state.in\_progress\ =\ false\ Pokud\ je\ castling\_state.in\_progress,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05154}05154\ \ \ \ \ \textcolor{comment}{//\ player\ change\ animace\ už\ se\ spustí\ v\ game\_execute\_move\_enhanced()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05155}05155\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_castling\_completion\_before\_move\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05156}05156\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05157}05157\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05158}05158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ game\_process\_drop\_command:\ BEFORE\ game\_execute\_move,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05159}05159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_player=\%s,\ is\_castling\_completion\_before\_move=\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05160}05160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05161}05161\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_castling\_completion\_before\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05162}05162\ \ \ \ \ \textcolor{keywordtype}{bool}\ move\_success\ =\ \mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05163}05163\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05164}05164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ game\_process\_drop\_command:\ AFTER\ game\_execute\_move,\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05165}05165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}move\_success=\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05166}05166\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_success);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05167}05167\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05168}05168\ \ \ \ \ \textcolor{keywordflow}{if}\ (move\_success)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05169}05169\ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Reset\ error\ state\ při\ jakémkoliv\ validním\ tahu!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05170}05170\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05171}05171\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Valid\ move\ -\/\ clearing\ error\ recovery\ state"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05172}05172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05173}05173\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05174}05174\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05175}05175\ \ \ \ \ \ \ \textcolor{comment}{//\ \#1:\ Check\ if\ promotion\ is\ pending\ -\/\ if\ so,\ SKIP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05176}05176\ \ \ \ \ \ \ \textcolor{comment}{//\ timer/animations\ They\ will\ execute\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05177}05177\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_process\_promotion\_command()\ after\ user\ selects\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05178}05178\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05179}05179\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05180}05180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Promotion\ pending\ at\ \%c\%d\ -\/\ skipping\ timer\ switch\ and\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05181}05181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animations"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05182}05182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05183}05183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05184}05184\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏸️\ \ Awaiting\ promotion\ selection\ via\ buttons/UART/web"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05185}05185\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏸️\ \ Timer\ remains\ with\ \%s\ player"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05186}05186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05187}05187\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05188}05188\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Keep\ promo\ square\ visually\ anchored\ (does\ not\ clear\ board)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05189}05189\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b0ea1f9a91c492a93d4ad9b2afcdb59}{game\_update\_promotion\_anchor\_led}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05190}05190\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05191}05191\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ success\ response\ without\ animations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05192}05192\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05193}05193\ \ \ \ \ \ \ \ \ snprintf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05194}05194\ \ \ \ \ \ \ \ \ \ \ \ \ success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05195}05195\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Valid\ move:\ \%c\%d\ →\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05196}05196\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}👑\ Promotion\ required\ at\ \%c\%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05197}05197\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔁\ Optional:\ swap\ on\ \%c\%d\ now\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05198}05198\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}➡️\ Then\ choose\ piece\ (green\ buttons\ /\ PROMOTE\ /\ web)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05199}05199\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05200}05200\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05201}05201\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05202}05202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05203}05203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05204}05204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Exit\ here\ -\/\ no\ timer\ switch,\ no\ animations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05205}05205\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05206}05206\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05207}05207\ \ \ \ \ \ \ \textcolor{comment}{//\ Použít\ is\_castling\_completion\_before\_move\ (uložené\ PŘED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05208}05208\ \ \ \ \ \ \ \textcolor{comment}{//\ game\_execute\_move())\ protože\ game\_execute\_move\_enhanced()\ resetuje}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05209}05209\ \ \ \ \ \ \ \textcolor{comment}{//\ castling\_state.in\_progress\ =\ false\ Pokud\ je}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05210}05210\ \ \ \ \ \ \ \textcolor{comment}{//\ is\_castling\_completion\_before\_move,\ player\ change\ animace\ už\ se}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05211}05211\ \ \ \ \ \ \ \textcolor{comment}{//\ spustila\ v\ game\_execute\_move\_enhanced()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05212}05212\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05213}05213\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!is\_castling\ \&\&\ !is\_castling\_completion\_before\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05214}05214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ move\ path\ animaci\ PŘED\ změnou\ hráče\ (podle\ starého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05215}05215\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05216}05216\ \ \ \ \ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05217}05217\ \ \ \ \ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05218}05218\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ move\_path\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05219}05219\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dab4580f84f360910c3c26cd55b1ecdf42}{LED\_CMD\_ANIM\_MOVE\_PATH}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05220}05220\ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05221}05221\ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05222}05222\ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05223}05223\ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05224}05224\ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05225}05225\ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&to\_led\ \textcolor{comment}{//\ Cílová\ pozice\ v\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05226}05226\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05227}05227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&move\_path\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05228}05228\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05229}05229\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Animace\ běží\ asynchronně,\ neblokujeme\ zpracování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05230}05230\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Animace\ jsou\ spuštěny\ v\ led\_task\ a\ běží\ nezávisle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05231}05231\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (vTaskDelay\ odstraněn\ pro\ lepší\ throughput)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05232}05232\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05233}05233\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ HRÁČ\ SE\ UŽ\ ZMĚNIL\ V\ game\_execute\_move()\ -\/\ použít\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05234}05234\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05235}05235\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05236}05236\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05237}05237\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05238}05238\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (drop):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05239}05239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05240}05240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05241}05241\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05242}05242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05243}05243\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05244}05244\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05245}05245\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05246}05246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05247}05247\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05248}05248\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05249}05249\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05250}05250\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05251}05251\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Game\ finished\ detected\ -\/\ animation\ triggered\ by\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05252}05252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}check\ function"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05253}05253\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05254}05254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05255}05255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05256}05256\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!is\_castling\_completion\_before\_move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05257}05257\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nespouštět\ player\ change\ animaci\ pokud\ je\ to\ castling\ dokončení}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05258}05258\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (player\ change\ animace\ už\ se\ spustila\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05259}05259\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_execute\_move\_enhanced())\ Není\ endgame\ a\ není\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05260}05260\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dokončení\ -\/\ spustit\ player\ change\ animaci\ s\ NOVÝM\ hráčem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05261}05261\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (current\_player)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05262}05262\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05263}05263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05264}05264\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05265}05265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05266}05266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05267}05267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05268}05268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05269}05269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05270}05270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05271}05271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05272}05272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05273}05273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ NOVÉHO\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05274}05274\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05275}05275\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05276}05276\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05277}05277\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Castling\ dokončení\ -\/\ player\ change\ animace\ už\ se\ spustila\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05278}05278\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_execute\_move\_enhanced()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05279}05279\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ completion\ -\/\ player\ change\ animation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05280}05280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}already\ triggered\ in\ game\_execute\_move\_enhanced()"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05281}05281\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05282}05282\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ Konec\ bloku\ if\ (!is\_castling\ \&\&\ !is\_castling\_completion\_before\_move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05283}05283\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05284}05284\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ animace\ se\ spustí\ vždy\ (i\ při\ castling\ dokončení)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05285}05285\ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu\ (pouze\ pokud\ move\_success)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05286}05286\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05287}05287\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05288}05288\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05289}05289\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05290}05290\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05291}05291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05292}05292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05293}05293\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05294}05294\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05295}05295\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05296}05296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05297}05297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05298}05298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05299}05299\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05300}05300\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05301}05301\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05302}05302\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05303}05303\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05304}05304\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05305}05305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05306}05306\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05307}05307\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05308}05308\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05309}05309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05310}05310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05311}05311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05312}05312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05313}05313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05314}05314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05315}05315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05316}05316\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05317}05317\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05318}05318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05319}05319\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05320}05320\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05321}05321\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05322}05322\ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ lifted\ piece\ state\ po\ úspěšném\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05323}05323\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05324}05324\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05325}05325\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05326}05326\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05327}05327\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05328}05328\ \ \ \ \ \ \ \textcolor{comment}{//\ MATRIX\ COMPATIBILITY:\ Show\ opponent\ pieces\ after\ successful\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05329}05329\ \ \ \ \ \ \ \textcolor{comment}{//\ (same\ as\ matrix\ flow)\ -\/\ ONLY\ if\ game\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05330}05330\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05331}05331\ \ \ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05332}05332\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05333}05333\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05334}05334\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05335}05335\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05336}05336\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ success\_msg);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05337}05337\ \ \ \ \ \ \ snprintf(success\_msg\ +\ strlen(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05338}05338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(success\_msg)\ -\/\ strlen(success\_msg),\ \textcolor{stringliteral}{"{}\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05339}05339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05340}05340\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📤\ Sending\ success\ response..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05341}05341\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05342}05342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05343}05343\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📤\ Success\ response\ sent"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05344}05344\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05345}05345\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05346}05346\ \ \ \ \ \textcolor{comment}{//\ NEVALIDNÍ\ TAH\ -\/\ ENHANCED\ ERROR\ HANDLING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05347}05347\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ move\ attempt:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05348}05348\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05349}05349\ \ \ \ \ \textcolor{comment}{//\ KRITICKÝ:\ Rozlišit\ první\ error\ vs\ další\ errory}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05350}05350\ \ \ \ \ \textcolor{keywordtype}{bool}\ already\_in\_error\ =\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05351}05351\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05352}05352\ \ \ \ \ \textcolor{comment}{//\ SPOLEČNÉ\ NASTAVENÍ\ pro\ všechny\ chyby}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05353}05353\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05354}05354\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05355}05355\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05356}05356\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05357}05357\ \ \ \ \ \ \ \ \ to\_row;\ \textcolor{comment}{//\ Aktualizovat\ na\ novou\ neplatnou\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05358}05358\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05359}05359\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05360}05360\ \ \ \ \ \textcolor{comment}{//\ KRITICKÝ:\ Nastavit\ original\_valid\ POUZE\ při\ PRVNÍM\ erroru!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05361}05361\ \ \ \ \ \textcolor{comment}{//\ Při\ dalších\ errorech\ NEPŘEPISOVAT\ -\/\ original\ zůstává\ stejné\ (A2)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05362}05362\ \ \ \ \ \textcolor{keywordflow}{if}\ (!already\_in\_error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05363}05363\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05364}05364\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}};\ \textcolor{comment}{//\ A2\ -\/\ první\ validní\ pozice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05365}05365\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05366}05366\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔧\ First\ error:\ original\_valid\ set\ to\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05367}05367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05368}05368\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05369}05369\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05370}05370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔧\ Successive\ error:\ original\_valid\ stays\ at\ \%c\%d\ (invalid\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05371}05371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}moves\ to\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05372}05372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05373}05373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05374}05374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05375}05375\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05376}05376\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05377}05377\ \ \ \ \ \textcolor{comment}{//\ AKTUALIZOVAT\ board\ stav\ -\/\ figurka\ je\ nyní\ na\ neplatném\ poli\ (fyzická}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05378}05378\ \ \ \ \ \textcolor{comment}{//\ realita)\ Board\ musí\ odpovídat\ fyzickému\ stavu,\ aby\ PICKUP\ fungoval}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05379}05379\ \ \ \ \ \textcolor{comment}{//\ správně!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05380}05380\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}][\mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05381}05381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ původní\ pole\ prázdné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05382}05382\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\ =\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}};\ \textcolor{comment}{//\ neplatné\ pole\ má\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05383}05383\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05384}05384\ \ \ \ \ \textcolor{comment}{//\ AKTUALIZOVAT\ lifted\_piece\ tracking\ na\ novou\ neplatnou\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05385}05385\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05386}05386\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05387}05387\ \ \ \ \ \textcolor{comment}{//\ piece\_lifted\ =\ true;\ //\ Zůstává\ true!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05388}05388\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05389}05389\ \ \ \ \ \textcolor{comment}{//\ LED\ INDIKACE\ -\/\ červené\ blikání\ na\ neplatném\ poli}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05390}05390\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(to\_row,\ to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05391}05391\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05392}05392\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05393}05393\ \ \ \ \ snprintf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05394}05394\ \ \ \ \ \ \ \ \ error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05395}05395\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ move\ to\ \%s\ -\/\ return\ to\ ORIGINAL\ \%c\%d\ or\ find\ valid\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05396}05396\ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05397}05397\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05398}05398\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05399}05399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05400}05400\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05401}05401\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05402}05402\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05408}\mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{05408}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(uint8\_t\ error\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05409}05409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ error\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05410}05410\ \ \ \textcolor{comment}{//\ Přerušit\ předchozí\ blikání}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05411}05411\ \ \ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05412}05412\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05413}05413\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ Starting\ non-\/blocking\ blink\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ error\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05414}05414\ \ \ \ \ \ \ \ \ \ \ \ error\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05415}05415\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05416}05416\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05417}05417\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05418}05418\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(error\_row,\ error\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05419}05419\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05420}05420\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.max\_blinks\ =\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05421}05421\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.last\_toggle\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05422}05422\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_interval\_ms\ =\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05423}05423\ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05424}05424\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05425}05425\ \ \ \textcolor{comment}{//\ Spustit\ první\ toggle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05426}05426\ \ \ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05427}05427\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05428}05428\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05432}\mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{05432}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05433}05433\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05434}05434\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05435}05435\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05436}05436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05437}05437\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05438}05438\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05439}05439\ \ \ \textcolor{comment}{//\ Kontrola\ timeoutu\ pro\ toggle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05440}05440\ \ \ \textcolor{keywordflow}{if}\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.last\_toggle\_time\ >=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05441}05441\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_interval\_ms)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05442}05442\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05443}05443\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05444}05444\ \ \ \ \ \textcolor{comment}{//\ Toggle\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05445}05445\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05446}05446\ \ \ \ \ \ \ \textcolor{comment}{//\ Vypnout\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05447}05447\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05448}05448\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05449}05449\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05450}05450\ \ \ \ \ \ \ \textcolor{comment}{//\ Zapnout\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05451}05451\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Červená}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05452}05452\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_state\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05453}05453\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05454}05454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05455}05455\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.last\_toggle\_time\ =\ current\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05456}05456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05457}05457\ \ \ \ \ \textcolor{comment}{//\ Kontrola\ ukončení\ blikání}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05458}05458\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.blink\_count\ >=\ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.max\_blinks)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05459}05459\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05460}05460\ \ \ \ \ \ \ \textcolor{comment}{//\ Nechat\ LED\ rozsvícenou\ na\ konci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05461}05461\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 255,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05462}05462\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Error\ blink\ completed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05463}05463\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05464}05464\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05465}05465\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05466}05466\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05470}\mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{05470}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a372a178141cd4d42682ec1b5a5f50e02}{game\_stop\_error\_blink}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05471}05471\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05472}05472\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05473}05473\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{game__task_8c_aa911d0eb12e9acc41eb02246254cdb26}{blink\_state}}.led\_index,\ 0,\ 0,\ 0);\ \textcolor{comment}{//\ Vypnout\ LED}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05474}05474\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🛑\ Error\ blink\ interrupted\ by\ user\ action"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05475}05475\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05476}05476\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05477}05477\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05489}\mbox{\hyperlink{game__task_8c_a1e01fb94ceb1dc74ff280d87a35c1076}{05489}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1e01fb94ceb1dc74ff280d87a35c1076}{game\_trigger\_victory\_animation}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05490}05490\ \ \ uint8\_t\ king\_pos\ =\ 27;\ \textcolor{comment}{//\ default\ fallback\ (d4)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05491}05491\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ winning\_king\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05492}05492\ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05493}05493\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05494}05494\ \ \ \textcolor{comment}{//\ Find\ king\ position\ of\ the\ WINNER}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05495}05495\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05496}05496\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ =\ i\ /\ 8;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05497}05497\ \ \ \ \ \textcolor{keywordtype}{int}\ c\ =\ i\ \%\ 8;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05498}05498\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}][c]\ ==\ winning\_king)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05499}05499\ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05500}05500\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05501}05501\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05502}05502\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05503}05503\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05504}05504\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Triggering\ Victory\ Animation\ for\ \%s\ (King\ at\ \%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05505}05505\ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05506}05506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05507}05507\ \ \ \textcolor{comment}{//\ Použít\ LED\_CMD\_ANIM\_ENDGAME\ místo\ start\_endgame\_animation()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05508}05508\ \ \ \textcolor{comment}{//\ Toto\ volá\ led\_anim\_endgame()\ v\ led\_task.c,\ která\ má\ správné\ barvy}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05509}05509\ \ \ \textcolor{comment}{//\ (zelená\ pro\ vítěze,\ červená\ pro\ poraženého,\ modrá\ pro\ prázdná\ pole)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05510}05510\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05511}05511\ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05512}05512\ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05513}05513\ \ \ \ \ \ \ .red\ =\ 0,\ \textcolor{comment}{//\ Barvy\ nejsou\ použity\ -\/\ animace\ si\ je\ určí\ sama}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05514}05514\ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05515}05515\ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05516}05516\ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05517}05517\ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05518}05518\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05519}05519\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05520}05520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05524}\mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{05524}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa3dc2b9ee227e2a5302b2c1d908ec6d7}{game\_reset\_error\_recovery\_state}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05525}05525\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05526}05526\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05527}05527\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05528}05528\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05529}05529\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05530}05530\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05531}05531\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05532}05532\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05533}05533\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05534}05534\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Error\ recovery\ state\ reset"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05535}05535\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05536}05536\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05537}05537\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05538}05538\ \textcolor{comment}{//\ PROMOTION\ HELPER\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05539}05539\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05540}05540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05549}\mbox{\hyperlink{game__task_8c_a5b0ea1f9a91c492a93d4ad9b2afcdb59}{05549}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5b0ea1f9a91c492a93d4ad9b2afcdb59}{game\_update\_promotion\_anchor\_led}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05550}05550\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05551}05551\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05552}05552\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05553}05553\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05554}05554\ \ \ uint8\_t\ row\ =\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05555}05555\ \ \ uint8\_t\ col\ =\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05556}05556\ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05557}05557\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05558}05558\ \ \ \textcolor{comment}{//\ Pulse\ between\ purple\ (pending)\ and\ gold\ (choice/upgrade)\ for\ clarity}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05559}05559\ \ \ uint32\_t\ now\_ms\ =\ (uint32\_t)(esp\_timer\_get\_time()\ /\ 1000ULL);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05560}05560\ \ \ \textcolor{keywordtype}{float}\ t\ =\ (float)(now\_ms\ \%\ 1000U)\ /\ 1000.0f;\ \textcolor{comment}{//\ 0..1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05561}05561\ \ \ \textcolor{keywordtype}{float}\ phase\ =\ t\ *\ 2.0f\ *\ 3.14159f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05562}05562\ \ \ \textcolor{keywordtype}{float}\ mix\ =\ 0.5f\ +\ 0.5f\ *\ sinf(phase);\ \textcolor{comment}{//\ 0..1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05563}05563\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05564}05564\ \ \ \textcolor{comment}{//\ Purple\ base}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05565}05565\ \ \ \textcolor{keywordtype}{float}\ pr\ =\ 128.0f,\ pg\ =\ 0.0f,\ pb\ =\ 128.0f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05566}05566\ \ \ \textcolor{comment}{//\ Gold\ target}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05567}05567\ \ \ \textcolor{keywordtype}{float}\ gr\ =\ 255.0f,\ gg\ =\ 215.0f,\ gb\ =\ 0.0f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05568}05568\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05569}05569\ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ =\ (uint8\_t)(pr\ *\ (1.0f\ -\/\ mix)\ +\ gr\ *\ mix);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05570}05570\ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a1673907d4d89d763bb7b94ec1eeb7b60}{g}}\ =\ (uint8\_t)(pg\ *\ (1.0f\ -\/\ mix)\ +\ gg\ *\ mix);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05571}05571\ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a4313c9563516f94387762ab05763456b}{b}}\ =\ (uint8\_t)(pb\ *\ (1.0f\ -\/\ mix)\ +\ gb\ *\ mix);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05572}05572\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05573}05573\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}},\ \mbox{\hyperlink{ha__light__task_8c_a1673907d4d89d763bb7b94ec1eeb7b60}{g}},\ \mbox{\hyperlink{ha__light__task_8c_a4313c9563516f94387762ab05763456b}{b}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05574}05574\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05575}05575\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05594}\mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{05594}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05595}05595\ \ \ \textcolor{comment}{//\ Reset\ promotion\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05596}05596\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05597}05597\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05598}05598\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05599}05599\ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05600}05600\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05601}05601\ \ \ \textcolor{comment}{//\ Check\ for\ pawns\ on\ promotion\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05602}05602\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05603}05603\ \ \ \ \ \textcolor{comment}{//\ White\ pawn\ on\ rank\ 8\ (row\ 7)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05604}05604\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05605}05605\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05606}05606\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05607}05607\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05608}05608\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05609}05609\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}};\ \textcolor{comment}{//\ Set\ game\ state\ to\ PROMOTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05610}05610\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05611}05611\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ White\ promotion\ needed\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05612}05612\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05613}05613\ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ promotion\ menu\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05614}05614\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05615}05615\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05616}05616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05617}05617\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ PAWN\ PROMOTION\ AVAILABLE!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05618}05618\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05619}05619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05620}05620\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📍\ Square:\ \%c\%d\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05621}05621\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎮\ Player:\ White\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05622}05622\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05623}05623\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎯\ Choose\ promotion\ piece:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05624}05624\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05625}05625\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}💡\ PHYSICAL\ BUTTONS\ (press\ one):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05626}05626\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 0\ (LED\ 64\ 🟢)\ →\ QUEEN\ \ (most\ powerful)\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05627}05627\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 1\ (LED\ 65\ 🟢)\ →\ ROOK\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05628}05628\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 2\ (LED\ 66\ 🟢)\ →\ BISHOP\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05629}05629\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 3\ (LED\ 67\ 🟢)\ →\ KNIGHT\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05630}05630\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05631}05631\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📝\ UART\ COMMANDS\ (alternative):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05632}05632\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=Q\ \ →\ Queen\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05633}05633\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=R\ \ →\ Rook\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05634}05634\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=B\ \ →\ Bishop\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05635}05635\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=N\ \ →\ Knight\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05636}05636\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05637}05637\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}⚠️\ \ Note:\ Until\ promotion\ is\ completed,\ only\ the\ promotion\ square\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05638}05638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}may\ be\ touched\ for\ optional\ swap.\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05639}05639\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05640}05640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05641}05641\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05642}05642\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05643}05643\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05644}05644\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05645}05645\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05646}05646\ \ \ \ \ \textcolor{comment}{//\ Black\ pawn\ on\ rank\ 1\ (row\ 0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05647}05647\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05648}05648\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05649}05649\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05650}05650\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05651}05651\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ =\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05652}05652\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}};\ \textcolor{comment}{//\ Set\ game\ state\ to\ PROMOTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05653}05653\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05654}05654\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Black\ promotion\ needed\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05655}05655\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05656}05656\ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ promotion\ menu\ to\ UART}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05657}05657\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05658}05658\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05659}05659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05660}05660\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ PAWN\ PROMOTION\ AVAILABLE!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05661}05661\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05662}05662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05663}05663\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📍\ Square:\ \%c\%d\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05664}05664\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎮\ Player:\ Black\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05665}05665\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05666}05666\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎯\ Choose\ promotion\ piece:\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05667}05667\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05668}05668\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}💡\ PHYSICAL\ BUTTONS\ (press\ one):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05669}05669\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 0\ (LED\ 68\ 🟢)\ →\ QUEEN\ \ (most\ powerful)\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05670}05670\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 1\ (LED\ 69\ 🟢)\ →\ ROOK\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05671}05671\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 2\ (LED\ 70\ 🟢)\ →\ BISHOP\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05672}05672\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ Button\ 3\ (LED\ 71\ 🟢)\ →\ KNIGHT\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05673}05673\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05674}05674\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}📝\ UART\ COMMANDS\ (alternative):\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05675}05675\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=Q\ \ →\ Queen\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05676}05676\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=R\ \ →\ Rook\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05677}05677\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=B\ \ →\ Bishop\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05678}05678\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ \ •\ PROMOTE\ \%c\%d=N\ \ →\ Knight\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05679}05679\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05680}05680\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}⚠️\ \ Note:\ Until\ promotion\ is\ completed,\ only\ the\ promotion\ square\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05681}05681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}may\ be\ touched\ for\ optional\ swap.\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05682}05682\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05683}05683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05684}05684\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05685}05685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05686}05686\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05687}05687\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05688}05688\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05689}05689\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05690}05690\ \ \ \textcolor{comment}{//\ Update\ LED\ indications\ for\ all\ promotion\ buttons}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05691}05691\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05692}05692\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05693}05693\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ promotion\ buttons\ (64-\/67):\ GREEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05694}05694\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 64;\ i\ <=\ 67;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05695}05695\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05696}05696\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05697}05697\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ promotion\ buttons\ (68-\/71):\ BLUE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05698}05698\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 68;\ i\ <=\ 71;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05699}05699\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05700}05700\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05701}05701\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05702}05702\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ promotion\ buttons\ (64-\/67):\ BLUE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05703}05703\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 64;\ i\ <=\ 67;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05704}05704\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05705}05705\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05706}05706\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ promotion\ buttons\ (68-\/71):\ GREEN}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05707}05707\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 68;\ i\ <=\ 71;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05708}05708\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05709}05709\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05710}05710\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05711}05711\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05712}05712\ \ \ \ \ \textcolor{comment}{//\ No\ promotion\ pending\ -\/\ all\ promotion\ buttons\ BLUE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05713}05713\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 64;\ i\ <=\ 71;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05714}05714\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(i,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05715}05715\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05716}05716\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05717}05717\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05718}05718\ \ \ \textcolor{comment}{//\ Reset\ button\ (LED\ 72):\ Always\ GREEN\ (always\ active)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05719}05719\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(72,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05720}05720\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05721}05721\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05736}\mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{05736}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{game\_process\_promotion\_button}}(uint8\_t\ button\_id)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05737}05737\ \ \ \textcolor{comment}{//\ \#2\ \&\ \#3:\ Atomic\ check\ with\ mutex}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05738}05738\ \ \ \textcolor{comment}{//\ Použít\ recursive\ mutex\ funkce\ (promotion\_mutex\ je\ recursive\ mutex)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05739}05739\ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTakeRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}},\ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05740}05740\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ acquire\ promotion\ mutex"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05741}05741\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05742}05742\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05743}05743\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05744}05744\ \ \ \textcolor{comment}{//\ Check\ if\ promotion\ is\ pending}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05745}05745\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05746}05746\ \ \ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05747}05747\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ Promotion\ already\ processed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05748}05748\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05749}05749\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05750}05750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05751}05751\ \ \ \textcolor{comment}{//\ Map\ physical\ button\ ID\ (0-\/3)\ to\ promotion\ choice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05752}05752\ \ \ \textcolor{comment}{//\ Physical\ buttons\ are\ shared\ between\ players:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05753}05753\ \ \ \textcolor{comment}{//\ -\/\ Button\ 0:\ QUEEN\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05754}05754\ \ \ \textcolor{comment}{//\ -\/\ Button\ 1:\ ROOK\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05755}05755\ \ \ \textcolor{comment}{//\ -\/\ Button\ 2:\ BISHOP\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05756}05756\ \ \ \textcolor{comment}{//\ -\/\ Button\ 3:\ KNIGHT\ (both\ white\ and\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05757}05757\ \ \ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05758}05758\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05759}05759\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05760}05760\ \ \ \textcolor{keywordflow}{if}\ (button\_id\ <=\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05761}05761\ \ \ \ \ \textcolor{comment}{//\ Valid\ physical\ button\ (0-\/3)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05762}05762\ \ \ \ \ choice\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})button\_id;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05763}05763\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05764}05764\ \ \ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});\ \textcolor{comment}{//\ Release\ mutex\ on\ invalid\ button}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05765}05765\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Invalid\ promotion\ button\ ID:\ \%d\ (expected\ 0-\/3)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05766}05766\ \ \ \ \ \ \ \ \ \ \ \ \ \ button\_id);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05767}05767\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05768}05768\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05769}05769\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05770}05770\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Physical\ promotion\ button\ pressed:\ button=\%d,\ choice=\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05771}05771\ \ \ \ \ \ \ \ \ \ \ \ button\_id,\ choice);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05772}05772\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05773}05773\ \ \ \textcolor{comment}{//\ Get\ piece\ name}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05774}05774\ \ \ \textcolor{keywordflow}{switch}\ (choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05775}05775\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05776}05776\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05777}05777\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05778}05778\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05779}05779\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05780}05780\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05781}05781\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05782}05782\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05783}05783\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05784}05784\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05785}05785\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05786}05786\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05787}05787\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05788}05788\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05789}05789\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05790}05790\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05791}05791\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05792}05792\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Processing\ promotion\ button\ \%d:\ \%s"{}},\ button\_id,\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05793}05793\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05794}05794\ \ \ \textcolor{comment}{//\ Execute\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05795}05795\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(choice))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05796}05796\ \ \ \ \ \textcolor{comment}{//\ Clear\ promotion\ state\ (mutex\ already\ held\ from\ beginning)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05797}05797\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05798}05798\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05799}05799\ \ \ \ \ \textcolor{comment}{//\ Log\ success}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05800}05800\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05801}05801\ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05802}05802\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05803}05803\ \ \ \ \ printf(\textcolor{stringliteral}{"{}👑\ PAWN\ PROMOTION\ SUCCESSFUL!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05804}05804\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Square:\ \%c\%d\(\backslash\)r\(\backslash\)n"{}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05805}05805\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05806}05806\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Promoted\ to:\ \%s\(\backslash\)r\(\backslash\)n"{}},\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05807}05807\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\ \ •\ Player:\ \%s\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05808}05808\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05809}05809\ \ \ \ \ printf(\textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)r"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05810}05810\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05811}05811\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05812}05812\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05813}05813\ \ \ \ \ \textcolor{comment}{//\ Switch\ to\ next\ player\ after\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05814}05814\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05815}05815\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05816}05816\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05817}05817\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05818}05818\ \ \ \ \ \textcolor{comment}{//\ \#3:\ Timer\ switch\ AFTER\ button\ promotion\ choice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05819}05819\ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05820}05820\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05821}05821\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (button\ promotion):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05822}05822\ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05823}05823\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05824}05824\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05825}05825\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05826}05826\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05827}05827\ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05828}05828\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05829}05829\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05830}05830\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05831}05831\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05832}05832\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05833}05833\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05834}05834\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05835}05835\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05836}05836\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05837}05837\ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05838}05838\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05839}05839\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05840}05840\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05841}05841\ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05842}05842\ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05843}05843\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05844}05844\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05845}05845\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05846}05846\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05847}05847\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05848}05848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ promotion!\ Starting\ endgame\ animation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05849}05849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05850}05850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05851}05851\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05852}05852\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05853}05853\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05854}05854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05855}05855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05856}05856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05857}05857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05858}05858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05859}05859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05860}05860\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05861}05861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05862}05862\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05863}05863\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05864}05864\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05865}05865\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05866}05866\ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05867}05867\ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05868}05868\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05869}05869\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05870}05870\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05871}05871\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05872}05872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05873}05873\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05874}05874\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05875}05875\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05876}05876\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05877}05877\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05878}05878\ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05879}05879\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05880}05880\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05881}05881\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05882}05882\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05883}05883\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05884}05884\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05885}05885\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05886}05886\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05887}05887\ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05888}05888\ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05889}05889\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05890}05890\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05891}05891\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05892}05892\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05893}05893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05894}05894\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05895}05895\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05896}05896\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05897}05897\ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05898}05898\ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05899}05899\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05900}05900\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05901}05901\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05902}05902\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05903}05903\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05904}05904\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05905}05905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05906}05906\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05907}05907\ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05908}05908\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05909}05909\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05910}05910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05911}05911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05912}05912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05913}05913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05914}05914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05915}05915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05916}05916\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05917}05917\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05918}05918\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05919}05919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05920}05920\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05921}05921\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05922}05922\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05923}05923\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promotion\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05924}05924\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05925}05925\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Promotion\ execution\ failed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05926}05926\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05927}05927\ \ \ \textcolor{comment}{//\ Release\ mutex\ at\ the\ end\ of\ the\ function\ to\ ensure\ it's\ always\ released}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05928}05928\ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05929}05929\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05930}05930\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05931}05931\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05932}05932\ \textcolor{comment}{//\ GRAPH\ GENERATION\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05933}05933\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05934}05934\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05942}\mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{05942}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{game\_generate\_advantage\_graph}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05943}05943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ game\_duration,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05944}05944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ total\_moves)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05945}05945\ \ \ \textcolor{keywordflow}{if}\ (!buffer\ ||\ buffer\_size\ <\ 512)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05946}05946\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05947}05947\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05948}05948\ \ \ \textcolor{comment}{//\ Graph\ dimensions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05949}05949\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ GRAPH\_WIDTH\ =\ 60;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05950}05950\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ GRAPH\_HEIGHT\ =\ 20;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05951}05951\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ MAX\_ADVANTAGE\ =\ 100;\ \textcolor{comment}{//\ Maximum\ advantage\ percentage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05952}05952\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05953}05953\ \ \ \textcolor{keywordtype}{char}\ *ptr\ =\ buffer;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05954}05954\ \ \ \textcolor{keywordtype}{size\_t}\ remaining\ =\ buffer\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05955}05955\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05956}05956\ \ \ \textcolor{comment}{//\ Graph\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05957}05957\ \ \ \textcolor{keywordtype}{int}\ written\ =\ snprintf(ptr,\ remaining,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05958}05958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n📈\ Game\ Advantage\ Graph\ (Chess.com\ Style):\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05959}05959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ White\ Advantage\ \%\%\%\%\ \ |\ \ Time\ (minutes)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05960}05960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05961}05961\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05962}05962\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05963}05963\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05964}05964\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05965}05965\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05966}05966\ \ \ \textcolor{comment}{//\ Generate\ graph\ data\ points\ based\ on\ move\ history\ and\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05967}05967\ \ \ \textcolor{keywordtype}{int}\ graph\_data[GRAPH\_WIDTH];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05968}05968\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05969}05969\ \ \ \textcolor{comment}{//\ Simulate\ advantage\ curve\ based\ on\ real\ game\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05970}05970\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ GRAPH\_WIDTH;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05971}05971\ \ \ \ \ \textcolor{keywordtype}{float}\ progress\ =\ (float)i\ /\ (GRAPH\_WIDTH\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05972}05972\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05973}05973\ \ \ \ \ \textcolor{comment}{//\ Calculate\ advantage\ based\ on\ material\ balance\ and\ move\ progression}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05974}05974\ \ \ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05975}05975\ \ \ \ \ \textcolor{keywordtype}{int}\ current\_balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05976}05976\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05977}05977\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05978}05978\ \ \ \ \ \textcolor{comment}{//\ Simulate\ advantage\ curve\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05979}05979\ \ \ \ \ \textcolor{keywordtype}{float}\ base\_advantage\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05980}05980\ \ \ \ \ \ \ \ \ (float)current\_balance\ *\ 10.0f;\ \textcolor{comment}{//\ Convert\ material\ to\ percentage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05981}05981\ \ \ \ \ \textcolor{keywordtype}{float}\ time\_factor\ =\ sin(progress\ *\ 3.14159f)\ *\ 20.0f;\ \textcolor{comment}{//\ Oscillating\ factor}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05982}05982\ \ \ \ \ \textcolor{keywordtype}{float}\ move\_factor\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05983}05983\ \ \ \ \ \ \ \ \ (total\_moves\ >\ 0)\ ?\ ((\textcolor{keywordtype}{float})i\ /\ total\_moves)\ *\ 30.0f\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05984}05984\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05985}05985\ \ \ \ \ \textcolor{keywordtype}{int}\ advantage\ =\ (int)(base\_advantage\ +\ time\_factor\ +\ move\_factor);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05986}05986\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05987}05987\ \ \ \ \ \textcolor{comment}{//\ Clamp\ advantage\ to\ valid\ range}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05988}05988\ \ \ \ \ \textcolor{keywordflow}{if}\ (advantage\ >\ MAX\_ADVANTAGE)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05989}05989\ \ \ \ \ \ \ advantage\ =\ MAX\_ADVANTAGE;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05990}05990\ \ \ \ \ \textcolor{keywordflow}{if}\ (advantage\ <\ -\/MAX\_ADVANTAGE)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05991}05991\ \ \ \ \ \ \ advantage\ =\ -\/MAX\_ADVANTAGE;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05992}05992\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05993}05993\ \ \ \ \ graph\_data[i]\ =\ advantage;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05994}05994\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05995}05995\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05996}05996\ \ \ \textcolor{comment}{//\ Draw\ graph\ from\ top\ to\ bottom}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05997}05997\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ GRAPH\_HEIGHT\ -\/\ 1;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05998}05998\ \ \ \ \ \textcolor{keywordtype}{float}\ y\_value\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l05999}05999\ \ \ \ \ \ \ \ \ (float)row\ /\ (GRAPH\_HEIGHT\ -\/\ 1)\ *\ (2\ *\ MAX\_ADVANTAGE)\ -\/\ MAX\_ADVANTAGE;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06000}06000\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06001}06001\ \ \ \ \ \textcolor{comment}{//\ Y-\/axis\ label}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06002}06002\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ \%\ 4\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06003}06003\ \ \ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\%3.0f\%\%\ |"{}},\ y\_value);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06004}06004\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06005}06005\ \ \ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\ \ \ \ |"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06006}06006\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06007}06007\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06008}06008\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06009}06009\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06010}06010\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06011}06011\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06012}06012\ \ \ \ \ \textcolor{comment}{//\ Draw\ graph\ line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06013}06013\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ GRAPH\_WIDTH;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06014}06014\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ advantage\ =\ graph\_data[col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06015}06015\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ symbol\ =\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06016}06016\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06017}06017\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(advantage\ -\/\ (\textcolor{keywordtype}{int})y\_value)\ <=\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06018}06018\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (advantage\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06019}06019\ \ \ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'\#'};\ \textcolor{comment}{//\ White\ advantage\ (solid\ block)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06020}06020\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (advantage\ <\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06021}06021\ \ \ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'*'};\ \textcolor{comment}{//\ Black\ advantage\ (darker\ block)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06022}06022\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06023}06023\ \ \ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'-\/'};\ \textcolor{comment}{//\ Equal\ (line)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06024}06024\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06025}06025\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (row\ ==\ GRAPH\_HEIGHT\ /\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06026}06026\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{charliteral}{'-\/'};\ \textcolor{comment}{//\ Center\ line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06027}06027\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06028}06028\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06029}06029\ \ \ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\%c"{}},\ symbol);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06030}06030\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06031}06031\ \ \ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06032}06032\ \ \ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06033}06033\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06034}06034\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06035}06035\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06036}06036\ \ \ \ \ \textcolor{comment}{//\ End\ of\ line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06037}06037\ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06038}06038\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06039}06039\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06040}06040\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06041}06041\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06042}06042\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06043}06043\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06044}06044\ \ \ \textcolor{comment}{//\ X-\/axis}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06045}06045\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\ \ \ \ +"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06046}06046\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06047}06047\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06048}06048\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06049}06049\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06050}06050\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06051}06051\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ GRAPH\_WIDTH;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06052}06052\ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}-\/"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06053}06053\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06054}06054\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06055}06055\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06056}06056\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06057}06057\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06058}06058\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06059}06059\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06060}06060\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06061}06061\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06062}06062\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06063}06063\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06064}06064\ \ \ \textcolor{comment}{//\ X-\/axis\ labels}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06065}06065\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\ \ \ \ \ 0"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06066}06066\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06067}06067\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06068}06068\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06069}06069\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06070}06070\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06071}06071\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <=\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06072}06072\ \ \ \ \ \textcolor{keywordtype}{int}\ label\_pos\ =\ (GRAPH\_WIDTH\ /\ 5)\ *\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06073}06073\ \ \ \ \ \textcolor{keywordtype}{float}\ time\_label\ =\ (float)i\ /\ 5.0f\ *\ (game\_duration\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06074}06074\ \ \ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\%*s\%.1f"{}},\ label\_pos\ -\/\ (i\ >\ 1\ ?\ 3\ :\ 0),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06075}06075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}},\ time\_label);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06076}06076\ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06077}06077\ \ \ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06078}06078\ \ \ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06079}06079\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06080}06080\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06081}06081\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06082}06082\ \ \ written\ =\ snprintf(ptr,\ remaining,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06083}06083\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06084}06084\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06085}06085\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06086}06086\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06087}06087\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06088}06088\ \ \ \textcolor{comment}{//\ Legend}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06089}06089\ \ \ written\ =\ snprintf(ptr,\ remaining,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06090}06090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n📊\ Legend:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06091}06091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \#\ =\ White\ Advantage\ (Positive)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06092}06092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ *\ =\ Black\ Advantage\ (Negative)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06093}06093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ -\/\ =\ Equal\ Position\ (0\%\%)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06094}06094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ X-\/axis:\ Game\ Time\ (minutes)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06095}06095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ Y-\/axis:\ Advantage\ Percentage\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06096}06096\ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0\ \&\&\ written\ <\ remaining)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06097}06097\ \ \ \ \ ptr\ +=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06098}06098\ \ \ \ \ remaining\ -\/=\ written;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06099}06099\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06100}06100\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06101}06101\ \ \ \textcolor{comment}{//\ Ensure\ null\ termination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06102}06102\ \ \ *ptr\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06103}06103\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06104}06104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06105}06105\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06106}06106\ \textcolor{comment}{//\ KING\ RESIGNATION\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06107}06107\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06108}06108\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06113}\mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{06113}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{resignation\_update\_button\_leds}}(uint32\_t\ elapsed\_ms)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06114}06114\ \ \ \textcolor{comment}{//\ 4\ tlačítka\ hráče\ (indexy\ 64-\/67\ pro\ white,\ 68-\/71\ pro\ black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06115}06115\ \ \ uint8\_t\ button\_start\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06116}06116\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 64\ :\ 68;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06117}06117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06118}06118\ \ \ \textcolor{comment}{//\ Fade\ začíná\ od\ 6s\ (kdy\ zbývá\ 4s\ do\ resignation)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06119}06119\ \ \ \textcolor{comment}{//\ 0-\/6s:\ Plná\ oranžová\ (255,\ 128,\ 0)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06120}06120\ \ \ \textcolor{comment}{//\ 6-\/10s:\ Postupný\ fade\ každého\ tlačítka\ (1s\ fade,\ 1s\ odstup)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06121}06121\ \ \ \textcolor{keyword}{const}\ uint32\_t\ FADE\_START\_MS\ =\ 6000;\ \ \ \ \textcolor{comment}{//\ Začátek\ fade\ (zbývá\ 4s)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06122}06122\ \ \ \textcolor{keyword}{const}\ uint32\_t\ FADE\_DURATION\_MS\ =\ 1000;\ \textcolor{comment}{//\ Každé\ tlačítko\ fáduje\ 1s}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06123}06123\ \ \ \textcolor{keyword}{const}\ uint32\_t\ LED\_OFFSET\_MS\ =\ 1000;\ \ \ \ \textcolor{comment}{//\ Odstup\ 1s\ mezi\ každým\ tlačítkem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06124}06124\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06125}06125\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06126}06126\ \ \ \ \ uint32\_t\ led\_start\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06127}06127\ \ \ \ \ \ \ \ \ FADE\_START\_MS\ +\ (i\ *\ LED\_OFFSET\_MS);\ \textcolor{comment}{//\ 6000,\ 7000,\ 8000,\ 9000ms}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06128}06128\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}\ =\ 255;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plná\ oranžová\ do\ začátku\ fade}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06129}06129\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06130}06130\ \ \ \ \ \textcolor{keywordflow}{if}\ (elapsed\_ms\ >=\ led\_start\_time)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06131}06131\ \ \ \ \ \ \ uint32\_t\ led\_elapsed\ =\ elapsed\_ms\ -\/\ led\_start\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06132}06132\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (led\_elapsed\ >=\ FADE\_DURATION\_MS)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06133}06133\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}\ =\ 0;\ \textcolor{comment}{//\ Úplně\ zhaslé}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06134}06134\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06135}06135\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lineární\ fade\ z\ 255\ na\ 0\ během\ 1s}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06136}06136\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}\ =\ 255\ -\/\ (led\_elapsed\ *\ 255\ /\ FADE\_DURATION\_MS);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06137}06137\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06138}06138\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06139}06139\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06140}06140\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ LED\ -\/\ oranžová\ barva\ s\ fade}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06141}06141\ \ \ \ \ uint8\_t\ led\_index\ =\ button\_start\_index\ +\ (3\ -\/\ i);\ \textcolor{comment}{//\ Zprava\ doleva}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06142}06142\ \ \ \ \ \mbox{\hyperlink{button__task_8c_ad004f184d705cb6e12a079c8105867bc}{button\_set\_led\_color}}(led\_index,\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}},\ \mbox{\hyperlink{ha__light__task_8c_a837c871f200f8c3d19d0c7f2e031ffc4}{brightness}}\ /\ 2,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06143}06143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Oranžová}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06144}06144\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06145}06145\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06146}06146\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06150}\mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{06150}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a71085e0827522509e5791df1cfa9f129}{resignation\_animation\_timer\_callback}}(TimerHandle\_t\ xTimer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06151}06151\ \ \ \textcolor{comment}{//\ IMPORTANT:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06152}06152\ \ \ \textcolor{comment}{//\ Timer\ callbacks\ run\ in\ FreeRTOS\ "{}Tmr\ Svc"{}\ task\ context.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06153}06153\ \ \ \textcolor{comment}{//\ Avoid\ heavy\ work\ here\ (printf/ESP\_LOG*,\ mutex\ waits,\ LED\ commits,\ game}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06154}06154\ \ \ \textcolor{comment}{//\ logic),\ otherwise\ Timer\ Service\ stack\ can\ overflow\ and\ crash\ the\ system.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06155}06155\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06156}06156\ \ \ \textcolor{comment}{//\ Resignation\ visuals\ and\ timeout\ are\ handled\ from\ the\ main\ \`{}game\_task`\ loop}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06157}06157\ \ \ \textcolor{comment}{//\ via\ \`{}resignation\_tick()`.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06158}06158\ \ \ (void)xTimer;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06159}06159\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06160}06160\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06164}\mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{06164}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a40374b39b8cbe6fecea219144af3b3dd}{resignation\_main\_timer\_callback}}(TimerHandle\_t\ xTimer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06165}06165\ \ \ \textcolor{comment}{//\ See\ comment\ in\ \`{}resignation\_animation\_timer\_callback()`.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06166}06166\ \ \ \textcolor{comment}{//\ Finalization\ is\ handled\ from\ \`{}game\_task`\ context\ via\ \`{}resignation\_tick()`.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06167}06167\ \ \ (void)xTimer;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06168}06168\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06169}06169\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06173}\mbox{\hyperlink{game__task_8c_a5e2939300449fca26ad46d2a04e6ec08}{06173}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5e2939300449fca26ad46d2a04e6ec08}{resignation\_finalize\_timeout}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06174}06174\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06175}06175\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06176}06176\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06177}06177\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06178}06178\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *player\_name\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06179}06179\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06180}06180\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\_name\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06181}06181\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06182}06182\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06183}06183\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏳️\ \%s\ resigned!\ \%s\ wins!"{}},\ player\_name,\ winner\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06184}06184\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06185}06185\ \ \ \textcolor{comment}{//\ Ukončit\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06186}06186\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06187}06187\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06188}06188\ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06189}06189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06190}06190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06191}06191\ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06192}06192\ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06193}06193\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06194}06194\ \ \ \textcolor{comment}{//\ Print\ report\ later\ in\ game\_task\ (stack-\/safe)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06195}06195\ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06196}06196\ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06197}06197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06198}06198\ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06199}06199\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06200}06200\ \ \ \textcolor{comment}{//\ Spustit\ victory\ animaci\ pro\ vítěze}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06201}06201\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06202}06202\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06203}06203\ \ \ \mbox{\hyperlink{game__task_8c_a1e01fb94ceb1dc74ff280d87a35c1076}{game\_trigger\_victory\_animation}}(winner\_player);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06204}06204\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06205}06205\ \ \ \textcolor{comment}{//\ Timeout\ =\ finalized\ cleanup\ (no\ cancel\ messages,\ do\ not\ restore\ king)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06206}06206\ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06207}06207\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06208}06208\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06212}\mbox{\hyperlink{game__task_8c_a3bf81752bb1e6c0587cfdb9804f883be}{06212}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a3bf81752bb1e6c0587cfdb9804f883be}{resignation\_tick}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06213}06213\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06214}06214\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06215}06215\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06216}06216\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06217}06217\ \ \ uint64\_t\ now\_ms\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06218}06218\ \ \ uint32\_t\ elapsed\_ms\ =\ (uint32\_t)(now\_ms\ -\/\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.start\_time\_ms);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06219}06219\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06220}06220\ \ \ \textcolor{comment}{//\ Update\ button\ LEDs\ (fade\ effect)\ in\ safe\ task\ context}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06221}06221\ \ \ \mbox{\hyperlink{game__task_8c_a6b536ba6f8bb5ebf7a76124fbb8d9b10}{resignation\_update\_button\_leds}}(elapsed\_ms);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06222}06222\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06223}06223\ \ \ \textcolor{comment}{//\ Finalize\ after\ 10\ seconds}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06224}06224\ \ \ \textcolor{keywordflow}{if}\ (elapsed\_ms\ >=\ 10000)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06225}06225\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e2939300449fca26ad46d2a04e6ec08}{resignation\_finalize\_timeout}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06226}06226\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06227}06227\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06228}06228\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06232}\mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{06232}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a2e8b9adc46a3a41117d46e39001f5e60}{resignation\_start}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06233}06233\ \ \ \textcolor{comment}{//\ Zastavit\ existující\ timer\ pokud\ běží\ (restart\ =\ tichý\ cleanup)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06234}06234\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06235}06235\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06236}06236\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06237}06237\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06238}06238\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *player\_name\ =\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06239}06239\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n⚠️\ \%s\ king\ lifted\ -\/\ hold\ for\ 10+\ seconds\ to\ resign!\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06240}06240\ \ \ \ \ \ \ \ \ \ player\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06241}06241\ \ \ printf(\textcolor{stringliteral}{"{}👑\ Resignation\ timer\ started\ for\ \%s\ player\(\backslash\)r\(\backslash\)n"{}},\ player\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06242}06242\ \ \ printf(\textcolor{stringliteral}{"{}🎨\ Button\ LED\ animation\ started\ (4\ buttons)\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06243}06243\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06244}06244\ \ \ \textcolor{comment}{//\ Inicializovat\ stav}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06245}06245\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06246}06246\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06247}06247\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06248}06248\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06249}06249\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.start\_time\_ms\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06250}06250\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.last\_countdown\_sec\ =\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06251}06251\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06252}06252\ \ \ \textcolor{comment}{//\ Odstranit\ krále\ z\ boardu\ (jako\ normální\ pickup)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06253}06253\ \ \ \textcolor{comment}{//\ Jinak\ drop\ kód\ očekává\ prázdné\ pole\ a\ spadne}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06254}06254\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06255}06255\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ King\ removed\ from\ board[\%d][\%d]\ for\ resignation"{}},\ row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06256}06256\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06257}06257\ \ \ \textcolor{comment}{//\ Kombinace\ červené\ (varování)\ a\ žluté\ (source\ square)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06258}06258\ \ \ \textcolor{comment}{//\ Oranžovo-\/červená\ mix\ místo\ jen\ červené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06259}06259\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 128,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06260}06260\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06261}06261\ \ \ \textcolor{comment}{//\ Spustit\ tlačítka\ na\ plnou\ oranžovou}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06262}06262\ \ \ uint8\_t\ button\_start\_index\ =\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 64\ :\ 68;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06263}06263\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06264}06264\ \ \ \ \ \mbox{\hyperlink{button__task_8c_ad004f184d705cb6e12a079c8105867bc}{button\_set\_led\_color}}(button\_start\_index\ +\ i,\ 255,\ 128,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06265}06265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Plná\ oranžová}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06266}06266\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06267}06267\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06268}06268\ \ \ \textcolor{comment}{//\ PRODUCTION\ STABILITY:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06269}06269\ \ \ \textcolor{comment}{//\ Do\ NOT\ run\ resignation\ logic\ from\ FreeRTOS\ timer\ callbacks\ ("{}Tmr\ Svc"{}).}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06270}06270\ \ \ \textcolor{comment}{//\ Handling\ is\ done\ in\ \`{}resignation\_tick()`\ from\ the\ main\ game\_task\ loop.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06271}06271\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06272}06272\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06273}06273\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06274}06274\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06280}\mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{06280}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae8b81fb2e3d4835fe8a0b74ac97abd53}{resignation\_stop}}(\textcolor{keywordtype}{bool}\ finalize)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06281}06281\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06282}06282\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06283}06283\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06284}06284\ \ \ \textcolor{keywordflow}{if}\ (!finalize)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06285}06285\ \ \ \ \ printf(\textcolor{stringliteral}{"{}✅\ King\ placed\ -\/\ resignation\ cancelled!\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06286}06286\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🛑\ Resignation\ timer\ stopped\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06287}06287\ \ \ \ \ printf(\textcolor{stringliteral}{"{}🎨\ Button\ LED\ animation\ stopped\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06288}06288\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06289}06289\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06290}06290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔄\ [STAGING]\ Resignation\ finalized\ (cleanup,\ no\ cancel\ msgs)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06291}06291\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06292}06292\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06293}06293\ \ \ \textcolor{comment}{//\ Pouze\ při\ zrušení\ uživatelem:\ vrátit\ krále\ na\ původní\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06294}06294\ \ \ \textcolor{keywordflow}{if}\ (!finalize)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06295}06295\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06296}06296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06297}06297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06298}06298\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06299}06299\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row][\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col]\ ==}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06300}06300\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06301}06301\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row][\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06302}06302\ \ \ \ \ \ \ \ \ \ \ king\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06303}06303\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06304}06304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ King\ returned\ to\ original\ position\ [\%d][\%d]\ (resignation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06305}06305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cancelled)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06306}06306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row,\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06307}06307\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06308}06308\ \ \ \ \ \ \ ESP\_LOGW(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06309}06309\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06310}06310\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Original\ king\ position\ [\%d][\%d]\ is\ occupied\ -\/\ drop\ processing\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06311}06311\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}will\ handle\ it"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06312}06312\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row,\ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06313}06313\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06314}06314\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06315}06315\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06316}06316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.king\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06317}06317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06318}06318\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06319}06319\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06320}06320\ \ \ \textcolor{comment}{//\ Zastavit\ a\ smazat\ timery}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06321}06321\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06322}06322\ \ \ \ \ xTimerStop(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06323}06323\ \ \ \ \ xTimerDelete(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06324}06324\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.main\_timer\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06325}06325\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06326}06326\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06327}06327\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06328}06328\ \ \ \ \ xTimerStop(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06329}06329\ \ \ \ \ xTimerDelete(\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06330}06330\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.animation\_timer\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06331}06331\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06332}06332\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06333}06333\ \ \ \textcolor{comment}{//\ Vypnout\ button\ LEDs}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06334}06334\ \ \ uint8\_t\ button\_start\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06335}06335\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 64\ :\ 68;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06336}06336\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06337}06337\ \ \ \ \ \mbox{\hyperlink{button__task_8c_ad004f184d705cb6e12a079c8105867bc}{button\_set\_led\_color}}(button\_start\_index\ +\ i,\ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06338}06338\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06339}06339\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06340}06340\ \ \ \textcolor{comment}{//\ Reset\ stavu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06341}06341\ \ \ \mbox{\hyperlink{game__task_8c_ab6b24338b18abfa681b8017ce9db9d79}{resignation\_state}}.active\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06342}06342\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06343}06343\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06344}06344\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06345}06345\ \textcolor{comment}{//\ COMMAND\ PROCESSING\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06346}06346\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06347}06347\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06355}\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{06355}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *notation,\ uint8\_t\ *row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06356}06356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ *col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06357}06357\ \ \ \textcolor{keywordflow}{if}\ (!notation\ ||\ !row\ ||\ !col\ ||\ strlen(notation)\ !=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06358}06358\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06359}06359\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06360}06360\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06361}06361\ \ \ \textcolor{comment}{//\ Convert\ file\ (column):\ a=0,\ b=1,\ ...,\ h=7}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06362}06362\ \ \ \textcolor{keywordflow}{if}\ (notation[0]\ <\ \textcolor{charliteral}{'a'}\ ||\ notation[0]\ >\ \textcolor{charliteral}{'h'})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06363}06363\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06364}06364\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06365}06365\ \ \ *col\ =\ notation[0]\ -\/\ \textcolor{charliteral}{'a'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06366}06366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06367}06367\ \ \ \textcolor{comment}{//\ Convert\ rank\ (row):\ 1=0,\ 2=1,\ ...,\ 8=7}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06368}06368\ \ \ \textcolor{keywordflow}{if}\ (notation[1]\ <\ \textcolor{charliteral}{'1'}\ ||\ notation[1]\ >\ \textcolor{charliteral}{'8'})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06369}06369\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06370}06370\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06371}06371\ \ \ *row\ =\ notation[1]\ -\/\ \textcolor{charliteral}{'1'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06372}06372\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06373}06373\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06374}06374\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06375}06375\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06383}\mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{06383}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(uint8\_t\ row,\ uint8\_t\ col,\ \textcolor{keywordtype}{char}\ *notation)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06384}06384\ \ \ \textcolor{keywordflow}{if}\ (!notation\ ||\ row\ >\ 7\ ||\ col\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06385}06385\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06386}06386\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06387}06387\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06388}06388\ \ \ notation[0]\ =\ \textcolor{charliteral}{'a'}\ +\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06389}06389\ \ \ notation[1]\ =\ \textcolor{charliteral}{'1'}\ +\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06390}06390\ \ \ notation[2]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06391}06391\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06392}06392\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06393}06393\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06394}06394\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06399}06399\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06400}06400\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06405}06405\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06406}06406\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06411}06411\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{game\_process\_evaluate\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06412}06412\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06417}06417\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{game\_process\_save\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06418}06418\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06423}06423\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{game\_process\_load\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06424}06424\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06429}06429\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{game\_process\_castle\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06430}06430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06435}06435\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{game\_process\_promote\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06436}06436\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06441}06441\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{game\_process\_component\_off\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06442}06442\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06447}06447\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{game\_process\_component\_on\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06448}06448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06456}06456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06461}06461\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{game\_process\_endgame\_white\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06462}06462\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06467}06467\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{game\_process\_endgame\_black\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06468}06468\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06473}06473\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{game\_process\_list\_games\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06474}06474\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06479}06479\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{game\_process\_delete\_game\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06480}06480\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06485}06485\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{game\_process\_promotion\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06486}06486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06487}06487\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06488}06488\ \textcolor{comment}{//\ NEW\ COMMAND\ IMPLEMENTATIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06489}06489\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06490}06490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06495}\mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{06495}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{game\_process\_evaluate\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06496}06496\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06497}06497\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06498}06498\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06499}06499\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Processing\ EVALUATE\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06500}06500\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06501}06501\ \ \ \textcolor{comment}{//\ Calculate\ position\ evaluation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06502}06502\ \ \ \textcolor{keywordtype}{int}\ material\_balance\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06503}06503\ \ \ \textcolor{keywordtype}{int}\ positional\_score\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06504}06504\ \ \ \textcolor{keywordtype}{int}\ mobility\_score\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06505}06505\ \ \ \textcolor{keywordtype}{int}\ king\_safety\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06506}06506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06507}06507\ \ \ \textcolor{comment}{//\ Count\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06508}06508\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06509}06509\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06510}06510\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06511}06511\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06512}06512\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06513}06513\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 100;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06514}06514\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06515}06515\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06516}06516\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06517}06517\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06518}06518\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06519}06519\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06520}06520\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06521}06521\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06522}06522\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 500;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06523}06523\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06524}06524\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06525}06525\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 900;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06526}06526\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06527}06527\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06528}06528\ \ \ \ \ \ \ \ \ material\_balance\ +=\ 10000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06529}06529\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06530}06530\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06531}06531\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 100;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06532}06532\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06533}06533\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06534}06534\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06535}06535\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06536}06536\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06537}06537\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 300;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06538}06538\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06539}06539\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06540}06540\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 500;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06541}06541\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06542}06542\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06543}06543\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 900;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06544}06544\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06545}06545\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06546}06546\ \ \ \ \ \ \ \ \ material\_balance\ -\/=\ 10000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06547}06547\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06548}06548\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06549}06549\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06550}06550\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06551}06551\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06552}06552\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06553}06553\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06554}06554\ \ \ \textcolor{comment}{//\ Simple\ positional\ evaluation\ (center\ control)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06555}06555\ \ \ \textcolor{keywordtype}{int}\ center\_squares[4]\ =\ \{3,\ 4,\ 3,\ 4\};\ \textcolor{comment}{//\ d4,\ e4,\ d5,\ e5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06556}06556\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06557}06557\ \ \ \ \ \textcolor{keywordtype}{int}\ row\ =\ center\_squares[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06558}06558\ \ \ \ \ \textcolor{keywordtype}{int}\ col\ =\ center\_squares[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06559}06559\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06560}06560\ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06561}06561\ \ \ \ \ \ \ positional\_score\ +=\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06562}06562\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06563}06563\ \ \ \ \ \ \ positional\_score\ -\/=\ 10;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06564}06564\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06565}06565\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06566}06566\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06567}06567\ \ \ \textcolor{comment}{//\ Calculate\ total\ evaluation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06568}06568\ \ \ \textcolor{keywordtype}{int}\ total\_evaluation\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06569}06569\ \ \ \ \ \ \ material\_balance\ +\ positional\_score\ +\ mobility\_score\ +\ king\_safety;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06570}06570\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06571}06571\ \ \ \textcolor{comment}{//\ Create\ evaluation\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06572}06572\ \ \ \textcolor{keywordtype}{char}\ eval\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06573}06573\ \ \ snprintf(eval\_data,\ \textcolor{keyword}{sizeof}(eval\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06574}06574\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📊\ Position\ Evaluation:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06575}06575\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Material\ Balance:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06576}06576\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Positional\ Score:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06577}06577\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Mobility\ Score:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06578}06578\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ Safety:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06579}06579\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Total\ Evaluation:\ \%+d\ centipawns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06580}06580\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Advantage:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06581}06581\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Current\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06582}06582\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Game\ Phase:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06583}06583\ \ \ \ \ \ \ \ \ \ \ \ material\_balance,\ positional\_score,\ mobility\_score,\ king\_safety,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06584}06584\ \ \ \ \ \ \ \ \ \ \ \ total\_evaluation,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06585}06585\ \ \ \ \ \ \ \ \ \ \ \ total\_evaluation\ >\ 50\ ?\ \textcolor{stringliteral}{"{}White"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06586}06586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (total\_evaluation\ <\ -\/50\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06587}06587\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06588}06588\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Middlegame"{}}\ \textcolor{comment}{//\ Simplified}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06589}06589\ \ \ );}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06590}06590\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06591}06591\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(eval\_data,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06592}06592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06593}06593\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06594}06594\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06599}\mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{06599}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{game\_process\_save\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06600}06600\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06601}06601\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06602}06602\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06603}06603\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💾\ Processing\ SAVE\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06604}06604\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06605}06605\ \ \ \textcolor{comment}{//\ In\ a\ real\ implementation,\ this\ would\ save\ to\ NVS\ or\ file\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06606}06606\ \ \ \textcolor{comment}{//\ For\ now,\ we'll\ simulate\ the\ save\ operation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06607}06607\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06608}06608\ \ \ \textcolor{keywordtype}{char}\ save\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06609}06609\ \ \ snprintf(save\_data,\ \textcolor{keyword}{sizeof}(save\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06610}06610\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💾\ Game\ Saved\ Successfully!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06611}06611\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Filename:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06612}06612\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Moves:\ \%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06613}06613\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Current\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06614}06614\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Game\ Status:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06615}06615\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Timestamp:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06616}06616\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06617}06617\ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ move\_count\ would\ be\ tracked}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06618}06618\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ \textcolor{stringliteral}{"{}In\ Progress"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06619}06619\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06620}06620\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06621}06621\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(save\_data,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06622}06622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06623}06623\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06624}06624\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06629}\mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{06629}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{game\_process\_load\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06630}06630\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06631}06631\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06632}06632\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06633}06633\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📂\ Processing\ LOAD\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06634}06634\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06635}06635\ \ \ \textcolor{comment}{//\ In\ a\ real\ implementation,\ this\ would\ load\ from\ NVS\ or\ file\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06636}06636\ \ \ \textcolor{comment}{//\ For\ now,\ we'll\ simulate\ the\ load\ operation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06637}06637\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06638}06638\ \ \ \textcolor{keywordtype}{char}\ load\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06639}06639\ \ \ snprintf(load\_data,\ \textcolor{keyword}{sizeof}(load\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06640}06640\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📂\ Game\ Loaded\ Successfully!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06641}06641\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Filename:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06642}06642\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Moves:\ \%d\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06643}06643\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Current\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06644}06644\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Game\ Status:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06645}06645\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Load\ Time:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06646}06646\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06647}06647\ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ move\_count\ would\ be\ loaded}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06648}06648\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ \textcolor{stringliteral}{"{}In\ Progress"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06649}06649\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06650}06650\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06651}06651\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(load\_data,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06652}06652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06653}06653\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06654}06654\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06659}\mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{06659}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{game\_process\_castle\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06660}06660\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06661}06661\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06662}06662\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06663}06663\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Processing\ CASTLE\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06664}06664\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06665}06665\ \ \ \textcolor{comment}{//\ Parse\ castle\ direction}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06666}06666\ \ \ \textcolor{keywordtype}{bool}\ is\_kingside\ =\ (strcmp(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \textcolor{stringliteral}{"{}kingside"{}})\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06667}06667\ \ \ \textcolor{keywordtype}{bool}\ is\_queenside\ =\ (strcmp(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \textcolor{stringliteral}{"{}queenside"{}})\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06668}06668\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06669}06669\ \ \ \textcolor{keywordflow}{if}\ (!is\_kingside\ \&\&\ !is\_queenside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06670}06670\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06671}06671\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06672}06672\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ castle\ direction:\ '\%s'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06673}06673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Valid\ options:\ 'kingside'\ or\ 'queenside'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06674}06674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Examples:\ CASTLE\ kingside,\ CASTLE\ queenside\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06675}06675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Notation:\ O-\/O\ (kingside),\ O-\/O-\/O\ (queenside)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06676}06676\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06677}06677\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06678}06678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06679}06679\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06680}06680\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06681}06681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06682}06682\ \ \ \textcolor{comment}{//\ Check\ if\ castling\ is\ legal\ (simplified\ check)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06683}06683\ \ \ \textcolor{keywordtype}{bool}\ can\_castle\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06684}06684\ \ \ \textcolor{keywordtype}{char}\ castle\_notation[8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06685}06685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06686}06686\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06687}06687\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06688}06688\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ White\ can\ castle\ kingside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06689}06689\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06690}06690\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][7]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06691}06691\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06692}06692\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06693}06693\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ White\ can\ castle\ queenside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06694}06694\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06695}06695\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][0]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06696}06696\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06697}06697\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06698}06698\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06699}06699\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06700}06700\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ Black\ can\ castle\ kingside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06701}06701\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06702}06702\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][7]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06703}06703\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06704}06704\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06705}06705\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ Black\ can\ castle\ queenside\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06706}06706\ \ \ \ \ \ \ can\_castle\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06707}06707\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][4]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][0]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06708}06708\ \ \ \ \ \ \ strcpy(castle\_notation,\ \textcolor{stringliteral}{"{}O-\/O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06709}06709\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06710}06710\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06711}06711\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06712}06712\ \ \ \textcolor{keywordflow}{if}\ (can\_castle)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06713}06713\ \ \ \ \ \textcolor{comment}{//\ ED:\ Actually\ perform\ castling\ with\ LED\ animations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06714}06714\ \ \ \ \ uint8\_t\ king\_row\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 0\ :\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06715}06715\ \ \ \ \ uint8\_t\ king\_from\_col\ =\ 4;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06716}06716\ \ \ \ \ uint8\_t\ king\_to\_col\ =\ is\_kingside\ ?\ 6\ :\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06717}06717\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ is\_kingside\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06718}06718\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ is\_kingside\ ?\ 5\ :\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06719}06719\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06720}06720\ \ \ \ \ \textcolor{comment}{//\ Get\ LED\ indices\ for\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06721}06721\ \ \ \ \ uint8\_t\ king\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06722}06722\ \ \ \ \ uint8\_t\ king\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06723}06723\ \ \ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06724}06724\ \ \ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06725}06725\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06726}06726\ \ \ \ \ \textcolor{comment}{//\ 1.\ Highlight\ king\ and\ rook\ positions\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06727}06727\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06728}06728\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06729}06729\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06730}06730\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06731}06731\ \ \ \ \ \textcolor{comment}{//\ 2.\ Show\ castling\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06732}06732\ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ castle\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac134d8980d40f9fc8a12f683b967b187}{LED\_CMD\_ANIM\_CASTLE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06733}06733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06734}06734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06735}06735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06736}06736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06737}06737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1500,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06738}06738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&king\_to\_led\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06739}06739\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&castle\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06740}06740\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(1000));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06741}06741\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06742}06742\ \ \ \ \ \textcolor{comment}{//\ 3.\ Actually\ perform\ the\ castling\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06743}06743\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][king\_from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06744}06744\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ rook\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06745}06745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06746}06746\ \ \ \ \ \textcolor{comment}{//\ Move\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06747}06747\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][king\_from\_col]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06748}06748\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][king\_to\_col]\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06749}06749\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06750}06750\ \ \ \ \ \textcolor{comment}{//\ Move\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06751}06751\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06752}06752\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[king\_row][\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}]\ =\ rook;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06753}06753\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06754}06754\ \ \ \ \ \textcolor{comment}{//\ Update\ castling\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06755}06755\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06756}06756\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06757}06757\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06758}06758\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06759}06759\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06760}06760\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06761}06761\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06762}06762\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06763}06763\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_kingside)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06764}06764\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06765}06765\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06766}06766\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06767}06767\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06768}06768\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06769}06769\ \ \ \ \ \textcolor{comment}{//\ 4.\ Highlight\ final\ positions\ (green)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06770}06770\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06771}06771\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06772}06772\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06773}06773\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06774}06774\ \ \ \ \ \textcolor{comment}{//\ 5.\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06775}06775\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06776}06776\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06777}06777\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06778}06778\ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06779}06779\ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06780}06780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Castling\ successful!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06781}06781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Move:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06782}06782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06783}06783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Type:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06784}06784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Notation:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06785}06785\ \ \ \ \ \ \ \ \ \ \ \ \ \ castle\_notation,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06786}06786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06787}06787\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_kingside\ ?\ \textcolor{stringliteral}{"{}Kingside"{}}\ :\ \textcolor{stringliteral}{"{}Queenside"{}},\ castle\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06788}06788\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06789}06789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06790}06790\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06791}06791\ \ \ \ \ \textcolor{comment}{//\ Switch\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06792}06792\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06793}06793\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06794}06794\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06795}06795\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06796}06796\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06797}06797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Castling\ not\ possible!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06798}06798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06799}06799\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06800}06800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Attempted:\ \%s\ castling\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06801}06801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Notation:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06802}06802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06803}06803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🚫\ Possible\ reasons:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06804}06804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ has\ already\ moved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06805}06805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Rook\ has\ already\ moved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06806}06806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Path\ between\ king\ and\ rook\ is\ blocked\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06807}06807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ is\ currently\ in\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06808}06808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ would\ pass\ through\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06809}06809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ would\ end\ up\ in\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06810}06810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06811}06811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Castling\ requirements:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06812}06812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ and\ rook\ must\ not\ have\ moved\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06813}06813\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ No\ pieces\ between\ king\ and\ rook\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06814}06814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ not\ in\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06815}06815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ King\ doesn't\ pass\ through\ or\ into\ check\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06816}06816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06817}06817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ Check\ current\ position\ with\ 'BOARD'\ command"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06818}06818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06819}06819\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_kingside\ ?\ \textcolor{stringliteral}{"{}Kingside"{}}\ :\ \textcolor{stringliteral}{"{}Queenside"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06820}06820\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_kingside\ ?\ \textcolor{stringliteral}{"{}O-\/O"{}}\ :\ \textcolor{stringliteral}{"{}O-\/O-\/O"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06821}06821\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06822}06822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06823}06823\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06824}06824\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06825}06825\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06830}\mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{06830}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{game\_process\_promote\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06831}06831\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06832}06832\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06833}06833\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06834}06834\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Processing\ PROMOTE\ command:\ \%s=\%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06835}06835\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06836}06836\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06837}06837\ \ \ \textcolor{comment}{//\ Parse\ promotion\ square\ and\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06838}06838\ \ \ uint8\_t\ row,\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06839}06839\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&row,\ \&col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06840}06840\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06841}06841\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06842}06842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ square\ notation:\ '\%s'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06843}06843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Valid\ format:\ letter\ +\ number\ (e.g.,\ 'e8',\ 'a1',\ 'h7')\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06844}06844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Letters:\ a-\/h\ (columns)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06845}06845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Numbers:\ 1-\/8\ (rows)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06846}06846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Example:\ PROMOTE\ e8=Q"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06847}06847\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06848}06848\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06849}06849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06850}06850\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06851}06851\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06852}06852\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06853}06853\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ pawn\ to\ promote}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06854}06854\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ current\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06855}06855\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_pawn\ =\ (current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06856}06856\ \ \ \textcolor{keywordtype}{bool}\ is\_black\_pawn\ =\ (current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06857}06857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06858}06858\ \ \ \textcolor{keywordflow}{if}\ (!is\_white\_pawn\ \&\&\ !is\_black\_pawn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06859}06859\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06860}06860\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06861}06861\ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06862}06862\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (current\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06863}06863\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06864}06864\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06865}06865\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06866}06866\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06867}06867\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06868}06868\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06869}06869\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06870}06870\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06871}06871\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06872}06872\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06873}06873\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06874}06874\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06875}06875\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06876}06876\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}White\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06877}06877\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06878}06878\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06879}06879\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Pawn"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06880}06880\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06881}06881\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06882}06882\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06883}06883\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06884}06884\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06885}06885\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06886}06886\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06887}06887\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06888}06888\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06889}06889\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06890}06890\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06891}06891\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06892}06892\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06893}06893\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06894}06894\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Black\ King"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06895}06895\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06896}06896\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06897}06897\ \ \ \ \ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Unknown\ piece"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06898}06898\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06899}06899\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06900}06900\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06901}06901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06902}06902\ \ \ \ \ snprintf(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06903}06903\ \ \ \ \ \ \ \ \ error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06904}06904\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ No\ pawn\ to\ promote\ at\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06905}06905\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06906}06906\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Square:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06907}06907\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Current\ piece:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06908}06908\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06909}06909\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Promotion\ requirements:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06910}06910\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Must\ be\ a\ pawn\ (not\ \%s)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06911}06911\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Pawn\ must\ be\ on\ 8th\ rank\ (for\ White)\ or\ 1st\ rank\ (for\ Black)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06912}06912\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Square\ must\ not\ be\ empty\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06913}06913\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06914}06914\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔍\ Check\ current\ position\ with\ 'BOARD'\ command\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06915}06915\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'MOVES\ pawn'\ to\ see\ all\ pawn\ positions"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06916}06916\ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06917}06917\ \ \ \ \ \ \ \ \ current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ ?\ \textcolor{stringliteral}{"{}Empty\ square"{}}\ :\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06918}06918\ \ \ \ \ \ \ \ \ current\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ ?\ \textcolor{stringliteral}{"{}empty"{}}\ :\ \textcolor{stringliteral}{"{}this\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06919}06919\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06920}06920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06921}06921\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06922}06922\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06923}06923\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06924}06924\ \ \ \textcolor{comment}{//\ Parse\ promotion\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06925}06925\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ promotion\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06926}06926\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06927}06927\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06928}06928\ \ \ \textcolor{keywordflow}{switch}\ (toupper(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}}[0]))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06929}06929\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'Q'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06930}06930\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06931}06931\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Queen"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06932}06932\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06933}06933\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'R'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06934}06934\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06935}06935\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Rook"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06936}06936\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06937}06937\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'B'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06938}06938\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06939}06939\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Bishop"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06940}06940\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06941}06941\ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'N'}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06942}06942\ \ \ \ \ promotion\_piece\ =\ is\_white\_pawn\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06943}06943\ \ \ \ \ piece\_name\ =\ \textcolor{stringliteral}{"{}Knight"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06944}06944\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06945}06945\ \ \ \textcolor{keywordflow}{default}:\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06946}06946\ \ \ \ \ \textcolor{keywordtype}{char}\ error\_msg[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06947}06947\ \ \ \ \ snprintf(error\_msg,\ \textcolor{keyword}{sizeof}(error\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06948}06948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ promotion\ piece:\ '\%s'\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06949}06949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06950}06950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Valid\ promotion\ pieces:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06951}06951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Q\ =\ Queen\ (most\ common)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06952}06952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ R\ =\ Rook\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06953}06953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ B\ =\ Bishop\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06954}06954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ N\ =\ Knight\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06955}06955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06956}06956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Examples:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06957}06957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ e8=Q\ (promote\ to\ Queen)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06958}06958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ a8=R\ (promote\ to\ Rook)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06959}06959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ h8=B\ (promote\ to\ Bishop)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06960}06960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ PROMOTE\ c8=N\ (promote\ to\ Knight)\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06961}06961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06962}06962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Note:\ Queen\ is\ the\ most\ powerful\ choice!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06963}06963\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06964}06964\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(error\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06965}06965\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06966}06966\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06967}06967\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06968}06968\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06969}06969\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06970}06970\ \ \ \textcolor{comment}{//\ ED:\ Add\ LED\ animations\ for\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06971}06971\ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06972}06972\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06973}06973\ \ \ \textcolor{comment}{//\ 1.\ Highlight\ promotion\ square\ (purple\ for\ special\ move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06974}06974\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ 128,\ 0,\ 128);\ \textcolor{comment}{//\ Purple}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06975}06975\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06976}06976\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06977}06977\ \ \ \textcolor{comment}{//\ 2.\ Show\ transformation\ animation\ (pawn\ -\/>\ promoted\ piece)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06978}06978\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06979}06979\ \ \ \ \ \textcolor{comment}{//\ Flash\ between\ pawn\ color\ and\ promoted\ piece\ color}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06980}06980\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ \%\ 2\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06981}06981\ \ \ \ \ \ \ \textcolor{comment}{//\ Pawn\ color\ (white/black)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06982}06982\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ is\_white\_pawn\ ?\ 255\ :\ 100,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06983}06983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_pawn\ ?\ 255\ :\ 100,\ is\_white\_pawn\ ?\ 255\ :\ 100);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06984}06984\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06985}06985\ \ \ \ \ \ \ \textcolor{comment}{//\ Promoted\ piece\ color\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06986}06986\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06987}06987\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06988}06988\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06989}06989\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06990}06990\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06991}06991\ \ \ \textcolor{comment}{//\ 3.\ Perform\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06992}06992\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ promotion\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06993}06993\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06994}06994\ \ \ \textcolor{comment}{//\ 4.\ Show\ final\ promoted\ piece\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06995}06995\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06996}06996\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06997}06997\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06998}06998\ \ \ \textcolor{comment}{//\ 5.\ Show\ celebration\ animation\ (rainbow\ colors)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l06999}06999\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07000}07000\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ =\ (i\ *\ 51)\ \%\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07001}07001\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a1673907d4d89d763bb7b94ec1eeb7b60}{g}}\ =\ ((i\ *\ 51)\ +\ 85)\ \%\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07002}07002\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{ha__light__task_8c_a4313c9563516f94387762ab05763456b}{b}}\ =\ ((i\ *\ 51)\ +\ 170)\ \%\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07003}07003\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(promotion\_led,\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}},\ \mbox{\hyperlink{ha__light__task_8c_a1673907d4d89d763bb7b94ec1eeb7b60}{g}},\ \mbox{\hyperlink{ha__light__task_8c_a4313c9563516f94387762ab05763456b}{b}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07004}07004\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(150));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07005}07005\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07006}07006\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07007}07007\ \ \ \textcolor{comment}{//\ 6.\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07008}07008\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07009}07009\ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07010}07010\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07011}07011\ \ \ \textcolor{keywordtype}{char}\ success\_msg[256];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07012}07012\ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07013}07013\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Pawn\ promotion\ successful!\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07014}07014\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Square:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07015}07015\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Promoted\ to:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07016}07016\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Player:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07017}07017\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Notation:\ \%s=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07018}07018\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07019}07019\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07020}07020\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07021}07021\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07022}07022\ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07023}07023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07024}07024\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07025}07025\ \ \ \textcolor{comment}{//\ Switch\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07026}07026\ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07027}07027\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07028}07028\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07029}07029\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07034}\mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{07034}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{game\_process\_component\_off\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07035}07035\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07036}07036\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07037}07037\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07038}07038\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔌\ Processing\ COMPONENT\_OFF\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07039}07039\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07040}07040\ \ \ \textcolor{keywordtype}{char}\ response\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07041}07041\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07042}07042\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔌\ Component\ Control\ -\/\ OFF\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07043}07043\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Status:\ Component\ turned\ OFF\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07044}07044\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Action:\ Disabled\ component\ functionality\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07045}07045\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Note:\ Hardware\ tasks\ continue\ running\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07046}07046\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Timestamp:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07047}07047\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07048}07048\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07049}07049\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07050}07050\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07051}07051\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07052}07052\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07053}07053\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07054}07054\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07055}07055\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07056}07056\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07057}07057\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07058}07058\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07059}07059\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07060}07060\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07061}07061\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07062}07062\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07063}07063\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07064}07064\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07065}07065\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07066}07066\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07067}07067\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07068}07068\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07069}07069\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07070}07070\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07071}07071\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07072}07072\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07073}07073\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07074}07074\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07075}07075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07076}07076\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07077}07077\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07078}07078\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07079}07079\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07080}07080\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07081}07081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07082}07082\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07083}07083\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07084}07084\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07085}07085\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07086}07086\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07087}07087\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07088}07088\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07089}07089\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07090}07090\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07091}07091\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07092}07092\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07093}07093\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07094}07094\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07095}07095\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07096}07096\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07097}07097\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07098}07098\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07103}\mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{07103}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{game\_process\_component\_on\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07104}07104\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07105}07105\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07106}07106\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07107}07107\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔌\ Processing\ COMPONENT\_ON\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07108}07108\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07109}07109\ \ \ \textcolor{keywordtype}{char}\ response\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07110}07110\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07111}07111\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔌\ Component\ Control\ -\/\ ON\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07112}07112\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Status:\ Component\ turned\ ON\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07113}07113\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Action:\ Enabled\ component\ functionality\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07114}07114\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Note:\ Hardware\ tasks\ continue\ running\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07115}07115\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Timestamp:\ \%llu\ ms"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07116}07116\ \ \ \ \ \ \ \ \ \ \ \ esp\_timer\_get\_time()\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07117}07117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07118}07118\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07119}07119\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07120}07120\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07121}07121\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07122}07122\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07123}07123\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07124}07124\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07125}07125\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07126}07126\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07127}07127\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07128}07128\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07129}07129\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07130}07130\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07131}07131\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07132}07132\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07133}07133\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07134}07134\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07135}07135\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07136}07136\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07137}07137\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07138}07138\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07139}07139\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07140}07140\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07141}07141\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07142}07142\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07143}07143\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07144}07144\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07145}07145\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07146}07146\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07147}07147\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07148}07148\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07149}07149\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07150}07150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07151}07151\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07152}07152\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07153}07153\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07154}07154\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07155}07155\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07156}07156\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07157}07157\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07158}07158\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07159}07159\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07160}07160\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07161}07161\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07162}07162\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07163}07163\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07164}07164\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07165}07165\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07166}07166\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07167}07167\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07172}\mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{07172}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{game\_process\_endgame\_white\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07173}07173\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07174}07174\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07175}07175\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07176}07176\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Processing\ ENDGAME\_WHITE\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07177}07177\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🧪\ TEST\ MODE\ -\/\ Statistics\ will\ NOT\ be\ updated"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07178}07178\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07179}07179\ \ \ \textcolor{comment}{//\ Get\ real\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07180}07180\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07181}07181\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07182}07182\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07183}07183\ \ \ uint32\_t\ total\_moves\ =\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07184}07184\ \ \ uint32\_t\ white\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07185}07185\ \ \ uint32\_t\ black\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07186}07186\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07187}07187\ \ \ \textcolor{comment}{//\ Calculate\ average\ times}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07188}07188\ \ \ uint32\_t\ white\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07189}07189\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07190}07190\ \ \ uint32\_t\ black\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07191}07191\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07192}07192\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07193}07193\ \ \ \textcolor{comment}{//\ Get\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07194}07194\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07195}07195\ \ \ \textcolor{keywordtype}{int}\ material\_balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07196}07196\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07197}07197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07198}07198\ \ \ \textcolor{comment}{//\ Determine\ game\ phase}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07199}07199\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_phase\ =\ (total\_moves\ >\ 30)\ \ \ ?\ \textcolor{stringliteral}{"{}Endgame"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07200}07200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (total\_moves\ >\ 15)\ ?\ \textcolor{stringliteral}{"{}Middle\ Game"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07201}07201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Opening"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07202}07202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07203}07203\ \ \ \textcolor{comment}{//\ Calculate\ accuracy\ (simplified\ based\ on\ captures\ and\ checks)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07204}07204\ \ \ \textcolor{keywordtype}{int}\ white\_accuracy\ =\ 70\ +\ (white\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07205}07205\ \ \ \textcolor{keywordtype}{int}\ black\_accuracy\ =\ 70\ +\ (black\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07206}07206\ \ \ \textcolor{keywordflow}{if}\ (white\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07207}07207\ \ \ \ \ white\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07208}07208\ \ \ \textcolor{keywordflow}{if}\ (black\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07209}07209\ \ \ \ \ black\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07210}07210\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07211}07211\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ malloc(3584+1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07212}07212\ \ \ \textcolor{comment}{//\ This\ eliminates\ heap\ fragmentation\ and\ reduces\ memory\ usage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07213}07213\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📡\ Using\ streaming\ output\ for\ endgame\ report\ (no\ malloc)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07214}07214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07215}07215\ \ \ \textcolor{comment}{//\ Configure\ streaming\ for\ queue\ output}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07216}07216\ \ \ esp\_err\_t\ ret\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07217}07217\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_aca427711530c81651095df3f70106d66}{streaming\_set\_queue\_output}}((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07218}07218\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07219}07219\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ configure\ streaming\ output:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07220}07220\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07221}07221\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07222}07222\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07223}07223\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07224}07224\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Generate\ advantage\ graph\ to\ small\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07225}07225\ \ \ \textcolor{keywordtype}{char}\ graph\_buffer[256];\ \textcolor{comment}{//\ Small\ stack\ buffer\ instead\ of\ malloc(1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07226}07226\ \ \ \mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{game\_generate\_advantage\_graph}}(graph\_buffer,\ \textcolor{keyword}{sizeof}(graph\_buffer),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07227}07227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ total\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07228}07228\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07229}07229\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ large\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07230}07230\ \ \ \textcolor{comment}{//\ Stream\ endgame\ report\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07231}07231\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🏆\ ENDGAME\ REPORT\ -\/\ WHITE\ VICTORY"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07232}07232\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07233}07233\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07234}07234\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🎯\ Game\ Result:\ WHITE\ WINS"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07235}07235\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}⏱️\ \ Game\ Duration:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07236}07236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ (\textcolor{keywordtype}{float})game\_duration\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07237}07237\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07238}07238\ \ \ \textcolor{comment}{//\ Stream\ move\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07239}07239\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Move\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07240}07240\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Moves:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (White:\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07241}07241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ Black:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07242}07242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves,\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}},\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07243}07243\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07244}07244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07245}07245\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07246}07246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07247}07247\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07248}07248\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07249}07249\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07250}07250\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07251}07251\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Average\ Time\ per\ Move:\ \%.1f\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07252}07252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves\ >\ 0\ ?\ (\textcolor{keywordtype}{float})game\_duration\ /\ total\_moves\ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07253}07253\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07254}07254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07255}07255\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07256}07256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07257}07257\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07258}07258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07259}07259\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07260}07260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07261}07261\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07262}07262\ \ \ \textcolor{comment}{//\ Stream\ game\ analysis}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07263}07263\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎮\ Game\ Analysis:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07264}07264\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Game\ Phase:\ \%s\(\backslash\)n"{}},\ game\_phase);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07265}07265\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Victory\ Condition:\ Checkmate"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07266}07266\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Material\ Balance:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07267}07267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ material\_balance\ >\ 0}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07268}07268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \textcolor{stringliteral}{"{}White\ Advantage"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07269}07269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ Advantage"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07270}07270\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07271}07271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07272}07272\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Max\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07273}07273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07274}07274\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07275}07275\ \ \ \textcolor{comment}{//\ Stream\ performance\ metrics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07276}07276\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📈\ Performance\ Metrics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07277}07277\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ white\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07278}07278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (white\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07279}07279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07280}07280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07281}07281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07282}07282\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ black\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07283}07283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (black\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07284}07284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07285}07285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07286}07286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07287}07287\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Material:\ \%d\ points\(\backslash\)n"{}},\ white\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07288}07288\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Material:\ \%d\ points\(\backslash\)n"{}},\ black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07289}07289\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07290}07290\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Material\ Advantage:\ \%s\ \%d\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07291}07291\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ \textcolor{stringliteral}{"{}White\ +"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07292}07292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ +"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07293}07293\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ material\_balance}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07294}07294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ -\/material\_balance\ :\ 0));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07295}07295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07296}07296\ \ \ \textcolor{comment}{//\ Stream\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07297}07297\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Game\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07298}07298\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Games\ Played:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07299}07299\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07300}07300\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07301}07301\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Draws:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07302}07302\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Win\ Rate:\ \%.1f\%\%\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07303}07303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}}\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ *\ 100.0f}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07304}07304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07305}07305\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07306}07306\ \ \ \textcolor{comment}{//\ Stream\ advantage\ graph}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07307}07307\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Advantage\ Graph:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07308}07308\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(graph\_buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07309}07309\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07310}07310\ \ \ \textcolor{comment}{//\ Stream\ conclusion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07311}07311\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🏆\ Congratulations\ to\ White\ player!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07312}07312\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}💡\ Game\ saved\ as\ 'victory\_white\_\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}.chess'\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07313}07313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07314}07314\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07315}07315\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Streaming\ output\ handles\ data\ transmission}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07316}07316\ \ \ \textcolor{comment}{//\ No\ need\ for\ manual\ queue\ management\ or\ large\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07317}07317\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ streaming\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07318}07318\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07319}07319\ \ \ \textcolor{comment}{//\ Add\ TEST\ MODE\ completion\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07320}07320\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🧪\ TEST\ MODE\ COMPLETE\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07321}07321\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Test\ complete\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07322}07322\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07323}07323\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07328}\mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{07328}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{game\_process\_endgame\_black\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07329}07329\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07330}07330\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07331}07331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07332}07332\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Processing\ ENDGAME\_BLACK\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07333}07333\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🧪\ TEST\ MODE\ -\/\ Statistics\ will\ NOT\ be\ updated"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07334}07334\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07335}07335\ \ \ \textcolor{comment}{//\ Get\ real\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07336}07336\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07337}07337\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07338}07338\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07339}07339\ \ \ uint32\_t\ total\_moves\ =\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07340}07340\ \ \ uint32\_t\ white\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a54642ff5d4cd1124c5d9c20879d0a17e}{white\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07341}07341\ \ \ uint32\_t\ black\_captures\_real\ =\ \mbox{\hyperlink{game__task_8c_a77c6e1ccb5248a069792d8a97fd74cab}{black\_captures}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07342}07342\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07343}07343\ \ \ \textcolor{comment}{//\ Calculate\ average\ times}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07344}07344\ \ \ uint32\_t\ white\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07345}07345\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07346}07346\ \ \ uint32\_t\ black\_avg\_time\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07347}07347\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ >\ 0)\ ?\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07348}07348\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07349}07349\ \ \ \textcolor{comment}{//\ Get\ material\ balance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07350}07350\ \ \ \textcolor{keywordtype}{int}\ white\_material,\ black\_material;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07351}07351\ \ \ \textcolor{keywordtype}{int}\ material\_balance\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07352}07352\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a715422f9b34ce3aff72a852b7951ebba}{game\_calculate\_material\_balance}}(\&white\_material,\ \&black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07353}07353\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07354}07354\ \ \ \textcolor{comment}{//\ Determine\ game\ phase}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07355}07355\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_phase\ =\ (total\_moves\ >\ 30)\ \ \ ?\ \textcolor{stringliteral}{"{}Endgame"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07356}07356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (total\_moves\ >\ 15)\ ?\ \textcolor{stringliteral}{"{}Middle\ Game"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07357}07357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Opening"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07358}07358\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07359}07359\ \ \ \textcolor{comment}{//\ Calculate\ accuracy\ (simplified\ based\ on\ captures\ and\ checks)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07360}07360\ \ \ \textcolor{keywordtype}{int}\ white\_accuracy\ =\ 70\ +\ (white\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07361}07361\ \ \ \textcolor{keywordtype}{int}\ black\_accuracy\ =\ 70\ +\ (black\_captures\_real\ *\ 3)\ +\ (\mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}\ *\ 2);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07362}07362\ \ \ \textcolor{keywordflow}{if}\ (white\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07363}07363\ \ \ \ \ white\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07364}07364\ \ \ \textcolor{keywordflow}{if}\ (black\_accuracy\ >\ 95)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07365}07365\ \ \ \ \ black\_accuracy\ =\ 95;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07366}07366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07367}07367\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ malloc(3584+1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07368}07368\ \ \ \textcolor{comment}{//\ This\ eliminates\ heap\ fragmentation\ and\ reduces\ memory\ usage}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07369}07369\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📡\ Using\ streaming\ output\ for\ endgame\ report\ (no\ malloc)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07370}07370\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07371}07371\ \ \ \textcolor{comment}{//\ Configure\ streaming\ for\ queue\ output}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07372}07372\ \ \ esp\_err\_t\ ret\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07373}07373\ \ \ \ \ \ \ \mbox{\hyperlink{streaming__output_8h_aca427711530c81651095df3f70106d66}{streaming\_set\_queue\_output}}((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07374}07374\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07375}07375\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ configure\ streaming\ output:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07376}07376\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07377}07377\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07378}07378\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07379}07379\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07380}07380\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Generate\ advantage\ graph\ to\ small\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07381}07381\ \ \ \textcolor{keywordtype}{char}\ graph\_buffer[256];\ \textcolor{comment}{//\ Small\ stack\ buffer\ instead\ of\ malloc(1024)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07382}07382\ \ \ \mbox{\hyperlink{game__task_8c_a09408e7fee7146bd08512755a44f6bae}{game\_generate\_advantage\_graph}}(graph\_buffer,\ \textcolor{keyword}{sizeof}(graph\_buffer),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07383}07383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ total\_moves);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07384}07384\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07385}07385\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Use\ streaming\ output\ instead\ of\ large\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07386}07386\ \ \ \textcolor{comment}{//\ Stream\ endgame\ report\ header}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07387}07387\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🏆\ ENDGAME\ REPORT\ -\/\ BLACK\ VICTORY"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07388}07388\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07389}07389\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07390}07390\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🎯\ Game\ Result:\ BLACK\ WINS"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07391}07391\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}⏱️\ \ Game\ Duration:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07392}07392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ (\textcolor{keywordtype}{float})game\_duration\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07393}07393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07394}07394\ \ \ \textcolor{comment}{//\ Stream\ move\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07395}07395\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Move\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07396}07396\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Moves:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ (White:\ \%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07397}07397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ Black:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07398}07398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves,\ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}},\ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07399}07399\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07400}07400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07401}07401\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Captures:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ pieces\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07402}07402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_captures\_real);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07403}07403\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07404}07404\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Checks:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07405}07405\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07406}07406\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Castles:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07407}07407\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Average\ Time\ per\ Move:\ \%.1f\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07408}07408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_moves\ >\ 0\ ?\ (\textcolor{keywordtype}{float})game\_duration\ /\ total\_moves\ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07409}07409\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07410}07410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ white\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07411}07411\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Average\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07412}07412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\_avg\_time);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07413}07413\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07414}07414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07415}07415\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Total\ Time:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ seconds\ (\%.1f\ minutes)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07416}07416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}},\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ /\ 60.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07417}07417\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07418}07418\ \ \ \textcolor{comment}{//\ Stream\ game\ analysis}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07419}07419\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎮\ Game\ Analysis:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07420}07420\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Game\ Phase:\ \%s\(\backslash\)n"{}},\ game\_phase);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07421}07421\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Victory\ Condition:\ Checkmate"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07422}07422\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Material\ Balance:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07423}07423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ material\_balance\ >\ 0}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07424}07424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \textcolor{stringliteral}{"{}White\ Advantage"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07425}07425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ Advantage"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07426}07426\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07427}07427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07428}07428\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Max\ Moves\ without\ Capture:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07429}07429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07430}07430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07431}07431\ \ \ \textcolor{comment}{//\ Stream\ performance\ metrics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07432}07432\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📈\ Performance\ Metrics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07433}07433\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ white\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07434}07434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (white\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07435}07435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07436}07436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (white\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07437}07437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07438}07438\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Accuracy:\ \%d\%\%\ (\%s)\(\backslash\)n"{}},\ black\_accuracy,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07439}07439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (black\_accuracy\ >=\ 85)\ \ \ ?\ \textcolor{stringliteral}{"{}Excellent"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07440}07440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 75)\ ?\ \textcolor{stringliteral}{"{}Good"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07441}07441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (black\_accuracy\ >=\ 65)\ ?\ \textcolor{stringliteral}{"{}Fair"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07442}07442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Poor"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07443}07443\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Material:\ \%d\ points\(\backslash\)n"{}},\ white\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07444}07444\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Material:\ \%d\ points\(\backslash\)n"{}},\ black\_material);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07445}07445\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07446}07446\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ •\ Material\ Advantage:\ \%s\ \%d\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07447}07447\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ \textcolor{stringliteral}{"{}White\ +"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07448}07448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ \textcolor{stringliteral}{"{}Black\ +"{}}\ :\ \textcolor{stringliteral}{"{}Equal"{}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07449}07449\ \ \ \ \ \ \ material\_balance\ >\ 0\ ?\ material\_balance}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07450}07450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (material\_balance\ <\ 0\ ?\ -\/material\_balance\ :\ 0));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07451}07451\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07452}07452\ \ \ \textcolor{comment}{//\ Stream\ game\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07453}07453\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Game\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07454}07454\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Total\ Games\ Played:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07455}07455\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ White\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07456}07456\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Black\ Wins:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07457}07457\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Draws:\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07458}07458\ \ \ \mbox{\hyperlink{streaming__output_8h_a19603309bb16a4e39d500f27a16101c1}{stream\_printf}}(\textcolor{stringliteral}{"{}\ \ •\ Win\ Rate:\ \%.1f\%\%\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07459}07459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ >\ 0\ ?\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}}\ /\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}}\ *\ 100.0f}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07460}07460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ 0.0f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07461}07461\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07462}07462\ \ \ \textcolor{comment}{//\ Stream\ victory\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07463}07463\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🏅\ Victory\ Conditions:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07464}07464\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Checkmate:\ YES"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07465}07465\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ King\ Captured:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07466}07466\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Resignation:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07467}07467\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Time\ Out:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07468}07468\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\ \ •\ Stalemate:\ NO"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07469}07469\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07470}07470\ \ \ \textcolor{comment}{//\ Stream\ advantage\ graph}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07471}07471\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n📊\ Advantage\ Graph:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07472}07472\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(graph\_buffer);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07473}07473\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07474}07474\ \ \ \textcolor{comment}{//\ Stream\ conclusion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07475}07475\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎨\ Endgame\ Animation:\ Starting..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07476}07476\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}📈\ Game\ Analysis:\ White\ had\ superior\ tactical\ play"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07477}07477\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}💡\ Best\ Move:\ Qh2\#\ (Checkmate)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07478}07478\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🎯\ Key\ Moment:\ Rook\ sacrifice\ on\ move\ 35"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07479}07479\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🎉\ Congratulations\ to\ White\ player!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07480}07480\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}🏆\ White\ wins\ with\ brilliant\ endgame\ technique!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07481}07481\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07482}07482\ \ \ \textcolor{comment}{//\ Použít\ LED\_CMD\_ANIM\_ENDGAME\ místo\ start\_endgame\_animation()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07483}07483\ \ \ \textcolor{comment}{//\ Najít\ pozici\ bílého\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07484}07484\ \ \ uint8\_t\ king\_pos\ =\ 27;\ \textcolor{comment}{//\ default\ fallback\ (d4)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07485}07485\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07486}07486\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ =\ i\ /\ 8;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07487}07487\ \ \ \ \ \textcolor{keywordtype}{int}\ c\ =\ i\ \%\ 8;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07488}07488\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}][c]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07489}07489\ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07490}07490\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07491}07491\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07492}07492\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07493}07493\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07494}07494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07495}07495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07496}07496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07497}07497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07498}07498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07499}07499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07500}07500\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07501}07501\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07502}07502\ \ \ \textcolor{comment}{//\ MEMORY\ OPTIMIZATION:\ Streaming\ output\ handles\ data\ transmission}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07503}07503\ \ \ \textcolor{comment}{//\ No\ need\ for\ manual\ queue\ management\ or\ large\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07504}07504\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ streaming\ completed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07505}07505\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07506}07506\ \ \ \textcolor{comment}{//\ Add\ TEST\ MODE\ completion\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07507}07507\ \ \ \mbox{\hyperlink{streaming__output_8h_a81bb5955edffac0083f39e3114c99386}{stream\_writeln}}(\textcolor{stringliteral}{"{}\(\backslash\)n🧪\ TEST\ MODE\ COMPLETE\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07508}07508\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Test\ complete\ -\/\ Game\ state\ unchanged"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07509}07509\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07510}07510\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07515}\mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{07515}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{game\_process\_list\_games\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07516}07516\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07517}07517\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07518}07518\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07519}07519\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📁\ Processing\ LIST\_GAMES\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07520}07520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07521}07521\ \ \ \textcolor{keywordtype}{char}\ response\_data[1024];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07522}07522\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07523}07523\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📁\ Saved\ Games\ List\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07524}07524\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07525}07525\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ Available\ saved\ games:\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07526}07526\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07527}07527\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}1.\ game\_001.chess\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07528}07528\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Date:\ 2024-\/01-\/15\ 14:30\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07529}07529\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Moves:\ 24\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07530}07530\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Status:\ In\ Progress\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07531}07531\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Player:\ White\ to\ move\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07532}07532\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07533}07533\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2.\ tournament\_round1.chess\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07534}07534\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Date:\ 2024-\/01-\/14\ 16:45\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07535}07535\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Moves:\ 42\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07536}07536\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Status:\ Completed\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07537}07537\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Result:\ White\ wins\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07538}07538\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07539}07539\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}3.\ practice\_game.chess\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07540}07540\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Date:\ 2024-\/01-\/13\ 10:20\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07541}07541\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Moves:\ 18\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07542}07542\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Status:\ In\ Progress\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07543}07543\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ •\ Player:\ Black\ to\ move\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07544}07544\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07545}07545\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'LOAD\ <filename>'\ to\ load\ a\ game\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07546}07546\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'DELETE\_GAME\ <filename>'\ to\ delete\ a\ game\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07547}07547\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Total:\ 3\ saved\ games"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07548}07548\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07549}07549\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07550}07550\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07551}07551\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07552}07552\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07553}07553\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07554}07554\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07555}07555\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07556}07556\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07557}07557\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07558}07558\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07559}07559\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07560}07560\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07561}07561\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07562}07562\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07563}07563\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07564}07564\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07565}07565\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07566}07566\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07567}07567\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07568}07568\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07569}07569\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07570}07570\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07571}07571\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07572}07572\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07573}07573\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07574}07574\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07575}07575\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07576}07576\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07577}07577\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07578}07578\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07579}07579\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07580}07580\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07581}07581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07582}07582\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07583}07583\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07584}07584\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07585}07585\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07586}07586\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07587}07587\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07588}07588\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07589}07589\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07590}07590\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07591}07591\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07592}07592\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07593}07593\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07594}07594\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07595}07595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07596}07596\ \ \ \textcolor{comment}{//\ Použít\ LED\_CMD\_ANIM\_ENDGAME\ místo\ start\_endgame\_animation()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07597}07597\ \ \ \textcolor{comment}{//\ Najít\ pozici\ černého\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07598}07598\ \ \ uint8\_t\ king\_pos\ =\ 27;\ \textcolor{comment}{//\ default\ fallback\ (d4)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07599}07599\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07600}07600\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}\ =\ i\ /\ 8;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07601}07601\ \ \ \ \ \textcolor{keywordtype}{int}\ c\ =\ i\ \%\ 8;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07602}07602\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{ha__light__task_8c_a4c5c6ceb8ed33456261fa907136e0c3a}{r}}][c]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07603}07603\ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07604}07604\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07605}07605\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07606}07606\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07607}07607\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07608}07608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07609}07609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07610}07610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07611}07611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07612}07612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07613}07613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07614}07614\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07615}07615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07616}07616\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07617}07617\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07618}07618\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07623}\mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{07623}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{game\_process\_delete\_game\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07624}07624\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07625}07625\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07626}07626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07627}07627\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🗑️\ Processing\ DELETE\_GAME\ command:\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07628}07628\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07629}07629\ \ \ \textcolor{keywordtype}{char}\ response\_data[512];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07630}07630\ \ \ snprintf(response\_data,\ \textcolor{keyword}{sizeof}(response\_data),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07631}07631\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🗑️\ Game\ Deletion\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07632}07632\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}═══════════════════════════════════════════════════════════════\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07633}07633\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ Game:\ \%s\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07634}07634\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Status:\ Successfully\ deleted\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07635}07635\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📁\ File\ removed\ from\ storage\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07636}07636\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💾\ Space\ freed:\ \string~2.5\ KB\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07637}07637\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07638}07638\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ Use\ 'LIST\_GAMES'\ to\ see\ remaining\ games"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07639}07639\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07640}07640\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07641}07641\ \ \ \textcolor{comment}{//\ CHUNKED\ OUTPUT\ -\/\ Send\ endgame\ report\ in\ chunks\ to\ prevent\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07642}07642\ \ \ \textcolor{comment}{//\ overflow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07643}07643\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ CHUNK\_SIZE\ =\ 256;\ \textcolor{comment}{//\ Small\ chunks\ for\ UART\ buffer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07644}07644\ \ \ \textcolor{keywordtype}{size\_t}\ total\_len\ =\ strlen(response\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07645}07645\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\_ptr\ =\ response\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07646}07646\ \ \ \textcolor{keywordtype}{size\_t}\ chunks\_remaining\ =\ total\_len;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07647}07647\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07648}07648\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ Sending\ endgame\ report\ in\ chunks:\ \%zu\ bytes\ total"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07649}07649\ \ \ \ \ \ \ \ \ \ \ \ total\_len);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07650}07650\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07651}07651\ \ \ \textcolor{keywordflow}{while}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07652}07652\ \ \ \ \ \textcolor{comment}{//\ Calculate\ chunk\ size}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07653}07653\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_size\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07654}07654\ \ \ \ \ \ \ \ \ (chunks\_remaining\ >\ CHUNK\_SIZE)\ ?\ CHUNK\_SIZE\ :\ chunks\_remaining;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07655}07655\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07656}07656\ \ \ \ \ \textcolor{comment}{//\ Create\ chunk\ response}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07657}07657\ \ \ \ \ \mbox{\hyperlink{structgame__response__t}{game\_response\_t}}\ chunk\_response\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07658}07658\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a03211d5ca1b7406c1cb6ab6851e79502a422f73724b8ecc76f312621fb868805d}{GAME\_RESPONSE\_SUCCESS}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07659}07659\ \ \ \ \ \ \ \ \ .command\_type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4beaa7c5ed6b0fe21e26bd42e5b7212f}{GAME\_CMD\_SHOW\_BOARD}},\ \textcolor{comment}{//\ Reuse\ board\ command\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07660}07660\ \ \ \ \ \ \ \ \ .error\_code\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07661}07661\ \ \ \ \ \ \ \ \ .message\ =\ \textcolor{stringliteral}{"{}Endgame\ report\ chunk\ sent"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07662}07662\ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07663}07663\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07664}07664\ \ \ \ \ \textcolor{comment}{//\ Copy\ chunk\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07665}07665\ \ \ \ \ strncpy(chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}},\ data\_ptr,\ chunk\_size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07666}07666\ \ \ \ \ chunk\_response.\mbox{\hyperlink{structgame__response__t_a1b9907db84187372f7e5df9135e8d522}{data}}[chunk\_size]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07667}07667\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07668}07668\ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ before\ sending\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07669}07669\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07670}07670\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07671}07671\ \ \ \ \ \textcolor{comment}{//\ Send\ chunk}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07672}07672\ \ \ \ \ \textcolor{keywordflow}{if}\ (xQueueSend((QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}},\ \&chunk\_response,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07673}07673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07674}07674\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ send\ endgame\ report\ chunk\ to\ UART\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07675}07675\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07676}07676\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07677}07677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07678}07678\ \ \ \ \ \textcolor{comment}{//\ Update\ pointers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07679}07679\ \ \ \ \ data\_ptr\ +=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07680}07680\ \ \ \ \ chunks\_remaining\ -\/=\ chunk\_size;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07681}07681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07682}07682\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ between\ chunks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07683}07683\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunks\_remaining\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07684}07684\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(5));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07685}07685\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07686}07686\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07687}07687\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07688}07688\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ report\ sent\ successfully\ in\ chunks"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07689}07689\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07690}07690\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07696}07696\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a33f0d04999a0cc77d79d2e529a227be1}{game\_handle\_piece\_lifted}}(uint8\_t\ row,\ uint8\_t\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07697}07697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07703}07703\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a696a56f72aa0226d23952ccbdfd20cd7}{game\_handle\_piece\_placed}}(uint8\_t\ row,\ uint8\_t\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07704}07704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07712}07712\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a73c95d04856c50d53520e346abedf4da}{game\_handle\_matrix\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,\ uint8\_t\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07713}07713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07714}07714\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07718}07718\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07719}07719\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07724}\mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{07724}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{game\_process\_chess\_move}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07725}07725\ \ \ \textcolor{keywordflow}{if}\ (!cmd)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07726}07726\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07727}07727\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07728}07728\ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Bezpečnostní\ kontrola\ všech\ notation\ stringů\ (arrays}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07729}07729\ \ \ \textcolor{comment}{//\ jsou\ vždy\ !=\ NULL)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07730}07730\ \ \ \textcolor{keywordflow}{if}\ (strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}})\ >\ 7\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07731}07731\ \ \ \ \ \ \ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}})\ ==\ 0\ ||\ strlen(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}})\ >\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07732}07732\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ or\ corrupted\ move\ notation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07733}07733\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07734}07734\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07735}07735\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07736}07736\ \ \ \textcolor{comment}{//\ BLOCK\ MOVES\ IF\ PROMOTION\ IS\ PENDING}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07737}07737\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07738}07738\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07739}07739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Move\ ignored\ -\/\ promotion\ pending.\ Complete\ promotion\ first."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07740}07740\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07741}07741\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Promotion\ pending!\ Use\ PROMOTE\ command\ or\ physical\ buttons."{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07742}07742\ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07743}07743\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07744}07744\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07745}07745\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07746}07746\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Processing\ UART\ chess\ move:\ \%s\ -\/>\ \%s\ (player:\ \%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07747}07747\ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a431384d6ef7f4db67d9a0946a7211ef1}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07748}07748\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07749}07749\ \ \ \textcolor{comment}{//\ Convert\ notation\ to\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07750}07750\ \ \ uint8\_t\ from\_row,\ from\_col,\ to\_row,\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07751}07751\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ \&from\_row,\ \&from\_col)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07752}07752\ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a20b79ef4675f25cd3f39ddcdaf65243c}{convert\_notation\_to\_coords}}(cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}},\ \&to\_row,\ \&to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07753}07753\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ notation:\ \%s\ -\/>\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07754}07754\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07755}07755\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07756}07756\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07757}07757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07758}07758\ \ \ \textcolor{comment}{//\ Create\ chess\ move\ structure}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07759}07759\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ move\ =\ \{.from\_row\ =\ from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07760}07760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07761}07761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07762}07762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07763}07763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07764}07764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07765}07765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07766}07766\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07767}07767\ \ \ \textcolor{comment}{//\ Validate\ move\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07768}07768\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07769}07769\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ MOVE\ VALIDATION:\ error\ =\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07770}07770\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07771}07771\ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07772}07772\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Move\ is\ valid,\ starting\ UART\ move\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07773}07773\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07774}07774\ \ \ \ \ \textcolor{comment}{//\ STEP\ 1:\ Show\ piece\ lifting\ animation\ (same\ as\ HW)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07775}07775\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Step\ 1:\ Lifting\ piece\ from\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07776}07776\ \ \ \ \ \textcolor{comment}{//\ ED:\ No\ animation\ when\ lifting\ piece,\ just\ highlight\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07777}07777\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07778}07778\ \ \ \ \ \textcolor{comment}{//\ Send\ LED\ command\ to\ highlight\ source\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07779}07779\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07780}07780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07781}07781\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07782}07782\ \ \ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07783}07783\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07784}07784\ \ \ \ \ \ \ \ \ 50));\ \textcolor{comment}{//\ 50ms\ -\/\ enough\ for\ scheduler,\ not\ too\ long\ for\ watchdog}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07785}07785\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07786}07786\ \ \ \ \ \textcolor{comment}{//\ STEP\ 2:\ Show\ possible\ moves\ (same\ as\ HW)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07787}07787\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Step\ 2:\ Showing\ possible\ moves\ from\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07788}07788\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07789}07789\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07790}07790\ \ \ \ \ \textcolor{comment}{//\ Get\ valid\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07791}07791\ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07792}07792\ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07793}07793\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(from\_row,\ from\_col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07794}07794\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07795}07795\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Found\ \%lu\ valid\ moves\ for\ piece\ at\ \%s"{}},\ valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07796}07796\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07797}07797\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07798}07798\ \ \ \ \ \textcolor{comment}{//\ Send\ LED\ commands\ to\ highlight\ possible\ destinations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07799}07799\ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07800}07800\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07801}07801\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07802}07802\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07803}07803\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07804}07804\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07805}07805\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ destination\ has\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07806}07806\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07807}07807\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07808}07808\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07809}07809\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07810}07810\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07811}07811\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07812}07812\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07813}07813\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07814}07814\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07815}07815\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07816}07816\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07817}07817\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07818}07818\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07819}07819\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07820}07820\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07821}07821\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07822}07822\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07823}07823\ \ \ \ \ \textcolor{comment}{//\ Give\ FreeRTOS\ scheduler\ time\ to\ process\ LED\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07824}07824\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07825}07825\ \ \ \ \ \ \ \ \ 50));\ \textcolor{comment}{//\ 50ms\ -\/\ enough\ for\ scheduler,\ not\ too\ long\ for\ watchdog}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07826}07826\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07827}07827\ \ \ \ \ \textcolor{comment}{//\ STEP\ 3:\ Execute\ the\ move\ immediately\ (same\ as\ HW)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07828}07828\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Step\ 3:\ Executing\ move\ \%s\ -\/>\ \%s"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07829}07829\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07830}07830\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07831}07831\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07832}07832\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ UART\ move\ executed\ successfully:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07833}07833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07834}07834\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07835}07835\ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ success\ to\ web/UART\ immediately\ so\ HTTP\ handler\ can\ receive\ and}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07836}07836\ \ \ \ \ \ \ \textcolor{comment}{//\ close\ queue\ before\ we\ run\ animations/highlights\ (prevents\ use-\/after-\/free}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07837}07837\ \ \ \ \ \ \ \textcolor{comment}{//\ crash\ when\ handler\ times\ out\ and\ deletes\ the\ queue).}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07838}07838\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07839}07839\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ success\_msg[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07840}07840\ \ \ \ \ \ \ \ \ snprintf(success\_msg,\ \textcolor{keyword}{sizeof}(success\_msg),\ \textcolor{stringliteral}{"{}Move\ executed:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07841}07841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07842}07842\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(success\_msg,\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07843}07843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07844}07844\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07845}07845\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07846}07846\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ a\ castling\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07847}07847\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_castling\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07848}07848\ \ \ \ \ \ \ \ \ \ \ (move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07849}07849\ \ \ \ \ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07850}07850\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07851}07851\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07852}07852\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Castling\ move\ -\/\ don't\ change\ player,\ don't\ show\ player\ change}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07853}07853\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07854}07854\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07855}07855\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07856}07856\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ UART\ Castling\ move\ executed\ -\/\ waiting\ for\ rook\ to\ be\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07857}07857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07858}07858\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ successful\ castling\ move\ with\ colors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07859}07859\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07860}07860\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[92m🏰\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07861}07861\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07862}07862\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CASTLING\ MOVE\ EXECUTED!"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07863}07863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07864}07864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07865}07865\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Move:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07866}07866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07867}07867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ →\ \%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07868}07868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07869}07869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07870}07870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07871}07871\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Piece:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07872}07872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07873}07873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07874}07874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07875}07875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07876}07876\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07877}07877\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[96m\ \ \ •\ Next:\ Move\ the\ rook\ to\ complete\ castling!"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07878}07878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07879}07879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07880}07880\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07881}07881\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07882}07882\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ move\ -\/\ switch\ player\ and\ show\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07883}07883\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ successful\ move\ with\ colors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07884}07884\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07885}07885\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[92m✅\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07886}07886\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07887}07887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}MOVE\ EXECUTED\ SUCCESSFULLY!"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07888}07888\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07889}07889\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07890}07890\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Move:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07891}07891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07892}07892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ →\ \%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07893}07893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07894}07894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07895}07895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07896}07896\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Piece:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07897}07897\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07898}07898\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07899}07899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07900}07900\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07901}07901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07902}07902\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (move.\mbox{\hyperlink{structchess__move__t_a02d91c42164e16fe1bb058dd71f04b8e}{captured\_piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07903}07903\ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)033[93m\ \ \ •\ Captured:\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07904}07904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[1m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07905}07905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07906}07906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)033[0m"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07907}07907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07908}07908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[move.\mbox{\hyperlink{structchess__move__t_a02d91c42164e16fe1bb058dd71f04b8e}{captured\_piece}}]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07909}07909\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07910}07910\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07911}07911\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07912}07912\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ED:\ LED\ animations\ are\ now\ handled\ in\ game\_process\_drop\_command}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07913}07913\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ function\ only\ shows\ text\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07914}07914\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07915}07915\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Odstraněno\ modré\ bliknutí\ -\/\ animace\ se\ řeší\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07916}07916\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_process\_drop\_command\ LED\ se\ zhasínají\ v}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07917}07917\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_process\_drop\_command\ po\ úspěšném\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07918}07918\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07919}07919\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ move\ path\ animaci\ PŘED\ změnou\ hráče\ (podle\ starého}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07920}07920\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07921}07921\ \ \ \ \ \ \ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07922}07922\ \ \ \ \ \ \ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move.\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07923}07923\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ move\_path\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07924}07924\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dab4580f84f360910c3c26cd55b1ecdf42}{LED\_CMD\_ANIM\_MOVE\_PATH}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07925}07925\ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07926}07926\ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07927}07927\ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07928}07928\ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07929}07929\ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07930}07930\ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&to\_led\ \textcolor{comment}{//\ Cílová\ pozice\ v\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07931}07931\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07932}07932\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&move\_path\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07933}07933\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07934}07934\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Animace\ běží\ asynchronně,\ neblokujeme\ zpracování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07935}07935\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Animace\ jsou\ spuštěny\ v\ led\_task\ a\ běží\ nezávisle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07936}07936\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (vTaskDelay\ odstraněn\ pro\ lepší\ throughput)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07937}07937\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07938}07938\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ HRÁČ\ SE\ UŽ\ ZMĚNIL\ V\ game\_execute\_move()\ -\/\ použít\ aktuálního}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07939}07939\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07940}07940\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07941}07941\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07942}07942\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07943}07943\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07944}07944\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07945}07945\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07946}07946\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07947}07947\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07948}07948\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07949}07949\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07950}07950\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07951}07951\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07952}07952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07953}07953\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07954}07954\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07955}07955\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07956}07956\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07957}07957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07958}07958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07959}07959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07960}07960\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07961}07961\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07962}07962\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07963}07963\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07964}07964\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ in\ UART\ move!\ Starting\ endgame\ animation\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07965}07965\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07966}07966\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07967}07967\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07968}07968\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07969}07969\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07970}07970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07971}07971\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07972}07972\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07973}07973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07974}07974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07975}07975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07976}07976\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07977}07977\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07978}07978\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07979}07979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07980}07980\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07981}07981\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07982}07982\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07983}07983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07984}07984\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07985}07985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07986}07986\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07987}07987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07988}07988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07989}07989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07990}07990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07991}07991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07992}07992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07993}07993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07994}07994\ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07995}07995\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07996}07996\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07997}07997\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07998}07998\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l07999}07999\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08000}08000\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08001}08001\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08002}08002\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08003}08003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08004}08004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08005}08005\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08006}08006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08007}08007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08008}08008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08009}08009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08010}08010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08011}08011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08012}08012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08013}08013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08014}08014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08015}08015\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08016}08016\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08017}08017\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08018}08018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08019}08019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08020}08020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08021}08021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08022}08022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08023}08023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08024}08024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08025}08025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08026}08026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08027}08027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08028}08028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08029}08029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08030}08030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08031}08031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08032}08032\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08033}08033\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08034}08034\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08035}08035\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08036}08036\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ integration:\ End\ timer\ for\ previous\ player\ and\ start\ for\ new}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08037}08037\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08038}08038\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Timer\ switch:\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08039}08039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08040}08040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08041}08041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08042}08042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08043}08043\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08044}08044\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unlock\ auto\ new\ game\ detection\ (player\ has\ moved)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08045}08045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08046}08046\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08047}08047\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔓\ Auto\ new\ game\ detection\ unblocked\ by\ valid\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08048}08048\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08049}08049\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08050}08050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figurky\ pro\ nového\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08051}08051\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08052}08052\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08053}08053\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08054}08054\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ execute\ UART\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08055}08055\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}Failed\ to\ execute\ move"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08056}08056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08057}08057\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08058}08058\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08059}08059\ \ \ \ \ \textcolor{comment}{//\ Move\ validation\ failed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08060}08060\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ Move\ rejected\ by\ validation:\ error=\%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08061}08061\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08062}08062\ \ \ \ \ \textcolor{comment}{//\ Provide\ detailed\ error\ message}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08063}08063\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *err\_msg\ =\ \textcolor{stringliteral}{"{}Invalid\ move"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08064}08064\ \ \ \ \ \textcolor{keywordflow}{switch}\ (error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08065}08065\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08066}08066\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}That's\ not\ your\ piece!"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08067}08067\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08068}08068\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08069}08069\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}No\ piece\ at\ source\ square"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08070}08070\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08071}08071\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4dab65373947ddaa9d99838441f3fcff}{MOVE\_ERROR\_DESTINATION\_OCCUPIED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08072}08072\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Destination\ blocked\ by\ your\ piece"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08073}08073\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08074}08074\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a641b6ce57e59a5c718ca5ee3e51f9444}{MOVE\_ERROR\_BLOCKED\_PATH}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08075}08075\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Path\ is\ blocked"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08076}08076\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08077}08077\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1adbc56938feb4f9a70401c3190d77f9de}{MOVE\_ERROR\_ILLEGAL\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08078}08078\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Illegal\ move\ for\ this\ piece"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08079}08079\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08080}08080\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a062f25db8c860c564d19c9e46c776fe0}{MOVE\_ERROR\_CASTLING\_BLOCKED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08081}08081\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Castling\ blocked\ or\ invalid"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08082}08082\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08083}08083\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a1efb8e4fd12884711d5de2950e74f087}{MOVE\_ERROR\_KING\_IN\_CHECK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08084}08084\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}King\ would\ be\ in\ check!"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08085}08085\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08086}08086\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a0d51fa502a0284e356d4c196152a9165}{MOVE\_ERROR\_OUT\_OF\_BOUNDS}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08087}08087\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Move\ out\ of\ bounds"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08088}08088\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08089}08089\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08090}08090\ \ \ \ \ \ \ err\_msg\ =\ \textcolor{stringliteral}{"{}Invalid\ move"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08091}08091\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08092}08092\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08093}08093\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08094}08094\ \ \ \ \ \textcolor{comment}{//\ Send\ error\ to\ Web/UART\ queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08095}08095\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08096}08096\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(err\_msg,\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08097}08097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08098}08098\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08099}08099\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08100}08100\ \ \ \ \ \textcolor{comment}{//\ Also\ trigger\ physical\ feedback\ (LEDs)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08101}08101\ \ \ \ \ \mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{game\_handle\_invalid\_move}}(error,\ \&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08102}08102\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08103}08103\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08104}08104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08105}\mbox{\hyperlink{game__task_8c_ac4ac5416414272fb1942f0269ea572c7}{08105}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac4ac5416414272fb1942f0269ea572c7}{game\_process\_commands}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08106}08106\ \ \ \textcolor{comment}{//\ AKTUALIZOVAT\ non-\/blocking\ blink}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08107}08107\ \ \ \mbox{\hyperlink{game__task_8c_accf34dd84b20310558e589194f84657a}{game\_update\_error\_blink}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08108}08108\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08109}08109\ \ \ \textcolor{comment}{//\ Update\ resignation\ visuals\ +\ timeout\ (safe\ task\ context)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08110}08110\ \ \ \mbox{\hyperlink{game__task_8c_a3bf81752bb1e6c0587cfdb9804f883be}{resignation\_tick}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08111}08111\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08112}08112\ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Process\ ALL\ commands\ in\ queue\ (not\ just\ one)\ with\ limit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08113}08113\ \ \ \textcolor{comment}{//\ to\ prevent\ watchdog\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08114}08114\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08115}08115\ \ \ \ \ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ chess\_cmd;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08116}08116\ \ \ \ \ uint32\_t\ commands\_processed\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08117}08117\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ MAX\_COMMANDS\_PER\_CYCLE\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08118}08118\ \ \ \ \ \ \ \ \ 15;\ \textcolor{comment}{//\ Limit\ to\ prevent\ watchdog\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08119}08119\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08120}08120\ \ \ \ \ \textcolor{comment}{//\ Process\ all\ commands\ in\ queue\ (up\ to\ limit)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08121}08121\ \ \ \ \ \textcolor{keywordflow}{while}\ (xQueueReceive(\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}},\ \&chess\_cmd,\ 0)\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08122}08122\ \ \ \ \ \ \ commands\_processed++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08123}08123\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📥\ Received\ command\ type:\ \%d\ (processed:\ \%lu/\%lu)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08124}08124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}},\ commands\_processed,\ MAX\_COMMANDS\_PER\_CYCLE);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08125}08125\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08126}08126\ \ \ \ \ \ \ \textcolor{comment}{//\ Report\ activity\ to\ HA\ light\ task\ (except\ read-\/only\ commands)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08127}08127\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_readonly\ =\ (chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}}\ ==\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ad280705c3d4a5140b36a1ed9bf9d0d45}{GAME\_CMD\_GET\_STATUS}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08128}08128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}}\ ==\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ac834cfe65957284eaf2fc08fb85f82c1}{GAME\_CMD\_GET\_BOARD}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08129}08129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}}\ ==\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a605e6b57d3beaf8791ef5fdb55b4eb8c}{GAME\_CMD\_GET\_VALID\_MOVES}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08130}08130\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!is\_readonly)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08131}08131\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ha__light__task_8c_af2c48fb0be8e0af2ec8f26872bea2721}{ha\_light\_report\_activity}}(\textcolor{stringliteral}{"{}command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08132}08132\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08133}08133\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08134}08134\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08135}08135\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a9cdd3824f45d61a774ab6868e898e1c0}{GAME\_CMD\_NEW\_GAME}}:\ \textcolor{comment}{//\ 0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08136}08136\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ NEW\ GAME\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08137}08137\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{game\_start\_new\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08138}08138\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}New\ game\ started\ successfully!"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08139}08139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08140}08140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08141}08141\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08142}08142\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4afa32272119e942c6d9ecf8e41d53e0e0}{GAME\_CMD\_RESET\_GAME}}:\ \textcolor{comment}{//\ 1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08143}08143\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ RESET\ GAME\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08144}08144\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08145}08145\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}Game\ reset\ to\ starting\ position!"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08146}08146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08147}08147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08148}08148\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08149}08149\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a4f5010e7796f733431849acc8175fdbe}{GAME\_CMD\_MAKE\_MOVE}}:\ \textcolor{comment}{//\ 2}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08150}08150\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ MAKE\ MOVE\ command\ from\ UART:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08151}08151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08152}08152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{game\_process\_chess\_move}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08153}08153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08154}08154\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08155}08155\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a982ea3a5c5efd162ad30ebb49ca51216}{GAME\_CMD\_UNDO\_MOVE}}:\ \textcolor{comment}{//\ 3}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08156}08156\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ UNDO\ MOVE\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08157}08157\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Implement\ undo\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08158}08158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08159}08159\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08160}08160\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ad280705c3d4a5140b36a1ed9bf9d0d45}{GAME\_CMD\_GET\_STATUS}}:\ \textcolor{comment}{//\ 4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08161}08161\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\ STATUS\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08162}08162\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a138dd79d240e644870a7d53580720206}{game\_print\_status}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08163}08163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08164}08164\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08165}08165\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ac834cfe65957284eaf2fc08fb85f82c1}{GAME\_CMD\_GET\_BOARD}}:\ \textcolor{comment}{//\ 5}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08166}08166\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\ BOARD\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08167}08167\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{game\_send\_board\_to\_uart}}((QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08168}08168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08169}08169\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08170}08170\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a605e6b57d3beaf8791ef5fdb55b4eb8c}{GAME\_CMD\_GET\_VALID\_MOVES}}:\ \textcolor{comment}{//\ 6}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08171}08171\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\ VALID\ MOVES\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08172}08172\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Implement\ get\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08173}08173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08174}08174\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08175}08175\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 7:\ \textcolor{comment}{//\ GAME\_CMD\_PICKUP\_PIECE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08176}08176\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PICKUP\ PIECE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08177}08177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08178}08178\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08179}08179\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08180}08180\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08181}08181\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 8:\ \textcolor{comment}{//\ GAME\_CMD\_DROP\_PIECE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08182}08182\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ DROP\ PIECE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08183}08183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08184}08184\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08185}08185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08186}08186\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08187}08187\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 9:\ \textcolor{comment}{//\ GAME\_CMD\_PROMOTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08188}08188\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PROMOTION\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08189}08189\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{game\_process\_promotion\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08190}08190\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08191}08191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08192}08192\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 10:\ \textcolor{comment}{//\ GAME\_CMD\_MOVE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08193}08193\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ MOVE\ command\ from\ UART:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08194}08194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08195}08195\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a13909ec7cf87ce1999cd9647689e46aa}{game\_process\_chess\_move}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08196}08196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08197}08197\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08198}08198\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 11:\ \textcolor{comment}{//\ GAME\_CMD\_SHOW\_BOARD}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08199}08199\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ SHOW\ BOARD\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08200}08200\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ace3afd7e286a0eb92ff013f9e6232577}{game\_send\_board\_to\_uart}}((QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08201}08201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08202}08202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08203}08203\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 12:\ \textcolor{comment}{//\ GAME\_CMD\_PICKUP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08204}08204\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PICKUP\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08205}08205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08206}08206\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0216d9328bf82ee185835194077f1e33}{game\_process\_pickup\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08207}08207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08208}08208\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08209}08209\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 13:\ \textcolor{comment}{//\ GAME\_CMD\_DROP}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08210}08210\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ DROP\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08211}08211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08212}08212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8de7eb2cbccf01d3c7ee792caaf9784e}{game\_process\_drop\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08213}08213\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08214}08214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08215}08215\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 17:\ \textcolor{comment}{//\ GAME\_CMD\_EVALUATE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08216}08216\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ EVALUATE\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08217}08217\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a91c043d9d5fe2af5faf77047de79256e}{game\_process\_evaluate\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08218}08218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08219}08219\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08220}08220\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 18:\ \textcolor{comment}{//\ GAME\_CMD\_SAVE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08221}08221\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ SAVE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08222}08222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08223}08223\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aba851251f06714196f8f83ce51067f33}{game\_process\_save\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08224}08224\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08225}08225\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08226}08226\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 19:\ \textcolor{comment}{//\ GAME\_CMD\_LOAD}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08227}08227\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ LOAD\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08228}08228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08229}08229\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa88c01d5f4c3f59c0e295897856ca9f5}{game\_process\_load\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08230}08230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08231}08231\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08232}08232\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 20:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_20}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08233}08233\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 29:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_29}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08234}08234\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 30:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_30}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08235}08235\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 31:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_31}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08236}08236\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 32:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_32}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08237}08237\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 38:\ \textcolor{comment}{//\ GAME\_CMD\_RESERVED\_SLOT\_38}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08238}08238\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Ignored\ legacy\ puzzle\ command:\ \%d"{}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08239}08239\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a94c2b5c6bf9d2da1132e5b32256f83ca}{game\_send\_response\_to\_uart}}(\textcolor{stringliteral}{"{}❌\ Puzzle\ system\ neni\ dostupny"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08240}08240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (QueueHandle\_t)chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a750e92bc6c9a40c005e3e48947dd10b5}{response\_queue}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08241}08241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08242}08242\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08243}08243\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 21:\ \textcolor{comment}{//\ GAME\_CMD\_CASTLE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08244}08244\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ CASTLE\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08245}08245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08246}08246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a22142c91365332eb732cca4b572b9383}{game\_process\_castle\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08247}08247\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08248}08248\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08249}08249\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 22:\ \textcolor{comment}{//\ GAME\_CMD\_PROMOTE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08250}08250\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PROMOTE\ command\ from\ UART:\ \%s=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08251}08251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a3396c5f2d92b68852cb9fcf6e79500fc}{to\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08252}08252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a195ee37f585a1c6b2a5a54afaa8aea21}{game\_process\_promote\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08253}08253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08254}08254\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08255}08255\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 23:\ \textcolor{comment}{//\ GAME\_CMD\_COMPONENT\_OFF}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08256}08256\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ COMPONENT\_OFF\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08257}08257\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0b85cb19c69ebbac367687a06e818021}{game\_process\_component\_off\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08258}08258\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08259}08259\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08260}08260\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 24:\ \textcolor{comment}{//\ GAME\_CMD\_COMPONENT\_ON}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08261}08261\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ COMPONENT\_ON\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08262}08262\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adb937b707476c4a4280f82e3c78b8a4f}{game\_process\_component\_on\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08263}08263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08264}08264\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08265}08265\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 25:\ \textcolor{comment}{//\ GAME\_CMD\_ENDGAME\_WHITE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08266}08266\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ ENDGAME\_WHITE\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08267}08267\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8351a9f9e065e3dfbfe3bdd50cb60d4a}{game\_process\_endgame\_white\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08268}08268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08269}08269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08270}08270\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 26:\ \textcolor{comment}{//\ GAME\_CMD\_ENDGAME\_BLACK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08271}08271\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ ENDGAME\_BLACK\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08272}08272\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae1e22b6f0b25caf0dfd763097e84b4c}{game\_process\_endgame\_black\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08273}08273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08274}08274\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08275}08275\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 27:\ \textcolor{comment}{//\ GAME\_CMD\_LIST\_GAMES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08276}08276\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ LIST\_GAMES\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08277}08277\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afc75720af79d21406b4818da5d502fe0}{game\_process\_list\_games\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08278}08278\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08279}08279\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08280}08280\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 28:\ \textcolor{comment}{//\ GAME\_CMD\_DELETE\_GAME}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08281}08281\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ DELETE\_GAME\ command\ from\ UART:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08282}08282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a51b8eb6617ef0642c722008827f2d3d1}{from\_notation}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08283}08283\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b253e24e11c0ad3222fb3d064f4d4cc}{game\_process\_delete\_game\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08284}08284\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08285}08285\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08286}08286\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 33:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_MOVE\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08287}08287\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_MOVE\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08288}08288\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad58e853637de174a1bc4f6ad9556bbaa}{game\_test\_move\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08289}08289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08290}08290\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08291}08291\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 34:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_PLAYER\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08292}08292\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_PLAYER\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08293}08293\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0054718644880d12b2f8ccb352644a2b}{game\_test\_player\_change\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08294}08294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08295}08295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08296}08296\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 35:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_CASTLE\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08297}08297\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_CASTLE\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08298}08298\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a38bb9a0b5b3cd868021ba1f05be228d6}{game\_test\_castle\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08299}08299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08300}08300\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08301}08301\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 36:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_PROMOTE\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08302}08302\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_PROMOTE\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08303}08303\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54c0942839659e43c97af3b1c7aca7e9}{game\_test\_promote\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08304}08304\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08305}08305\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08306}08306\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 37:\ \textcolor{comment}{//\ GAME\_CMD\_TEST\_ENDGAME\_ANIM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08307}08307\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TEST\_ENDGAME\_ANIM\ command\ from\ UART"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08308}08308\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac06cb22933b494c00b27ecb35160eeaa}{game\_test\_endgame\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08309}08309\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08310}08310\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08311}08311\ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ System\ Commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08312}08312\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a0ba09395c8b55913ce75adb28ac19003}{GAME\_CMD\_SET\_TIME\_CONTROL}}:\ \textcolor{comment}{//\ 39}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08313}08313\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ SET\_TIME\_CONTROL\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08314}08314\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08315}08315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08316}08316\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08317}08317\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a04714aa90de7f3ace2585fe01cf67659}{GAME\_CMD\_PAUSE\_TIMER}}:\ \textcolor{comment}{//\ 40}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08318}08318\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ PAUSE\_TIMER\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08319}08319\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08320}08320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08321}08321\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08322}08322\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a19a04a30f9a17d5a85cd43db2b1e298a}{GAME\_CMD\_RESUME\_TIMER}}:\ \textcolor{comment}{//\ 41}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08323}08323\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ RESUME\_TIMER\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08324}08324\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08325}08325\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08326}08326\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08327}08327\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4aee7fca1d1758d39255d3b023f569313d}{GAME\_CMD\_RESET\_TIMER}}:\ \textcolor{comment}{//\ 42}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08328}08328\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ RESET\_TIMER\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08329}08329\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08330}08330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08331}08331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08332}08332\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ae152c62fc7eae57cbf8fc14a3ff749e2}{GAME\_CMD\_GET\_TIMER\_STATE}}:\ \textcolor{comment}{//\ 43}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08333}08333\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ GET\_TIMER\_STATE\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08334}08334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08335}08335\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08336}08336\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08337}08337\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a1963a76107560b25595a00d47b103534}{GAME\_CMD\_TIMER\_TIMEOUT}}:\ \textcolor{comment}{//\ 44}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08338}08338\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ TIMER\_TIMEOUT\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08339}08339\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\&chess\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08340}08340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08341}08341\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08342}08342\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08343}08343\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Unknown\ game\ command:\ \%d"{}},\ chess\_cmd.\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08344}08344\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08345}08345\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08346}08346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08347}08347\ \ \ \ \ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Check\ limit\ to\ prevent\ watchdog\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08348}08348\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (commands\_processed\ >=\ MAX\_COMMANDS\_PER\_CYCLE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08349}08349\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08350}08350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Reached\ max\ commands\ per\ cycle\ (\%lu),\ processing\ rest\ in\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08351}08351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}next\ cycle"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08352}08352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MAX\_COMMANDS\_PER\_CYCLE);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08353}08353\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Process\ remaining\ commands\ in\ next\ cycle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08354}08354\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08355}08355\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08356}08356\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08357}08357\ \ \ \ \ \textcolor{comment}{//\ Log\ if\ we\ processed\ multiple\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08358}08358\ \ \ \ \ \textcolor{keywordflow}{if}\ (commands\_processed\ >\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08359}08359\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Processed\ \%lu\ commands\ in\ this\ cycle"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08360}08360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ commands\_processed);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08361}08361\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08362}08362\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08363}08363\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08364}08364\ \ \ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08365}08365\ \ \ \textcolor{comment}{//\ BUTTON\ EVENT\ PROCESSING\ -\/\ Physical\ button\ support}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08366}08366\ \ \ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08367}08367\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08368}08368\ \ \ \textcolor{comment}{//\ Process\ button\ events\ from\ button\_task}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08369}08369\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_a05107bbe85fd87a92dad9efd71dbd653}{button\_event\_queue}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08370}08370\ \ \ \ \ \mbox{\hyperlink{structbutton__event__t}{button\_event\_t}}\ button\_event;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08371}08371\ \ \ \ \ \textcolor{keywordflow}{while}\ (xQueueReceive(\mbox{\hyperlink{freertos__chess_8c_a05107bbe85fd87a92dad9efd71dbd653}{button\_event\_queue}},\ \&button\_event,\ 0)\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08372}08372\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08373}08373\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ process\ PRESS\ events\ (ignore\ release,\ long\ press,\ double\ press)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08374}08374\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\_event.\mbox{\hyperlink{structbutton__event__t_aaf4df16f9df04bfcd820337024e7dec6}{type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a54c67f8a6d26165b932e66b06b5b904bac5a8f24e3beed7990f5495be58d2dc79}{BUTTON\_EVENT\_PRESS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08375}08375\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08376}08376\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎮\ Button\ pressed:\ ID=\%d"{}},\ button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08377}08377\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08378}08378\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ button\ (ID\ 8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08379}08379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}}\ ==\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08380}08380\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Reset\ button\ pressed\ -\/\ resetting\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08381}08381\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac75becc8b5888b8fa31045d7c28c085e}{game\_reset\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08382}08382\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a54aee9078e2583f3063e1a0baec25c21}{game\_check\_promotion\_needed}}();\ \textcolor{comment}{//\ Update\ LED\ indications}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08383}08383\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08384}08384\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08385}08385\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08386}08386\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Promotion\ buttons\ (ID\ 0-\/3)\ -\/\ physical\ buttons}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08387}08387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}}\ <=\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08388}08388\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Promotion\ button\ \%d\ pressed"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08389}08389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08390}08390\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6f86764d953efaad0ea951c27cea07e3}{game\_process\_promotion\_button}}(button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08391}08391\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08392}08392\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08393}08393\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08394}08394\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unknown\ button}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08395}08395\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Unknown\ button\ ID:\ \%d"{}},\ button\_event.\mbox{\hyperlink{structbutton__event__t_a42509e77a8d1f6fe1cafa0705f27b6df}{button\_id}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08396}08396\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08397}08397\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08398}08398\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08399}08399\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08400}08400\ \ \ \textcolor{comment}{//\ Keep\ promo\ square\ visually\ anchored\ (does\ not\ clear\ board)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08401}08401\ \ \ \mbox{\hyperlink{game__task_8c_a5b0ea1f9a91c492a93d4ad9b2afcdb59}{game\_update\_promotion\_anchor\_led}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08402}08402\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08403}08403\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08409}08409\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08410}08410\ \textcolor{comment}{//\ ENHANCED\ SMART\ ERROR\ HANDLING\ SYSTEM}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08411}08411\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08412}08412\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08418}\mbox{\hyperlink{game__task_8c_ae998755862849e203b40a085fde47541}{08418}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae998755862849e203b40a085fde47541}{game\_handle\_invalid\_move\_smart}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08419}08419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08420}08420\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚫\ INVALID\ MOVE\ -\/\ Starting\ smart\ recovery"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08421}08421\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08422}08422\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08423}08423\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Critical\ error:\ NULL\ move\ pointer\ in\ error\ handling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08424}08424\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08425}08425\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08426}08426\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08427}08427\ \ \ \textcolor{comment}{//\ 1.\ Červené\ bliknutí\ chybného\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08428}08428\ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08429}08429\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08430}08430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08431}08431\ \ \ \textcolor{comment}{//\ Flash\ error\ -\/\ 5\ rychlých\ červených\ bliknutí}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08432}08432\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08433}08433\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08434}08434\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 255,\ 0,\ 0);\ \ \ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08435}08435\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08436}08436\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08437}08437\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08438}08438\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08439}08439\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08440}08440\ \ \ \textcolor{comment}{//\ 2.\ Rosvítit\ zeleně\ zdrojové\ pole\ (kde\ je\ figurka)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08441}08441\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green\ -\/\ kde\ vzít\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08442}08442\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08443}08443\ \ \ \textcolor{comment}{//\ 3.\ Rosvítit\ červeně\ kolem\ nevalidního\ cíle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08444}08444\ \ \ \mbox{\hyperlink{game__task_8c_acd21a8521c05d2746643f0a674e9ee5d}{game\_highlight\_invalid\_target\_area}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08445}08445\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08446}08446\ \ \ \textcolor{comment}{//\ 4.\ Rosvítit\ validní\ tahy\ pro\ tuto\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08447}08447\ \ \ \mbox{\hyperlink{game__task_8c_ac0310521f54ddea6598d78bf6e009713}{game\_highlight\_valid\_moves\_for\_piece}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08448}08448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08449}08449\ \ \ \textcolor{comment}{//\ 5.\ KRITICKÉ:\ Neměnit\ hráče,\ nechat\ ho\ opravit\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08450}08450\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Please\ return\ piece\ to\ correct\ square.\ Valid\ moves\ are\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08451}08451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}highlighted."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08452}08452\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08453}08453\ \ \ \textcolor{comment}{//\ 6.\ Nastavit\ internal\ stav\ "{}waiting\ for\ correction"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08454}08454\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08455}08455\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08456}08456\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08457}08457\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08458}08458\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08464}\mbox{\hyperlink{game__task_8c_acd21a8521c05d2746643f0a674e9ee5d}{08464}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_acd21a8521c05d2746643f0a674e9ee5d}{game\_highlight\_invalid\_target\_area}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08465}08465\ \ \ \textcolor{comment}{//\ Rosvítit\ červeně\ pole\ okolo\ nevalidního\ cíle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08466}08466\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dr\ =\ -\/1;\ dr\ <=\ 1;\ dr++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08467}08467\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dc\ =\ -\/1;\ dc\ <=\ 1;\ dc++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08468}08468\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ new\_row\ =\ row\ +\ dr;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08469}08469\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ new\_col\ =\ col\ +\ dc;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08470}08470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08471}08471\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_row\ >=\ 0\ \&\&\ new\_row\ <\ 8\ \&\&\ new\_col\ >=\ 0\ \&\&\ new\_col\ <\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08472}08472\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(new\_row,\ new\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08473}08473\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 50,\ 50);\ \textcolor{comment}{//\ Light\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08474}08474\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08475}08475\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08476}08476\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08477}08477\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08478}08478\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08484}\mbox{\hyperlink{game__task_8c_ac0310521f54ddea6598d78bf6e009713}{08484}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac0310521f54ddea6598d78bf6e009713}{game\_highlight\_valid\_moves\_for\_piece}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08485}08485\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08486}08486\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08487}08487\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08488}08488\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08489}08489\ \ \ \textcolor{comment}{//\ Najít\ všechny\ validní\ tahy\ pro\ tuto\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08490}08490\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_row\ =\ 0;\ to\_row\ <\ 8;\ to\_row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08491}08491\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_col\ =\ 0;\ to\_col\ <\ 8;\ to\_col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08492}08492\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ test\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08493}08493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08494}08494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08495}08495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08496}08496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08497}08497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col]\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08498}08498\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08499}08499\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&test\_move)\ ==\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08500}08500\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(to\_row,\ to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08501}08501\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue\ -\/\ validní\ tahy}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08502}08502\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08503}08503\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08504}08504\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08505}08505\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08506}08506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08510}\mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{08510}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{game\_handle\_invalid\_move}}(\mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08511}08511\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ ENTERING\ game\_handle\_invalid\_move\ -\/\ error:\ \%d"{}},\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08512}08512\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08513}08513\ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Bezpečnostní\ kontrola\ move\ pointeru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08514}08514\ \ \ \textcolor{keywordflow}{if}\ (!move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08515}08515\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Critical\ error:\ NULL\ move\ pointer\ in\ error\ handling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08516}08516\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08517}08517\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08518}08518\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08519}08519\ \ \ \textcolor{comment}{//\ Kontrola\ validity\ coordinates\ před\ použitím}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08520}08520\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ >=\ 8\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ >=\ 8\ ||\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ >=\ 8\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08521}08521\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ >=\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08522}08522\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Critical\ error:\ Invalid\ coordinates\ in\ move\ structure"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08523}08523\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08524}08524\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08525}08525\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08526}08526\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ Invalid\ move\ detected\ -\/\ smart\ error\ handling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08527}08527\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ Move:\ \%c\%d\ -\/>\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08528}08528\ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08529}08529\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08530}08530\ \ \ \textcolor{comment}{//\ Chytrý\ error\ handling\ podle\ požadavků}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08531}08531\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08532}08532\ \ \ \textcolor{comment}{//\ 1.\ Nastavit\ červené\ pole\ na\ neplatné\ pozici}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08533}08533\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.has\_invalid\_piece\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08534}08534\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08535}08535\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08536}08536\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.piece\_type\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08537}08537\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08538}08538\ \ \ \textcolor{comment}{//\ 2.\ Zapamatovat\ si\ původní\ validní\ pozici\ (odkud\ byl\ tah)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08539}08539\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08540}08540\ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08541}08541\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08542}08542\ \ \ \textcolor{comment}{//\ 3.\ Přesunout\ figurku\ na\ neplatnou\ pozici\ (simulace\ HW\ reality)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08543}08543\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08544}08544\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08545}08545\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08546}08546\ \ \ \textcolor{comment}{//\ 4.\ JASNÉ\ VIZUÁLNÍ\ UPOZORNĚNÍ\ -\/\ červené\ pole\ +\ blikání\ pro\ upoutání}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08547}08547\ \ \ \textcolor{comment}{//\ pozornosti}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08548}08548\ \ \ \mbox{\hyperlink{led__task_8h_afff280b4c9b7261d1a086e0cfa356604}{led\_clear\_all\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08549}08549\ \ \ uint8\_t\ invalid\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08550}08550\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08551}08551\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🚨\ STARTING\ ERROR\ ANIMATION\ -\/\ RED\ BLINKING"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08552}08552\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08553}08553\ \ \ \textcolor{comment}{//\ Blikání\ pro\ upoutání\ pozornosti\ (krátké,\ non-\/blocking)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08554}08554\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ blink\ =\ 0;\ blink\ <\ 4;\ blink++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08555}08555\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(invalid\_led,\ 255,\ 0,\ 0);\ \textcolor{comment}{//\ Červená}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08556}08556\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(150));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08557}08557\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(invalid\_led,\ 0,\ 0,\ 0);\ \textcolor{comment}{//\ Zhasnout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08558}08558\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(150));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08559}08559\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08560}08560\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08561}08561\ \ \ \textcolor{comment}{//\ Nechat\ červené\ pole\ trvale\ rozsvícené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08562}08562\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(invalid\_led,\ 255,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08563}08563\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08564}08564\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔴\ RED\ SQUARE\ ACTIVE:\ \%c\%d\ (piece\ must\ be\ lifted\ from\ here)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08565}08565\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08566}08566\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08567}08567\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}📍\ RECOVERY\ TARGET:\ Valid\ moves\ will\ show\ from\ \%c\%d\ when\ piece\ is\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08568}08568\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}lifted"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08569}08569\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08570}08570\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08571}08571\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}💡\ USER\ ACTION\ REQUIRED:\ Lift\ piece\ from\ red\ square\ to\ continue"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08572}08572\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08573}08573\ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ NON-\/BLOCKING\ error\ handling\ -\/\ žádné\ loops!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08574}08574\ \ \ \textcolor{comment}{//\ Červené\ pole\ zůstane\ rozsvícené\ dokud\ se\ figurka\ nezvedne}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08575}08575\ \ \ \textcolor{comment}{//\ Recovery\ se\ řeší\ v\ game\_process\_pickup\_command()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08576}08576\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08577}08577\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Error\ recovery\ active\ -\/\ red\ square\ will\ stay\ lit\ until\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08578}08578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}piece\ is\ lifted"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08579}08579\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08580}08580\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08585}\mbox{\hyperlink{game__task_8c_a1e6678c31e3832807ff10c23bbcd517b}{08585}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1e6678c31e3832807ff10c23bbcd517b}{game\_process\_move\_command}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *move\_cmd\_ptr)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08586}08586\ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08587}08587\ \ \ \ \ uint8\_t\ command\_type;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08588}08588\ \ \ \ \ uint8\_t\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08589}08589\ \ \ \ \ uint8\_t\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08590}08590\ \ \ \ \ uint8\_t\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08591}08591\ \ \ \ \ uint8\_t\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08592}08592\ \ \ \}\ move\_command\_t;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08593}08593\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08594}08594\ \ \ \textcolor{keyword}{const}\ move\_command\_t\ *move\_cmd\ =\ (\textcolor{keyword}{const}\ move\_command\_t\ *)move\_cmd\_ptr;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08595}08595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08596}08596\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Processing\ move:\ [\%d,\%d]\ -\/>\ [\%d,\%d]"{}},\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08597}08597\ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_col,\ move\_cmd-\/>to\_row,\ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08598}08598\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08599}08599\ \ \ \textcolor{comment}{//\ Validate\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08600}08600\ \ \ \textcolor{keywordflow}{if}\ (move\_cmd-\/>from\_row\ >=\ 8\ ||\ move\_cmd-\/>from\_col\ >=\ 8\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08601}08601\ \ \ \ \ \ \ move\_cmd-\/>to\_row\ >=\ 8\ ||\ move\_cmd-\/>to\_col\ >=\ 8)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08602}08602\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ coordinates:\ out\ of\ board\ range"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08603}08603\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08604}08604\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08605}08605\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08606}08606\ \ \ \textcolor{comment}{//\ Get\ pieces\ at\ source\ and\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08607}08607\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ from\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move\_cmd-\/>from\_row][move\_cmd-\/>from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08608}08608\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ to\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move\_cmd-\/>to\_row][move\_cmd-\/>to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08609}08609\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08610}08610\ \ \ \textcolor{comment}{//\ Check\ if\ source\ square\ has\ a\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08611}08611\ \ \ \textcolor{keywordflow}{if}\ (from\_piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08612}08612\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move:\ no\ piece\ at\ [\%d,\%d]"{}},\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08613}08613\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08614}08614\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08615}08615\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08616}08616\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08617}08617\ \ \ \textcolor{comment}{//\ Check\ if\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08618}08618\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08619}08619\ \ \ \ \ \ \ (from\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ from\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08620}08620\ \ \ \textcolor{keywordtype}{bool}\ is\_black\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08621}08621\ \ \ \ \ \ \ (from\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ from\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08622}08622\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08623}08623\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !is\_white\_piece)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08624}08624\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !is\_black\_piece))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08625}08625\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move:\ cannot\ move\ opponent's\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08626}08626\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08627}08627\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08628}08628\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08629}08629\ \ \ \textcolor{comment}{//\ Check\ if\ destination\ is\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08630}08630\ \ \ \textcolor{keywordflow}{if}\ (to\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08631}08631\ \ \ \ \ \textcolor{keywordtype}{bool}\ dest\_is\_white\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08632}08632\ \ \ \ \ \ \ \ \ (to\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ to\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08633}08633\ \ \ \ \ \textcolor{keywordtype}{bool}\ dest\_is\_black\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08634}08634\ \ \ \ \ \ \ \ \ (to\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ to\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08635}08635\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08636}08636\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_is\_white)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08637}08637\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_is\_black))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08638}08638\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ move:\ destination\ occupied\ by\ own\ piece"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08639}08639\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08640}08640\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08641}08641\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08642}08642\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08643}08643\ \ \ \textcolor{comment}{//\ TODO:\ Add\ proper\ chess\ move\ validation\ (piece-\/specific\ rules)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08644}08644\ \ \ \textcolor{comment}{//\ For\ now,\ just\ allow\ any\ move\ that\ passes\ basic\ checks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08645}08645\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08646}08646\ \ \ \textcolor{comment}{//\ Create\ chess\ move\ structure\ for\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08647}08647\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ chess\_move\ =\ \{.from\_row\ =\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08648}08648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ move\_cmd-\/>from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08649}08649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ move\_cmd-\/>to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08650}08650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ move\_cmd-\/>to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08651}08651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ from\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08652}08652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ to\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08653}08653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08654}08654\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08655}08655\ \ \ \textcolor{comment}{//\ Validate\ move\ using\ enhanced\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08656}08656\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ move\_error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&chess\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08657}08657\ \ \ \textcolor{keywordflow}{if}\ (move\_error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08658}08658\ \ \ \ \ \textcolor{comment}{//\ NEW\ ERROR\ HANDLING:\ Don't\ return,\ handle\ invalid\ move\ properly}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08659}08659\ \ \ \ \ \mbox{\hyperlink{game__task_8c_accc9ce251093d9ee6c29aea32234ad53}{game\_handle\_invalid\_move}}(move\_error,\ \&chess\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08660}08660\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08661}08661\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08662}08662\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08663}08663\ \ \ \textcolor{comment}{//\ Use\ game\_execute\_move()\ instead\ of\ direct\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08664}08664\ \ \ \textcolor{comment}{//\ manipulation\ This\ ensures\ all\ game\ state\ is\ properly\ updated\ (castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08665}08665\ \ \ \textcolor{comment}{//\ flags,\ en\ passant,\ etc.)\ and\ player\ is\ changed\ correctly}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08666}08666\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Executing\ move:\ \%s\ piece\ from\ [\%d,\%d]\ to\ [\%d,\%d]"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08667}08667\ \ \ \ \ \ \ \ \ \ \ \ (is\_white\_piece\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}}),\ move\_cmd-\/>from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08668}08668\ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_col,\ move\_cmd-\/>to\_row,\ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08669}08669\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08670}08670\ \ \ \textcolor{comment}{//\ Execute\ the\ move\ using\ proper\ game\_execute\_move()\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08671}08671\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&chess\_move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08672}08672\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ execute\ move\ from\ [\%d,\%d]\ to\ [\%d,\%d]"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08673}08673\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>from\_row,\ move\_cmd-\/>from\_col,\ move\_cmd-\/>to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08674}08674\ \ \ \ \ \ \ \ \ \ \ \ \ \ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08675}08675\ \ \ \ \ \textcolor{comment}{//\ Note:\ move\_cmd\ doesn't\ have\ response\_queue,\ this\ is\ legacy\ function}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08676}08676\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08677}08677\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08678}08678\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08679}08679\ \ \ \textcolor{comment}{//\ HRÁČ\ SE\ UŽ\ ZMĚNIL\ V\ game\_execute\_move()\ -\/\ použít\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08680}08680\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08681}08681\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08682}08682\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08683}08683\ \ \ \textcolor{comment}{//\ Spustit\ move\ path\ animaci\ PŘED\ změnou\ hráče\ (podle\ starého\ projektu)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08684}08684\ \ \ uint8\_t\ from\_led\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08685}08685\ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move\_cmd-\/>from\_row,\ move\_cmd-\/>from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08686}08686\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(move\_cmd-\/>to\_row,\ move\_cmd-\/>to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08687}08687\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ move\_path\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08688}08688\ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dab4580f84f360910c3c26cd55b1ecdf42}{LED\_CMD\_ANIM\_MOVE\_PATH}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08689}08689\ \ \ \ \ \ \ .led\_index\ =\ from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08690}08690\ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08691}08691\ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08692}08692\ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08693}08693\ \ \ \ \ \ \ .duration\_ms\ =\ 1000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08694}08694\ \ \ \ \ \ \ .data\ =\ \&to\_led\ \textcolor{comment}{//\ Cílová\ pozice\ v\ data}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08695}08695\ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08696}08696\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&move\_path\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08697}08697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08698}08698\ \ \ \textcolor{comment}{//\ STABILITY\ FIX:\ Animace\ běží\ asynchronně,\ neblokujeme\ zpracování}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08699}08699\ \ \ \textcolor{comment}{//\ Animace\ jsou\ spuštěny\ v\ led\_task\ a\ běží\ nezávisle}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08700}08700\ \ \ \textcolor{comment}{//\ (vTaskDelay\ odstraněn\ pro\ lepší\ throughput)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08701}08701\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08702}08702\ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08703}08703\ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08704}08704\ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08705}08705\ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08706}08706\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08707}08707\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08708}08708\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08709}08709\ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08710}08710\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08711}08711\ \ \ \ \ \ \ \ \ previous\_player;\ \ \ \textcolor{comment}{//\ Vítěz\ je\ předchozí\ hráč\ (ten,\ kdo\ udělal\ tah)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08712}08712\ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08713}08713\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08714}08714\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08715}08715\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08716}08716\ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08717}08717\ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08718}08718\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08719}08719\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08720}08720\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08721}08721\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08722}08722\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08723}08723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ in\ move\ command!\ Starting\ endgame\ animation\ at\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08724}08724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08725}08725\ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08726}08726\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08727}08727\ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08728}08728\ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08729}08729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08730}08730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08731}08731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08732}08732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08733}08733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08734}08734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08735}08735\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08736}08736\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08737}08737\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08738}08738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08739}08739\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08740}08740\ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci\ s\ NOVÝM\ hráčem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08741}08741\ \ \ \ \ \textcolor{comment}{//\ (current\_player)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08742}08742\ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08743}08743\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08744}08744\ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08745}08745\ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08746}08746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08747}08747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08748}08748\ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08749}08749\ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08750}08750\ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08751}08751\ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08752}08752\ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08753}08753\ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ NOVÉHO\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08754}08754\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08755}08755\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08756}08756\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08757}08757\ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08758}08758\ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08759}08759\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08760}08760\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08761}08761\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08762}08762\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08763}08763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08764}08764\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08765}08765\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08766}08766\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08767}08767\ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08768}08768\ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08769}08769\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08770}08770\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08771}08771\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08772}08772\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08773}08773\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08774}08774\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08775}08775\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08776}08776\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08777}08777\ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08778}08778\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08779}08779\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08780}08780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08781}08781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08782}08782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08783}08783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08784}08784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08785}08785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08786}08786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08787}08787\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08788}08788\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08789}08789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08790}08790\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08791}08791\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08792}08792\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08793}08793\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08794}08794\ \ \ \textcolor{comment}{//\ History\ and\ last\_move\ tracking\ is\ already\ done\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08795}08795\ \ \ \textcolor{comment}{//\ game\_execute\_move()\ -\/\ no\ need\ to\ duplicate\ here}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08796}08796\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08797}08797\ \ \ \textcolor{comment}{//\ Track\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08798}08798\ \ \ \textcolor{keywordflow}{if}\ (to\_piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08799}08799\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08800}08800\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ piece\ was\ captured\ by\ white}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08801}08801\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}\ <\ 16)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08802}08802\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a586ff3f9834832bd857999ba5fe7a754}{black\_captured\_index}}++]\ =\ to\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08803}08803\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08804}08804\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08805}08805\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08806}08806\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ piece\ was\ captured\ by\ black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08807}08807\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}\ <\ 16)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08808}08808\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[\mbox{\hyperlink{game__task_8c_a2f596338bf66b8c99a411bda0d7e4f05}{white\_captured\_index}}++]\ =\ to\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08809}08809\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08810}08810\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08811}08811\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08812}08812\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ =\ 0;\ \textcolor{comment}{//\ Reset\ counter\ on\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08813}08813\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08814}08814\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}++;\ \textcolor{comment}{//\ Increment\ counter\ for\ non-\/capture\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08815}08815\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ >\ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08816}08816\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab85ef2a6cc22b437e180ef15dfc4f043}{max\_moves\_without\_capture}}\ =\ \mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08817}08817\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08818}08818\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08819}08819\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08820}08820\ \ \ \textcolor{comment}{//\ Update\ time\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08821}08821\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08822}08822\ \ \ uint32\_t\ move\_time\ =\ current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08823}08823\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08824}08824\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08825}08825\ \ \ \ \ \textcolor{comment}{//\ Black\ just\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08826}08826\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}}\ +=\ move\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08827}08827\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08828}08828\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08829}08829\ \ \ \ \ \textcolor{comment}{//\ White\ just\ moved}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08830}08830\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}}\ +=\ move\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08831}08831\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08832}08832\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08833}08833\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08834}08834\ \ \ \textcolor{comment}{//\ Update\ position\ history\ for\ draw\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08835}08835\ \ \ \mbox{\hyperlink{game__task_8c_a7d059ee1bbc8427968feaf95af032112}{game\_add\_position\_to\_history}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08836}08836\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08837}08837\ \ \ \textcolor{comment}{//\ Note:\ End-\/game\ conditions\ already\ checked\ earlier\ in\ this\ function\ (line}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08838}08838\ \ \ \textcolor{comment}{//\ 6612)\ If\ game\ finished,\ it\ was\ already\ handled\ with\ endgame\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08839}08839\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08840}08840\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08841}08841\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08842}08842\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08843}08843\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08844}08844\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08845}08845\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08846}08846\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08847}08847\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ CHECK!\ \%s\ king\ is\ under\ attack!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08848}08848\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08849}08849\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08850}08850\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08851}08851\ \ \ \textcolor{comment}{//\ Update\ last\ move\ time\ for\ next\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08852}08852\ \ \ \mbox{\hyperlink{game__task_8c_a88728ddbe481a763027b941da8297c87}{last\_move\_time}}\ =\ current\_time;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08853}08853\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08854}08854\ \ \ \textcolor{comment}{//\ Display\ updated\ board\ (check\ auto-\/display\ setting)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08855}08855\ \ \ \textcolor{comment}{//\ Note:\ Auto-\/display\ control\ is\ in\ UART\ task,\ board\ is\ always\ shown\ for\ now}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08856}08856\ \ \ \mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{game\_print\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08857}08857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08858}08858\ \ \ \textcolor{comment}{//\ Check\ for\ check/checkmate\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08859}08859\ \ \ \mbox{\hyperlink{game__task_8c_ad50b0c62b7700e4422eba52d68e2a938}{game\_check\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08860}08860\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08861}08861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08871}\mbox{\hyperlink{game__task_8c_a5fb8c34959fb71ce48802b7757701dbb}{08871}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5fb8c34959fb71ce48802b7757701dbb}{game\_show\_move\_animation}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08872}08872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col,\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08873}08873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ captured)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08874}08874\ \ \ \textcolor{comment}{//\ Convert\ coordinates\ to\ chess\ notation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08875}08875\ \ \ \textcolor{keywordtype}{char}\ from\_square[4],\ to\_square[4];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08876}08876\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(from\_row,\ from\_col,\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08877}08877\ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(to\_row,\ to\_col,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08878}08878\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08879}08879\ \ \ \textcolor{comment}{//\ Get\ piece\ symbol\ and\ name}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08880}08880\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_symbol\ =\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[piece];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08881}08881\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *piece\_name\ =\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08882}08882\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08883}08883\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╭─────────────────────────────────╮"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08884}08884\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ \ \ \ \ \ \ MOVE\ ANIMATION\ \ \ \ \ \ \ \ \ \ │"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08885}08885\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}├─────────────────────────────────┤"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08886}08886\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ \%s\ \%s\ moves\ from\ \%s\ to\ \%s\ \ │"{}},\ piece\_symbol,\ piece\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08887}08887\ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08888}08888\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08889}08889\ \ \ \textcolor{keywordflow}{if}\ (captured\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08890}08890\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *captured\_symbol\ =\ \mbox{\hyperlink{game__task_8c_ae9609d2c6acb49bcfdc4a72a4ee02d06}{piece\_symbols}}[captured];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08891}08891\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *captured\_name\ =\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(captured);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08892}08892\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ Captures:\ \%s\ \%s\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ │"{}},\ captured\_symbol,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08893}08893\ \ \ \ \ \ \ \ \ \ \ \ \ \ captured\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08894}08894\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08895}08895\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}│\ \ No\ capture\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ │"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08896}08896\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08897}08897\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08898}08898\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╰─────────────────────────────────╯"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08899}08899\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08900}08900\ \ \ \textcolor{comment}{//\ ED:\ LED\ animations\ are\ now\ handled\ in\ game\_process\_drop\_command}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08901}08901\ \ \ \textcolor{comment}{//\ This\ function\ only\ shows\ text\ information}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08902}08902\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08903}08903\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Move:\ \%s\ -\/>\ \%s"{}},\ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08904}08904\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}♟️\ \ \%s\ \%s\ moves..."{}},\ piece\_symbol,\ piece\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08905}08905\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✨\ ...to\ \%s"{}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08906}08906\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08907}08907\ \ \ \textcolor{keywordflow}{if}\ (captured\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08908}08908\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💥\ \%s\ captured!"{}},\ \mbox{\hyperlink{game__task_8c_ae11065cb566adb8002df27fc8edc2b67}{game\_get\_piece\_name}}(captured));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08909}08909\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08910}08910\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08911}08911\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Move\ completed!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08912}08912\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08913}08913\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08919}\mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{08919}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{game\_show\_player\_change\_animation}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08920}08920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08921}08921\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Showing\ player\ change\ animation:\ \%s\ -\/>\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08922}08922\ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08923}08923\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08924}08924\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08925}08925\ \ \ \textcolor{comment}{//\ Clear\ board\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08926}08926\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08927}08927\ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08928}08928\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08929}08929\ \ \ \textcolor{comment}{//\ ED:\ Find\ all\ pieces\ first,\ then\ animate\ all\ columns\ simultaneously}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08930}08930\ \ \ \textcolor{keywordtype}{int}\ prev\_pieces[8]\ =\ \{-\/1,\ -\/1,\ -\/1,\ -\/1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08931}08931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/1,\ -\/1,\ -\/1,\ -\/1\};\ \textcolor{comment}{//\ Row\ positions\ for\ each\ column}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08932}08932\ \ \ \textcolor{keywordtype}{int}\ curr\_pieces[8]\ =\ \{-\/1,\ -\/1,\ -\/1,\ -\/1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08933}08933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/1,\ -\/1,\ -\/1,\ -\/1\};\ \textcolor{comment}{//\ Row\ positions\ for\ each\ column}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08934}08934\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08935}08935\ \ \ \textcolor{comment}{//\ Find\ closest\ pieces\ for\ all\ columns}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08936}08936\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08937}08937\ \ \ \ \ \textcolor{comment}{//\ Find\ closest\ piece\ of\ previous\ player\ (closest\ to\ opponent's\ side)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08938}08938\ \ \ \ \ \textcolor{keywordflow}{if}\ (previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08939}08939\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ top\ (row\ 7)\ down\ to\ find\ white\ piece\ closest\ to\ black\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08940}08940\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08941}08941\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08942}08942\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08943}08943\ \ \ \ \ \ \ \ \ \ \ prev\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08944}08944\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08945}08945\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08946}08946\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08947}08947\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08948}08948\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ bottom\ (row\ 0)\ up\ to\ find\ black\ piece\ closest\ to\ white\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08949}08949\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08950}08950\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08951}08951\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08952}08952\ \ \ \ \ \ \ \ \ \ \ prev\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08953}08953\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08954}08954\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08955}08955\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08956}08956\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08957}08957\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08958}08958\ \ \ \ \ \textcolor{comment}{//\ Find\ closest\ piece\ of\ current\ player\ (closest\ to\ previous\ player's}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08959}08959\ \ \ \ \ \textcolor{comment}{//\ side)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08960}08960\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08961}08961\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ bottom\ (row\ 0)\ up\ to\ find\ white\ piece\ closest\ to\ black\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08962}08962\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08963}08963\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08964}08964\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08965}08965\ \ \ \ \ \ \ \ \ \ \ curr\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08966}08966\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08967}08967\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08968}08968\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08969}08969\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08970}08970\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ from\ top\ (row\ 7)\ down\ to\ find\ black\ piece\ closest\ to\ white\ side}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08971}08971\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08972}08972\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08973}08973\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08974}08974\ \ \ \ \ \ \ \ \ \ \ curr\_pieces[col]\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08975}08975\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08976}08976\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08977}08977\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08978}08978\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08979}08979\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08980}08980\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08981}08981\ \ \ \textcolor{comment}{//\ ENHANCED:\ Ultra-\/smooth\ player\ change\ animation\ with\ harmonious\ colors}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08982}08982\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ step\ =\ 0;\ step\ <\ 8;\ step++)\ \{\ \textcolor{comment}{//\ Reduced\ steps\ for\ speed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08983}08983\ \ \ \ \ \textcolor{keywordtype}{float}\ progress\ =\ (float)step\ /\ 7.0f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08984}08984\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08985}08985\ \ \ \ \ \textcolor{comment}{//\ Clear\ board\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08986}08986\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08987}08987\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08988}08988\ \ \ \ \ \textcolor{comment}{//\ Animate\ all\ columns\ at\ once\ with\ ultra-\/smooth\ trail\ effect}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08989}08989\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08990}08990\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prev\_pieces[col]\ !=\ -\/1\ \&\&\ curr\_pieces[col]\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08991}08991\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ ultra-\/smooth\ trail\ effect\ -\/\ show\ multiple\ points\ along\ the}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08992}08992\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ path}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08993}08993\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ trail\ =\ 0;\ trail\ <\ 5;\ trail++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08994}08994\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ trail\_progress\ =\ progress\ -\/\ (trail\ *\ 0.12f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08995}08995\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08996}08996\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08997}08997\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trail\_progress\ >\ 1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08998}08998\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l08999}08999\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09000}09000\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ intermediate\ position\ with\ smooth\ easing}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09001}09001\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ eased\_progress\ =\ trail\_progress\ *\ trail\_progress\ *}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09002}09002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (3.0f\ -\/\ 2.0f\ *\ trail\_progress);\ \textcolor{comment}{//\ Smooth\ step}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09003}09003\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_row\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09004}09004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prev\_pieces[col]\ +}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09005}09005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (curr\_pieces[col]\ -\/\ prev\_pieces[col])\ *\ eased\_progress;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09006}09006\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09007}09007\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ inter\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(inter\_row,\ inter\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09008}09008\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09009}09009\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Harmonious\ color\ transition:\ Deep\ Blue\ -\/>\ Purple\ -\/>\ Magenta\ -\/>}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09010}09010\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pink}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09011}09011\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/>\ Gold\ -\/>\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09012}09012\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ red,\ green,\ blue;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09013}09013\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.16f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09014}09014\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Deep\ Blue\ to\ Purple}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09015}09015\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ trail\_progress\ /\ 0.16f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09016}09016\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ (uint8\_t)(128\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09017}09017\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09018}09018\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09019}09019\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.33f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09020}09020\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Purple\ to\ Magenta}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09021}09021\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.16f)\ /\ 0.17f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09022}09022\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 128\ +\ (uint8\_t)(127\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09023}09023\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09024}09024\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09025}09025\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.5f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09026}09026\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Magenta\ to\ Pink}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09027}09027\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.33f)\ /\ 0.17f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09028}09028\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09029}09029\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ (uint8\_t)(128\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09030}09030\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 255\ -\/\ (uint8\_t)(128\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09031}09031\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.66f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09032}09032\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pink\ to\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09033}09033\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.5f)\ /\ 0.16f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09034}09034\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09035}09035\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 128\ +\ (uint8\_t)(127\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09036}09036\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 127\ -\/\ (uint8\_t)(127\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09037}09037\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (trail\_progress\ <\ 0.83f)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09038}09038\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Gold\ to\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09039}09039\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09040}09040\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09041}09041\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09042}09042\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09043}09043\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow\ to\ Bright\ White}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09044}09044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ local\_progress\ =\ (trail\_progress\ -\/\ 0.83f)\ /\ 0.17f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09045}09045\ \ \ \ \ \ \ \ \ \ \ \ \ red\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09046}09046\ \ \ \ \ \ \ \ \ \ \ \ \ green\ =\ 255;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09047}09047\ \ \ \ \ \ \ \ \ \ \ \ \ blue\ =\ (uint8\_t)(255\ *\ local\_progress);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09048}09048\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09049}09049\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09050}09050\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enhanced\ trail\ brightness\ effect\ -\/\ smoother\ gradient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09051}09051\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ trail\_brightness\ =\ 1.0f\ -\/\ (trail\ *\ 0.18f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09052}09052\ \ \ \ \ \ \ \ \ \ \ red\ =\ (uint8\_t)(red\ *\ trail\_brightness);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09053}09053\ \ \ \ \ \ \ \ \ \ \ green\ =\ (uint8\_t)(green\ *\ trail\_brightness);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09054}09054\ \ \ \ \ \ \ \ \ \ \ blue\ =\ (uint8\_t)(blue\ *\ trail\_brightness);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09055}09055\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09056}09056\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enhanced\ pulsing\ effect\ with\ multiple\ harmonics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09057}09057\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ pulse1\ =\ 0.7f\ +\ 0.3f\ *\ sin(progress\ *\ 6.28f\ +\ trail\ *\ 1.26f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09058}09058\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ pulse2\ =\ 0.9f\ +\ 0.1f\ *\ sin(progress\ *\ 12.56f\ +\ trail\ *\ 2.51f);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09059}09059\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ combined\_pulse\ =\ pulse1\ *\ pulse2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09060}09060\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09061}09061\ \ \ \ \ \ \ \ \ \ \ red\ =\ (uint8\_t)(red\ *\ combined\_pulse);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09062}09062\ \ \ \ \ \ \ \ \ \ \ green\ =\ (uint8\_t)(green\ *\ combined\_pulse);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09063}09063\ \ \ \ \ \ \ \ \ \ \ blue\ =\ (uint8\_t)(blue\ *\ combined\_pulse);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09064}09064\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09065}09065\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(inter\_led,\ red,\ green,\ blue);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09066}09066\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09067}09067\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09068}09068\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09069}09069\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09070}09070\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(25));\ \textcolor{comment}{//\ Faster\ animation\ -\/\ half\ the\ time}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09071}09071\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09072}09072\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09073}09073\ \ \ \textcolor{comment}{//\ Clear\ board\ after\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09074}09074\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09075}09075\ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09076}09076\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09077}09077\ \ \ \textcolor{comment}{//\ Finally,\ highlight\ movable\ pieces\ for\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09078}09078\ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09079}09079\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09080}09080\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09084}\mbox{\hyperlink{game__task_8c_ad58e853637de174a1bc4f6ad9556bbaa}{09084}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad58e853637de174a1bc4f6ad9556bbaa}{game\_test\_move\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09085}09085\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ move\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09086}09086\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09087}09087\ \ \ \textcolor{comment}{//\ Test\ move\ from\ e2\ to\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09088}09088\ \ \ \textcolor{comment}{//\ uint8\_t\ to\_led\ =\ chess\_pos\_to\_led\_index(3,\ 4);\ \ \ //\ e4\ -\/\ removed\ unused}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09089}09089\ \ \ \textcolor{comment}{//\ variable}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09090}09090\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09091}09091\ \ \ \textcolor{comment}{//\ Progressive\ color\ animation\ from\ green\ to\ blue\ -\/\ ZRYCHLENO}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09092}09092\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ step\ =\ 0;\ step\ <\ 6;\ step++)\ \{\ \textcolor{comment}{//\ ZRYCHLENO:\ z\ 10\ na\ 6\ kroků}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09093}09093\ \ \ \ \ \textcolor{keywordtype}{float}\ progress\ =\ (float)step\ /\ 5.0f;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09094}09094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09095}09095\ \ \ \ \ \textcolor{comment}{//\ Calculate\ intermediate\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09096}09096\ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_row\ =\ 1\ +\ (3\ -\/\ 1)\ *\ progress;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09097}09097\ \ \ \ \ \textcolor{keywordtype}{int}\ inter\_col\ =\ 4;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09098}09098\ \ \ \ \ uint8\_t\ inter\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(inter\_row,\ inter\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09099}09099\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09100}09100\ \ \ \ \ \textcolor{comment}{//\ Calculate\ color\ transition\ (green\ -\/>\ blue)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09101}09101\ \ \ \ \ uint8\_t\ red\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09102}09102\ \ \ \ \ uint8\_t\ green\ =\ 255\ -\/\ (255\ *\ progress);\ \textcolor{comment}{//\ 255\ -\/>\ 0}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09103}09103\ \ \ \ \ uint8\_t\ blue\ =\ 0\ +\ (255\ *\ progress);\ \ \ \ \textcolor{comment}{//\ 0\ -\/>\ 255}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09104}09104\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09105}09105\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09106}09106\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(inter\_led,\ red,\ green,\ blue);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09107}09107\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(50));\ \textcolor{comment}{//\ ZRYCHLENO:\ z\ 100ms\ na\ 50ms}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09108}09108\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09109}09109\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09110}09110\ \ \ \textcolor{comment}{//\ Odstraněno\ modré\ bliknutí\ na\ konci\ -\/\ animace\ končí\ plynule}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09111}09111\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09112}09112\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09116}\mbox{\hyperlink{game__task_8c_a0054718644880d12b2f8ccb352644a2b}{09116}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0054718644880d12b2f8ccb352644a2b}{game\_test\_player\_change\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09117}09117\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ player\ change\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09118}09118\ \ \ \mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{game\_show\_player\_change\_animation}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}},\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09119}09119\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09120}09120\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09124}\mbox{\hyperlink{game__task_8c_a38bb9a0b5b3cd868021ba1f05be228d6}{09124}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a38bb9a0b5b3cd868021ba1f05be228d6}{game\_test\_castle\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09125}09125\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ castling\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09126}09126\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09127}09127\ \ \ \textcolor{comment}{//\ Test\ white\ kingside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09128}09128\ \ \ uint8\_t\ king\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 4);\ \textcolor{comment}{//\ e1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09129}09129\ \ \ uint8\_t\ king\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 6);\ \ \ \textcolor{comment}{//\ g1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09130}09130\ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 7);\ \textcolor{comment}{//\ h1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09131}09131\ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(0,\ 5);\ \ \ \textcolor{comment}{//\ f1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09132}09132\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09133}09133\ \ \ \textcolor{comment}{//\ 1.\ Highlight\ king\ and\ rook\ positions\ (gold)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09134}09134\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09135}09135\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09136}09136\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09137}09137\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09138}09138\ \ \ \textcolor{comment}{//\ 2.\ Show\ castling\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09139}09139\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ castle\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac134d8980d40f9fc8a12f683b967b187}{LED\_CMD\_ANIM\_CASTLE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09140}09140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_from\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09141}09141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09142}09142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09143}09143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09144}09144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 1500,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09145}09145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&king\_to\_led\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09146}09146\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&castle\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09147}09147\ \ \ vTaskDelay(pdMS\_TO\_TICKS(1000));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09148}09148\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09149}09149\ \ \ \textcolor{comment}{//\ 3.\ Highlight\ final\ positions\ (green)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09150}09150\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(king\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09151}09151\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09152}09152\ \ \ vTaskDelay(pdMS\_TO\_TICKS(500));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09153}09153\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09154}09154\ \ \ \textcolor{comment}{//\ 4.\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09155}09155\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09156}09156\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09157}09157\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09161}\mbox{\hyperlink{game__task_8c_a54c0942839659e43c97af3b1c7aca7e9}{09161}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a54c0942839659e43c97af3b1c7aca7e9}{game\_test\_promote\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09162}09162\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ promotion\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09163}09163\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09164}09164\ \ \ \textcolor{comment}{//\ Test\ promotion\ on\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09165}09165\ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(7,\ 0);\ \textcolor{comment}{//\ a8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09166}09166\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09167}09167\ \ \ \textcolor{comment}{//\ Show\ enhanced\ promotion\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09168}09168\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09169}09169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ promotion\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09170}09170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09171}09171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09172}09172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09173}09173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09174}09174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09175}09175\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09176}09176\ \ \ vTaskDelay(pdMS\_TO\_TICKS(1000));\ \textcolor{comment}{//\ Faster\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09177}09177\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09178}09178\ \ \ \textcolor{comment}{//\ Clear\ highlights}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09179}09179\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09180}09180\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09181}09181\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09185}\mbox{\hyperlink{game__task_8c_ac06cb22933b494c00b27ecb35160eeaa}{09185}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ac06cb22933b494c00b27ecb35160eeaa}{game\_test\_endgame\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09186}09186\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎬\ Testing\ endgame\ animation..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09187}09187\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09188}09188\ \ \ \textcolor{comment}{//\ Test\ endgame\ animation\ using\ direct\ LED\ command}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09189}09189\ \ \ uint8\_t\ king\_pos\ =\ 27;\ \textcolor{comment}{//\ d4\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09190}09190\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09191}09191\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09192}09192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09193}09193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09194}09194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09195}09195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09196}09196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 3000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09197}09197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09198}09198\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09199}09199\ \ \ vTaskDelay(pdMS\_TO\_TICKS(1500));\ \textcolor{comment}{//\ Faster\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09200}09200\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09201}09201\ \ \ \textcolor{comment}{//\ Clear\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09202}09202\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09203}09203\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09204}09204\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09208}\mbox{\hyperlink{game__task_8c_ad50b0c62b7700e4422eba52d68e2a938}{09208}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad50b0c62b7700e4422eba52d68e2a938}{game\_check\_game\_conditions}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09209}09209\ \ \ \textcolor{comment}{//\ TODO:\ Implement\ check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09210}09210\ \ \ \textcolor{comment}{//\ For\ now,\ just\ log\ the\ current\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09211}09211\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09212}09212\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔍\ Checking\ game\ conditions..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09213}09213\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09214}09214\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check\ (simplified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09215}09215\ \ \ \textcolor{keywordtype}{bool}\ white\_king\_found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09216}09216\ \ \ \textcolor{keywordtype}{bool}\ black\_king\_found\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09217}09217\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09218}09218\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09219}09219\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09220}09220\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09221}09221\ \ \ \ \ \ \ \ \ white\_king\_found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09222}09222\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09223}09223\ \ \ \ \ \ \ \ \ black\_king\_found\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09224}09224\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09225}09225\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09226}09226\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09227}09227\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09228}09228\ \ \ \textcolor{keywordflow}{if}\ (!white\_king\_found)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09229}09229\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ WHITE\ KING\ MISSING\ -\/\ Black\ wins!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09230}09230\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09231}09231\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!black\_king\_found)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09232}09232\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ BLACK\ KING\ MISSING\ -\/\ White\ wins!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09233}09233\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09234}09234\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09235}09235\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09236}09236\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ state:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09237}09237\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Active"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09238}09238\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dac440660deb460f2f6ad318818cd0458f}{GAME\_STATE\_IDLE}})\ \ \ ?\ \textcolor{stringliteral}{"{}Idle"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09239}09239\ \ \ \ \ \ \ \ \ \ \ \ :\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}})\ ?\ \textcolor{stringliteral}{"{}Paused"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09240}09240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Finished"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09241}09241\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09242}09242\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09243}09243\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09244}09244\ \textcolor{comment}{//\ END-\/GAME\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09245}09245\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09246}09246\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09252}\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{09252}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09253}09253\ \ \ \textcolor{comment}{//\ Find\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09254}09254\ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09255}09255\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09256}09256\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09257}09257\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09258}09258\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09259}09259\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09260}09260\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09261}09261\ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09262}09262\ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09263}09263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09264}09264\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09265}09265\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09266}09266\ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09267}09267\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09268}09268\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09269}09269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09270}09270\ \ \ \textcolor{keywordflow}{if}\ (king\_row\ ==\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09271}09271\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ King\ not\ found}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09272}09272\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09273}09273\ \ \ \textcolor{comment}{//\ Check\ if\ any\ opponent\ piece\ can\ capture\ the\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09274}09274\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ opponent\_pieces\_start\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09275}09275\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09276}09276\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ opponent\_pieces\_end\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09277}09277\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09278}09278\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09279}09279\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09280}09280\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09281}09281\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09282}09282\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ >=\ opponent\_pieces\_start\ \&\&\ piece\ <=\ opponent\_pieces\_end)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09283}09283\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ temporary\ move\ to\ check\ if\ it\ can\ capture\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09284}09284\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ temp\_move\ =\ \{.from\_row\ =\ row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09285}09285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .from\_col\ =\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09286}09286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_row\ =\ king\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09287}09287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .to\_col\ =\ king\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09288}09288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .piece\ =\ piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09289}09289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .captured\_piece\ =\ king\_piece,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09290}09290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .timestamp\ =\ 0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09291}09291\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09292}09292\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ move\ is\ valid\ (would\ capture\ king)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09293}09293\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a2c589b4bfa6cd43ea3582050e37c1cc4}{game\_validate\_piece\_move\_enhanced}}(\&temp\_move,\ piece)\ ==}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09294}09294\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09295}09295\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ King\ is\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09296}09296\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09297}09297\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09298}09298\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09299}09299\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09300}09300\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09301}09301\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09302}09302\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09303}09303\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09309}\mbox{\hyperlink{game__task_8c_a90e272f6928e9145d30671ce523ff35e}{09309}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a90e272f6928e9145d30671ce523ff35e}{game\_has\_legal\_moves}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09310}09310\ \ \ \textcolor{comment}{//\ Use\ existing\ move\ generation\ system\ instead\ of\ brute\ force}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09311}09311\ \ \ uint32\_t\ moves\_count\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09312}09312\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09313}09313\ \ \ \textcolor{keywordflow}{return}\ (moves\_count\ >\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09314}09314\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09315}09315\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09323}\mbox{\hyperlink{chess__types_8h_a4a1fae8d66a8db2dd28a091a3b11279c}{09323}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a4a1fae8d66a8db2dd28a091a3b11279c}{game\_is\_enemy\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09324}09324\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09325}09325\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09326}09326\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09327}09327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09328}09328\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09329}09329\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09330}\mbox{\hyperlink{game__task_8c_a93a1f0d6a82af5e13f78ebecc8a5ed8c}{09330}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a93a1f0d6a82af5e13f78ebecc8a5ed8c}{game\_is\_insufficient\_material}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09331}09331\ \ \ \textcolor{keywordtype}{int}\ white\_pieces\ =\ 0,\ black\_pieces\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09332}09332\ \ \ \textcolor{keywordtype}{int}\ white\_minors\ =\ 0,\ black\_minors\ =\ 0;\ \textcolor{comment}{//\ Knights\ and\ bishops}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09333}09333\ \ \ \textcolor{keywordtype}{bool}\ white\_has\_bishop\ =\ \textcolor{keyword}{false},\ black\_has\_bishop\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09334}09334\ \ \ \textcolor{keywordtype}{bool}\ white\_has\_knight\ =\ \textcolor{keyword}{false},\ black\_has\_knight\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09335}09335\ \ \ \textcolor{keywordtype}{bool}\ white\_bishop\_color\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09336}09336\ \ \ \ \ \ \ \ black\_bishop\_color\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ false\ =\ light,\ true\ =\ dark}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09337}09337\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09338}09338\ \ \ \textcolor{comment}{//\ Count\ pieces\ and\ analyze\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09339}09339\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09340}09340\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09341}09341\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09342}09342\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09343}09343\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09344}09344\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09345}09345\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09346}09346\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09347}09347\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09348}09348\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09349}09349\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09350}09350\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09351}09351\ \ \ \ \ \ \ \ \ white\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09352}09352\ \ \ \ \ \ \ \ \ white\_has\_bishop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09353}09353\ \ \ \ \ \ \ \ \ white\_bishop\_color\ =\ ((row\ +\ col)\ \%\ 2\ ==\ 0);\ \textcolor{comment}{//\ Light\ squares\ =\ false}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09354}09354\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09355}09355\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09356}09356\ \ \ \ \ \ \ \ \ white\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09357}09357\ \ \ \ \ \ \ \ \ white\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09358}09358\ \ \ \ \ \ \ \ \ white\_has\_knight\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09359}09359\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09360}09360\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09361}09361\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09362}09362\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09363}09363\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09364}09364\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09365}09365\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09366}09366\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09367}09367\ \ \ \ \ \ \ \ \ black\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09368}09368\ \ \ \ \ \ \ \ \ black\_has\_bishop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09369}09369\ \ \ \ \ \ \ \ \ black\_bishop\_color\ =\ ((row\ +\ col)\ \%\ 2\ ==\ 0);\ \textcolor{comment}{//\ Light\ squares\ =\ false}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09370}09370\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09371}09371\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09372}09372\ \ \ \ \ \ \ \ \ black\_pieces++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09373}09373\ \ \ \ \ \ \ \ \ black\_minors++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09374}09374\ \ \ \ \ \ \ \ \ black\_has\_knight\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09375}09375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09376}09376\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09377}09377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09378}09378\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09379}09379\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09380}09380\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09381}09381\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09382}09382\ \ \ \textcolor{comment}{//\ King\ vs\ King\ -\/\ always\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09383}09383\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ ==\ 0\ \&\&\ black\_pieces\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09384}09384\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09385}09385\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09386}09386\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09387}09387\ \ \ \textcolor{comment}{//\ King\ +\ minor\ vs\ King\ -\/\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09388}09388\ \ \ \textcolor{keywordflow}{if}\ ((white\_pieces\ ==\ 1\ \&\&\ black\_pieces\ ==\ 0)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09389}09389\ \ \ \ \ \ \ (white\_pieces\ ==\ 0\ \&\&\ black\_pieces\ ==\ 1))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09390}09390\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09391}09391\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09392}09392\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09393}09393\ \ \ \textcolor{comment}{//\ King\ +\ Bishop\ vs\ King\ +\ Bishop\ (same\ color)\ -\/\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09394}09394\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ ==\ 1\ \&\&\ black\_pieces\ ==\ 1\ \&\&\ white\_has\_bishop\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09395}09395\ \ \ \ \ \ \ black\_has\_bishop\ \&\&\ white\_bishop\_color\ ==\ black\_bishop\_color)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09396}09396\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09397}09397\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09398}09398\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09399}09399\ \ \ \textcolor{comment}{//\ King\ +\ Knight\ vs\ King\ +\ Knight\ -\/\ insufficient}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09400}09400\ \ \ \textcolor{keywordflow}{if}\ (white\_pieces\ ==\ 1\ \&\&\ black\_pieces\ ==\ 1\ \&\&\ white\_has\_knight\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09401}09401\ \ \ \ \ \ \ black\_has\_knight)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09402}09402\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09403}09403\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09404}09404\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09405}09405\ \ \ \textcolor{comment}{//\ King\ +\ 2\ Knights\ vs\ King\ -\/\ insufficient\ (very\ rare,\ but\ technically}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09406}09406\ \ \ \textcolor{comment}{//\ insufficient)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09407}09407\ \ \ \textcolor{keywordflow}{if}\ ((white\_pieces\ ==\ 2\ \&\&\ black\_pieces\ ==\ 0\ \&\&\ white\_minors\ ==\ 2\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09408}09408\ \ \ \ \ \ \ \ white\_has\_knight)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09409}09409\ \ \ \ \ \ \ (white\_pieces\ ==\ 0\ \&\&\ black\_pieces\ ==\ 2\ \&\&\ black\_minors\ ==\ 2\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09410}09410\ \ \ \ \ \ \ \ black\_has\_knight))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09411}09411\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09412}09412\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09413}09413\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09414}09414\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Sufficient\ material\ for\ checkmate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09415}09415\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09416}09416\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09445}\mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{09445}}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09446}09446\ \ \ \textcolor{comment}{//\ Check\ if\ current\ player\ is\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09447}09447\ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09448}09448\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09449}09449\ \ \ \textcolor{comment}{//\ Check\ if\ current\ player\ has\ legal\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09450}09450\ \ \ \textcolor{keywordtype}{bool}\ has\_moves\ =\ \mbox{\hyperlink{game__task_8c_a90e272f6928e9145d30671ce523ff35e}{game\_has\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09451}09451\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09452}09452\ \ \ \textcolor{keywordflow}{if}\ (in\_check\ \&\&\ !has\_moves)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09453}09453\ \ \ \ \ \textcolor{comment}{//\ Checkmate\ -\/\ určit\ typ\ podle\ posledního\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09454}09454\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09455}09455\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09456}09456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09457}09457\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09458}09458\ \ \ \ \ \textcolor{comment}{//\ Rozlišit\ typ\ šachmatu\ podle\ posledního\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09459}09459\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09460}09460\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{LAST\_MOVE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09461}09461\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09462}09462\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ EN\ PASSANT!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09463}09463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09464}09464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09465}09465\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09466}09466\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09467}09467\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09468}09468\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ CASTLING!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09469}09469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09470}09470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09471}09471\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09472}09472\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{LAST\_MOVE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09473}09473\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09474}09474\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ PROMOTION!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09475}09475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09476}09476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09477}09477\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09478}09478\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a1f704b3fdc9edf5defa5ca3f23fef635}{LAST\_MOVE\_DISCOVERED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09479}09479\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09480}09480\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09481}09481\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09482}09482\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ CHECKMATE\ BY\ DISCOVERED\ CHECK!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09483}09483\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09484}09484\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09485}09485\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09486}09486\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09487}09487\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ CHECKMATE!\ \%s\ wins\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves!"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09488}09488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09489}09489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09490}09490\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09491}09491\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09492}09492\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09493}09493\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09494}09494\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09495}09495\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09496}09496\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09497}09497\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09498}09498\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09499}09499\ \ \ \ \ \textcolor{comment}{//\ UNIFIED\ VICTORY\ ANIMATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09500}09500\ \ \ \ \ \textcolor{comment}{//\ Checkmate\ =\ Victory\ for\ current\_player\ (who\ delivered\ mate?\ No\ wait.)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09501}09501\ \ \ \ \ \textcolor{comment}{//\ Logic:\ if\ current\_player\ is\ in\ check\ \&\ no\ moves,\ they\ LOST.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09502}09502\ \ \ \ \ \textcolor{comment}{//\ Winner\ is\ the\ OPPONENT.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09503}09503\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09504}09504\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09505}09505\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a1e01fb94ceb1dc74ff280d87a35c1076}{game\_trigger\_victory\_animation}}(winner);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09506}09506\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09507}09507\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09508}09508\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!in\_check\ \&\&\ !has\_moves)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09509}09509\ \ \ \ \ \textcolor{comment}{//\ Stalemate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09510}09510\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09511}09511\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a05e8dcf1a732c2020d364fb5d9cea20e}{RESULT\_DRAW\_STALEMATE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09512}09512\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}};\ \textcolor{comment}{//\ Označit\ jako\ stalemate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09513}09513\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09514}09514\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09515}09515\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09516}09516\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09517}09517\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09518}09518\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09519}09519\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ STALEMATE!\ Game\ drawn\ in\ \%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\ moves"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09520}09520\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09521}09521\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09522}09522\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09523}09523\ \ \ \textcolor{comment}{//\ BUG\ \#13:\ Check\ for\ draw\ conditions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09524}09524\ \ \ \textcolor{comment}{//\ 50-\/move\ rule:\ 50\ plných\ tahů\ =\ 100\ půltahů\ (half-\/moves/ply)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09525}09525\ \ \ \textcolor{comment}{//\ moves\_without\_capture\ počítá\ půltahy,\ takže\ >=\ 100}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09526}09526\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a371c1b2d4cadfc3079414c671ed85847}{moves\_without\_capture}}\ >=\ 100)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09527}09527\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09528}09528\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a6577cffad8cbf7e5ca95dd46e504705b}{RESULT\_DRAW\_50\_MOVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09529}09529\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09530}09530\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}};\ \textcolor{comment}{//\ Označit\ jako\ 50-\/move\ rule}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09531}09531\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09532}09532\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09533}09533\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09534}09534\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09535}09535\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09536}09536\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09537}09537\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ 50\ moves\ without\ capture\ (50-\/move\ rule)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09538}09538\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09539}09539\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09540}09540\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09541}09541\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a009d7069912fb2689b7443575d3def38}{game\_is\_position\_repeated}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09542}09542\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09543}09543\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0486ad918f30f8bb5d8db5d92f72c208}{RESULT\_DRAW\_REPETITION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09544}09544\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09545}09545\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}};\ \textcolor{comment}{//\ Označit\ jako\ threefold\ repetition}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09546}09546\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09547}09547\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09548}09548\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09549}09549\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09550}09550\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09551}09551\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09552}09552\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Position\ repeated\ (draw\ by\ repetition)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09553}09553\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09554}09554\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09555}09555\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09556}09556\ \ \ \textcolor{comment}{//\ Check\ for\ insufficient\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09557}09557\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a93a1f0d6a82af5e13f78ebecc8a5ed8c}{game\_is\_insufficient\_material}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09558}09558\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09559}09559\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a330166862ce8a46d98a340b42435faad}{RESULT\_DRAW\_INSUFFICIENT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09560}09560\ \ \ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09561}09561\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}};\ \textcolor{comment}{//\ Označit\ jako\ insufficient\ material}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09562}09562\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09563}09563\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Požadavek\ na\ report}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09564}09564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09565}09565\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ timer\ (hra\ skončila)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09566}09566\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09567}09567\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09568}09568\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🤝\ DRAW!\ Insufficient\ material\ to\ checkmate"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09569}09569\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09570}09570\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09571}09571\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09572}09572\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09573}09573\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09574}09574\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09575}09575\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09576}09576\ \textcolor{comment}{//\ GAME\ CONTROL\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09577}09577\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09578}09578\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09583}\mbox{\hyperlink{game__task_8c_a92c446eef9cfeb30bdcdbf87546c561b}{09583}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a92c446eef9cfeb30bdcdbf87546c561b}{game\_toggle\_timer}}(\textcolor{keywordtype}{bool}\ enabled)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09584}09584\ \ \ \mbox{\hyperlink{game__task_8c_a9f577310be55e50d099f72849f597a25}{timer\_enabled}}\ =\ enabled;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09585}09585\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ timer\ \%s"{}},\ enabled\ ?\ \textcolor{stringliteral}{"{}enabled"{}}\ :\ \textcolor{stringliteral}{"{}disabled"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09586}09586\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09587}09587\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09592}\mbox{\hyperlink{game__task_8c_a6710818895e93c8a7b6852ab80ad59bb}{09592}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6710818895e93c8a7b6852ab80ad59bb}{game\_save\_game}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_name)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09593}09593\ \ \ \textcolor{keywordflow}{if}\ (game\_name\ ==\ NULL\ ||\ strlen(game\_name)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09594}09594\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ game\ name\ for\ save"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09595}09595\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09596}09596\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09597}09597\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09598}09598\ \ \ \textcolor{comment}{//\ This\ is\ a\ placeholder\ -\/\ in\ a\ real\ implementation\ you\ would:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09599}09599\ \ \ \textcolor{comment}{//\ 1.\ Save\ board\ state\ to\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09600}09600\ \ \ \textcolor{comment}{//\ 2.\ Save\ move\ history\ to\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09601}09601\ \ \ \textcolor{comment}{//\ 3.\ Save\ game\ statistics\ to\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09602}09602\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09603}09603\ \ \ strncpy(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}},\ game\_name,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}})\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09604}09604\ \ \ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}}[\textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}})\ -\/\ 1]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09605}09605\ \ \ \mbox{\hyperlink{game__task_8c_a1f70b0c8dbc0c485ab51c2892c75b959}{game\_saved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09606}09606\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09607}09607\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💾\ Game\ saved\ as:\ \%s"{}},\ \mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09608}09608\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09609}09609\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09614}\mbox{\hyperlink{game__task_8c_a6d7435b0a21ea4d6d2791e2a7cb665b5}{09614}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a6d7435b0a21ea4d6d2791e2a7cb665b5}{game\_load\_game}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_name)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09615}09615\ \ \ \textcolor{keywordflow}{if}\ (game\_name\ ==\ NULL\ ||\ strlen(game\_name)\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09616}09616\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ game\ name\ for\ load"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09617}09617\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09618}09618\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09619}09619\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09620}09620\ \ \ \textcolor{comment}{//\ This\ is\ a\ placeholder\ -\/\ in\ a\ real\ implementation\ you\ would:}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09621}09621\ \ \ \textcolor{comment}{//\ 1.\ Load\ board\ state\ from\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09622}09622\ \ \ \textcolor{comment}{//\ 2.\ Load\ move\ history\ from\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09623}09623\ \ \ \textcolor{comment}{//\ 3.\ Load\ game\ statistics\ from\ NVS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09624}09624\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09625}09625\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📂\ Loading\ game:\ \%s"{}},\ game\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09626}09626\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ Game\ loading\ not\ yet\ implemented"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09627}09627\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09628}09628\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09634}\mbox{\hyperlink{game__task_8c_a0a4948efe62eece9f97fd6eef22db6e8}{09634}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a0a4948efe62eece9f97fd6eef22db6e8}{game\_export\_pgn}}(\textcolor{keywordtype}{char}\ *pgn\_buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09635}09635\ \ \ \textcolor{keywordflow}{if}\ (pgn\_buffer\ ==\ NULL\ ||\ buffer\_size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09636}09636\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ PGN\ buffer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09637}09637\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09638}09638\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09639}09639\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09640}09640\ \ \ \textcolor{comment}{//\ Start\ PGN\ with\ metadata}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09641}09641\ \ \ \textcolor{keywordtype}{int}\ pos\ =\ snprintf(pgn\_buffer,\ buffer\_size,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09642}09642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Event\ \(\backslash\)"{}ESP32\ Chess\ Game\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09643}09643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Site\ \(\backslash\)"{}ESP32-\/C6\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09644}09644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Date\ \(\backslash\)"{}\%s\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09645}09645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Round\ \(\backslash\)"{}1\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09646}09646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[White\ \(\backslash\)"{}Player\ 1\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09647}09647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Black\ \(\backslash\)"{}Player\ 2\(\backslash\)"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09648}09648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[Result\ \(\backslash\)"{}*\(\backslash\)"{}]\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09649}09649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2025-\/01-\/01"{}});\ \textcolor{comment}{//\ TODO:\ Get\ actual\ date}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09650}09650\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09651}09651\ \ \ \textcolor{comment}{//\ Add\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09652}09652\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ \&\&\ pos\ <\ buffer\_size\ -\/\ 50;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09653}09653\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09654}09654\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_square[4],\ to\_square[4];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09655}09655\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ from\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09656}09656\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}},\ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09657}09657\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09658}09658\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ \%\ 2\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09659}09659\ \ \ \ \ \ \ \textcolor{comment}{//\ White\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09660}09660\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}.\ \%s\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09661}09661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (i\ /\ 2)\ +\ 1,\ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09662}09662\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09663}09663\ \ \ \ \ \ \ \textcolor{comment}{//\ Black\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09664}09664\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ \%s\%s\ "{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09665}09665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_square,\ to\_square);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09666}09666\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09667}09667\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09668}09668\ \ \ \ \ \textcolor{comment}{//\ Add\ newline\ every\ 10\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09669}09669\ \ \ \ \ \textcolor{keywordflow}{if}\ ((i\ +\ 1)\ \%\ 20\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09670}09670\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09671}09671\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09672}09672\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09673}09673\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09674}09674\ \ \ \textcolor{comment}{//\ Add\ result}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09675}09675\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09676}09676\ \ \ \ \ \textcolor{keywordflow}{if}\ (strstr(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}},\ \textcolor{stringliteral}{"{}CHECKMATE"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09677}09677\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ 1-\/0"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09678}09678\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strstr(\mbox{\hyperlink{game__task_8c_a37493b1f0bf22f8cfffaa5d37f6d589d}{saved\_game\_name}},\ \textcolor{stringliteral}{"{}STALEMATE"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09679}09679\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ 1/2-\/1/2"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09680}09680\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09681}09681\ \ \ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ 1/2-\/1/2"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09682}09682\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09683}09683\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09684}09684\ \ \ \ \ pos\ +=\ snprintf(pgn\_buffer\ +\ pos,\ buffer\_size\ -\/\ pos,\ \textcolor{stringliteral}{"{}\ *"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09685}09685\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09686}09686\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09687}09687\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}📄\ PGN\ export\ completed\ (\%d\ characters)"{}},\ pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09688}09688\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09689}09689\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09696}\mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{09696}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a36549782eb3387a93e25c7d73325bd9f}{game\_coords\_to\_square}}(uint8\_t\ row,\ uint8\_t\ col,\ \textcolor{keywordtype}{char}\ *square)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09697}09697\ \ \ \textcolor{keywordflow}{if}\ (square\ ==\ NULL)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09698}09698\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09699}09699\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09700}09700\ \ \ \textcolor{comment}{//\ Convert\ column\ to\ file\ (a-\/h)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09701}09701\ \ \ square[0]\ =\ \textcolor{charliteral}{'a'}\ +\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09702}09702\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09703}09703\ \ \ \textcolor{comment}{//\ Convert\ row\ to\ rank\ (1-\/8)\ -\/\ row\ 0\ =\ rank\ 1,\ row\ 7\ =\ rank\ 8}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09704}09704\ \ \ square[1]\ =\ \textcolor{charliteral}{'1'}\ +\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09705}09705\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09706}09706\ \ \ square[2]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09707}09707\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09708}09708\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09709}\mbox{\hyperlink{game__task_8c_a138dd79d240e644870a7d53580720206}{09709}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a138dd79d240e644870a7d53580720206}{game\_print\_status}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09710}09710\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Status:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09711}09711\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ State:\ \%d"{}},\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09712}09712\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Current\ player:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09713}09713\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09714}09714\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Move\ count:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09715}09715\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Game\ active:\ \%s"{}},\ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ ?\ \textcolor{stringliteral}{"{}Yes"{}}\ :\ \textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09716}09716\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Total\ games:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_aedb793cda816bdac01c6e216df7a2860}{total\_games}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09717}09717\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ White\ wins:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a86665d38f77c7b87cfd267e81708df58}{white\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09718}09718\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Black\ wins:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_a1033ed34d6f3dd511442ce41cc79ffae}{black\_wins}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09719}09719\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ Draws:\ \%lu"{}},\ \mbox{\hyperlink{game__task_8c_ae9bb73183d10c72b880fb4cd10d3f585}{draws}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09720}09720\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09721}09721\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09722}09722\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09723}09723\ \textcolor{comment}{//\ MAIN\ TASK\ FUNCTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09724}09724\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09725}09725\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09726}\mbox{\hyperlink{game__task_8c_ab26d022ec766e04addd46d9b6da9768a}{09726}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ab26d022ec766e04addd46d9b6da9768a}{game\_task\_start}}(\textcolor{keywordtype}{void}\ *pvParameters)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09727}09727\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ task\ started\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09728}09728\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09729}09729\ \ \ \textcolor{comment}{//\ CRITICAL:\ Register\ with\ TWDT\ from\ within\ task}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09730}09730\ \ \ esp\_err\_t\ wdt\_ret\ =\ esp\_task\_wdt\_add(NULL);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09731}09731\ \ \ \textcolor{keywordflow}{if}\ (wdt\_ret\ !=\ ESP\_OK\ \&\&\ wdt\_ret\ !=\ ESP\_ERR\_INVALID\_ARG)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09732}09732\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ register\ Game\ task\ with\ TWDT:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09733}09733\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(wdt\_ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09734}09734\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09735}09735\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Game\ task\ registered\ with\ TWDT"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09736}09736\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09737}09737\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09738}09738\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Features:"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09739}09739\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Standard\ chess\ rules"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09740}09740\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Move\ validation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09741}09741\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ task\ initialized\ -\/\ ready\ to\ start\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09742}09742\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Board\ initialized\ with\ starting\ position"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09743}09743\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ Command\ queue\ ready\ for\ UART/Web/Button\ inputs"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09744}09744\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ LED\ animations\ ready"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09745}09745\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ •\ 1\ second\ game\ loop\ cycle"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09746}09746\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09747}09747\ \ \ \textcolor{comment}{//\ \#2:\ Initialize\ promotion\ mutex\ for\ concurrency\ protection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09748}09748\ \ \ \textcolor{comment}{//\ Použít\ recursive\ mutex,\ protože\ game\_execute\_move()\ může\ být\ volána}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09749}09749\ \ \ \textcolor{comment}{//\ reentrantně\ (např.\ z\ capture\ flow,\ který\ volá\ game\_execute\_move(),\ který}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09750}09750\ \ \ \textcolor{comment}{//\ může\ detekovat\ promotion)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09751}09751\ \ \ \mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}}\ =\ xSemaphoreCreateRecursiveMutex();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09752}09752\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}}\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09753}09753\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ CRITICAL:\ Failed\ to\ create\ promotion\ mutex!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09754}09754\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09755}09755\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promotion\ recursive\ mutex\ initialized"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09756}09756\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09757}09757\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09758}09758\ \ \ \mbox{\hyperlink{animation__task_8c_a35141cb45623cb3b7b4d96da35ed1831}{task\_running}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09759}09759\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09760}09760\ \ \ \textcolor{comment}{//\ Initialize\ timer\ system}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09761}09761\ \ \ esp\_err\_t\ timer\_ret\ =\ \mbox{\hyperlink{game__task_8c_a917f1907b236e1476e75bb033e2a3165}{game\_init\_timer\_system}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09762}09762\ \ \ \textcolor{keywordflow}{if}\ (timer\_ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09763}09763\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09764}09764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Timer\ system\ initialization\ failed,\ continuing\ without\ timer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09765}09765\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09766}09766\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09767}09767\ \ \ \textcolor{comment}{//\ Initialize\ game}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09768}09768\ \ \ \mbox{\hyperlink{game__task_8c_a9b4b4ef6ba4260c09a59192fc68be834}{game\_initialize\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09769}09769\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09770}09770\ \ \ \textcolor{comment}{//\ Main\ task\ loop}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09771}09771\ \ \ uint32\_t\ loop\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09772}09772\ \ \ TickType\_t\ last\_wake\_time\ =\ xTaskGetTickCount();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09773}09773\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09774}09774\ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09775}09775\ \ \ \ \ \textcolor{comment}{//\ =========================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09776}09776\ \ \ \ \ \textcolor{comment}{//\ 🛑\ BOOT\ ANIMATION\ PROTECTION\ -\/\ BLOKUJE\ VŠECHNY\ GAME\ OPERACE\ BĚHEM\ BOOT}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09777}09777\ \ \ \ \ \textcolor{comment}{//\ =========================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09778}09778\ \ \ \ \ \textcolor{comment}{//\ Pokud\ běží\ boot\ animace\ (řízená\ z\ main.c),\ game\ task\ NESMÍ\ dělat\ NIC!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09779}09779\ \ \ \ \ \textcolor{comment}{//\ Auto\ new\ game\ detection,\ LED\ operace,\ cokoliv\ by\ mohlo\ přerušit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09780}09780\ \ \ \ \ \textcolor{comment}{//\ animaci.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09781}09781\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{led__task_8h_a006a24ec8e7f302c4a6f8481675803d1}{led\_is\_booting}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09782}09782\ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ WDT\ aby\ task\ nespadl,\ ale\ nic\ nedělat}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09783}09783\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09784}09784\ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(10));\ \textcolor{comment}{//\ 10ms\ -\/\ rychlé\ probuzení\ po\ fade\_out!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09785}09785\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Přeskočit\ zbytek\ smyčky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09786}09786\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09787}09787\ \ \ \ \ \textcolor{comment}{//\ =========================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09788}09788\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09789}09789\ \ \ \ \ \textcolor{comment}{//\ CRITICAL:\ Reset\ watchdog\ for\ game\ task\ in\ every\ iteration\ (only\ if}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09790}09790\ \ \ \ \ \textcolor{comment}{//\ registered)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09791}09791\ \ \ \ \ esp\_err\_t\ wdt\_ret\ =\ \mbox{\hyperlink{game__task_8c_ade55abfe5c56999016c2e1ec6b9583fa}{game\_task\_wdt\_reset\_safe}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09792}09792\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdt\_ret\ !=\ ESP\_OK\ \&\&\ wdt\_ret\ !=\ ESP\_ERR\_NOT\_FOUND)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09793}09793\ \ \ \ \ \ \ \textcolor{comment}{//\ Task\ not\ registered\ with\ TWDT\ yet\ -\/\ this\ is\ normal\ during\ startup}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09794}09794\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09795}09795\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09796}09796\ \ \ \ \ \textcolor{comment}{//\ Process\ game\ commands}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09797}09797\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac4ac5416414272fb1942f0269ea572c7}{game\_process\_commands}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09798}09798\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09799}09799\ \ \ \ \ \textcolor{comment}{//\ Process\ matrix\ events\ (moves)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09800}09800\ \ \ \ \ \textcolor{comment}{//\ DEPRECATED:\ Matrix\ events\ are\ now\ processed\ via\ game\_command\_queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09801}09801\ \ \ \ \ \textcolor{comment}{//\ game\_process\_matrix\_events();\ \ //\ No\ longer\ needed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09802}09802\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09803}09803\ \ \ \ \ \textcolor{comment}{//\ Update\ timer\ display\ and\ check\ for\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09804}09804\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aab2504466c50dfa9455e1414810bc073}{game\_update\_timer\_display}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09805}09805\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09806}09806\ \ \ \ \ \textcolor{comment}{//\ Zpracovat\ endgame\ report\ request\ (s\ dostatečným\ stackem\ 10KB)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09807}09807\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09808}09808\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Reset\ flag}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09809}09809\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa4254801c2619ab854e6e41d640768bd}{game\_print\_endgame\_report\_uart}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09810}09810\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09811}09811\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09812}09812\ \ \ \ \ \textcolor{comment}{//\ Auto\ new\ game\ detection\ (kdyz\ jsou\ figurky\ v\ pocatecni\ pozici\ 2s)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09813}09813\ \ \ \ \ \textcolor{comment}{//\ Logic\ update:\ Must\ not\ be\ blocked\ (require\ 1\ move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09814}09814\ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_start\_pos\ =\ \mbox{\hyperlink{game__task_8c_a3534f1702346800f3c81568d62f497bc}{game\_is\_board\_in\_starting\_position}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09815}09815\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09816}09816\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_start\_pos\ \&\&\ !\mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09817}09817\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09818}09818\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09819}09819\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09820}09820\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{auto\_new\_game\_timer\_start}}\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09821}09821\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09822}09822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Auto\ new\ game:\ Starting\ position\ detected,\ waiting\ 2s..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09823}09823\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((esp\_timer\_get\_time()\ /\ 1000\ -\/\ \mbox{\hyperlink{game__task_8c_a742eef556956d6c9f4b0c3276501dabd}{auto\_new\_game\_timer\_start}})\ >}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09824}09824\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab5d37ae881c4c3c8d9ac1a35e00e7b71}{AUTO\_NEW\_GAME\_CONFIRMATION\_TIME\_MS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09825}09825\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09826}09826\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09827}09827\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Auto\ new\ game:\ Position\ confirmed\ for\ 2s\ -\/\ triggering\ new\ game"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09828}09828\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09829}09829\ \ \ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a9cdd3824f45d61a774ab6868e898e1c0}{GAME\_CMD\_NEW\_GAME}},\ .player\ =\ 0,\ .response\_queue\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09830}09830\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09831}09831\ \ \ \ \ \ \ \ \ \ \ xQueueSend(\mbox{\hyperlink{freertos__chess_8c_a4ed770cbe46604586e494bae84b62304}{game\_command\_queue}},\ \&cmd,\ pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09832}09832\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09833}09833\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09834}09834\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Block\ auto-\/new\ game\ detection\ until\ at\ least\ one\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09835}09835\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ is\ made.\ This\ prevents\ infinite\ loop\ when\ auto-\/new\ game\ is\ triggered}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09836}09836\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ while\ pieces\ are\ already\ in\ starting\ position.}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09837}09837\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aeeb78940e65fff2e71ea41c1a8787c1c}{auto\_new\_game\_blocked\_until\_move}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09838}09838\ \ \ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09839}09839\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09840}09840\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🔒\ Auto\ new\ game\ detection\ blocked\ until\ first\ move\ (prevents\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09841}09841\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}infinite\ loop)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09842}09842\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09843}09843\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09844}09844\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!in\_start\_pos)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09845}09845\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a04d3ba5e73ae60bb8c57f895a51db47b}{auto\_new\_game\_triggered}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09846}09846\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aae9a4d0a6d4c8c30d7b645eacd06716f}{auto\_new\_game\_in\_starting\_position}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09847}09847\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09848}09848\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09849}09849\ \ \ \ \ \textcolor{comment}{//\ Periodic\ status\ update}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09850}09850\ \ \ \ \ \textcolor{keywordflow}{if}\ (loop\_count\ \%\ 5000\ ==\ 0)\ \{\ \textcolor{comment}{//\ Every\ 5\ seconds}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09851}09851\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Task\ Status:\ loop=\%d,\ state=\%d,\ player=\%d,\ moves=\%lu"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09852}09852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ loop\_count,\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}},\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09853}09853\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09854}09854\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09855}09855\ \ \ \ \ loop\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09856}09856\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09857}09857\ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ next\ cycle\ (100ms)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09858}09858\ \ \ \ \ vTaskDelayUntil(\&last\_wake\_time,\ pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09859}09859\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09860}09860\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09861}09861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09869}\mbox{\hyperlink{game__task_8c_a502098cd25ad56400beb2339a1bfb84c}{09869}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a502098cd25ad56400beb2339a1bfb84c}{game\_process\_matrix\_events}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09870}09870\ \ \ \textcolor{comment}{//\ Matrix\ events\ are\ now\ processed\ via\ game\_command\_queue}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09871}09871\ \ \ \textcolor{comment}{//\ This\ function\ is\ kept\ for\ compatibility\ but\ does\ nothing}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09872}09872\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09873}09873\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09874}09874\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09875}09875\ \textcolor{comment}{//\ ENHANCED\ CHESS\ LOGIC\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09876}09876\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09877}09877\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09878}09878\ \textcolor{comment}{//\ Direction\ vectors\ for\ piece\ movement\ (knight\_moves\ moved\ to\ top\ of\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09879}09879\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09880}\mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{09880}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[8][2]\ =\ \{\{-\/1,\ -\/1\},\ \{-\/1,\ 0\},\ \{-\/1,\ 1\},\ \{0,\ -\/1\},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09881}09881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{0,\ 1\},\ \ \ \{1,\ -\/1\},\ \{1,\ 0\},\ \ \{1,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09882}09882\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09883}\mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{09883}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}}[4][2]\ =\ \{\{-\/1,\ -\/1\},\ \{-\/1,\ 1\},\ \{1,\ -\/1\},\ \{1,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09884}09884\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09885}\mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{09885}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int8\_t\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}}[4][2]\ =\ \{\{-\/1,\ 0\},\ \{1,\ 0\},\ \{0,\ -\/1\},\ \{0,\ 1\}\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09886}09886\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09887}09887\ \textcolor{comment}{//\ Castling\ flags\ (moved\ to\ top\ of\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09888}09888\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09889}09889\ \textcolor{comment}{//\ En\ passant\ state\ (moved\ to\ top\ of\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09890}09890\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09891}09891\ \textcolor{comment}{//\ Lifted\ piece\ state\ tracking\ (already\ defined\ above)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09892}09892\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09893}09893\ \textcolor{comment}{//\ Move\ generation\ buffers}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09894}\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{09894}}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ \mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[128];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09895}\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{09895}}\ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09896}09896\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09897}09897\ \textcolor{comment}{//\ Game\ position\ history\ for\ draw\ detection\ (declared\ earlier\ in\ the\ file)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09898}09898\ \textcolor{comment}{//\ static\ uint32\_t\ position\_hashes[100];}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09899}09899\ \textcolor{comment}{//\ static\ uint32\_t\ position\_history\_count\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09900}09900\ \textcolor{comment}{//\ fifty\_move\_counter\ is\ now\ declared\ in\ GAME\ STATE\ VARIABLES\ section}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09901}09901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09902}09902\ \textcolor{comment}{//\ Promotion\ state\ (for\ future\ use)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09903}09903\ \textcolor{comment}{//\ static\ bool\ promotion\_pending\ =\ false;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09904}09904\ \textcolor{comment}{//\ static\ chess\_move\_extended\_t\ promotion\_move;}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09905}09905\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09906}09906\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09907}09907\ \textcolor{comment}{//\ BASIC\ UTILITY\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09908}09908\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09909}09909\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09913}\mbox{\hyperlink{chess__types_8h_ad58024344b5777da494b4a35f8250c32}{09913}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(\textcolor{keywordtype}{int}\ row,\ \textcolor{keywordtype}{int}\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09914}09914\ \ \ \textcolor{keywordflow}{return}\ (row\ >=\ 0\ \&\&\ row\ <\ 8\ \&\&\ col\ >=\ 0\ \&\&\ col\ <\ 8);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09915}09915\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09916}09916\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09920}\mbox{\hyperlink{chess__types_8h_a7f31b3ea42f40399386306ba3d88cb9c}{09920}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(\mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09921}09921\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09922}09922\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09923}09923\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{game__task_8c_a8f69768eebdeba16538566a535f25351}{game\_is\_white\_piece}}(piece)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09924}09924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{game__task_8c_a304560a99cb8733e12bdcd9461b66926}{game\_is\_black\_piece}}(piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09925}09925\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09926}09926\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09927}09927\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09928}09928\ \textcolor{comment}{//\ ATTACK\ AND\ CHECK\ DETECTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09929}09929\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09930}09930\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09934}\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{09934}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(uint8\_t\ row,\ uint8\_t\ col,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ by\_player)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09935}09935\ \ \ \textcolor{comment}{//\ Check\ pawn\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09936}09936\ \ \ \textcolor{keywordtype}{int}\ pawn\_dir\ =\ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09937}09937\ \ \ \textcolor{keywordtype}{int}\ pawn\_row\ =\ row\ -\/\ pawn\_dir;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09938}09938\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_pawn\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09939}09939\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09940}09940\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09941}09941\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(pawn\_row,\ col\ -\/\ 1)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09942}09942\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[pawn\_row][col\ -\/\ 1]\ ==\ attacking\_pawn)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09943}09943\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09944}09944\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(pawn\_row,\ col\ +\ 1)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09945}09945\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[pawn\_row][col\ +\ 1]\ ==\ attacking\_pawn)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09946}09946\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09947}09947\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09948}09948\ \ \ \textcolor{comment}{//\ Check\ knight\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09949}09949\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_knight\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09950}09950\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09951}09951\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09952}09952\ \ \ \ \ \textcolor{keywordtype}{int}\ nr\ =\ row\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09953}09953\ \ \ \ \ \textcolor{keywordtype}{int}\ nc\ =\ col\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09954}09954\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc)\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc]\ ==\ attacking\_knight)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09955}09955\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09956}09956\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09957}09957\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09958}09958\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09959}09959\ \ \ \textcolor{comment}{//\ Check\ bishop/queen\ diagonal\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09960}09960\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_bishop\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09961}09961\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09962}09962\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_queen\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09963}09963\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09964}09964\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09965}09965\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ 4;\ d++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09966}09966\ \ \ \ \ \textcolor{keywordtype}{int}\ dr\ =\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}}[d][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09967}09967\ \ \ \ \ \textcolor{keywordtype}{int}\ dc\ =\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}}[d][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09968}09968\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09969}09969\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ nr\ =\ row\ +\ dr,\ nc\ =\ col\ +\ dc;\ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09970}09970\ \ \ \ \ \ \ \ \ \ nr\ +=\ dr,\ nc\ +=\ dc)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09971}09971\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09972}09972\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09973}09973\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09974}09974\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09975}09975\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ attacking\_bishop\ ||\ piece\ ==\ attacking\_queen)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09976}09976\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09977}09977\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09978}09978\ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Blocked\ by\ any\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09979}09979\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09980}09980\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09981}09981\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09982}09982\ \ \ \textcolor{comment}{//\ Check\ rook/queen\ orthogonal\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09983}09983\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_rook\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09984}09984\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09985}09985\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09986}09986\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ 4;\ d++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09987}09987\ \ \ \ \ \textcolor{keywordtype}{int}\ dr\ =\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}}[d][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09988}09988\ \ \ \ \ \textcolor{keywordtype}{int}\ dc\ =\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}}[d][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09989}09989\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09990}09990\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ nr\ =\ row\ +\ dr,\ nc\ =\ col\ +\ dc;\ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09991}09991\ \ \ \ \ \ \ \ \ \ nr\ +=\ dr,\ nc\ +=\ dc)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09992}09992\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09993}09993\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09994}09994\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09995}09995\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09996}09996\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ attacking\_rook\ ||\ piece\ ==\ attacking\_queen)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09997}09997\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09998}09998\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l09999}09999\ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Blocked\ by\ any\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10000}10000\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10001}10001\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10002}10002\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10003}10003\ \ \ \textcolor{comment}{//\ Check\ king\ attacks}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10004}10004\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ attacking\_king\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10005}10005\ \ \ \ \ \ \ (by\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10006}10006\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10007}10007\ \ \ \ \ \textcolor{keywordtype}{int}\ nr\ =\ row\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10008}10008\ \ \ \ \ \textcolor{keywordtype}{int}\ nc\ =\ col\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10009}10009\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(nr,\ nc)\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[nr][nc]\ ==\ attacking\_king)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10010}10010\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10011}10011\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10012}10012\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10013}10013\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10014}10014\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10015}10015\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10016}10016\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10017}10017\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10018}10018\ \textcolor{comment}{//\ MOVE\ VALIDATION\ AND\ SIMULATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10019}10019\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10020}10020\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10024}\mbox{\hyperlink{chess__types_8h_a3d771c47f735ab5e75fee68915b073fc}{10024}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(\mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10025}10025\ \ \ \textcolor{comment}{//\ Save\ original\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10026}10026\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10027}10027\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ original\_en\_passant\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10028}10028\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10029}10029\ \ \ \textcolor{comment}{//\ Handle\ en\ passant\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10030}10030\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10031}10031\ \ \ \ \ original\_en\_passant\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10032}10032\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10033}10033\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10034}10034\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10035}10035\ \ \ \textcolor{comment}{//\ Make\ the\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10036}10036\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10037}10037\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10038}10038\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10039}10039\ \ \ \textcolor{comment}{//\ Check\ if\ king\ is\ in\ check\ after\ this\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10040}10040\ \ \ \textcolor{keywordtype}{bool}\ king\_in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10041}10041\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10042}10042\ \ \ \textcolor{comment}{//\ Restore\ original\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10043}10043\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10044}10044\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ original\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10045}10045\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10046}10046\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10047}10047\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ original\_en\_passant;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10048}10048\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10049}10049\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10050}10050\ \ \ \textcolor{keywordflow}{return}\ !king\_in\_check;\ \textcolor{comment}{//\ Return\ true\ if\ move\ is\ legal\ (doesn't\ leave\ king}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10051}10051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ in\ check)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10052}10052\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10053}10053\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10054}10054\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10055}10055\ \textcolor{comment}{//\ MOVE\ GENERATION\ -\/\ INDIVIDUAL\ PIECES}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10056}10056\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10057}10057\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10061}\mbox{\hyperlink{game__task_8c_aba34fdb2616d1c154dadc9d122338c80}{10061}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aba34fdb2616d1c154dadc9d122338c80}{game\_generate\_pawn\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10062}10062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10063}10063\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ pawn\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10064}10064\ \ \ \textcolor{keywordtype}{bool}\ is\_white\ =\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10065}10065\ \ \ \textcolor{keywordtype}{int}\ direction\ =\ is\_white\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10066}10066\ \ \ \textcolor{keywordtype}{int}\ start\_row\ =\ is\_white\ ?\ 1\ :\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10067}10067\ \ \ \textcolor{keywordtype}{int}\ promotion\_row\ =\ is\_white\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10068}10068\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10069}10069\ \ \ \textcolor{comment}{//\ Forward\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10070}10070\ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ direction;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10071}10071\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ from\_col)\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10072}10072\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][from\_col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10073}10073\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10074}10074\ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ promotion\_row)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10075}10075\ \ \ \ \ \ \ \textcolor{comment}{//\ Promotion\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10076}10076\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ promo\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}};\ promo\ <=\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}};\ promo++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10077}10077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10078}10078\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10079}10079\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10080}10080\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10081}10081\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10082}10082\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10083}10083\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10084}10084\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10085}10085\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10086}10086\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10087}10087\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10088}10088\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}}\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})promo;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10089}10089\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10090}10090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10091}10091\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10092}10092\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10093}10093\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10094}10094\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10095}10095\ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ forward\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10096}10096\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10097}10097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10098}10098\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10099}10099\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10100}10100\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10101}10101\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10102}10102\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10103}10103\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10104}10104\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10105}10105\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10106}10106\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10107}10107\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10108}10108\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10109}10109\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10110}10110\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10111}10111\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10112}10112\ \ \ \ \ \ \ \textcolor{comment}{//\ Double\ move\ from\ starting\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10113}10113\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_row\ ==\ start\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10114}10114\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row\ +\ direction][from\_col]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10115}10115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10116}10116\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10117}10117\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10118}10118\ \ \ \ \ \ \ \ \ move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10119}10119\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10120}10120\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10121}10121\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row\ +\ direction;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10122}10122\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10123}10123\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10124}10124\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10125}10125\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10126}10126\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10127}10127\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10128}10128\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10129}10129\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10130}10130\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10131}10131\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10132}10132\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10133}10133\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10134}10134\ \ \ \textcolor{comment}{//\ Captures\ (diagonal)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10135}10135\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dc\ =\ -\/1;\ dc\ <=\ 1;\ dc\ +=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10136}10136\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ from\_col\ +\ dc;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10137}10137\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10138}10138\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10139}10139\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10140}10140\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4a1fae8d66a8db2dd28a091a3b11279c}{game\_is\_enemy\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10141}10141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (to\_row\ ==\ promotion\_row)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10142}10142\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Capture\ with\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10143}10143\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ promo\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}};\ promo\ <=\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10144}10144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ promo++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10145}10145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10146}10146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10147}10147\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10148}10148\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10149}10149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10150}10150\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10151}10151\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10152}10152\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10153}10153\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10154}10154\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10155}10155\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10156}10156\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10157}10157\ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}}\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})promo;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10158}10158\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10159}10159\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10160}10160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10161}10161\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10162}10162\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10163}10163\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10164}10164\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10165}10165\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10166}10166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10167}10167\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10168}10168\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10169}10169\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10170}10170\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10171}10171\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10172}10172\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10173}10173\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10174}10174\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10175}10175\ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10176}10176\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10177}10177\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10178}10178\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10179}10179\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10180}10180\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10181}10181\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10182}10182\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10183}10183\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10184}10184\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10185}10185\ \ \ \textcolor{comment}{//\ En\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10186}10186\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ \&\&\ from\_row\ ==\ (is\_white\ ?\ 4\ :\ 3))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10187}10187\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ dc\ =\ -\/1;\ dc\ <=\ 1;\ dc\ +=\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10188}10188\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_col\ +\ dc\ ==\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10189}10189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10190}10190\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10191}10191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10192}10192\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10193}10193\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10194}10194\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10195}10195\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10196}10196\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10197}10197\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ pawn;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10198}10198\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10199}10199\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10200}10200\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10201}10201\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10202}10202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10203}10203\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10204}10204\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10205}10205\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10206}10206\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10207}10207\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10208}10208\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10209}10209\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10213}\mbox{\hyperlink{game__task_8c_a62e1a3f62089cca625cf6121749115b1}{10213}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a62e1a3f62089cca625cf6121749115b1}{game\_generate\_knight\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10214}10214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10215}10215\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ knight\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10216}10216\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10217}10217\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10218}10218\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10219}10219\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ from\_col\ +\ \mbox{\hyperlink{game__task_8c_aa8992a10c771c05333aaea769d0cc506}{knight\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10220}10220\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10221}10221\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10222}10222\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10223}10223\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10224}10224\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10225}10225\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10226}10226\ \ \ \ \ \textcolor{comment}{//\ Skip\ if\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10227}10227\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10228}10228\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10229}10229\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10230}10230\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10231}10231\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10232}10232\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10233}10233\ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10234}10234\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10235}10235\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10236}10236\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10237}10237\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10238}10238\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ knight;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10239}10239\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10240}10240\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10241}10241\ \ \ \ \ \ \ \ \ (target\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}}\ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10242}10242\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10243}10243\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10244}10244\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10245}10245\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10246}10246\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10247}10247\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10248}10248\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10252}\mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{10252}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10253}10253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \textcolor{keyword}{const}\ int8\_t\ directions[][2],}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10254}10254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_directions)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10255}10255\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10256}10256\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10257}10257\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ num\_directions;\ d++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10258}10258\ \ \ \ \ \textcolor{keywordtype}{int}\ dr\ =\ directions[d][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10259}10259\ \ \ \ \ \textcolor{keywordtype}{int}\ dc\ =\ directions[d][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10260}10260\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10261}10261\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ dr,\ to\_col\ =\ from\_col\ +\ dc;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10262}10262\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col);\ to\_row\ +=\ dr,\ to\_col\ +=\ dc)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10263}10263\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10264}10264\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10265}10265\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10266}10266\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ move\ to\ square\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10267}10267\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10268}10268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10269}10269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10270}10270\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10271}10271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10272}10272\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10273}10273\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10274}10274\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10275}10275\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10276}10276\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10277}10277\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10278}10278\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10279}10279\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10280}10280\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10281}10281\ \ \ \ \ \ \ \ \ \ \ (target\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}}\ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10282}10282\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10283}10283\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10284}10284\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10285}10285\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10286}10286\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10287}10287\ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ if\ we\ hit\ any\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10288}10288\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (target\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10289}10289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10290}10290\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10291}10291\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10292}10292\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10293}10293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10297}\mbox{\hyperlink{game__task_8c_adb84cfa34e63ffebf55a5fc8784eb0a9}{10297}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_adb84cfa34e63ffebf55a5fc8784eb0a9}{game\_generate\_king\_moves}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10298}10298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10299}10299\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10300}10300\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10301}10301\ \ \ \textcolor{comment}{//\ Normal\ king\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10302}10302\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10303}10303\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_row\ =\ from\_row\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][0];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10304}10304\ \ \ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ from\_col\ +\ \mbox{\hyperlink{game__task_8c_a7ba91d42df01587a1fa707b8a6e65c8c}{king\_moves}}[i][1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10305}10305\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10306}10306\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10307}10307\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10308}10308\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10309}10309\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ target\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10310}10310\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10311}10311\ \ \ \ \ \textcolor{comment}{//\ Skip\ if\ occupied\ by\ own\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10312}10312\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(target,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10313}10313\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10314}10314\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10315}10315\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10316}10316\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10317}10317\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10318}10318\ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10319}10319\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10320}10320\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10321}10321\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ to\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10322}10322\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10323}10323\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10324}10324\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ target;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10325}10325\ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10326}10326\ \ \ \ \ \ \ \ \ (target\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ ?\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a81d6017982215bfb2df43b04360c21f7}{MOVE\_TYPE\_NORMAL}}\ :\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0c1ae66eb0f22d3d3da0216c3c4a4c43}{MOVE\_TYPE\_CAPTURE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10327}10327\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10328}10328\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a3d771c47f735ab5e75fee68915b073fc}{game\_simulate\_move\_check}}(move,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10329}10329\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10330}10330\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10331}10331\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10332}10332\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10333}10333\ \ \ \textcolor{comment}{//\ Castling\ -\/\ FIXED:\ Use\ proper\ bounds\ checking\ and\ correct\ coordinates}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10334}10334\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10335}10335\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Can't\ castle\ when\ in\ check}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10336}10336\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10337}10337\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10338}10338\ \ \ \ \ \textcolor{comment}{//\ White\ kingside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10339}10339\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][5]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10340}10340\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][6]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10341}10341\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 5,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10342}10342\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 6,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10343}10343\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10344}10344\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10345}10345\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ ED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10346}10346\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10347}10347\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10348}10348\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ ED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10349}10349\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10350}10350\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10351}10351\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10352}10352\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10353}10353\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10354}10354\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10355}10355\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10356}10356\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10357}10357\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10358}10358\ \ \ \ \ \textcolor{comment}{//\ White\ queenside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10359}10359\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][1]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10360}10360\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][2]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[0][3]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10361}10361\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 2,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10362}10362\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(0,\ 3,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10363}10363\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10364}10364\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10365}10365\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ ED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10366}10366\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10367}10367\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10368}10368\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ ED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10369}10369\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10370}10370\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10371}10371\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10372}10372\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10373}10373\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10374}10374\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10375}10375\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10376}10376\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10377}10377\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10378}10378\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10379}10379\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !\mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10380}10380\ \ \ \ \ \textcolor{comment}{//\ Black\ kingside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10381}10381\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][5]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10382}10382\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][6]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10383}10383\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 5,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10384}10384\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 6,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10385}10385\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10386}10386\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10387}10387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ ED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10388}10388\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10389}10389\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10390}10390\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ ED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10391}10391\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10392}10392\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10393}10393\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 6;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10394}10394\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10395}10395\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10396}10396\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10397}10397\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10398}10398\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10399}10399\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10400}10400\ \ \ \ \ \textcolor{comment}{//\ Black\ queenside\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10401}10401\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][1]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10402}10402\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][2]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[7][3]\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10403}10403\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 2,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10404}10404\ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_a719de74e100448e17548867befc43a1b}{game\_is\_square\_attacked}}(7,\ 3,\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10405}10405\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10406}10406\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ >=\ 128)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10407}10407\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ ED:\ Proper\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10408}10408\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10409}10409\ \ \ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[\mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10410}10410\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ =\ from\_row;\ \textcolor{comment}{//\ ED:\ Use\ actual\ king\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10411}10411\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ =\ from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10412}10412\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ =\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10413}10413\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ =\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10414}10414\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ =\ king;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10415}10415\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10416}10416\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ =\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10417}10417\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10418}10418\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10419}10419\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10420}10420\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10421}10421\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10422}10422\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10423}10423\ \textcolor{comment}{//\ MAIN\ MOVE\ GENERATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10424}10424\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10425}10425\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10429}\mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{10429}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10430}10430\ \ \ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10431}10431\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10432}10432\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10433}10433\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10434}10434\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10435}10435\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10436}10436\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(piece,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}}))}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10437}10437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10438}10438\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10439}10439\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10440}10440\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10441}10441\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10442}10442\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_aba34fdb2616d1c154dadc9d122338c80}{game\_generate\_pawn\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10443}10443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10444}10444\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10445}10445\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10446}10446\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10447}10447\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a62e1a3f62089cca625cf6121749115b1}{game\_generate\_knight\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10448}10448\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10449}10449\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10450}10450\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10451}10451\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10452}10452\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10453}10453\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10454}10454\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10455}10455\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10456}10456\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10457}10457\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10458}10458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10459}10459\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10460}10460\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10461}10461\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10462}10462\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_a74a955b0f7a508aa10c622ae8d7563eb}{bishop\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10463}10463\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a64663ccff188c00244631bbeb85da3e1}{game\_generate\_sliding\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}},\ \mbox{\hyperlink{game__task_8c_ad0b01bbbe6f8ae3314cff69f772b691f}{rook\_dirs}},\ 4);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10464}10464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10465}10465\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10466}10466\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10467}10467\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10468}10468\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_adb84cfa34e63ffebf55a5fc8784eb0a9}{game\_generate\_king\_moves}}(row,\ col,\ \mbox{\hyperlink{game__task_8c_ac5a8201c5f6bbce303ec36500d67b6d8}{player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10469}10469\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10470}10470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10471}10471\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10472}10472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10473}10473\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10474}10474\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10475}10475\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10476}10476\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10477}10477\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a5b26569ffdd2946a02907fb9875307cf}{legal\_moves\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10478}10478\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10479}10479\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10480}10480\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10481}10481\ \textcolor{comment}{//\ MOVE\ EXECUTION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10482}10482\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10483}10483\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10487}\mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{10487}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a5ab63491e32394b086a3c916db195c31}{game\_execute\_move\_enhanced}}(\mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10488}10488\ \ \ \textcolor{keywordflow}{if}\ (move\ ==\ NULL)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10489}10489\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10490}10490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10491}10491\ \ \ \textcolor{comment}{//\ Nastavit\ typ\ posledního\ tahu\ pro\ detekci\ speciálních\ šachmatů}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10492}10492\ \ \ \textcolor{keywordflow}{switch}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10493}10493\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a23c92ea1d63a461f09485c3762e3656d}{MOVE\_TYPE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10494}10494\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ captured\ pawn}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10495}10495\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}][\mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10496}10496\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a5e9afb17a5a3d533a10a72f8365c2fee}{LAST\_MOVE\_EN\_PASSANT}};\ \textcolor{comment}{//\ Označit\ jako\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10497}10497\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚔️\ En\ passant\ move\ executed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10498}10498\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10499}10499\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10500}10500\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10501}10501\ \ \ \ \ \textcolor{comment}{//\ Věž\ se\ nepřesunuje\ automaticky\ -\/\ hráč\ ji\ musí\ přesunout\ sám}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10502}10502\ \ \ \ \ \textcolor{comment}{//\ Věž\ zůstává\ na\ původní\ pozici,\ animace\ donutí\ hráče\ ji\ přesunout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10503}10503\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}};\ \textcolor{comment}{//\ Označit\ jako\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10504}10504\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Kingside\ castling\ -\/\ rook\ stays\ in\ place,\ waiting\ for\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10505}10505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}player\ to\ move\ it"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10506}10506\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10507}10507\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10508}10508\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a9402d70bce003961f9bef482a0f05abc}{MOVE\_TYPE\_CASTLE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10509}10509\ \ \ \ \ \textcolor{comment}{//\ Věž\ se\ nepřesunuje\ automaticky\ -\/\ hráč\ ji\ musí\ přesunout\ sám}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10510}10510\ \ \ \ \ \textcolor{comment}{//\ Věž\ zůstává\ na\ původní\ pozici,\ animace\ donutí\ hráče\ ji\ přesunout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10511}10511\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428a74b328b19fe88255418ae15211170d9e}{LAST\_MOVE\_CASTLING}};\ \textcolor{comment}{//\ Označit\ jako\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10512}10512\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Queenside\ castling\ -\/\ rook\ stays\ in\ place,\ waiting\ for\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10513}10513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}player\ to\ move\ it"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10514}10514\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10515}10515\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10516}10516\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10517}10517\ \ \ \ \ \textcolor{comment}{//\ Handle\ promotion\ -\/\ the\ piece\ will\ be\ set\ below}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10518}10518\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428af03c0fabe13195d12257c4e19af68013}{LAST\_MOVE\_PROMOTION}};\ \textcolor{comment}{//\ Označit\ jako\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10519}10519\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10520}10520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10521}10521\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10522}10522\ \ \ \ \ \textcolor{comment}{//\ Normal\ move\ or\ capture\ -\/\ nothing\ special\ needed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10523}10523\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a4310fc073a4924b686ab768c91bb6766}{last\_move\_type}}\ =\ \mbox{\hyperlink{game__task_8c_a35ee807e9b8fc9f96e7a97f77e38b428adaa3371423259563b378fbafc75fd5d7}{LAST\_MOVE\_NORMAL}};\ \textcolor{comment}{//\ Resetovat\ na\ normální\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10524}10524\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10525}10525\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10526}10526\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10527}10527\ \ \ \textcolor{comment}{//\ Make\ the\ basic\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10528}10528\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10529}10529\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10530}10530\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10531}10531\ \ \ \textcolor{comment}{//\ Handle\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10532}10532\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a0616f79303505961b7054938d27c5a0f}{MOVE\_TYPE\_PROMOTION}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10533}10533\ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat\ zda\ je\ promotion\_state.pending}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10534}10534\ \ \ \ \ \textcolor{comment}{//\ Pokud\ ano,\ pak\ uživatel\ ještě\ nevybral\ figurku\ -\/\ ponechat\ pěšce\ na\ místě}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10535}10535\ \ \ \ \ \textcolor{comment}{//\ Pokud\ ne,\ pak\ promotion\_piece\ je\ nastaveno\ a\ můžeme\ provést\ promoci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10536}10536\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10537}10537\ \ \ \ \ \ \ \textcolor{comment}{//\ Promotion\ je\ pending\ -\/\ uživatel\ ještě\ nevybral\ figurku}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10538}10538\ \ \ \ \ \ \ \textcolor{comment}{//\ Ponechat\ pěšce\ na\ promotion\ rank\ (už\ je\ tam\ přesunutý\ v\ předchozím}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10539}10539\ \ \ \ \ \ \ \textcolor{comment}{//\ kroku)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10540}10540\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10541}10541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⏸️\ \ Promotion\ pending\ -\/\ keeping\ pawn\ at\ \%c\%d,\ waiting\ for\ user\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10542}10542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}selection"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10543}10543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}},\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10544}10544\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10545}10545\ \ \ \ \ \ \ \textcolor{comment}{//\ Promotion\ není\ pending\ -\/\ promotion\_piece\ je\ nastaveno,\ provést\ promoci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10546}10546\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10547}10547\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10548}10548\ \ \ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10549}10549\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10550}10550\ \ \ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10551}10551\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10552}10552\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}]\ =\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10553}10553\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promotion\ executed\ immediately\ with\ piece\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10554}10554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_ad18a1ba58a42a71b7004dc78a654a0dc}{promotion\_piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10555}10555\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10556}10556\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10557}10557\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10558}10558\ \ \ \textcolor{comment}{//\ Update\ castling\ flags}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10559}10559\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10560}10560\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10561}10561\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10562}10562\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10563}10563\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10564}10564\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10565}10565\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10566}10566\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10567}10567\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10568}10568\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10569}10569\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10570}10570\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10571}10571\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10572}10572\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10573}10573\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10574}10574\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10575}10575\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10576}10576\ \ \ \textcolor{comment}{//\ Update\ en\ passant\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10577}10577\ \ \ \mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10578}10578\ \ \ \textcolor{keywordflow}{if}\ ((move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10579}10579\ \ \ \ \ \ \ abs(move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ -\/\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}})\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10580}10580\ \ \ \ \ \textcolor{comment}{//\ Pawn\ made\ a\ double\ move\ -\/\ enable\ en\ passant}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10581}10581\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a01bb301cbe8700c281dbf823fc412923}{en\_passant\_available}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10582}10582\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a088deaf2db03b864150aa4b907da0ce7}{en\_passant\_target\_row}}\ =\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ +\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}})\ /\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10583}10583\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a5d18dd08e04b69848244304316e48083}{en\_passant\_target\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10584}10584\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a34994c75ae9b319265448cbd9b9a2c0c}{en\_passant\_victim\_row}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10585}10585\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a595cee17e3316a52530de0e4ecef9222}{en\_passant\_victim\_col}}\ =\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10586}10586\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10587}10587\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10588}10588\ \ \ \textcolor{comment}{//\ Update\ fifty-\/move\ counter}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10589}10589\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ ||\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aec665ac464d3a9223022d74795a4a8ab}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10590}10590\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a16faacd78ba6e8d0036fe058422762d0}{captured\_piece}}\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10591}10591\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10592}10592\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10593}10593\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aa37fa03c5c45c9a925b4b41ac3cdd4f2}{fifty\_move\_counter}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10594}10594\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10595}10595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10596}10596\ \ \ \textcolor{comment}{//\ Update\ move\ counters\ and\ statistics}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10597}10597\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10598}10598\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad3290a04aa3aca9932f3567c262e5a68}{white\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10599}10599\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10600}10600\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a717ec25ef6ee64f8fe8a8749fe9b50f4}{black\_moves\_count}}++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10601}10601\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10602}10602\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10603}10603\ \ \ \textcolor{comment}{//\ NEMĚNIT\ HRÁČE\ ZDE\ -\/\ hráč\ se\ mění\ v\ game\_execute\_move()\ po}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10604}10604\ \ \ \textcolor{comment}{//\ dokončení\ tahu\ Switch\ players\ -\/\ REMOVED:\ player\ is\ switched\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10605}10605\ \ \ \textcolor{comment}{//\ game\_execute\_move()\ after\ move\ execution}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10606}10606\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10607}10607\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10608}10608\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10609}10609\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10610}10610\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10611}10611\ \textcolor{comment}{//\ ENHANCED\ BOARD\ DISPLAY}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10612}10612\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10613}10613\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10617}\mbox{\hyperlink{game__task_8c_aee07708800ca9d9eee519b40b78f71d3}{10617}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_aee07708800ca9d9eee519b40b78f71d3}{game\_print\_board\_enhanced}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10618}10618\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╔═══════════════════════════════╗"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10619}10619\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}║\ \ \ \ \ \ \ \ CHESS\ BOARD\ \ \ \ \ \ \ \ \ \ \ \ ║"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10620}10620\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}╚═══════════════════════════════╝"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10621}10621\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10622}10622\ \ \ \textcolor{comment}{//\ Print\ board\ from\ rank\ 8\ to\ rank\ 1}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10623}10623\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 7;\ row\ >=\ 0;\ row-\/-\/)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10624}10624\ \ \ \ \ \textcolor{keywordtype}{char}\ line[64]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10625}10625\ \ \ \ \ \textcolor{keywordtype}{char}\ *ptr\ =\ line;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10626}10626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10627}10627\ \ \ \ \ ptr\ +=\ sprintf(ptr,\ \textcolor{stringliteral}{"{}\ \%d\ │"{}},\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10628}10628\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10629}10629\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10630}10630\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10631}10631\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *symbol;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10632}10632\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10633}10633\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10634}10634\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10635}10635\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♙"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10636}10636\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10637}10637\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10638}10638\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♘"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10639}10639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10640}10640\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10641}10641\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♗"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10642}10642\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10643}10643\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10644}10644\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♖"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10645}10645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10646}10646\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10647}10647\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♕"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10648}10648\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10649}10649\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10650}10650\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♔"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10651}10651\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10652}10652\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10653}10653\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♟"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10654}10654\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10655}10655\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10656}10656\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♞"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10657}10657\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10658}10658\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10659}10659\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♝"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10660}10660\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10661}10661\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10662}10662\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♜"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10663}10663\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10664}10664\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10665}10665\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♛"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10666}10666\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10667}10667\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10668}10668\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}♚"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10669}10669\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10670}10670\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10671}10671\ \ \ \ \ \ \ \ \ symbol\ =\ \textcolor{stringliteral}{"{}·"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10672}10672\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10673}10673\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10674}10674\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10675}10675\ \ \ \ \ \ \ ptr\ +=\ sprintf(ptr,\ \textcolor{stringliteral}{"{}\ \%s\ │"{}},\ symbol);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10676}10676\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10677}10677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10678}10678\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\%s"{}},\ line);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10679}10679\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10680}10680\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ ├───┼───┼───┼───┼───┼───┼───┼───┤"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10681}10681\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10682}10682\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10683}10683\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10684}10684\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ └───┴───┴───┴───┴───┴───┴───┴───┘"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10685}10685\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ \ \ \ a\ \ \ b\ \ \ c\ \ \ d\ \ \ e\ \ \ f\ \ \ g\ \ \ h\ \ "{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10686}10686\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10687}10687\ \ \ \textcolor{comment}{//\ Print\ game\ status}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10688}10688\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10689}10689\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ Status:\ \%s\ to\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10690}10690\ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10691}10691\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Move\ \#\%lu"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10692}10692\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10693}10693\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10694}10694\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ \ CHECK!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10695}10695\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10696}10696\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10697}10697\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10698}10698\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10699}10699\ \textcolor{comment}{//\ INTEGRATION\ WITH\ EXISTING\ GAME\ TASK}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10700}10700\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10701}10701\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10705}\mbox{\hyperlink{game__task_8c_ac096591c429faefd9993ddcc3d87bf11}{10705}}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ \mbox{\hyperlink{game__task_8c_ac096591c429faefd9993ddcc3d87bf11}{game\_validate\_move\_enhanced}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10706}10706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10707}10707\ \ \ \textcolor{comment}{//\ Basic\ coordinate\ validation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10708}10708\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(from\_row,\ from\_col)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10709}10709\ \ \ \ \ \ \ !\mbox{\hyperlink{game__task_8c_ad58024344b5777da494b4a35f8250c32}{game\_is\_valid\_square}}(to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10710}10710\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ad0f6ecbd8e5bf7852d4298269a812f33}{MOVE\_ERROR\_INVALID\_COORDINATES}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10711}10711\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10712}10712\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10713}10713\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ piece\ at\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10714}10714\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10715}10715\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10716}10716\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1ae25a34f37cd35bcd83411aecc8f439f1}{MOVE\_ERROR\_NO\_PIECE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10717}10717\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10718}10718\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10719}10719\ \ \ \textcolor{comment}{//\ Check\ if\ it's\ player's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10720}10720\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a7f31b3ea42f40399386306ba3d88cb9c}{game\_is\_own\_piece}}(piece,\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10721}10721\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a5723bd10d7972babaac58c5fa122371e}{MOVE\_ERROR\_WRONG\_COLOR}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10722}10722\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10723}10723\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10724}10724\ \ \ \textcolor{comment}{//\ Generate\ all\ legal\ moves\ and\ check\ if\ this\ move\ is\ in\ the\ list}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10725}10725\ \ \ uint32\_t\ num\_legal\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10726}10726\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10727}10727\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ num\_legal;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10728}10728\ \ \ \ \ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move\ =\ \&\mbox{\hyperlink{game__task_8c_a743bcb69a1d8c2d43776b4320477738a}{legal\_moves\_buffer}}[i];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10729}10729\ \ \ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_a7e73820058cbbef9a1cfa47dfd1e5f9e}{from\_row}}\ ==\ from\_row\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a8ff4fcb8d2a94dfbc8f099a4815534c8}{from\_col}}\ ==\ from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10730}10730\ \ \ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__extended__t_a287d533872003ff749138ed16e12d299}{to\_row}}\ ==\ to\_row\ \&\&\ move-\/>\mbox{\hyperlink{structchess__move__extended__t_aa5a0ffb4e21787a7ad0b6843b296ceda}{to\_col}}\ ==\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10731}10731\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}};\ \textcolor{comment}{//\ Move\ is\ legal}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10732}10732\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10733}10733\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10734}10734\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10735}10735\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1adbc56938feb4f9a70401c3190d77f9de}{MOVE\_ERROR\_ILLEGAL\_MOVE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10736}10736\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10737}10737\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10738}10738\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10739}10739\ \textcolor{comment}{//\ MATRIX\ LED\ WORKFLOW\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10740}10740\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10741}10741\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10747}\mbox{\hyperlink{game__task_8c_ad6aef74bc8447dabf92abcb081340931}{10747}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_ad6aef74bc8447dabf92abcb081340931}{game\_detect\_new\_game\_setup}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10748}10748\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ jestli\ jsou\ řádky\ 1,\ 2,\ 7,\ 8\ obsazené\ figurkami}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10749}10749\ \ \ \textcolor{comment}{//\ a\ řádky\ 3,\ 4,\ 5,\ 6\ jsou\ prázdné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10750}10750\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10751}10751\ \ \ \textcolor{comment}{//\ Zkontrolovat\ řádky\ 0,\ 1\ (bílé\ figurky)\ a\ 6,\ 7\ (černé\ figurky)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10752}10752\ \ \ \textcolor{keywordtype}{bool}\ rows\_0\_1\_6\_7\_occupied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10753}10753\ \ \ \textcolor{keywordtype}{bool}\ rows\_2\_3\_4\_5\_empty\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10754}10754\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10755}10755\ \ \ \textcolor{comment}{//\ Zkontrolovat\ řádky\ 0,\ 1,\ 6,\ 7\ -\/\ musí\ být\ obsazené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10756}10756\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10757}10757\ \ \ \ \ \textcolor{keywordtype}{bool}\ row\_has\_pieces\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10758}10758\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10759}10759\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10760}10760\ \ \ \ \ \ \ \ \ row\_has\_pieces\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10761}10761\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10762}10762\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10763}10763\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10764}10764\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10765}10765\ \ \ \ \ \textcolor{keywordflow}{if}\ ((row\ ==\ 0\ ||\ row\ ==\ 1\ ||\ row\ ==\ 6\ ||\ row\ ==\ 7))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10766}10766\ \ \ \ \ \ \ \textcolor{comment}{//\ Tyto\ řádky\ musí\ být\ obsazené}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10767}10767\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!row\_has\_pieces)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10768}10768\ \ \ \ \ \ \ \ \ rows\_0\_1\_6\_7\_occupied\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10769}10769\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10770}10770\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10771}10771\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (row\ >=\ 2\ \&\&\ row\ <=\ 5)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10772}10772\ \ \ \ \ \ \ \textcolor{comment}{//\ Tyto\ řádky\ musí\ být\ prázdné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10773}10773\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (row\_has\_pieces)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10774}10774\ \ \ \ \ \ \ \ \ rows\_2\_3\_4\_5\_empty\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10775}10775\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10776}10776\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10777}10777\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10778}10778\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10779}10779\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10780}10780\ \ \ \textcolor{keywordtype}{bool}\ is\_starting\_setup\ =\ rows\_0\_1\_6\_7\_occupied\ \&\&\ rows\_2\_3\_4\_5\_empty;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10781}10781\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10782}10782\ \ \ \textcolor{keywordflow}{if}\ (is\_starting\_setup)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10783}10783\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎮\ Starting\ position\ detected:\ rows\ 0,1,6,7\ occupied,\ rows\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10784}10784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2,3,4,5\ empty"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10785}10785\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10786}10786\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10787}10787\ \ \ \textcolor{keywordflow}{return}\ is\_starting\_setup;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10788}10788\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10789}10789\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10798}\mbox{\hyperlink{game__task_8c_a33f0d04999a0cc77d79d2e529a227be1}{10798}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a33f0d04999a0cc77d79d2e529a227be1}{game\_handle\_piece\_lifted}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10799}10799\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🖐️\ Matrix:\ Piece\ lifted\ from\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10800}10800\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10801}10801\ \ \ \textcolor{comment}{//\ Check\ if\ there's\ a\ piece\ at\ the\ square}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10802}10802\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10803}10803\ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10804}10804\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ No\ piece\ to\ lift\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10805}10805\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10806}10806\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10807}10807\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10808}10808\ \ \ \textcolor{comment}{//\ Check\ if\ it's\ the\ current\ player's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10809}10809\ \ \ \textcolor{keywordtype}{bool}\ is\_white\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10810}10810\ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10811}10811\ \ \ \textcolor{keywordtype}{bool}\ is\_current\_player\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ is\_white\_piece)\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10812}10812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ !is\_white\_piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10813}10813\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10814}10814\ \ \ \textcolor{keywordflow}{if}\ (!is\_current\_player)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10815}10815\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Cannot\ lift\ opponent's\ piece\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10816}10816\ \ \ \ \ \ \ \ \ \ \ \ \ \ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10817}10817\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10818}10818\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10819}10819\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10820}10820\ \ \ \textcolor{comment}{//\ Check\ if\ castle\ animation\ is\ active\ and\ this\ is\ a\ rook}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10821}10821\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10822}10822\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_rook\ =\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10823}10823\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10824}10824\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_rook)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10825}10825\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ rook\ is\ being\ lifted\ from\ the\ correct\ position\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10826}10826\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ ==\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10827}10827\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Rook\ lifted\ from\ correct\ position\ for\ castling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10828}10828\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Continue\ with\ normal\ move\ highlighting}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10829}10829\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10830}10830\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rook\ lifted\ from\ wrong\ position\ -\/\ show\ error\ and\ valid\ moves\ from}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10831}10831\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ correct\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10832}10832\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10833}10833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Rook\ lifted\ from\ wrong\ position\ for\ castling:\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10834}10834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(expected:\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10835}10835\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10836}10836\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10837}10837\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ error\ animation\ -\/\ blink\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10838}10838\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10839}10839\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10840}10840\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10841}10841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10842}10842\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10843}10843\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10844}10844\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10845}10845\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10846}10846\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10847}10847\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ valid\ moves\ from\ the\ correct\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10848}10848\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10849}10849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10850}10850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10851}10851\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}),\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10852}10852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10853}10853\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10854}10854\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10855}10855\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10856}10856\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10857}10857\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castle\ animation\ active\ -\/\ only\ rook\ can\ be\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10858}10858\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10859}10859\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10860}10860\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10861}10861\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10862}10862\ \ \ \textcolor{comment}{//\ Show\ possible\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10863}10863\ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10864}10864\ \ \ uint32\_t\ valid\_moves\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10865}10865\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10866}10866\ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10867}10867\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Found\ \%lu\ valid\ moves\ for\ piece\ at\ \%c\%d"{}},\ valid\_moves,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10868}10868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10869}10869\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10870}10870\ \ \ \ \ \textcolor{comment}{//\ Send\ LED\ commands\ to\ highlight\ possible\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10871}10871\ \ \ \ \ \textcolor{comment}{//\ Highlight\ source\ square\ in\ yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10872}10872\ \ \ \ \ \textcolor{comment}{//\ Highlight\ source\ square\ (yellow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10873}10873\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10874}10874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10875}10875\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10876}10876\ \ \ \ \ \textcolor{comment}{//\ Highlight\ possible\ destinations}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10877}10877\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10878}10878\ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10879}10879\ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10880}10880\ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10881}10881\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10882}10882\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ destination\ has\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10883}10883\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10884}10884\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10885}10885\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10886}10886\ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10887}10887\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10888}10888\ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10889}10889\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10890}10890\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10891}10891\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Orange\ for\ opponent's\ pieces\ (capture)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10892}10892\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10893}10893\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10894}10894\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Green\ for\ empty\ squares}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10895}10895\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10896}10896\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10897}10897\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10898}10898\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10899}10899\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ No\ valid\ moves\ for\ piece\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10900}10900\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10901}10901\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10902}10902\ \ \ \textcolor{comment}{//\ Po\ zvednutí\ figurky\ spustit\ animaci\ změny\ hráče\ a\ zobrazit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10903}10903\ \ \ \textcolor{comment}{//\ pohyblivé\ figurky\ (pouze\ pokud\ není\ aktivní\ animace\ rosady\ a\ není}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10904}10904\ \ \ \textcolor{comment}{//\ očekávána\ rosada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10905}10905\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10906}10906\ \ \ \ \ \textcolor{comment}{//\ After\ piece\ is\ lifted,\ show\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10907}10907\ \ \ \ \ \textcolor{comment}{//\ This\ completes\ the\ cycle\ as\ requested\ by\ the\ user}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10908}10908\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10909}10909\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10910}10910\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10911}10911\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10920}\mbox{\hyperlink{game__task_8c_a696a56f72aa0226d23952ccbdfd20cd7}{10920}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a696a56f72aa0226d23952ccbdfd20cd7}{game\_handle\_piece\_placed}}(uint8\_t\ row,\ uint8\_t\ col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10921}10921\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✋\ Matrix:\ Piece\ placed\ at\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10922}10922\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10923}10923\ \ \ \textcolor{comment}{//\ Detekce\ nové\ hry\ po\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10924}10924\ \ \ \textcolor{comment}{//\ Zkontrolovat,\ jestli\ se\ figurky\ rozestavily\ na\ startovní\ pozice\ (řádky\ 1,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10925}10925\ \ \ \textcolor{comment}{//\ 2,\ 7,\ 8)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10926}10926\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ad6aef74bc8447dabf92abcb081340931}{game\_detect\_new\_game\_setup}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10927}10927\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10928}10928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ NEW\ GAME\ DETECTED!\ Pieces\ arranged\ in\ starting\ positions"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10929}10929\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10930}10930\ \ \ \ \ \textcolor{comment}{//\ Zastavit\ všechny\ animace}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10931}10931\ \ \ \ \ \mbox{\hyperlink{unified__animation__manager_8h_a00e3ed0913caba4f42ed8749b9e41d6f}{unified\_animation\_stop\_all}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10932}10932\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10933}10933\ \ \ \ \ \textcolor{comment}{//\ Spustit\ novou\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10934}10934\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a57e990b9360540c1ba82ea3d5a32cf44}{game\_start\_new\_game}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10935}10935\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10936}10936\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Ukončit\ -\/\ nová\ hra\ byla\ spuštěna}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10937}10937\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10938}10938\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10939}10939\ \ \ \textcolor{comment}{//\ Check\ if\ castle\ animation\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10940}10940\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10941}10941\ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10942}10942\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10943}10943\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castle\ animation\ active\ -\/\ checking\ if\ rook\ was\ placed\ correctly"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10944}10944\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10945}10945\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ is\ a\ rook\ piece\ being\ placed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10946}10946\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10947}10947\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_rook\ =\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10948}10948\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10949}10949\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_rook)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10950}10950\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ rook\ was\ placed\ on\ correct\ position\ for\ castling}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10951}10951\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ ==\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ \&\&\ col\ ==\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10952}10952\ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Rook\ placed\ on\ correct\ position\ for\ castling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10953}10953\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ move\ will\ be\ completed\ in\ game\_handle\_matrix\_move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10954}10954\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10955}10955\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10956}10956\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rook\ placed\ on\ wrong\ position\ -\/\ show\ error}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10957}10957\ \ \ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10958}10958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Rook\ placed\ on\ wrong\ position\ for\ castling:\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10959}10959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}(expected:\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10960}10960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10961}10961\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10962}10962\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ error\ animation\ -\/\ blink\ red\ then\ show\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10963}10963\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10964}10964\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10965}10965\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Blink\ the\ wrong\ position\ red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10966}10966\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10967}10967\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10968}10968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10969}10969\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10970}10970\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10971}10971\ \ \ \ \ \ \ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(200));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10972}10972\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10973}10973\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10974}10974\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ correct\ rook\ position\ and\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10975}10975\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10976}10976\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10977}10977\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10978}10978\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}),\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10979}10979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10980}10980\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10981}10981\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10982}10982\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10983}10983\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10984}10984\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10985}10985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🏰\ Castle\ animation\ active\ -\/\ waiting\ for\ rook\ to\ be\ moved"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10986}10986\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10987}10987\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10988}10988\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10989}10989\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10990}10990\ \ \ \textcolor{comment}{//\ Clear\ only\ board\ LEDs}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10991}10991\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10992}10992\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10993}10993\ \ \ \textcolor{comment}{//\ Po\ umístění\ figurky\ spustit\ animaci\ změny\ hráče\ a\ zobrazit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10994}10994\ \ \ \textcolor{comment}{//\ pohyblivé\ figurky\ (pouze\ pokud\ není\ aktivní\ animace\ rosady\ a\ není}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10995}10995\ \ \ \textcolor{comment}{//\ očekávána\ rosada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10996}10996\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10997}10997\ \ \ \ \ \textcolor{comment}{//\ After\ piece\ is\ placed,\ show\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10998}10998\ \ \ \ \ \textcolor{comment}{//\ This\ completes\ the\ cycle\ as\ requested\ by\ the\ user}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l10999}10999\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11000}11000\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11001}11001\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11002}11002\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11013}\mbox{\hyperlink{game__task_8c_a73c95d04856c50d53520e346abedf4da}{11013}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a73c95d04856c50d53520e346abedf4da}{game\_handle\_matrix\_move}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,\ uint8\_t\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11014}11014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11015}11015\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎯\ Matrix:\ Complete\ move\ \%c\%d\ -\/>\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11016}11016\ \ \ \ \ \ \ \ \ \ \ \ from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11017}11017\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11018}11018\ \ \ \textcolor{comment}{//\ Check\ if\ castle\ animation\ is\ active}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11019}11019\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11020}11020\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{game\_complete\_castle\_animation}}(from\_row,\ from\_col,\ to\_row,\ to\_col))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11021}11021\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Castle\ animation\ completed\ via\ matrix\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11022}11022\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11023}11023\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11024}11024\ \ \ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11025}11025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ rook\ move\ for\ castling\ -\/\ waiting\ for\ correct\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11026}11026\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11027}11027\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11028}11028\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11029}11029\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11030}11030\ \ \ \textcolor{comment}{//\ Convert\ matrix\ event\ to\ chess\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11031}11031\ \ \ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ move\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11032}11032\ \ \ \ \ \ \ .from\_row\ =\ from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11033}11033\ \ \ \ \ \ \ .from\_col\ =\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11034}11034\ \ \ \ \ \ \ .to\_row\ =\ to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11035}11035\ \ \ \ \ \ \ .to\_col\ =\ to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11036}11036\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11037}11037\ \ \ \ \ \ \ .piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[from\_row][from\_col],\ \textcolor{comment}{//\ Skutečná\ figurka\ ze\ zdrojového\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11038}11038\ \ \ \ \ \ \ .captured\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11039}11039\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[to\_row][to\_col],\ \textcolor{comment}{//\ Skutečná\ figurka\ z\ cílového\ pole}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11040}11040\ \ \ \ \ \ \ .timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11041}11041\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11042}11042\ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Validace\ tahu\ před\ voláním\ game\_execute\_move\ (stejně}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11043}11043\ \ \ \textcolor{comment}{//\ jako\ UART\ flow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11044}11044\ \ \ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1}{move\_error\_t}}\ error\ =\ \mbox{\hyperlink{game__task_8c_a20c746cc968a038cbdf28e01a9dd8307}{game\_is\_valid\_move}}(\&move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11045}11045\ \ \ \textcolor{keywordflow}{if}\ (error\ !=\ \mbox{\hyperlink{chess__types_8h_ad29cfdba222dc553f977a701312d18c1a4100d3557901ed1bf26cadf95436db60}{MOVE\_ERROR\_NONE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11046}11046\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ matrix\ move\ rejected:\ \%c\%d\ -\/>\ \%c\%d\ (error:\ \%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11047}11047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ from\_col,\ from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,\ error);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11048}11048\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11049}11049\ \ \ \ \ \textcolor{comment}{//\ Clear\ LEDs\ on\ invalid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11050}11050\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11051}11051\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11052}11052\ \ \ \ \ \textcolor{comment}{//\ Show\ error\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11053}11053\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(from\_row,\ from\_col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11054}11054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red\ for\ source}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11055}11055\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(to\_row,\ to\_col),\ 255,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11056}11056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Red\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11057}11057\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11058}11058\ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Reject\ invalid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11059}11059\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11060}11060\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11061}11061\ \ \ \textcolor{comment}{//\ Detekce\ rosady\ před\ voláním\ game\_execute\_move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11062}11062\ \ \ \textcolor{keywordtype}{bool}\ is\_castling\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11063}11063\ \ \ \ \ \ \ (move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ move.\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11064}11064\ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11065}11065\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11066}11066\ \ \ \textcolor{keywordflow}{if}\ (is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11067}11067\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ CASTLING\ DETECTED\ in\ matrix\ move:\ \%c\%d\ -\/>\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11068}11068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ move.\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}},\ move.\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ move.\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11069}11069\ \ \ \ \ \ \ \ \ \ \ \ \ \ move.\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11070}11070\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11071}11071\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11072}11072\ \ \ \textcolor{comment}{//\ Execute\ move\ (already\ validated)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11073}11073\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4ec624bee837dfc3ef8429dd6edfc961}{game\_execute\_move}}(\&move))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11074}11074\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Matrix\ move\ executed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11075}11075\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11076}11076\ \ \ \ \ \textcolor{comment}{//\ KRITICKÁ\ OPRAVA:\ Kontrola\ checkmate/stalemate\ po\ každém\ tahu!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11077}11077\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11078}11078\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11079}11079\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11080}11080\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11081}11081\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🎉\ Game\ finished\ detected\ in\ matrix\ move!"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11082}11082\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11083}11083\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11084}11084\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_castling)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11085}11085\ \ \ \ \ \ \ \textcolor{comment}{//\ Pro\ rosadu\ nespouštět\ game\_highlight\_opponent\_pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11086}11086\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ move\ completed\ -\/\ waiting\ for\ rook\ animation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11087}11087\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11088}11088\ \ \ \ \ \ \ \textcolor{comment}{//\ Po\ úspěšném\ tahu\ spustit\ animaci\ změny\ hráče\ a\ zobrazit}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11089}11089\ \ \ \ \ \ \ \textcolor{comment}{//\ pohyblivé\ figurky\ (pouze\ pokud\ není\ aktivní\ animace\ rosady\ a\ není}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11090}11090\ \ \ \ \ \ \ \textcolor{comment}{//\ očekávána\ rosada)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11091}11091\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}()\ \&\&\ !\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11092}11092\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ After\ successful\ move,\ show\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11093}11093\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11094}11094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11095}11095\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11096}11096\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11097}11097\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ matrix\ move\ rejected"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11098}11098\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11099}11099\ \ \ \ \ \textcolor{comment}{//\ Clear\ LEDs\ on\ invalid\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11100}11100\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11101}11101\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11102}11102\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11103}11103\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11107}\mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{11107}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ad511756b40fd92878c0b2dde47feea60}{game\_highlight\_opponent\_pieces}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11108}11108\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Highlighting\ opponent\ pieces\ that\ can\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11109}11109\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11110}11110\ \ \ \textcolor{comment}{//\ LED\ command\ queue\ removed\ -\/\ using\ direct\ LED\ calls\ now}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11111}11111\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11112}11112\ \ \ \textcolor{comment}{//\ Switch\ to\ opponent's\ perspective\ temporarily}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11113}11113\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ opponent\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11114}11114\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11115}11115\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11116}11116\ \ \ \textcolor{comment}{//\ Find\ all\ pieces\ that\ the\ opponent\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11117}11117\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11118}11118\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11119}11119\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11120}11120\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11121}11121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11122}11122\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11123}11123\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ it's\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11124}11124\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11125}11125\ \ \ \ \ \ \ \ \ \ \ (opponent\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11126}11126\ \ \ \ \ \ \ \ \ \ \ \ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11127}11127\ \ \ \ \ \ \ \ \ \ \ (opponent\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11128}11128\ \ \ \ \ \ \ \ \ \ \ \ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11129}11129\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11130}11130\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11131}11131\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ piece\ has\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11132}11132\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11133}11133\ \ \ \ \ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11134}11134\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11135}11135\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11136}11136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11137}11137\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Highlight\ this\ piece\ in\ blue\ (indicating\ it\ can\ move)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11138}11138\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 0,\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11139}11139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255);\ \textcolor{comment}{//\ Blue\ for\ pieces\ that\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11140}11140\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11141}11141\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11142}11142\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11143}11143\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11144}11144\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11145}11145\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11150}\mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{11150}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_ae1fac0ebfd2541173adbc7d7d5639605}{game\_process\_promotion\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11151}11151\ \ \ \textcolor{keywordflow}{if}\ (!cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11152}11152\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Invalid\ promotion\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11153}11153\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11154}11154\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11155}11155\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11156}11156\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Processing\ promotion\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11157}11157\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11158}11158\ \ \ \textcolor{comment}{//\ \#2\ \&\ \#3:\ Atomic\ check\ with\ mutex\ to\ prevent\ double\ execution}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11159}11159\ \ \ \textcolor{comment}{//\ Použít\ recursive\ mutex\ funkce\ (promotion\_mutex\ je\ recursive\ mutex)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11160}11160\ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTakeRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}},\ pdMS\_TO\_TICKS(100))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11161}11161\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ acquire\ promotion\ mutex"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11162}11162\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11163}11163\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11164}11164\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11165}11165\ \ \ \textcolor{comment}{//\ Check\ if\ promotion\ is\ still\ pending\ (might\ have\ been\ processed\ by\ another}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11166}11166\ \ \ \textcolor{comment}{//\ task)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11167}11167\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11168}11168\ \ \ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11169}11169\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ Promotion\ already\ processed\ by\ another\ task"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11170}11170\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11171}11171\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11172}11172\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11173}11173\ \ \ \textcolor{comment}{//\ CRITICAL:\ Keep\ mutex\ held\ during\ ENTIRE\ execution\ to\ prevent\ race!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11174}11174\ \ \ \textcolor{comment}{//\ DO\ NOT\ release\ here\ -\/\ release\ only\ after\ completion\ or\ on\ error}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11175}11175\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11176}11176\ \ \ \textcolor{comment}{//\ Determine\ promotion\ choice\ (default\ to\ Queen\ if\ invalid\ or\ not\ specified)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11177}11177\ \ \ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice\ =\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11178}11178\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11179}11179\ \ \ \textcolor{keywordflow}{if}\ (cmd-\/>\mbox{\hyperlink{structchess__move__command__t_ae6e4449e8345fed34c9c685eba9f1363}{promotion\_choice}}\ <=\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11180}11180\ \ \ \ \ choice\ =\ (\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}})cmd-\/>\mbox{\hyperlink{structchess__move__command__t_ae6e4449e8345fed34c9c685eba9f1363}{promotion\_choice}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11181}11181\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Promotion\ choice\ received:\ \%d\ (\%s)"{}},\ choice,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11182}11182\ \ \ \ \ \ \ \ \ \ \ \ \ \ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}\ \ \ \ ?\ \textcolor{stringliteral}{"{}Queen"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11183}11183\ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}\ \ \ ?\ \textcolor{stringliteral}{"{}Rook"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11184}11184\ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}\ ?\ \textcolor{stringliteral}{"{}Bishop"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11185}11185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Knight"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11186}11186\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11187}11187\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11188}11188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}⚠️\ Invalid\ or\ missing\ promotion\ choice\ (\%d),\ defaulting\ to\ Queen"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11189}11189\ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_ae6e4449e8345fed34c9c685eba9f1363}{promotion\_choice}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11190}11190\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11191}11191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11192}11192\ \ \ \textcolor{comment}{//\ Execute\ the\ promotion\ with\ the\ selected\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11193}11193\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(choice))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11194}11194\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promotion\ executed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11195}11195\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11196}11196\ \ \ \ \ \textcolor{comment}{//\ Clear\ promotion\ state\ (mutex\ already\ held\ from\ line\ 10419)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11197}11197\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11198}11198\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11199}11199\ \ \ \ \ \textcolor{comment}{//\ Clear\ promotion\ state\ and\ return\ to\ active\ gameplay}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11200}11200\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11201}11201\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};\ \textcolor{comment}{//\ Fix:\ use\ constant\ instead\ of\ magic\ number\ 6}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11202}11202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11203}11203\ \ \ \ \ \textcolor{comment}{//\ Switch\ to\ next\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11204}11204\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11205}11205\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11206}11206\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11207}11207\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11208}11208\ \ \ \ \ \textcolor{comment}{//\ \#2:\ Timer\ switch\ AFTER\ promotion\ choice}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11209}11209\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Timer\ switch\ (promotion):\ ending\ for\ \%s,\ starting\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11210}11210\ \ \ \ \ \ \ \ \ \ \ \ \ \ previous\_player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11211}11211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11212}11212\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11213}11213\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11214}11214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11215}11215\ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11216}11216\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11217}11217\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11218}11218\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11219}11219\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11220}11220\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11221}11221\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11222}11222\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11223}11223\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11224}11224\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11225}11225\ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11226}11226\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11227}11227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11228}11228\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11229}11229\ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11230}11230\ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11231}11231\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11232}11232\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11233}11233\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11234}11234\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11235}11235\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11236}11236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ promotion\ command!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11237}11237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11238}11238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11239}11239\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11240}11240\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11241}11241\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11242}11242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11243}11243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11244}11244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11245}11245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11246}11246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11247}11247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11248}11248\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11249}11249\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11250}11250\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11251}11251\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11252}11252\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11253}11253\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11254}11254\ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11255}11255\ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11256}11256\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11257}11257\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11258}11258\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11259}11259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11260}11260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11261}11261\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11262}11262\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11263}11263\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11264}11264\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11265}11265\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11266}11266\ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11267}11267\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11268}11268\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11269}11269\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11270}11270\ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ updated\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11271}11271\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad7894f48d6e00cfe140b99026be38b71}{game\_print\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11272}11272\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11273}11273\ \ \ \ \ \ \ \textcolor{comment}{//\ Highlight\ pieces\ that\ the\ new\ current\ player\ can\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11274}11274\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11275}11275\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11276}11276\ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11277}11277\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11278}11278\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11279}11279\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11280}11280\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11281}11281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11282}11282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11283}11283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11284}11284\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11285}11285\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11286}11286\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11287}11287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11288}11288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11289}11289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11290}11290\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11291}11291\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11292}11292\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11293}11293\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11294}11294\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11295}11295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11296}11296\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11297}11297\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11298}11298\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11299}11299\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11300}11300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11301}11301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11302}11302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11303}11303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11304}11304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11305}11305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11306}11306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11307}11307\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11308}11308\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11309}11309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11310}11310\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11311}11311\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11312}11312\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11313}11313\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11314}11314\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11315}11315\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ execute\ promotion"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11316}11316\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11317}11317\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11318}11318\ \ \ \textcolor{comment}{//\ CRITICAL:\ Release\ mutex\ at\ the\ end\ of\ the\ function\ to\ ensure\ it's\ always}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11319}11319\ \ \ \textcolor{comment}{//\ released\ Použít\ recursive\ mutex\ funkce\ (promotion\_mutex\ je\ recursive\ mutex)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11320}11320\ \ \ xSemaphoreGiveRecursive(\mbox{\hyperlink{game__task_8c_a63a7da38fbec25e9b4ca6591dbc94966}{promotion\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11321}11321\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11322}11322\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11346}\mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{11346}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_af5345cde0988d26d0eb842aa7e33b202}{game\_execute\_promotion}}(\mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237}{promotion\_choice\_t}}\ choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11347}11347\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}👑\ Executing\ pawn\ promotion:\ \%d"{}},\ choice);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11348}11348\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11349}11349\ \ \ \textcolor{comment}{//\ Find\ the\ pawn\ that\ needs\ to\ be\ promoted}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11350}11350\ \ \ \textcolor{comment}{//\ This\ should\ be\ set\ when\ a\ pawn\ reaches\ the\ promotion\ rank}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11351}11351\ \ \ \textcolor{comment}{//\ For\ now,\ we'll\ implement\ a\ basic\ version}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11352}11352\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11353}11353\ \ \ \textcolor{comment}{//\ Convert\ promotion\ choice\ to\ piece\ type}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11354}11354\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11355}11355\ \ \ \textcolor{comment}{//\ Use\ promotion\_state.player\ instead\ of\ current\_player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11356}11356\ \ \ \textcolor{comment}{//\ current\_player\ has\ already\ been\ switched\ to\ the\ opponent\ by}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11357}11357\ \ \ \textcolor{comment}{//\ game\_execute\_move()\ so\ we\ must\ use\ the\ player\ stored\ in\ the\ promotion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11358}11358\ \ \ \textcolor{comment}{//\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11359}11359\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11360}11360\ \ \ \ \ \textcolor{keywordflow}{switch}\ (choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11361}11361\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11362}11362\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a6d9b099ad26f6f85108b90494697d5dc}{PIECE\_WHITE\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11363}11363\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11364}11364\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11365}11365\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac403d9dfd1cf2dc0be0217a0a54c0a42}{PIECE\_WHITE\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11366}11366\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11367}11367\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11368}11368\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ac5624ba607e63e7a6f7ebdab4b322992}{PIECE\_WHITE\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11369}11369\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11370}11370\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11371}11371\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a4c99e4617db8d3f21a4dd23e497d0b0c}{PIECE\_WHITE\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11372}11372\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11373}11373\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11374}11374\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11375}11375\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11376}11376\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11377}11377\ \ \ \ \ \textcolor{keywordflow}{switch}\ (choice)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11378}11378\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11379}11379\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a29e99921b92026f4b6bbeacf08289238}{PIECE\_BLACK\_QUEEN}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11380}11380\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11381}11381\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11382}11382\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a26b69f7adf92c62bfa744b9e77907584}{PIECE\_BLACK\_ROOK}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11383}11383\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11384}11384\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11385}11385\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2ae844e749448cbcaae2fda6a56bb70b86}{PIECE\_BLACK\_BISHOP}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11386}11386\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11387}11387\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a38e92903ca7d679f019bbc0895c00910}{PROMOTION\_KNIGHT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11388}11388\ \ \ \ \ \ \ promoted\_piece\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a3888c0ae958fcf54d7b4f77a26bdaa60}{PIECE\_BLACK\_KNIGHT}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11389}11389\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11390}11390\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11391}11391\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11392}11392\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11393}11393\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11394}11394\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11395}11395\ \ \ \textcolor{comment}{//\ BUG\ \#3:\ Use\ stored\ position\ instead\ of\ scanning\ entire\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11396}11396\ \ \ \textcolor{comment}{//\ The\ position\ was\ already\ found\ and\ stored\ in\ promotion\_state\ by}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11397}11397\ \ \ \textcolor{comment}{//\ game\_check\_promotion\_needed()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11398}11398\ \ \ uint8\_t\ row\ =\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11399}11399\ \ \ uint8\_t\ col\ =\ \mbox{\hyperlink{game__task_8c_a434aeae5dd0d1550ab0cad1e0a6b5f0f}{promotion\_state}}.square\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11400}11400\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11401}11401\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11402}11402\ \ \ \textcolor{comment}{//\ Verify\ it's\ actually\ a\ pawn\ (safety\ check)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11403}11403\ \ \ \textcolor{keywordflow}{if}\ (piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ !=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11404}11404\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Promotion\ failed:\ No\ pawn\ at\ stored\ position\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11405}11405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ col,\ row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11406}11406\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11407}11407\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11408}11408\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11409}11409\ \ \ \textcolor{comment}{//\ Promote\ the\ pawn}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11410}11410\ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ =\ promoted\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11411}11411\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}};\ \textcolor{comment}{//\ Restore\ game\ state\ to\ ACTIVE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11412}11412\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Promoted\ \%s\ pawn\ at\ \%c\%d\ to\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11413}11413\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}white"{}}\ :\ \textcolor{stringliteral}{"{}black"{}},\ \textcolor{charliteral}{'a'}\ +\ col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11414}11414\ \ \ \ \ \ \ \ \ \ \ \ row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11415}11415\ \ \ \ \ \ \ \ \ \ \ \ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237ace7ae3bfdb598aeffb32c01d08805045}{PROMOTION\_QUEEN}}\ \ \ \ ?\ \textcolor{stringliteral}{"{}Queen"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11416}11416\ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237a86adcf7f4dd13fe13c310740b684fd85}{PROMOTION\_ROOK}}\ \ \ ?\ \textcolor{stringliteral}{"{}Rook"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11417}11417\ \ \ \ \ \ \ \ \ \ \ \ :\ choice\ ==\ \mbox{\hyperlink{chess__types_8h_a1b67a105371c4a0066f77f3fa12ad237af76338fd133ad75d03265525fab6a060}{PROMOTION\_BISHOP}}\ ?\ \textcolor{stringliteral}{"{}Bishop"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11418}11418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}Knight"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11419}11419\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11420}11420\ \ \ \textcolor{comment}{//\ Spustit\ promotion\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11421}11421\ \ \ uint8\_t\ promotion\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11422}11422\ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ promote\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da08d8d77aeb5693180fb3c7752dccd626}{LED\_CMD\_ANIM\_PROMOTE}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11423}11423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ promotion\_led,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11424}11424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11425}11425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 215,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11426}11426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \textcolor{comment}{//\ Gold}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11427}11427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 2000,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11428}11428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11429}11429\ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&promote\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11430}11430\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11431}11431\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11432}11432\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11433}11433\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11437}\mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{11437}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11438}11438\ \ \ \textcolor{comment}{//\ Do\ not\ highlight\ pieces\ if\ system\ is\ booting}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11439}11439\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{led__task_8h_a006a24ec8e7f302c4a6f8481675803d1}{led\_is\_booting}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11440}11440\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11441}11441\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11442}11442\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11443}11443\ \ \ \textcolor{comment}{//\ Do\ not\ highlight\ movable\ pieces\ if\ a\ piece\ is\ already}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11444}11444\ \ \ \textcolor{comment}{//\ lifted\ This\ prevents\ overwriting\ the\ "{}valid\ moves"{}\ (green)\ with\ "{}movable}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11445}11445\ \ \ \textcolor{comment}{//\ pieces"{}\ (yellow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11446}11446\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11447}11447\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Highlight\ skipped\ -\/\ piece\ is\ lifted"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11448}11448\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11449}11449\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11450}11450\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11451}11451\ \ \ \textcolor{comment}{//\ Nespouštět\ highlight\ během\ rošády\ -\/\ rošáda\ má\ vlastní\ LED\ indikaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11452}11452\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11453}11453\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Highlight\ skipped\ -\/\ castling\ in\ progress"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11454}11454\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11455}11455\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11456}11456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11457}11457\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🟡\ Highlighting\ movable\ pieces\ for\ \%s\ player"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11458}11458\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}white"{}}\ :\ \textcolor{stringliteral}{"{}black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11459}11459\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11460}11460\ \ \ \textcolor{comment}{//\ Endgame\ detection\ is\ handled\ in\ game\_analyze\_position()\ called\ from}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11461}11461\ \ \ \textcolor{comment}{//\ game\_execute\_move()}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11462}11462\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11463}11463\ \ \ \textcolor{comment}{//\ LED\ command\ queue\ removed\ -\/\ using\ direct\ LED\ calls\ now}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11464}11464\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11465}11465\ \ \ uint32\_t\ highlighted\_count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11466}11466\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11467}11467\ \ \ \textcolor{comment}{//\ Scan\ all\ squares\ for\ current\ player's\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11468}11468\ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11469}11469\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11470}11470\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11471}11471\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11472}11472\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ piece\ belongs\ to\ current\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11473}11473\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_current\_player\_piece\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11474}11474\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11475}11475\ \ \ \ \ \ \ \ \ is\_current\_player\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11476}11476\ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11477}11477\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11478}11478\ \ \ \ \ \ \ \ \ is\_current\_player\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11479}11479\ \ \ \ \ \ \ \ \ \ \ \ \ (piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&\ piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11480}11480\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11481}11481\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11482}11482\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_current\_player\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11483}11483\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ piece\ has\ valid\ moves}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11484}11484\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OPTIMIZATION:\ Reduced\ buffer\ size\ from\ 64\ to\ 1\ to\ prevent\ stack}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11485}11485\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ overflow\ in\ Timer\ Task\ We\ only\ need\ to\ know\ if\ count\ >\ 0,\ so\ asking}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11486}11486\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ 1\ move\ is\ enough}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11487}11487\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[1];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11488}11488\ \ \ \ \ \ \ \ \ uint32\_t\ valid\_moves\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11489}11489\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(row,\ col,\ suggestions,\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11490}11490\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11491}11491\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11492}11492\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Highlight\ movable\ piece\ in\ yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11493}11493\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(\mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(row,\ col),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11494}11494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);\ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11495}11495\ \ \ \ \ \ \ \ \ \ \ highlighted\_count++;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11496}11496\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11497}11497\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11498}11498\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11499}11499\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11500}11500\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11501}11501\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🟡\ Highlighted\ \%lu\ movable\ pieces"{}},\ highlighted\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11502}11502\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11503}11503\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11504}11504\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11505}11505\ \textcolor{comment}{//\ PUZZLE\ COMMAND\ IMPLEMENTATIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11506}11506\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11507}11507\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11512}\mbox{\hyperlink{game__task_8c_a1bab09959bb451eacb7eadf20da5aff1}{11512}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a1bab09959bb451eacb7eadf20da5aff1}{game\_detect\_and\_handle\_castling}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11513}11513\ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11514}11514\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11515}11515\ \ \ \textcolor{comment}{//\ Je\ to\ král\ a\ pohybuje\ se\ o\ 2\ pole?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11516}11516\ \ \ \textcolor{keywordflow}{if}\ ((piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11517}11517\ \ \ \ \ \ \ abs((\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ -\/\ (\textcolor{keywordtype}{int})move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}})\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11518}11518\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11519}11519\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ CASTLING\ DETECTED!\ King\ moved\ 2\ squares"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11520}11520\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11521}11521\ \ \ \ \ \textcolor{comment}{//\ Nastavit\ stav\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11522}11522\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11523}11523\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11524}11524\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11525}11525\ \ \ \ \ \textcolor{comment}{//\ Vypočítat\ pozice\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11526}11526\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_kingside\ =\ (move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ 6);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11527}11527\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11528}11528\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ =\ is\_kingside\ ?\ 7\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11529}11529\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11530}11530\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col\ =\ is\_kingside\ ?\ 5\ :\ 3;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11531}11531\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11532}11532\ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ LED\ guidance\ pro\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11533}11533\ \ \ \ \ \mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{game\_show\_castling\_rook\_guidance}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11534}11534\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11535}11535\ \ \ \ \ \textcolor{comment}{//\ NEZMĚNIT\ HRÁČE\ -\/\ čekat\ na\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11536}11536\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏳\ Waiting\ for\ rook\ move\ to\ complete\ castling..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11537}11537\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11538}11538\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11539}11539\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11543}\mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{11543}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{game\_show\_castling\_rook\_guidance}}()\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11544}11544\ \ \ \textcolor{comment}{//\ Vyčistit\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11545}11545\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11546}11546\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11547}11547\ \ \ \textcolor{comment}{//\ Postupná\ animace\ od\ věže\ k\ cíli}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11548}11548\ \ \ uint8\_t\ rook\_from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11549}11549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11550}11550\ \ \ uint8\_t\ rook\_to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11551}11551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11552}11552\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11553}11553\ \ \ \textcolor{comment}{//\ Zvýraznit\ věž\ (žlutá)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11554}11554\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_from\_led,\ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Žlutá\ -\/\ zvedni\ odtud}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11555}11555\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11556}11556\ \ \ \textcolor{comment}{//\ Postupně\ rozsvítit\ pole\ od\ věže\ k\ cíli}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11557}11557\ \ \ \textcolor{keywordtype}{int}\ from\_col\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11558}11558\ \ \ \textcolor{keywordtype}{int}\ to\_col\ =\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11559}11559\ \ \ \textcolor{keywordtype}{int}\ step\ =\ (to\_col\ >\ from\_col)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11560}11560\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11561}11561\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ from\_col\ +\ step;\ col\ !=\ to\_col\ +\ step;\ col\ +=\ step)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11562}11562\ \ \ \ \ uint8\_t\ led\_index\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11563}11563\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,\ col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11564}11564\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ -\/\ cesta}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11565}11565\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(300));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11566}11566\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11567}11567\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11568}11568\ \ \ \textcolor{comment}{//\ Zvýraznit\ cíl\ (zelená)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11569}11569\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_to\_led,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Zelená\ -\/\ polož\ sem}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11570}11570\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11571}11571\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}💡\ Move\ rook\ from\ \%c\%d\ to\ \%c\%d\ to\ complete\ castling"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11572}11572\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11573}11573\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11574}11574\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11575}11575\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11581}\mbox{\hyperlink{game__task_8c_a6974209fc82de9bbb764a014d9badec0}{11581}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a6974209fc82de9bbb764a014d9badec0}{game\_check\_castling\_completion}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__t}{chess\_move\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11582}11582\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11583}11583\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11584}11584\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11585}11585\ \ \ \textcolor{comment}{//\ Je\ to\ správný\ tah\ věže?}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11586}11586\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__t_a87e6934d4b28fea1a59c341d6cbe9eb7}{from\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11587}11587\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a3b8bdb363c16e1f221da6c3e80d9aa70}{from\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11588}11588\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11589}11589\ \ \ \ \ \ \ move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}\ ==\ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11590}11590\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11591}11591\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ CASTLING\ COMPLETED!\ Rook\ moved\ correctly"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11592}11592\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11593}11593\ \ \ \ \ \textcolor{comment}{//\ Provedeme\ posun\ věže\ v\ board[][]}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11594}11594\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[move-\/>\mbox{\hyperlink{structchess__move__t_a12ee5250e947928c028f50b4c28c9d24}{to\_row}}][move-\/>\mbox{\hyperlink{structchess__move__t_a481848c592fd4bcac9b17b995ac18de1}{to\_col}}]\ =\ move-\/>\mbox{\hyperlink{structchess__move__t_abedc85077eb8fc089e9b2e71d5761354}{piece}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11595}11595\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row][\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col]\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11596}11596\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11597}11597\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11598}11598\ \ \ \ \ \textcolor{comment}{//\ Aktualizovat\ příznaky\ pro\ krále\ a\ věž}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11599}11599\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.player\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11600}11600\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0620fd0930d19a0b135c237682869d90}{white\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11601}11601\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11602}11602\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad84cf76d9d65212e80f52ce534b3d7bf}{white\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11603}11603\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11604}11604\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3864eaf443fa01680872e54e26e69e49}{white\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11605}11605\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11606}11606\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a8bc4bd88f8a4b4dca7d334ac907df78b}{black\_king\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11607}11607\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col\ ==\ 7)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11608}11608\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a52f58ae06711b813b98133559c278850}{black\_rook\_h\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11609}11609\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11610}11610\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a230aeeeb272e2891526956413febc269}{black\_rook\_a\_moved}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11611}11611\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11612}11612\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11613}11613\ \ \ \ \ \textcolor{comment}{//\ Zlatá\ animace\ dokončení\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11614}11614\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{show\_castling\_completion\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11615}11615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11616}11616\ \ \ \ \ \textcolor{comment}{//\ Změnit\ hráče\ TEPRVE\ TEĎ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11617}11617\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11618}11618\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11619}11619\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11620}11620\ \ \ \ \ \textcolor{comment}{//\ KRITICKÉ:\ Endgame\ kontrola\ PŘED\ player\ change\ animací!}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11621}11621\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ endgame,\ player\ change\ se\ NESPOUŠTÍ}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11622}11622\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414d}{game\_state\_t}}\ end\_game\_result\ =\ \mbox{\hyperlink{game__task_8c_a3cd556600affcd7945ded58e0a05c9c3}{game\_check\_end\_game\_conditions}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11623}11623\ \ \ \ \ \textcolor{keywordflow}{if}\ (end\_game\_result\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11624}11624\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11625}11625\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11626}11626\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11627}11627\ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále\ vítěze\ pro\ endgame\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11628}11628\ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11629}11629\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11630}11630\ \ \ \ \ \ \ uint8\_t\ king\_pos\ =\ 28;\ \textcolor{comment}{//\ default\ e4}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11631}11631\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11632}11632\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[i\ /\ 8][i\ \%\ 8];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11633}11633\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11634}11634\ \ \ \ \ \ \ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ piece\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11635}11635\ \ \ \ \ \ \ \ \ \ \ king\_pos\ =\ i;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11636}11636\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11637}11637\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11638}11638\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11639}11639\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11640}11640\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11641}11641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎯\ Game\ finished\ after\ castling\ completion!\ Starting\ endgame\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11642}11642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}animation\ at\ position\ \%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11643}11643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_pos);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11644}11644\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11645}11645\ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ endgame\ animaci\ (wave\ z\ krále\ vítěze)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11646}11646\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ endgame\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66daf8bf66ffd150099b9aed3c2e8a54d430}{LED\_CMD\_ANIM\_ENDGAME}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11647}11647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_pos,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11648}11648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11649}11649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11650}11650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yellow}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11651}11651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,\ \textcolor{comment}{//\ Endless}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11652}11652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11653}11653\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&endgame\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11654}11654\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11655}11655\ \ \ \ \ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11656}11656\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11657}11657\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}✅\ Endgame\ animation\ started\ -\/\ player\ change\ animation\ SKIPPED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11658}11658\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11659}11659\ \ \ \ \ \ \ \textcolor{comment}{//\ Není\ endgame\ -\/\ spustit\ player\ change\ animaci}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11660}11660\ \ \ \ \ \ \ uint8\_t\ player\_color\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11661}11661\ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 1\ :\ 0;\ \textcolor{comment}{//\ 1=white,\ 0=black}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11662}11662\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ player\_change\_cmd\ =\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11663}11663\ \ \ \ \ \ \ \ \ \ \ .type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66dac0069a9eecc579e3bcc3c14d6865fe28}{LED\_CMD\_ANIM\_PLAYER\_CHANGE}},\ \textcolor{comment}{//\ Použít}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11664}11664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ANIM\_PLAYER\_CHANGE\ místo}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11665}11665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PLAYER\_CHANGE}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11666}11666\ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11667}11667\ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11668}11668\ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11669}11669\ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11670}11670\ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11671}11671\ \ \ \ \ \ \ \ \ \ \ .data\ =\ \&player\_color\ \textcolor{comment}{//\ Předat\ barvu\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11672}11672\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11673}11673\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&player\_change\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11674}11674\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11675}11675\ \ \ \ \ \ \ \textcolor{comment}{//\ Vyčistit\ stav\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11676}11676\ \ \ \ \ \ \ memset(\&\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}},\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11677}11677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11678}11678\ \ \ \ \ \ \ \textcolor{comment}{//\ Zobrazit\ pohyblivé\ figury\ pro\ nového\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11679}11679\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11680}11680\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11681}11681\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11682}11682\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ completed!\ \%s\ to\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11683}11683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11684}11684\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11685}11685\ \ \ \ \ \ \ \textcolor{comment}{//\ Zkontrolovat,\ zda\ je\ nový\ hráč\ v\ šachu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11686}11686\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11687}11687\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11688}11688\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Najít\ pozici\ krále}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11689}11689\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11690}11690\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11691}11691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11692}11692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11693}11693\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11694}11694\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11695}11695\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11696}11696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11697}11697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11698}11698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11699}11699\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11700}11700\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11701}11701\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11702}11702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11703}11703\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11704}11704\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11705}11705\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1\ \&\&\ king\_col\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11706}11706\ \ \ \ \ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11707}11707\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Spustit\ check\ animaci\ -\/\ růžové\ svícení\ na\ králi}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11708}11708\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11709}11709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11710}11710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11711}11711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11712}11712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11713}11713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11714}11714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{comment}{//\ Trvalé\ až\ do\ dalšího\ tahu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11715}11715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11716}11716\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11717}11717\ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⚠️\ CHECK!\ \%s\ is\ in\ check"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11718}11718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11719}11719\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11720}11720\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11721}11721\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11722}11722\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11723}11723\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11724}11724\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11725}11725\ \ \ \ \ \textcolor{comment}{//\ Nesprávný\ tah\ věže\ -\/\ ukázat\ znovu\ guidance}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11726}11726\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Incorrect\ rook\ move\ for\ castling"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11727}11727\ \ \ \ \ \mbox{\hyperlink{game__task_8c_afd365d57cb897126d7c7df4547c45d25}{game\_show\_castling\_rook\_guidance}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11728}11728\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11729}11729\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11730}11730\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11731}11731\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11735}\mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{11735}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_acf17b5ac5ef3ff609422be26351370df}{show\_castling\_completion\_animation}}()\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11736}11736\ \ \ \textcolor{comment}{//\ Zlatá\ animace\ úspěšné\ rošády}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11737}11737\ \ \ uint8\_t\ rook\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11738}11738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11739}11739\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11740}11740\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 5;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11741}11741\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_led,\ 255,\ 215,\ 0);\ \textcolor{comment}{//\ Zlatá}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11742}11742\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11743}11743\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(rook\_led,\ 0,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11744}11744\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(100));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11745}11745\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11746}11746\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11747}11747\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰✨\ CASTLING\ ANIMATION\ COMPLETED"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11748}11748\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11749}11749\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11750}11750\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11751}11751\ \textcolor{comment}{//\ CASTLING\ ANIMATION\ SYSTEM\ (LEGACY)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11752}11752\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11753}11753\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11758}\mbox{\hyperlink{game__task_8c_a5163d6404ac51406bdeffbe99262725c}{11758}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a5163d6404ac51406bdeffbe99262725c}{game\_start\_castle\_animation}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__extended__t}{chess\_move\_extended\_t}}\ *move)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11759}11759\ \ \ \textcolor{keywordflow}{if}\ (!move)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11760}11760\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11761}11761\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11762}11762\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Starting\ castle\ animation\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11763}11763\ \ \ \ \ \ \ \ \ \ \ \ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}})\ ?\ \textcolor{stringliteral}{"{}kingside"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11764}11764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}queenside"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11765}11765\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11766}11766\ \ \ \textcolor{comment}{//\ Calculate\ rook\ positions}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11767}11767\ \ \ uint8\_t\ king\_row\ =\ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ 0\ :\ 7;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11768}11768\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11769}11769\ \ \ \textcolor{keywordflow}{if}\ (move-\/>\mbox{\hyperlink{structchess__move__extended__t_ae6200dd0d0fe9610ed5ee1de3d410aa0}{move\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a049445f8ca6e7d0daf13a256e4375576a348ebd44da63a3260560e30452bd3d4c}{MOVE\_TYPE\_CASTLE\_KING}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11770}11770\ \ \ \ \ \textcolor{comment}{//\ Kingside:\ rook\ from\ h-\/file\ to\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11771}11771\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11772}11772\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 7;\ \textcolor{comment}{//\ h-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11773}11773\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11774}11774\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 5;\ \textcolor{comment}{//\ f-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11775}11775\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11776}11776\ \ \ \ \ \textcolor{comment}{//\ Queenside:\ rook\ from\ a-\/file\ to\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11777}11777\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11778}11778\ \ \ \ \ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ =\ 0;\ \textcolor{comment}{//\ a-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11779}11779\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ =\ king\_row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11780}11780\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}\ =\ 3;\ \textcolor{comment}{//\ d-\/file}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11781}11781\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11782}11782\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11783}11783\ \ \ \textcolor{comment}{//\ Store\ castle\ move\ for\ completion}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11784}11784\ \ \ \mbox{\hyperlink{game__task_8c_aec956796e1629a92f299b1725070b1c2}{pending\_castle\_move}}\ =\ *move;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11785}11785\ \ \ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11786}11786\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11787}11787\ \ \ \textcolor{comment}{//\ Clear\ board\ and\ start\ repeating\ rook\ move\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11788}11788\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11789}11789\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11790}11790\ \ \ \textcolor{comment}{//\ Spustit\ opakující\ se\ animaci\ pohybu\ věže}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11791}11791\ \ \ \mbox{\hyperlink{game__task_8c_afbd09cfaddffe4661015d92975561bd2}{game\_start\_repeating\_rook\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11792}11792\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11793}11793\ \ \ \textcolor{comment}{//\ Show\ initial\ animation\ immediately}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11794}11794\ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11795}11795\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11796}11796\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);\ \textcolor{comment}{//\ Yellow\ for\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11797}11797\ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);\ \ \ \ \ \textcolor{comment}{//\ Green\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11798}11798\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11799}11799\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Rook\ at\ \%c\%d\ needs\ to\ move\ to\ \%c\%d"{}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11800}11800\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11801}11801\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11802}11802\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11807}\mbox{\hyperlink{game__task_8c_af26d73c4a9e269473827e4d4497b21b3}{11807}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_af26d73c4a9e269473827e4d4497b21b3}{rook\_animation\_timer\_callback}}(TimerHandle\_t\ xTimer)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11808}11808\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ ||\ !\mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11809}11809\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11810}11810\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11811}11811\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11812}11812\ \ \ \textcolor{comment}{//\ Simple\ pulsing\ animation\ -\/\ show\ rook\ position\ and\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11813}11813\ \ \ uint8\_t\ from\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}},\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11814}11814\ \ \ uint8\_t\ to\_led\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}},\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11815}11815\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11816}11816\ \ \ \textcolor{comment}{//\ Clear\ board\ first}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11817}11817\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11818}11818\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11819}11819\ \ \ \textcolor{comment}{//\ Show\ rook\ position\ in\ yellow\ (pulsing)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11820}11820\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ pulse\_state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11821}11821\ \ \ pulse\_state\ =\ !pulse\_state;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11822}11822\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11823}11823\ \ \ \textcolor{keywordflow}{if}\ (pulse\_state)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11824}11824\ \ \ \ \ \textcolor{comment}{//\ Bright\ yellow\ for\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11825}11825\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 255,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11826}11826\ \ \ \ \ \textcolor{comment}{//\ Bright\ green\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11827}11827\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 255,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11828}11828\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11829}11829\ \ \ \ \ \textcolor{comment}{//\ Dim\ yellow\ for\ rook\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11830}11830\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(from\_led,\ 128,\ 128,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11831}11831\ \ \ \ \ \textcolor{comment}{//\ Dim\ green\ for\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11832}11832\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(to\_led,\ 0,\ 128,\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11833}11833\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11834}11834\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11835}11835\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Rook\ animation:\ \%c\%d\ -\/>\ \%c\%d\ (\%s)"{}},\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11836}11836\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11837}11837\ \ \ \ \ \ \ \ \ \ \ \ pulse\_state\ ?\ \textcolor{stringliteral}{"{}bright"{}}\ :\ \textcolor{stringliteral}{"{}dim"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11838}11838\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11839}11839\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11843}\mbox{\hyperlink{game__task_8c_afbd09cfaddffe4661015d92975561bd2}{11843}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_afbd09cfaddffe4661015d92975561bd2}{game\_start\_repeating\_rook\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11844}11844\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11845}11845\ \ \ \ \ \textcolor{comment}{//\ Create\ timer\ for\ rook\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11846}11846\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11847}11847\ \ \ \ \ \ \ \ \ xTimerCreate(\textcolor{stringliteral}{"{}rook\_anim\_timer"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11848}11848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdMS\_TO\_TICKS(500),\ \textcolor{comment}{//\ 500ms\ interval\ (snappier)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11849}11849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pdTRUE,\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Auto-\/reload}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11850}11850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NULL,\ \mbox{\hyperlink{game__task_8c_af26d73c4a9e269473827e4d4497b21b3}{rook\_animation\_timer\_callback}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11851}11851\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11852}11852\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11853}11853\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ create\ rook\ animation\ timer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11854}11854\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11855}11855\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11856}11856\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11857}11857\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11858}11858\ \ \ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11859}11859\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11860}11860\ \ \ \textcolor{comment}{//\ Start\ the\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11861}11861\ \ \ \textcolor{keywordflow}{if}\ (xTimerStart(\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}},\ 0)\ !=\ pdPASS)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11862}11862\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ start\ rook\ animation\ timer"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11863}11863\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11864}11864\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11865}11865\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11866}11866\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11867}11867\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Started\ repeating\ rook\ animation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11868}11868\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11869}11869\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11873}\mbox{\hyperlink{game__task_8c_a400c845a7ea99010ffc662d32fc20147}{11873}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a400c845a7ea99010ffc662d32fc20147}{game\_stop\_repeating\_rook\_animation}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11874}11874\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11875}11875\ \ \ \ \ xTimerStop(\mbox{\hyperlink{game__task_8c_ae342d6a960ec01e2dfef5b8876cccb9b}{rook\_animation\_timer}},\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11876}11876\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11877}11877\ \ \ \mbox{\hyperlink{game__task_8c_a0c4431921d8a29ef2f1347ffae4941cf}{rook\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11878}11878\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Stopped\ repeating\ rook\ animation"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11879}11879\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11880}11880\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11885}\mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{11885}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a67dfb69eac8af38766e7d92cf3b4b5d0}{game\_is\_castle\_animation\_active}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}};\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11886}11886\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11892}\mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{11892}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aa407236aeb356b0929ab54581fe041bb}{game\_is\_castling\_expected}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11893}11893\ \ \ \textcolor{comment}{//\ Check\ if\ a\ king\ is\ lifted\ and\ about\ to\ be\ placed\ 2\ squares\ away}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11894}11894\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11895}11895\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ ||\ \mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}}\ ==\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11896}11896\ \ \ \ \ \textcolor{comment}{//\ This\ function\ is\ called\ from\ game\_handle\_piece\_placed}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11897}11897\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ check\ if\ the\ king\ is\ being\ placed\ 2\ squares\ away\ from\ its}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11898}11898\ \ \ \ \ \textcolor{comment}{//\ original\ position\ But\ we\ don't\ have\ access\ to\ the\ destination}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11899}11899\ \ \ \ \ \textcolor{comment}{//\ coordinates\ here\ So\ we\ return\ true\ to\ prevent\ premature\ opponent\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11900}11900\ \ \ \ \ \textcolor{comment}{//\ highlighting\ The\ actual\ castling\ detection\ will\ happen\ in}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11901}11901\ \ \ \ \ \textcolor{comment}{//\ game\_handle\_matrix\_move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11902}11902\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ King\ is\ lifted\ -\/\ castling\ might\ be\ expected"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11903}11903\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11904}11904\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11905}11905\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11906}11906\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11907}11907\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11916}\mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{11916}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a98af1de0d72580a78b6f87a672710bc7}{game\_complete\_castle\_animation}}(uint8\_t\ from\_row,\ uint8\_t\ from\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11917}11917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ to\_row,\ uint8\_t\ to\_col)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11918}11918\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11919}11919\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11920}11920\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11921}11921\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11922}11922\ \ \ \textcolor{comment}{//\ Check\ if\ rook\ was\ moved\ to\ correct\ position}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11923}11923\ \ \ \textcolor{keywordflow}{if}\ (from\_row\ ==\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ \&\&\ from\_col\ ==\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11924}11924\ \ \ \ \ \ \ to\_row\ ==\ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ \&\&\ to\_col\ ==\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11925}11925\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11926}11926\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Castle\ animation\ completed!\ Rook\ moved\ correctly."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11927}11927\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11928}11928\ \ \ \ \ \textcolor{comment}{//\ Skutečně\ přesunout\ věž\ až\ když\ hráč\ udělá\ správný\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11929}11929\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ rook\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11930}11930\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}][\mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}}]\ =\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a78c1cf9cdf8f00b3f94fcc2f867180f1}{PIECE\_EMPTY}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11931}11931\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[\mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}][\mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}}]\ =\ rook\_piece;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11932}11932\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11933}11933\ \ \ \ \ \textcolor{comment}{//\ Stop\ repeating\ rook\ animation}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11934}11934\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a400c845a7ea99010ffc662d32fc20147}{game\_stop\_repeating\_rook\_animation}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11935}11935\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11936}11936\ \ \ \ \ \textcolor{comment}{//\ Complete\ the\ castle\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11937}11937\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a7fab2e1c6f61a44564d0c595da75dc05}{castle\_animation\_active}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11938}11938\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11939}11939\ \ \ \ \ \textcolor{comment}{//\ Switch\ players\ now\ that\ castle\ is\ complete}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11940}11940\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ previous\_player\ =\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11941}11941\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11942}11942\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11943}11943\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11944}11944\ \ \ \ \ \textcolor{comment}{//\ Po\ úspěšné\ rošádě\ spustit\ animaci\ změny\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11945}11945\ \ \ \ \ \mbox{\hyperlink{game__task_8c_acecde79c7924b9de393d93d82e662595}{game\_show\_player\_change\_animation}}(previous\_player,\ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11946}11946\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11947}11947\ \ \ \ \ \textcolor{comment}{//\ Clear\ board\ and\ show\ movable\ pieces\ for\ new\ player}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11948}11948\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11949}11949\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11950}11950\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11951}11951\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏰\ Castling\ completed!\ \%s\ to\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11952}11952\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11953}11953\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11954}11954\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11955}11955\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11956}11956\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11957}11957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}❌\ Invalid\ rook\ move\ for\ castling:\ \%c\%d\ -\/>\ \%c\%d\ (expected:\ \%c\%d\ "{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11958}11958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}-\/>\ \%c\%d)"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11959}11959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ from\_col,\ from\_row\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ to\_col,\ to\_row\ +\ 1,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11960}11960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_aaf08ecb764a4aa8e2ce3d75d9bcf58f2}{rook\_from\_col}},\ \mbox{\hyperlink{game__task_8c_a2e655fa25f4bbdd873eabad03e266985}{rook\_from\_row}}\ +\ 1,\ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_a802ed5327f737b0304fbc1809d0aac8f}{rook\_to\_col}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11961}11961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ad71601a1741c8dcb2c45992ebfc373b0}{rook\_to\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11962}11962\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11963}11963\ \ \ \ \ \textcolor{comment}{//\ Keep\ castle\ animation\ active,\ wait\ for\ correct\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11964}11964\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11965}11965\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11966}11966\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11967}11967\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11968}11968\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11969}11969\ \textcolor{comment}{//\ WEB\ SERVER\ JSON\ EXPORT\ FUNCTIONS}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11970}11970\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11971}11971\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11972}\mbox{\hyperlink{game__task_8c_a6199d3c51c2ba715c27b7be7428c61b7}{11972}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a6199d3c51c2ba715c27b7be7428c61b7}{game\_get\_board\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11973}11973\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11974}11974\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11975}11975\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11976}11976\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11977}11977\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ board}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11978}11978\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11979}11979\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11980}11980\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11981}11981\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11982}11982\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11983}11983\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11984}11984\ \ \ \textcolor{comment}{//\ Build\ JSON\ string\ manually\ (more\ efficient\ than\ cJSON)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11985}11985\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11986}11986\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11987}11987\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}board\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11988}11988\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11989}11989\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11990}11990\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11991}11991\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11992}11992\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11993}11993\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\%c\(\backslash\)"{}"{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11994}11994\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (col\ <\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11995}11995\ \ \ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11996}11996\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11997}11997\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11998}11998\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}]"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l11999}11999\ \ \ \ \ \textcolor{keywordflow}{if}\ (row\ <\ 7)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12000}12000\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12001}12001\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12002}12002\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12003}12003\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12004}12004\ \ \ uint64\_t\ timestamp\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12005}12005\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}],\(\backslash\)"{}timestamp\(\backslash\)"{}:\%llu\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12006}12006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ timestamp);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12007}12007\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12008}12008\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12009}12009\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12010}12010\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12011}12011\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12012}12012\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12013}12013\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12014}12014\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12018}\mbox{\hyperlink{game__task_8c_a2e528b3b66fe59544f28ca993c4a6143}{12018}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a2e528b3b66fe59544f28ca993c4a6143}{game\_get\_move\_count}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12019}12019\ \ \ uint32\_t\ count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12020}12020\ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(100))\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12021}12021\ \ \ \ \ count\ =\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12022}12022\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12023}12023\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12024}12024\ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12025}12025\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12026}12026\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12027}\mbox{\hyperlink{game__task_8c_abdf3ba446d87db43c26b6c51275a521e}{12027}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_abdf3ba446d87db43c26b6c51275a521e}{game\_get\_status\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12028}12028\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12029}12029\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12030}12030\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12031}12031\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12032}12032\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ game\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12033}12033\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12034}12034\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12035}12035\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12036}12036\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12037}12037\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12038}12038\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12039}12039\ \ \ \textcolor{comment}{//\ Build\ JSON\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12040}12040\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12041}12041\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12042}12042\ \ \ \textcolor{comment}{//\ Game\ state\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12043}12043\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *game\_state\_str\ =\ \textcolor{stringliteral}{"{}idle"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12044}12044\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12045}12045\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12046}12046\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}active"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12047}12047\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12048}12048\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414dae6a757f0eb2e39168756440ac804ffa7}{GAME\_STATE\_PAUSED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12049}12049\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}paused"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12050}12050\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12051}12051\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12052}12052\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}finished"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12053}12053\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12054}12054\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12055}12055\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}promotion"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12056}12056\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12057}12057\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12058}12058\ \ \ \ \ game\_state\_str\ =\ \textcolor{stringliteral}{"{}idle"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12059}12059\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12060}12060\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12061}12061\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12062}12062\ \ \ \textcolor{comment}{//\ Check\ detection}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12063}12063\ \ \ \textcolor{keywordtype}{bool}\ in\_check\ =\ \mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12064}12064\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12065}12065\ \ \ \textcolor{comment}{//\ Checkmate\ detection\ (simplified\ -\/\ king\ in\ check\ and\ no\ legal\ moves)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12066}12066\ \ \ \textcolor{keywordtype}{bool}\ checkmate\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12067}12067\ \ \ \textcolor{keywordflow}{if}\ (in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12068}12068\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ generate\ legal\ moves\ -\/\ if\ none,\ it's\ checkmate}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12069}12069\ \ \ \ \ uint32\_t\ legal\_moves\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12070}12070\ \ \ \ \ checkmate\ =\ (legal\_moves\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12071}12071\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12072}12072\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12073}12073\ \ \ \textcolor{comment}{//\ Stalemate\ detection\ (simplified\ -\/\ not\ in\ check\ but\ no\ legal\ moves)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12074}12074\ \ \ \textcolor{keywordtype}{bool}\ stalemate\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12075}12075\ \ \ \textcolor{keywordflow}{if}\ (!in\_check)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12076}12076\ \ \ \ \ uint32\_t\ legal\_moves\ =\ \mbox{\hyperlink{game__task_8c_a0108839d1688d03bc9eba3f1c581788e}{game\_generate\_legal\_moves}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12077}12077\ \ \ \ \ stalemate\ =\ (legal\_moves\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12078}12078\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12079}12079\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12080}12080\ \ \ offset\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12081}12081\ \ \ \ \ \ \ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12082}12082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}game\_state\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12083}12083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}current\_player\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12084}12084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}move\_count\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12085}12085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}white\_time\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12086}12086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}black\_time\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12087}12087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}in\_check\(\backslash\)"{}:\%s,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12088}12088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}checkmate\(\backslash\)"{}:\%s,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12089}12089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}stalemate\(\backslash\)"{}:\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12090}12090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_state\_str,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12091}12091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12092}12092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a3d4dd73ea0cc420ac9d98dac91b8e2cd}{white\_time\_total}},\ \mbox{\hyperlink{game__task_8c_a18290b02f1d4991d7fd4fe790ca0fecb}{black\_time\_total}},\ in\_check\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12093}12093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkmate\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}},\ stalemate\ ?\ \textcolor{stringliteral}{"{}true"{}}\ :\ \textcolor{stringliteral}{"{}false"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12094}12094\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12095}12095\ \ \ \textcolor{comment}{//\ Piece\ lifted\ info}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12096}12096\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12097}12097\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a39ddf6298a44867b27f8f0672eee5c96}{lifted\_piece}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12098}12098\ \ \ \ \ \textcolor{keywordtype}{char}\ notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12099}12099\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12100}12100\ \ \ \ \ offset\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12101}12101\ \ \ \ \ \ \ \ \ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12102}12102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}piece\_lifted\(\backslash\)"{}:\{\(\backslash\)"{}lifted\(\backslash\)"{}:true,\(\backslash\)"{}row\(\backslash\)"{}:\%d,\(\backslash\)"{}col\(\backslash\)"{}:\%d,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12103}12103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}piece\(\backslash\)"{}:\(\backslash\)"{}\%c\(\backslash\)"{},\(\backslash\)"{}notation\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{}\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12104}12104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ piece\_char,\ notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12105}12105\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12106}12106\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12107}12107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}piece\_lifted\(\backslash\)"{}:\{\(\backslash\)"{}lifted\(\backslash\)"{}:false,\(\backslash\)"{}row\(\backslash\)"{}:0,\(\backslash\)"{}col\(\backslash\)"{}:"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12108}12108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}0,\(\backslash\)"{}piece\(\backslash\)"{}:\(\backslash\)"{}\ \(\backslash\)"{},\(\backslash\)"{}notation\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12109}12109\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12110}12110\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12111}12111\ \ \ \textcolor{comment}{/*\ Rošáda\ na\ 2\ tahy:\ web\ musí\ vědět,\ že\ má\ čekat\ na\ tah\ věže\ (deska\ je\ mezistav).\ */}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12112}12112\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.in\_progress)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12113}12113\ \ \ \ \ \textcolor{keywordtype}{char}\ cf[4]\ =\ \{0\},\ ct[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12114}12114\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12115}12115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_from\_col,\ cf);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12116}12116\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12117}12117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a78f8e370f447d9c7ebea62679a5ad0c5}{castling\_state}}.rook\_to\_col,\ ct);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12118}12118\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12119}12119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}castling\_in\_progress\(\backslash\)"{}:true,\(\backslash\)"{}castling\_from\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12120}12120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}castling\_to\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{}"{}},\ cf,\ ct);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12121}12121\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12122}12122\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12123}12123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}castling\_in\_progress\(\backslash\)"{}:false"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12124}12124\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12125}12125\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12126}12126\ \ \ \textcolor{comment}{//\ Game\ end\ information\ -\/\ použít\ current\_endgame\_reason\ pro\ přesné}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12127}12127\ \ \ \textcolor{comment}{//\ rozlišení}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12128}12128\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12129}12129\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *end\_reason\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12130}12130\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\ =\ \textcolor{stringliteral}{"{}None"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12131}12131\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *loser\ =\ \textcolor{stringliteral}{"{}None"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12132}12132\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12133}12133\ \ \ \ \ \textcolor{comment}{//\ Nejprve\ určit\ vítěze}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12134}12134\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12135}12135\ \ \ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12136}12136\ \ \ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12137}12137\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12138}12138\ \ \ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12139}12139\ \ \ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12140}12140\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12141}12141\ \ \ \ \ \ \ winner\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12142}12142\ \ \ \ \ \ \ loser\ =\ \textcolor{stringliteral}{"{}Draw"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12143}12143\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12144}12144\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12145}12145\ \ \ \ \ \textcolor{comment}{//\ Pak\ určit\ důvod\ podle\ current\_endgame\_reason}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12146}12146\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12147}12147\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa52cd39edd88b14727c7fad1cef6ee7d2}{ENDGAME\_REASON\_CHECKMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12148}12148\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12149}12149\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12150}12150\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa9103a2521e362b42cd1b9a8505075242}{ENDGAME\_REASON\_CHECKMATE\_EN\_PASSANT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12151}12151\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (En\ Passant)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12152}12152\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12153}12153\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa2b9fe119a75eb59424c83b9120108ac9}{ENDGAME\_REASON\_CHECKMATE\_CASTLING}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12154}12154\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Castling)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12155}12155\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12156}12156\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa82859e0109b9e57299d8f20b6abf0801}{ENDGAME\_REASON\_CHECKMATE\_PROMOTION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12157}12157\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Promotion)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12158}12158\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12159}12159\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caabde34381022074969ecde98b6f33583c}{ENDGAME\_REASON\_CHECKMATE\_DISCOVERED}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12160}12160\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Checkmate\ (Discovered\ Check)"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12161}12161\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12162}12162\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa6572be1bd9ec4bf05582b9506e79f869}{ENDGAME\_REASON\_RESIGNATION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12163}12163\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Resignation"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12164}12164\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12165}12165\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12166}12166\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Timeout"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12167}12167\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12168}12168\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa06fe60e50aa01b44d380419d81f1db15}{ENDGAME\_REASON\_STALEMATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12169}12169\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Stalemate"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12170}12170\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12171}12171\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa5808c364da6d0b918d480194b6b052de}{ENDGAME\_REASON\_50\_MOVE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12172}12172\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}50-\/move\ rule"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12173}12173\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12174}12174\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caac48674036719b12ebdccbcaef0724ef8}{ENDGAME\_REASON\_REPETITION}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12175}12175\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Threefold\ repetition"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12176}12176\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12177}12177\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caa07cc538fbe0da7f3c53e2a65dc4cb764}{ENDGAME\_REASON\_INSUFFICIENT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12178}12178\ \ \ \ \ \ \ end\_reason\ =\ \textcolor{stringliteral}{"{}Insufficient\ material"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12179}12179\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12180}12180\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12181}12181\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12182}12182\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12183}12183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}game\_end\(\backslash\)"{}:\{\(\backslash\)"{}ended\(\backslash\)"{}:true,\(\backslash\)"{}reason\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12184}12184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}winner\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}loser\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{}\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12185}12185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ end\_reason,\ winner,\ loser);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12186}12186\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12187}12187\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12188}12188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}game\_end\(\backslash\)"{}:\{\(\backslash\)"{}ended\(\backslash\)"{}:false,\(\backslash\)"{}reason\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12189}12189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}winner\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{},\(\backslash\)"{}loser\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12190}12190\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12191}12191\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12192}12192\ \ \ \textcolor{comment}{//\ Error\ recovery\ state\ pro\ vizuální\ indikaci\ na\ webu}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12193}12193\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12194}12194\ \ \ \ \ \textcolor{keywordtype}{char}\ invalid\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12195}12195\ \ \ \ \ \textcolor{keywordtype}{char}\ original\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12196}12196\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12197}12197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12198}12198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ invalid\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12199}12199\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12200}12200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12201}12201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12202}12202\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12203}12203\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12204}12204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}error\_state\(\backslash\)"{}:\{\(\backslash\)"{}active\(\backslash\)"{}:true,"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12205}12205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}invalid\_pos\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12206}12206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}original\_pos\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12207}12207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}error\_count\(\backslash\)"{}:\%d\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12208}12208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ invalid\_notation,\ original\_notation,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12209}12209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.error\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12210}12210\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12211}12211\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12212}12212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}error\_state\(\backslash\)"{}:\{\(\backslash\)"{}active\(\backslash\)"{}:false\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12213}12213\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12214}12214\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12215}12215\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12216}12216\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12217}12217\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12218}12218\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12219}12219\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12220}12220\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12221}12221\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12222}12222\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12223}12223\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12224}\mbox{\hyperlink{game__task_8c_a5d08ec12c99532e3819abb072385a921}{12224}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a5d08ec12c99532e3819abb072385a921}{game\_get\_history\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12225}12225\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12226}12226\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12227}12227\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12228}12228\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12229}12229\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ move\ history}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12230}12230\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12231}12231\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12232}12232\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12233}12233\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12234}12234\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12235}12235\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12236}12236\ \ \ \textcolor{comment}{//\ Build\ JSON\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12237}12237\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12238}12238\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}moves\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12239}12239\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12240}12240\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12241}12241\ \ \ \ \ \textcolor{keywordtype}{char}\ from\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12242}12242\ \ \ \ \ \textcolor{keywordtype}{char}\ to\_notation[4]\ =\ \{0\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12243}12243\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].from\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12244}12244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].from\_col,\ from\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12245}12245\ \ \ \ \ \mbox{\hyperlink{game__task_8c_ae79fef0478151bf7d3256446807a2bf7}{convert\_coords\_to\_notation}}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].to\_row,\ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].to\_col,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12246}12246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_notation);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12247}12247\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].piece);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12248}12248\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12249}12249\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12250}12250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}from\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}to\(\backslash\)"{}:\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}piece\(\backslash\)"{}:\(\backslash\)"{}\%c\(\backslash\)"{},"{}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12251}12251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}timestamp\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{}\}"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12252}12252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_notation,\ to\_notation,\ piece\_char,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12253}12253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_af35759f7837c69c445a70f697226b584}{move\_history}}[i].timestamp);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12254}12254\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12255}12255\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_a2342129729fb9edaa9cf56931d99c00e}{history\_index}}\ -\/\ 1\ \&\&\ i\ <\ \mbox{\hyperlink{game__task_8c_a28d6040fd0cdaaa59aef59c0a4529ce6}{MAX\_MOVES\_HISTORY}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12256}12256\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12257}12257\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12258}12258\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12259}12259\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12260}12260\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}]\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12261}12261\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12262}12262\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12263}12263\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12264}12264\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12265}12265\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12266}12266\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12267}12267\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12268}12268\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12269}\mbox{\hyperlink{game__task_8c_aa442a40b76d56106f726f76bc210b84e}{12269}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_aa442a40b76d56106f726f76bc210b84e}{game\_get\_captured\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12270}12270\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12271}12271\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12272}12272\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12273}12273\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12274}12274\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access\ to\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12275}12275\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12276}12276\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12277}12277\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12278}12278\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12279}12279\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12280}12280\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12281}12281\ \ \ \textcolor{comment}{//\ Build\ JSON\ string}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12282}12282\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12283}12283\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}white\_captured\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12284}12284\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12285}12285\ \ \ \textcolor{comment}{//\ Add\ white\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12286}12286\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12287}12287\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a5659a83d5bfbbf6f1dde862e173b7f85}{white\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12288}12288\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\%c\(\backslash\)"{}"{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12289}12289\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_a0cfc5f6377b9053f8ba0acdcbb649b89}{white\_captured\_count}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12290}12290\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12291}12291\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12292}12292\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12293}12293\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12294}12294\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}],\(\backslash\)"{}black\_captured\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12295}12295\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12296}12296\ \ \ \textcolor{comment}{//\ Add\ black\ captured\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12297}12297\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12298}12298\ \ \ \ \ \textcolor{keywordtype}{char}\ piece\_char\ =\ \mbox{\hyperlink{game__task_8c_a18410c1d6d949a27fc7b6440dcf2dc72}{piece\_to\_char}}(\mbox{\hyperlink{game__task_8c_a8fa6f675bba152e024abc896c6fe5502}{black\_captured\_pieces}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12299}12299\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\%c\(\backslash\)"{}"{}},\ piece\_char);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12300}12300\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_a2420950523896e65e6f8119cf831cbbc}{black\_captured\_count}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12301}12301\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12302}12302\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12303}12303\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12304}12304\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12305}12305\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}]\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12306}12306\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12307}12307\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12308}12308\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12309}12309\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12310}12310\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12311}12311\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12312}12312\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12313}12313\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12320}\mbox{\hyperlink{game__task_8c_a8aacf784d572f6de13c441c564d8037e}{12320}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a8aacf784d572f6de13c441c564d8037e}{game\_get\_advantage\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12321}12321\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12322}12322\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12323}12323\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12324}12324\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12325}12325\ \ \ \textcolor{comment}{//\ Thread-\/safe\ access}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12326}12326\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12327}12327\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}},\ pdMS\_TO\_TICKS(1000))\ !=\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12328}12328\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_TIMEOUT;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12329}12329\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12330}12330\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12331}12331\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12332}12332\ \ \ \textcolor{comment}{//\ Build\ JSON:\ \{"{}history"{}:[0,1,2,-\/1,0,...],\ "{}count"{}:42,\ "{}white\_checks"{}:5,}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12333}12333\ \ \ \textcolor{comment}{//\ "{}black\_checks"{}:3,\ ...\}}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12334}12334\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12335}12335\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}history\(\backslash\)"{}:["{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12336}12336\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12337}12337\ \ \ \textcolor{comment}{//\ Add\ advantage\ values}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12338}12338\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}};\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12339}12339\ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12340}12340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a919011f371063105bc6e73a40625e0ed}{material\_advantage\_history}}[i]);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12341}12341\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}}\ -\/\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12342}12342\ \ \ \ \ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{},"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12343}12343\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12344}12344\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12345}12345\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12346}12346\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}],\(\backslash\)"{}count\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12347}12347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afb3b2e18e26654ce6ceb6b8ff455ad69}{advantage\_history\_count}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12348}12348\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12349}12349\ \ \ \textcolor{comment}{//\ Přidat\ další\ statistiky}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12350}12350\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12351}12351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}white\_checks\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\(\backslash\)"{}black\_checks\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12352}12352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_afdd74432e6827c9e6b4ede5e8a85568f}{white\_checks}},\ \mbox{\hyperlink{game__task_8c_a1794518da5b69585365914ea4de9df8c}{black\_checks}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12353}12353\ \ \ offset\ +=}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12354}12354\ \ \ \ \ \ \ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12355}12355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}white\_castles\(\backslash\)"{}:\%"{}}\ PRIu32\ \textcolor{stringliteral}{"{},\(\backslash\)"{}black\_castles\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12356}12356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_ac467517c9f77dd562bc355b03452a599}{white\_castles}},\ \mbox{\hyperlink{game__task_8c_a1327325ac2c835cb293b62d8a14bc30e}{black\_castles}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12357}12357\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12358}12358\ \ \ \textcolor{comment}{//\ Průměrný\ čas\ na\ tah}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12359}12359\ \ \ uint32\_t\ current\_time\ =\ esp\_timer\_get\_time()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12360}12360\ \ \ uint32\_t\ game\_duration\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12361}12361\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}}\ >\ 0)\ ?\ (current\_time\ -\/\ \mbox{\hyperlink{game__task_8c_ad42240bf8319b29277fbf734cb427aa5}{game\_start\_time}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12362}12362\ \ \ uint32\_t\ avg\_time\_per\_move\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12363}12363\ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}}\ >\ 0)\ ?\ (game\_duration\ /\ \mbox{\hyperlink{game__task_8c_a154fb9029ef76390cf7a42e2672c397b}{move\_count}})\ :\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12364}12364\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12365}12365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}game\_duration\_ms\(\backslash\)"{}:\%"{}}\ PRIu32}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12366}12366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\(\backslash\)"{}avg\_time\_per\_move\_ms\(\backslash\)"{}:\%"{}}\ PRIu32,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12367}12367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ game\_duration,\ avg\_time\_per\_move);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12368}12368\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12369}12369\ \ \ offset\ +=\ snprintf(buffer\ +\ offset,\ size\ -\/\ offset,\ \textcolor{stringliteral}{"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12370}12370\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12371}12371\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}}\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12372}12372\ \ \ \ \ xSemaphoreGive(\mbox{\hyperlink{freertos__chess_8c_af5298ceb88597b4b25328ac7e1af7ff0}{game\_mutex}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12373}12373\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12374}12374\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12375}12375\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12376}12376\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12377}12377\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12378}12378\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12379}12379\ \textcolor{comment}{//\ TIMER\ SYSTEM\ INTEGRATION\ IMPLEMENTATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12380}12380\ \textcolor{comment}{//\ ============================================================================}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12381}12381\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12382}\mbox{\hyperlink{game__task_8c_a4373558ca8d873f8a649ab8436720807}{12382}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a4373558ca8d873f8a649ab8436720807}{game\_get\_timer\_json}}(\textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12383}12383\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ size\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12384}12384\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ buffer\ parameters"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12385}12385\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12386}12386\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12387}12387\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12388}12388\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a902602a46b245d091fd3d474ecde0e82}{timer\_get\_json}}(buffer,\ size);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12389}12389\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12390}12390\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12391}\mbox{\hyperlink{game__task_8c_a3784bb9de91bf60f6bff17c25c220c37}{12391}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a3784bb9de91bf60f6bff17c25c220c37}{game\_set\_time\_control}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structtime__control__config__t}{time\_control\_config\_t}}\ *config)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12392}12392\ \ \ \textcolor{keywordflow}{if}\ (config\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12393}12393\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ config\ parameter"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12394}12394\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12395}12395\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12396}12396\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12397}12397\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a158cdf2baa4bc74c696f82e8c610737d}{timer\_set\_time\_control}}(config);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12398}12398\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12399}12399\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Time\ control\ set:\ \%s"{}},\ config-\/>\mbox{\hyperlink{structtime__control__config__t_ac5f05a43dfc9af7383b21d26235c8425}{name}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12400}12400\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12401}12401\ \ \ \ \ \textcolor{comment}{//\ Pokud\ je\ hra\ aktivní,\ spustit\ timer\ pro\ aktuálního\ hráče}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12402}12402\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ ==\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da073e32e8ef26903af9aab57f672e893c}{GAME\_STATE\_ACTIVE}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12403}12403\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ is\ active,\ starting\ timer\ for\ current\ player"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12404}12404\ \ \ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a23265b63c17ea7990a7362a4d497d6d9}{timer\_start\_move}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12405}12405\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12406}12406\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12407}12407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Game\ state\ is\ \%d\ (not\ active),\ timer\ will\ start\ on\ first\ move"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12408}12408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12409}12409\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12410}12410\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12411}12411\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12412}12412\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12413}12413\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12414}12414\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12415}\mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{12415}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a76220c211d4e21aa36ac90a00761f698}{game\_start\_timer\_move}}(\textcolor{keywordtype}{bool}\ is\_white\_turn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12416}12416\ \ \ ESP\_LOGI(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12417}12417\ \ \ \ \ \ \ \mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12418}12418\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}🎮\ game\_start\_timer\_move\ called:\ is\_white\_turn=\%s,\ current\_player=\%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12419}12419\ \ \ \ \ \ \ is\_white\_turn\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12420}12420\ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ ?\ \textcolor{stringliteral}{"{}WHITE"{}}\ :\ \textcolor{stringliteral}{"{}BLACK"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12421}12421\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a23265b63c17ea7990a7362a4d497d6d9}{timer\_start\_move}}(is\_white\_turn);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12422}12422\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12423}12423\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}✅\ Timer\ started\ successfully\ for\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12424}12424\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_turn\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12425}12425\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12426}12426\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}❌\ Failed\ to\ start\ timer\ for\ \%s:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12427}12427\ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_white\_turn\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}},\ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12428}12428\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12429}12429\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12430}12430\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12431}12431\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12432}12432\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12433}\mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{12433}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a95937d38b6f9490371d95bd51ec8460c}{game\_end\_timer\_move}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12434}12434\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a89c7235662a4eeb08b1d5e8b77c58492}{timer\_end\_move}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12435}12435\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12436}12436\ \ \ \ \ ESP\_LOGD(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ ended\ for\ move"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12437}12437\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12438}12438\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12439}12439\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12440}12440\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12441}12441\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12442}\mbox{\hyperlink{game__task_8c_a25364833eb80653b4d30414376f3fe35}{12442}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a25364833eb80653b4d30414376f3fe35}{game\_pause\_timer}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12443}12443\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12444}12444\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12445}12445\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ paused"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12446}12446\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12447}12447\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12448}12448\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12449}12449\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12450}12450\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12451}\mbox{\hyperlink{game__task_8c_aa1855cbe07e70ad38d0fbd163e7e9746}{12451}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_aa1855cbe07e70ad38d0fbd163e7e9746}{game\_resume\_timer}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12452}12452\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a48d538badd51ca6eca88b2f54ae3f7fe}{timer\_resume}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12453}12453\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12454}12454\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ resumed"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12455}12455\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12456}12456\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12457}12457\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12458}12458\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12459}12459\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12460}\mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{12460}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{game\_reset\_timer}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12461}12461\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_ac52afa2de7a6af69f2f67d86af351a05}{timer\_reset}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12462}12462\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12463}12463\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ reset"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12464}12464\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12465}12465\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12466}12466\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12467}12467\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12468}12468\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12469}\mbox{\hyperlink{game__task_8c_aac9b313d5314a9f9c948b466052c1e06}{12469}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_aac9b313d5314a9f9c948b466052c1e06}{game\_check\_timer\_timeout}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_aaa24fcf316f295f7a17bf2ff5ed8dd5e}{timer\_check\_timeout}}();\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12470}12470\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12471}\mbox{\hyperlink{game__task_8c_a58b489e87078e33ccf75b35d892bb4fe}{12471}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a58b489e87078e33ccf75b35d892bb4fe}{game\_get\_remaining\_time}}(\textcolor{keywordtype}{bool}\ is\_white\_turn)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12472}12472\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a3129dee6f4627aead1732185abca4395}{timer\_get\_remaining\_time}}(is\_white\_turn);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12473}12473\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12474}12474\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12475}\mbox{\hyperlink{game__task_8c_af09ae67f3a64e8d2865bac5eb0d7e3ca}{12475}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_af09ae67f3a64e8d2865bac5eb0d7e3ca}{game\_get\_timer\_state}}(\mbox{\hyperlink{structchess__timer__t}{chess\_timer\_t}}\ *timer\_data)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12476}12476\ \ \ \textcolor{keywordflow}{if}\ (timer\_data\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12477}12477\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ timer\_data\ parameter"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12478}12478\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12479}12479\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12480}12480\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12481}12481\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a10198b60b509490f91eee1685ba0d980}{timer\_get\_state}}(timer\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12482}12482\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12483}12483\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12484}\mbox{\hyperlink{game__task_8c_a917f1907b236e1476e75bb033e2a3165}{12484}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a917f1907b236e1476e75bb033e2a3165}{game\_init\_timer\_system}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12485}12485\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Initializing\ timer\ system\ in\ game\ task..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12486}12486\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12487}12487\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a8ad517573ace8a78289a8305b9acb3ea}{timer\_system\_init}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12488}12488\ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12489}12489\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Timer\ system\ initialized\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12490}12490\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12491}12491\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ initialize\ timer\ system:\ \%s"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12492}12492\ \ \ \ \ \ \ \ \ \ \ \ \ \ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12493}12493\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12494}12494\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12495}12495\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12496}12496\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12497}12497\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12498}\mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{12498}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a7c1b38b6a6342df233fdcafe702b5a0f}{game\_process\_timer\_command}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structchess__move__command__t}{chess\_move\_command\_t}}\ *cmd)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12499}12499\ \ \ \textcolor{keywordflow}{if}\ (cmd\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12500}12500\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ command\ parameter"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12501}12501\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12502}12502\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12503}12503\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12504}12504\ \ \ esp\_err\_t\ ret\ =\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12505}12505\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12506}12506\ \ \ \textcolor{keywordflow}{switch}\ (cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12507}12507\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a0ba09395c8b55913ce75adb28ac19003}{GAME\_CMD\_SET\_TIME\_CONTROL}}:\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12508}12508\ \ \ \ \ \mbox{\hyperlink{structtime__control__config__t}{time\_control\_config\_t}}\ config;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12509}12509\ \ \ \ \ \mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97}{time\_control\_type\_t}}\ type\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12510}12510\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97}{time\_control\_type\_t}})cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a2e078f65d1fab8a9ebd51547cd733fd9}{timer\_data}}.\mbox{\hyperlink{structchess__move__command__t_ae05888f64383039d1414ffa36ae22aa9}{timer\_config}}.\mbox{\hyperlink{structchess__move__command__t_a19b5d713be6ea325b1121180f0382263}{time\_control\_type}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12511}12511\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12512}12512\ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97ad913e6fe488ef15d0d74676c2f09cef0}{TIME\_CONTROL\_CUSTOM}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12513}12513\ \ \ \ \ \ \ \textcolor{comment}{//\ Vlastní\ časová\ kontrola}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12514}12514\ \ \ \ \ \ \ ret\ =\ \mbox{\hyperlink{timer__system_8h_a11ab1bc968801095ba83fad279c4d282}{timer\_set\_custom\_time\_control}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12515}12515\ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a2e078f65d1fab8a9ebd51547cd733fd9}{timer\_data}}.\mbox{\hyperlink{structchess__move__command__t_ae05888f64383039d1414ffa36ae22aa9}{timer\_config}}.\mbox{\hyperlink{structchess__move__command__t_ab1469d3613ac521e6521da4c7fabad75}{custom\_minutes}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12516}12516\ \ \ \ \ \ \ \ \ \ \ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a2e078f65d1fab8a9ebd51547cd733fd9}{timer\_data}}.\mbox{\hyperlink{structchess__move__command__t_ae05888f64383039d1414ffa36ae22aa9}{timer\_config}}.\mbox{\hyperlink{structchess__move__command__t_aa66efcd3b24e2c130ede000aca79466d}{custom\_increment}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12517}12517\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12518}12518\ \ \ \ \ \ \ \textcolor{comment}{//\ Předdefinovaná\ časová\ kontrola}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12519}12519\ \ \ \ \ \ \ ret\ =\ \mbox{\hyperlink{timer__system_8h_acc36d1000e481c6d6062135a9f115d40}{timer\_get\_config\_by\_type}}(type,\ \&config);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12520}12520\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12521}12521\ \ \ \ \ \ \ \ \ ret\ =\ \mbox{\hyperlink{timer__system_8h_a158cdf2baa4bc74c696f82e8c610737d}{timer\_set\_time\_control}}(\&config);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12522}12522\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12523}12523\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12524}12524\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12525}12525\ \ \ \ \ \textcolor{keywordflow}{if}\ (ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12526}12526\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Time\ control\ command\ processed\ successfully"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12527}12527\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12528}12528\ \ \ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ process\ time\ control\ command"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12529}12529\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12530}12530\ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12531}12531\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12532}12532\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a04714aa90de7f3ace2585fe01cf67659}{GAME\_CMD\_PAUSE\_TIMER}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12533}12533\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_a25364833eb80653b4d30414376f3fe35}{game\_pause\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12534}12534\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12535}12535\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12536}12536\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a19a04a30f9a17d5a85cd43db2b1e298a}{GAME\_CMD\_RESUME\_TIMER}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12537}12537\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_aa1855cbe07e70ad38d0fbd163e7e9746}{game\_resume\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12538}12538\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12539}12539\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12540}12540\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4aee7fca1d1758d39255d3b023f569313d}{GAME\_CMD\_RESET\_TIMER}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12541}12541\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_a0df29c9e5d4723c41477e530799976b0}{game\_reset\_timer}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12542}12542\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12543}12543\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12544}12544\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4ae152c62fc7eae57cbf8fc14a3ff749e2}{GAME\_CMD\_GET\_TIMER\_STATE}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12545}12545\ \ \ \ \ \textcolor{comment}{//\ Timer\ state\ je\ získáván\ přes\ JSON\ API}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12546}12546\ \ \ \ \ ret\ =\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12547}12547\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12548}12548\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12549}12549\ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{chess__types_8h_ade7744437207164be6ca650b128bd9e4a1963a76107560b25595a00d47b103534}{GAME\_CMD\_TIMER\_TIMEOUT}}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12550}12550\ \ \ \ \ ret\ =\ \mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{game\_handle\_time\_expiration}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12551}12551\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12552}12552\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12553}12553\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12554}12554\ \ \ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Unknown\ timer\ command:\ \%d"{}},\ cmd-\/>\mbox{\hyperlink{structchess__move__command__t_a87f810beeb0b0322d2b99c87d5a7c91c}{type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12555}12555\ \ \ \ \ ret\ =\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12556}12556\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12557}12557\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12558}12558\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12559}12559\ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12560}12560\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12561}12561\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12562}\mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{12562}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{game\_handle\_time\_expiration}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12563}12563\ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}⏰\ Time\ expired!\ Handling\ timeout..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12564}12564\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12565}12565\ \ \ \textcolor{comment}{//\ Získat\ stav\ timeru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12566}12566\ \ \ \mbox{\hyperlink{structchess__timer__t}{chess\_timer\_t}}\ timer\_data;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12567}12567\ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{timer__system_8h_a10198b60b509490f91eee1685ba0d980}{timer\_get\_state}}(\&timer\_data);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12568}12568\ \ \ \textcolor{keywordflow}{if}\ (ret\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12569}12569\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Failed\ to\ get\ timer\ state"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12570}12570\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12571}12571\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12572}12572\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12573}12573\ \ \ \textcolor{comment}{//\ Určit\ vítěze}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12574}12574\ \ \ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1}{player\_t}}\ winner\ =\ timer\_data.\mbox{\hyperlink{structchess__timer__t_a5fbbe88e66de5ea14c6570f5526a39ae}{is\_white\_turn}}\ ?\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ :\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12575}12575\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *winner\_name\ =\ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}White"{}}\ :\ \textcolor{stringliteral}{"{}Black"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12576}12576\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *loser\_name\ =\ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \textcolor{stringliteral}{"{}Black"{}}\ :\ \textcolor{stringliteral}{"{}White"{}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12577}12577\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12578}12578\ \ \ ESP\_LOGW(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🏆\ \%s\ wins\ by\ timeout!\ \%s\ ran\ out\ of\ time."{}},\ winner\_name,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12579}12579\ \ \ \ \ \ \ \ \ \ \ \ loser\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12580}12580\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12581}12581\ \ \ \textcolor{comment}{//\ Ukončit\ hru}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12582}12582\ \ \ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12583}12583\ \ \ \mbox{\hyperlink{game__task_8c_a5e3dc04c60e763a8338084ef2d20d34f}{game\_result}}\ =\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da605d180d86561f11b5015a52dbf6d9f2}{GAME\_STATE\_FINISHED}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12584}12584\ \ \ \mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}}\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12585}12585\ \ \ \ \ \ \ (winner\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10abb26be1a9e2d11602e9c5968e1a63602}{RESULT\_WHITE\_WINS}}\ :\ \mbox{\hyperlink{chess__types_8h_a4d48e82714c3766a44b6ae5378386b10a0f3de4cbc4ca712f898984075e875990}{RESULT\_BLACK\_WINS}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12586}12586\ \ \ \mbox{\hyperlink{game__task_8c_adef591657b12c25bdfa613166b89f076}{current\_endgame\_reason}}\ =\ \mbox{\hyperlink{game__task_8c_ac2c530ea32ce9318e13d562eb6ed63caaf504ae744a15e3a3ec113ff53541df72}{ENDGAME\_REASON\_TIMEOUT}};\ \textcolor{comment}{//\ Označit\ jako\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12587}12587\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12588}12588\ \ \ \textcolor{comment}{//\ Požadavek\ na\ endgame\ report\ (stejný\ fix\ jako\ u\ resignation)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12589}12589\ \ \ \mbox{\hyperlink{game__task_8c_a0edf3b817789dd7433c93714c7c2e0fe}{game\_update\_endgame\_statistics}}(\mbox{\hyperlink{game__task_8c_a4276036f284fa3441e791279608a4ffa}{current\_result\_type}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12590}12590\ \ \ \mbox{\hyperlink{game__task_8c_ada50d1ec543170004c480c898a2718c6}{endgame\_report\_requested}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12591}12591\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12592}12592\ \ \ \textcolor{comment}{//\ UNIFIED\ VICTORY\ ANIMATION}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12593}12593\ \ \ \textcolor{comment}{//\ Timeout\ =\ Winner\ determined\ above}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12594}12594\ \ \ \mbox{\hyperlink{game__task_8c_a1e01fb94ceb1dc74ff280d87a35c1076}{game\_trigger\_victory\_animation}}(winner);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12595}12595\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12596}12596\ \ \ \textcolor{comment}{//\ Zobrazit\ výsledek\ na\ LED\ (použít\ existující\ LED\ funkce)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12597}12597\ \ \ \textcolor{comment}{//\ led\_show\_game\_result(game\_result);\ //\ Funkce\ neexistuje}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12598}12598\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12599}12599\ \ \ \textcolor{comment}{//\ Pozastavit\ timer}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12600}12600\ \ \ \mbox{\hyperlink{timer__system_8h_a66030ee8356a62eed7bbe0717cbd5f22}{timer\_pause}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12601}12601\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12602}12602\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Game\ ended\ due\ to\ timeout.\ Winner:\ \%s"{}},\ winner\_name);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12603}12603\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12604}12604\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12605}12605\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12606}12606\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12607}\mbox{\hyperlink{game__task_8c_aab2504466c50dfa9455e1414810bc073}{12607}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_aab2504466c50dfa9455e1414810bc073}{game\_update\_timer\_display}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12608}12608\ \ \ \textcolor{comment}{//\ Kontrola\ timeout}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12609}12609\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{timer__system_8h_aaa24fcf316f295f7a17bf2ff5ed8dd5e}{timer\_check\_timeout}}())\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12610}12610\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{game__task_8c_a3b6831d8d640dff74119ccdb4f9ff9d2}{game\_handle\_time\_expiration}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12611}12611\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12612}12612\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12613}12613\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12614}12614\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12615}12615\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12616}\mbox{\hyperlink{game__task_8c_a7d42316d2411ec24cc4ccbae29fa3cd9}{12616}}\ uint32\_t\ \mbox{\hyperlink{game__task_8c_a7d42316d2411ec24cc4ccbae29fa3cd9}{game\_get\_available\_time\_controls}}(\mbox{\hyperlink{structtime__control__config__t}{time\_control\_config\_t}}\ *controls,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12617}12617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ max\_count)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12618}12618\ \ \ \textcolor{keywordflow}{if}\ (controls\ ==\ NULL\ ||\ max\_count\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12619}12619\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12620}12620\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12621}12621\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12622}12622\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a737397401ab70e21a2979653e14837e6}{timer\_get\_available\_controls}}(controls,\ max\_count);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12623}12623\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12624}12624\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12625}\mbox{\hyperlink{game__task_8c_a66ce03930668ef5869101bef9e2a8474}{12625}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_a66ce03930668ef5869101bef9e2a8474}{game\_set\_custom\_time\_control}}(uint32\_t\ minutes,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12626}12626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ increment\_seconds)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12627}12627\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a11ab1bc968801095ba83fad279c4d282}{timer\_set\_custom\_time\_control}}(minutes,\ increment\_seconds);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12628}12628\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12629}12629\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12630}\mbox{\hyperlink{game__task_8c_af61ca7975c281efd16bd95628b65bd5e}{12630}}\ esp\_err\_t\ \mbox{\hyperlink{game__task_8c_af61ca7975c281efd16bd95628b65bd5e}{game\_get\_timer\_stats}}(uint32\_t\ *total\_moves,\ uint32\_t\ *avg\_move\_time)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12631}12631\ \ \ \textcolor{keywordflow}{if}\ (total\_moves\ ==\ NULL\ ||\ avg\_move\_time\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12632}12632\ \ \ \ \ ESP\_LOGE(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}Invalid\ parameters"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12633}12633\ \ \ \ \ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12634}12634\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12635}12635\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12636}12636\ \ \ *total\_moves\ =\ \mbox{\hyperlink{timer__system_8h_a1e23fdb509bdce625a0de3e5ce093fba}{timer\_get\_total\_moves}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12637}12637\ \ \ *avg\_move\_time\ =\ \mbox{\hyperlink{timer__system_8h_a918dfb50c8da934336dc81cf36c28a08}{timer\_get\_average\_move\_time}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12638}12638\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12639}12639\ \ \ \textcolor{keywordflow}{return}\ ESP\_OK;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12640}12640\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12641}12641\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12642}\mbox{\hyperlink{game__task_8c_a2f01e5a8d282157e3cd8bd5a03b9c8b5}{12642}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{game__task_8c_a2f01e5a8d282157e3cd8bd5a03b9c8b5}{game\_is\_timer\_active}}(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_a0812f137aa77d3f66c950c1b98505e20}{timer\_is\_active}}();\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12643}12643\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12644}\mbox{\hyperlink{game__task_8c_a7fb22aa3cdacc593dccf7d95db908750}{12644}}\ \mbox{\hyperlink{timer__system_8h_a5f46eb643558022bf40c897c5d752f97}{time\_control\_type\_t}}\ \mbox{\hyperlink{game__task_8c_a7fb22aa3cdacc593dccf7d95db908750}{game\_get\_current\_time\_control\_type}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12645}12645\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{timer__system_8h_af9ad41921ea1477b929f7dd703b71adc}{timer\_get\_current\_type}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12646}12646\ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12647}12647\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12652}\mbox{\hyperlink{game__task_8c_a8b7aa3018c0775246c6fe867f3ae6af1}{12652}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{game__task_8c_a8b7aa3018c0775246c6fe867f3ae6af1}{game\_refresh\_leds}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12653}12653\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}🔄\ Refreshing\ LED\ state\ based\ on\ game\ status..."{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12654}12654\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12655}12655\ \ \ \textcolor{comment}{//\ If\ game\ is\ not\ active,\ just\ show\ the\ board\ pattern}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12656}12656\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{game__task_8c_ab2f53c552730de70a774cd254de77ff1}{game\_active}}\ \&\&\ \mbox{\hyperlink{game__task_8c_a6b5f091d5551e8348e4b43edde98e03f}{current\_game\_state}}\ !=\ \mbox{\hyperlink{chess__types_8h_a4edce1ca040716922b6e4a79be4e414da755790e6ec07d2f80a27fab71e9c5735}{GAME\_STATE\_PROMOTION}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12657}12657\ \ \ \ \ \textcolor{comment}{//\ If\ we\ are\ in\ "{}setup"{}\ or\ "{}idle"{}\ mode}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12658}12658\ \ \ \ \ \mbox{\hyperlink{led__task_8h_a13da231e8e3dc956e4c3415a89409670}{led\_show\_chess\_board}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12659}12659\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12660}12660\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12661}12661\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12662}12662\ \ \ \textcolor{comment}{//\ Clear\ board\ first\ (to\ remove\ HA\ colors)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12663}12663\ \ \ \mbox{\hyperlink{led__task_8h_ab245ceabb580934b6117f59343c6d9a2}{led\_clear\_board\_only}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12664}12664\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12665}12665\ \ \ \textcolor{comment}{//\ 1.\ Check\ for\ Error\ Recovery\ State}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12666}12666\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.waiting\_for\_move\_correction)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12667}12667\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ -\/\ Restoring\ ERROR\ state\ LEDs"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12668}12668\ \ \ \ \ \textcolor{comment}{//\ Show\ validation\ error}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12669}12669\ \ \ \ \ \mbox{\hyperlink{game__task_8c_a907213fbd2400f88f96bd2a5bb4ff98d}{game\_show\_invalid\_move\_error\_with\_blink}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12670}12670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.invalid\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12671}12671\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12672}12672\ \ \ \ \ \textcolor{comment}{//\ Also\ highlight\ the\ original\ valid\ position\ (Blue)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12673}12673\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12674}12674\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_row,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12675}12675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a597a9f3b32563fba96f3041533db53da}{error\_recovery\_state}}.original\_valid\_col),}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12676}12676\ \ \ \ \ \ \ \ \ 0,\ 0,\ 255);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12677}12677\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12678}12678\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12679}12679\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12680}12680\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12681}12681\ \ \ \textcolor{comment}{//\ 2.\ Check\ for\ Lifted\ Piece\ State}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12682}12682\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_af81491a006e7a193e8fd657043851221}{piece\_lifted}})\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12683}12683\ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ -\/\ Restoring\ LIFTED\ piece\ state\ LEDs\ at\ \%c\%d"{}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12684}12684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'a'}\ +\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}}\ +\ 1);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12685}12685\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12686}12686\ \ \ \ \ \textcolor{comment}{//\ Highlight\ source\ square\ (Yellow)}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12687}12687\ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12688}12688\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(\mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}}),\ 255,\ 255,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12689}12689\ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12690}12690\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12691}12691\ \ \ \ \ \textcolor{comment}{//\ Show\ valid\ moves\ for\ this\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12692}12692\ \ \ \ \ \mbox{\hyperlink{structmove__suggestion__t}{move\_suggestion\_t}}\ suggestions[64];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12693}12693\ \ \ \ \ uint32\_t\ valid\_moves\ =\ \mbox{\hyperlink{game__task_8c_a7feffd0ac688b65213940c59e6414b5a}{game\_get\_available\_moves}}(}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12694}12694\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{game__task_8c_a879607e096b78cf354a1c67cd43b010a}{lifted\_piece\_row}},\ \mbox{\hyperlink{game__task_8c_ac6b4fa04af83701dd9196051e02d67f2}{lifted\_piece\_col}},\ suggestions,\ 64);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12695}12695\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12696}12696\ \ \ \ \ \textcolor{keywordflow}{if}\ (valid\_moves\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12697}12697\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ i\ =\ 0;\ i\ <\ valid\_moves;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12698}12698\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_row\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a81af2edcc02d5fef8b48fb1c8fe22134}{to\_row}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12699}12699\ \ \ \ \ \ \ \ \ uint8\_t\ dest\_col\ =\ suggestions[i].\mbox{\hyperlink{structmove__suggestion__t_a68a17ae426e3f81008e87b1f92090935}{to\_col}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12700}12700\ \ \ \ \ \ \ \ \ uint8\_t\ led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(dest\_row,\ dest\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12701}12701\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12702}12702\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ destination\ has\ opponent's\ piece}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12703}12703\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ dest\_piece\ =\ \mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[dest\_row][dest\_col];}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12704}12704\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_opponent\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12705}12705\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a153df31a0a287a4198f917f52a56be1b}{PIECE\_BLACK\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12706}12706\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}})\ ||}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12707}12707\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1af8db5eba569f0a6497497bf46037c98e}{PLAYER\_BLACK}}\ \&\&\ dest\_piece\ >=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2af13b4b9f9748aed2bca41c5700956f2d}{PIECE\_WHITE\_PAWN}}\ \&\&}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12708}12708\ \ \ \ \ \ \ \ \ \ \ \ \ \ dest\_piece\ <=\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12709}12709\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12710}12710\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_opponent\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12711}12711\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 255,\ 165,\ 0);\ \textcolor{comment}{//\ Orange\ for\ capture}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12712}12712\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12713}12713\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_ad4b7ef962f86de71ef5f934f2a92544a}{led\_set\_pixel\_safe}}(led\_index,\ 0,\ 255,\ 0);\ \textcolor{comment}{//\ Green\ for\ move}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12714}12714\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12715}12715\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12716}12716\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12717}12717\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12718}12718\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12719}12719\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12720}12720\ \ \ \textcolor{comment}{//\ 3.\ Check\ for\ Check\ state}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12721}12721\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_a737d8907ff7e0ea86e3c46e70f3c3614}{game\_is\_king\_in\_check}}(\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}))\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12722}12722\ \ \ \ \ \textcolor{comment}{//\ Find\ King}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12723}12723\ \ \ \ \ \textcolor{keywordtype}{int}\ king\_row\ =\ -\/1,\ king\_col\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12724}12724\ \ \ \ \ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2}{piece\_t}}\ king\_piece\ =}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12725}12725\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{game__task_8c_a39560fbeaa9a251526561b4f2a86eac1}{current\_player}}\ ==\ \mbox{\hyperlink{chess__types_8h_a49ff5e2d7800ecd3792c990f4445c3f1a3fc75a745f989dff2b00f6b96f5baa9f}{PLAYER\_WHITE}})\ ?\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a01fd9d2b562a7147017fd02542bd1411}{PIECE\_WHITE\_KING}}\ :\ \mbox{\hyperlink{chess__types_8h_ab9be55f539b97c45fb9f57efded733c2a026ec390a91a6f3858e8819b550c1fe6}{PIECE\_BLACK\_KING}};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12726}12726\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ row\ =\ 0;\ row\ <\ 8;\ row++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12727}12727\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ col\ =\ 0;\ col\ <\ 8;\ col++)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12728}12728\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{game__task_8c_acd8995588803c845a38aeae9849f7be8}{board}}[row][col]\ ==\ king\_piece)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12729}12729\ \ \ \ \ \ \ \ \ \ \ king\_row\ =\ row;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12730}12730\ \ \ \ \ \ \ \ \ \ \ king\_col\ =\ col;}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12731}12731\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12732}12732\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12733}12733\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12734}12734\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12735}12735\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12736}12736\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12737}12737\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12738}12738\ \ \ \ \ \textcolor{keywordflow}{if}\ (king\_row\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12739}12739\ \ \ \ \ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ -\/\ Restoring\ CHECK\ state\ LEDs"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12740}12740\ \ \ \ \ \ \ uint8\_t\ king\_led\_index\ =\ \mbox{\hyperlink{led__mapping_8h_a6f6c321f16b2494986ebfb82fa9bf5df}{chess\_pos\_to\_led\_index}}(king\_row,\ king\_col);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12741}12741\ \ \ \ \ \ \ \mbox{\hyperlink{structled__command__t}{led\_command\_t}}\ check\_cmd\ =\ \{.type\ =\ \mbox{\hyperlink{chess__types_8h_a4b9c35d83af38787d5601d9c2443a66da09320b788323ec0c6c037fbe5405fc94}{LED\_CMD\_ANIM\_CHECK}},}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12742}12742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .led\_index\ =\ king\_led\_index,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12743}12743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .red\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12744}12744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .green\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12745}12745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .blue\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12746}12746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .duration\_ms\ =\ 0,}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12747}12747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .data\ =\ NULL\};}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12748}12748\ \ \ \ \ \ \ \mbox{\hyperlink{led__task_8h_a85578cf6b1c0acb68c6278c9cd1a4f26}{led\_execute\_command\_new}}(\&check\_cmd);}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12749}12749\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12750}12750\ \ \ \}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12751}12751\ }
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12752}12752\ \ \ \textcolor{comment}{//\ 4.\ Default\ Active\ State\ -\/\ Highlight\ movable\ pieces}}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12753}12753\ \ \ ESP\_LOGI(\mbox{\hyperlink{main_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}{TAG}},\ \textcolor{stringliteral}{"{}\ \ -\/\ Restoring\ ACTIVE\ state\ LEDs\ (movable\ pieces)"{}});}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12754}12754\ \ \ \mbox{\hyperlink{game__task_8c_a484415c76302e466ea7b01ecb2edee09}{game\_highlight\_movable\_pieces}}();}
\DoxyCodeLine{\Hypertarget{game__task_8c_source_l12755}12755\ \}}

\end{DoxyCode}
