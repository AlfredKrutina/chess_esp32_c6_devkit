# P≈ôehledov√Ω diagram programu - CZECHMATE v2.4
# Zkop√≠rujte tento text do https://mermaid.live/ pro vizualizaci
#
# Tento diagram poskytuje p≈ôehledn√Ω p≈ôehled architektury programu
# s jasn√Ωm vertik√°ln√≠m flow (Hardware ‚Üí Input ‚Üí Core ‚Üí Output ‚Üí Hardware).
# Vhodn√Ω pro tisk na A4 (na v√Ω≈°ku - portrait).

flowchart TD
    %% ========================================================================
    %% HARDWARE INPUT (naho≈ôe)
    %% ========================================================================
    subgraph HW_IN["üîå HARDWARE INPUT"]
        direction LR
        MATRIX_HW["Reed Switch<br/>8√ó8 Matrix"]
        BUTTON_HW["4 Buttons"]
        UART_HW["UART Serial"]
    end

    %% ========================================================================
    %% INPUT TASKS (vstupn√≠ tasky - sb√≠raj√≠ data z hardware)
    %% ========================================================================
    subgraph INPUT["üì• INPUT TASKS"]
        direction LR
        MATRIX_TASK["Matrix Task<br/>P6 ¬∑ 10ms"]
        BUTTON_TASK["Button Task<br/>P5 ¬∑ 5ms"]
        UART_TASK["UART Task<br/>P3 ¬∑ 1ms"]
        WEB_TASK["Web Server<br/>P3"]
    end

    %% ========================================================================
    %% COMMUNICATION QUEUES (fronty pro komunikaci)
    %% ========================================================================
    subgraph QUEUES["üîÑ QUEUES"]
        direction LR
        GQ["Game Queue<br/>20 msgs"]
        BQ["Button Queue<br/>5 msgs"]
        URQ["Response Queue<br/>20 msgs"]
    end

    %% ========================================================================
    %% CORE SYSTEM (j√°dro - ≈°achov√° logika)
    %% ========================================================================
    subgraph CORE["‚öôÔ∏è CORE SYSTEM"]
        GAME_TASK["gameTask<br/>P4 ¬∑ 100ms<br/>≈†achov√° logika<br/>Validace tah≈Ø"]
    end

    %% ========================================================================
    %% OUTPUT TASKS (v√Ωstupn√≠ tasky - prov√°dƒõj√≠ akce)
    %% ========================================================================
    subgraph OUTPUT["üì§ OUTPUT TASKS"]
        LED_TASK["LED Task<br/>P7 ¬∑ 33ms"]
    end

    %% ========================================================================
    %% HARDWARE OUTPUT (dole)
    %% ========================================================================
    subgraph HW_OUT["üîå HARDWARE OUTPUT"]
        LED_HW["64 LED<br/>WS2812B"]
    end

    %% ========================================================================
    %% MAIN FLOW (shora dol≈Ø - vertik√°ln√≠ flow)
    %% ========================================================================
    HW_IN --> INPUT
    INPUT --> QUEUES
    QUEUES --> CORE
    CORE --> OUTPUT
    OUTPUT --> HW_OUT

    %% ========================================================================
    %% HARDWARE ‚Üí INPUT TASKS (konkr√©tn√≠ p≈ôipojen√≠)
    %% ========================================================================
    MATRIX_HW -->|GPIO Scan| MATRIX_TASK
    BUTTON_HW -->|GPIO Scan| BUTTON_TASK
    UART_HW <-->|Read/Write| UART_TASK

    %% ========================================================================
    %% INPUT TASKS ‚Üí QUEUES (pos√≠l√°n√≠ p≈ô√≠kaz≈Ø)
    %% ========================================================================
    MATRIX_TASK -->|Send| GQ
    BUTTON_TASK -->|Send| BQ
    UART_TASK -->|Send| GQ
    WEB_TASK -->|Send| GQ

    %% ========================================================================
    %% QUEUES ‚Üí CORE (p≈ô√≠jem p≈ô√≠kaz≈Ø)
    %% ========================================================================
    GQ -->|Receive| GAME_TASK
    BQ -->|Receive| GAME_TASK

    %% ========================================================================
    %% CORE ‚Üí OUTPUT (prov√°dƒõn√≠ akc√≠)
    %% ========================================================================
    GAME_TASK -->|Direct Call| LED_TASK
    GAME_TASK -->|Send| URQ

    %% ========================================================================
    %% OUTPUT ‚Üí INPUT (zpƒõtn√° vazba - odpovƒõdi)
    %% ========================================================================
    URQ -->|Receive| UART_TASK

    %% ========================================================================
    %% BIDIRECTIONAL COMMUNICATION (ƒçten√≠ stavu - bez fronty)
    %% ========================================================================
    WEB_TASK -.->|Read JSON| GAME_TASK

    %% ========================================================================
    %% OUTPUT ‚Üí HARDWARE (finaln√≠ v√Ωstup)
    %% ========================================================================
    LED_TASK -->|WS2812B| LED_HW

    %% ========================================================================
    %% STYLING (barvy a vizu√°ln√≠ hierarchie)
    %% ========================================================================
    classDef hardware fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef input fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef queues fill:#f5f5f5,stroke:#757575,stroke-width:1px,stroke-dasharray: 5 5
    classDef core fill:#f3e5f5,stroke:#4a148c,stroke-width:4px
    classDef output fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px

    class MATRIX_HW,BUTTON_HW,UART_HW,LED_HW hardware
    class MATRIX_TASK,BUTTON_TASK,UART_TASK,WEB_TASK input
    class GQ,BQ,URQ queues
    class GAME_TASK core
    class LED_TASK output
